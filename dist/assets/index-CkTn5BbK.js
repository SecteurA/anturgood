(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var jt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function fh(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var s=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(s,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}),s}var Td={exports:{}},Wa={},Dd={exports:{}},he={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var An=Symbol.for("react.element"),ph=Symbol.for("react.portal"),gh=Symbol.for("react.fragment"),yh=Symbol.for("react.strict_mode"),bh=Symbol.for("react.profiler"),vh=Symbol.for("react.provider"),jh=Symbol.for("react.context"),wh=Symbol.for("react.forward_ref"),Nh=Symbol.for("react.suspense"),_h=Symbol.for("react.memo"),kh=Symbol.for("react.lazy"),rc=Symbol.iterator;function Ch(t){return t===null||typeof t!="object"?null:(t=rc&&t[rc]||t["@@iterator"],typeof t=="function"?t:null)}var Ld={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Fd=Object.assign,Ad={};function $s(t,e,s){this.props=t,this.context=e,this.refs=Ad,this.updater=s||Ld}$s.prototype.isReactComponent={};$s.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};$s.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Od(){}Od.prototype=$s.prototype;function eo(t,e,s){this.props=t,this.context=e,this.refs=Ad,this.updater=s||Ld}var to=eo.prototype=new Od;to.constructor=eo;Fd(to,$s.prototype);to.isPureReactComponent=!0;var sc=Array.isArray,$d=Object.prototype.hasOwnProperty,ro={current:null},Rd={key:!0,ref:!0,__self:!0,__source:!0};function Id(t,e,s){var n,a={},i=null,l=null;if(e!=null)for(n in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(i=""+e.key),e)$d.call(e,n)&&!Rd.hasOwnProperty(n)&&(a[n]=e[n]);var o=arguments.length-2;if(o===1)a.children=s;else if(1<o){for(var c=Array(o),d=0;d<o;d++)c[d]=arguments[d+2];a.children=c}if(t&&t.defaultProps)for(n in o=t.defaultProps,o)a[n]===void 0&&(a[n]=o[n]);return{$$typeof:An,type:t,key:i,ref:l,props:a,_owner:ro.current}}function Sh(t,e){return{$$typeof:An,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function so(t){return typeof t=="object"&&t!==null&&t.$$typeof===An}function Eh(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var nc=/\/+/g;function yi(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Eh(""+t.key):e.toString(36)}function oa(t,e,s,n,a){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case An:case ph:l=!0}}if(l)return l=t,a=a(l),t=n===""?"."+yi(l,0):n,sc(a)?(s="",t!=null&&(s=t.replace(nc,"$&/")+"/"),oa(a,e,s,"",function(d){return d})):a!=null&&(so(a)&&(a=Sh(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(nc,"$&/")+"/")+t)),e.push(a)),1;if(l=0,n=n===""?".":n+":",sc(t))for(var o=0;o<t.length;o++){i=t[o];var c=n+yi(i,o);l+=oa(i,e,s,c,a)}else if(c=Ch(t),typeof c=="function")for(t=c.call(t),o=0;!(i=t.next()).done;)i=i.value,c=n+yi(i,o++),l+=oa(i,e,s,c,a);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function qn(t,e,s){if(t==null)return t;var n=[],a=0;return oa(t,n,"","",function(i){return e.call(s,i,a++)}),n}function Ph(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ze={current:null},ca={transition:null},Th={ReactCurrentDispatcher:Ze,ReactCurrentBatchConfig:ca,ReactCurrentOwner:ro};function Md(){throw Error("act(...) is not supported in production builds of React.")}he.Children={map:qn,forEach:function(t,e,s){qn(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return qn(t,function(){e++}),e},toArray:function(t){return qn(t,function(e){return e})||[]},only:function(t){if(!so(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};he.Component=$s;he.Fragment=gh;he.Profiler=bh;he.PureComponent=eo;he.StrictMode=yh;he.Suspense=Nh;he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Th;he.act=Md;he.cloneElement=function(t,e,s){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=Fd({},t.props),a=t.key,i=t.ref,l=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,l=ro.current),e.key!==void 0&&(a=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(c in e)$d.call(e,c)&&!Rd.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&o!==void 0?o[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=s;else if(1<c){o=Array(c);for(var d=0;d<c;d++)o[d]=arguments[d+2];n.children=o}return{$$typeof:An,type:t.type,key:a,ref:i,props:n,_owner:l}};he.createContext=function(t){return t={$$typeof:jh,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:vh,_context:t},t.Consumer=t};he.createElement=Id;he.createFactory=function(t){var e=Id.bind(null,t);return e.type=t,e};he.createRef=function(){return{current:null}};he.forwardRef=function(t){return{$$typeof:wh,render:t}};he.isValidElement=so;he.lazy=function(t){return{$$typeof:kh,_payload:{_status:-1,_result:t},_init:Ph}};he.memo=function(t,e){return{$$typeof:_h,type:t,compare:e===void 0?null:e}};he.startTransition=function(t){var e=ca.transition;ca.transition={};try{t()}finally{ca.transition=e}};he.unstable_act=Md;he.useCallback=function(t,e){return Ze.current.useCallback(t,e)};he.useContext=function(t){return Ze.current.useContext(t)};he.useDebugValue=function(){};he.useDeferredValue=function(t){return Ze.current.useDeferredValue(t)};he.useEffect=function(t,e){return Ze.current.useEffect(t,e)};he.useId=function(){return Ze.current.useId()};he.useImperativeHandle=function(t,e,s){return Ze.current.useImperativeHandle(t,e,s)};he.useInsertionEffect=function(t,e){return Ze.current.useInsertionEffect(t,e)};he.useLayoutEffect=function(t,e){return Ze.current.useLayoutEffect(t,e)};he.useMemo=function(t,e){return Ze.current.useMemo(t,e)};he.useReducer=function(t,e,s){return Ze.current.useReducer(t,e,s)};he.useRef=function(t){return Ze.current.useRef(t)};he.useState=function(t){return Ze.current.useState(t)};he.useSyncExternalStore=function(t,e,s){return Ze.current.useSyncExternalStore(t,e,s)};he.useTransition=function(){return Ze.current.useTransition()};he.version="18.3.1";Dd.exports=he;var N=Dd.exports;const ye=xh(N);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dh=N,Lh=Symbol.for("react.element"),Fh=Symbol.for("react.fragment"),Ah=Object.prototype.hasOwnProperty,Oh=Dh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$h={key:!0,ref:!0,__self:!0,__source:!0};function Ud(t,e,s){var n,a={},i=null,l=null;s!==void 0&&(i=""+s),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(l=e.ref);for(n in e)Ah.call(e,n)&&!$h.hasOwnProperty(n)&&(a[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:Lh,type:t,key:i,ref:l,props:a,_owner:Oh.current}}Wa.Fragment=Fh;Wa.jsx=Ud;Wa.jsxs=Ud;Td.exports=Wa;var r=Td.exports,zd={exports:{}},xt={},qd={exports:{}},Bd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(b,S){var E=b.length;b.push(S);e:for(;0<E;){var w=E-1>>>1,R=b[w];if(0<a(R,S))b[w]=S,b[E]=R,E=w;else break e}}function s(b){return b.length===0?null:b[0]}function n(b){if(b.length===0)return null;var S=b[0],E=b.pop();if(E!==S){b[0]=E;e:for(var w=0,R=b.length,L=R>>>1;w<L;){var U=2*(w+1)-1,se=b[U],P=U+1,B=b[P];if(0>a(se,E))P<R&&0>a(B,se)?(b[w]=B,b[P]=E,w=P):(b[w]=se,b[U]=E,w=U);else if(P<R&&0>a(B,E))b[w]=B,b[P]=E,w=P;else break e}}return S}function a(b,S){var E=b.sortIndex-S.sortIndex;return E!==0?E:b.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();t.unstable_now=function(){return l.now()-o}}var c=[],d=[],u=1,m=null,p=3,x=!1,f=!1,v=!1,j=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(b){for(var S=s(d);S!==null;){if(S.callback===null)n(d);else if(S.startTime<=b)n(d),S.sortIndex=S.expirationTime,e(c,S);else break;S=s(d)}}function C(b){if(v=!1,g(b),!f)if(s(c)!==null)f=!0,I(M);else{var S=s(d);S!==null&&O(C,S.startTime-b)}}function M(b,S){f=!1,v&&(v=!1,h(A),A=-1),x=!0;var E=p;try{for(g(S),m=s(c);m!==null&&(!(m.expirationTime>S)||b&&!K());){var w=m.callback;if(typeof w=="function"){m.callback=null,p=m.priorityLevel;var R=w(m.expirationTime<=S);S=t.unstable_now(),typeof R=="function"?m.callback=R:m===s(c)&&n(c),g(S)}else n(c);m=s(c)}if(m!==null)var L=!0;else{var U=s(d);U!==null&&O(C,U.startTime-S),L=!1}return L}finally{m=null,p=E,x=!1}}var $=!1,T=null,A=-1,D=5,q=-1;function K(){return!(t.unstable_now()-q<D)}function J(){if(T!==null){var b=t.unstable_now();q=b;var S=!0;try{S=T(!0,b)}finally{S?Z():($=!1,T=null)}}else $=!1}var Z;if(typeof y=="function")Z=function(){y(J)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,V=Y.port2;Y.port1.onmessage=J,Z=function(){V.postMessage(null)}}else Z=function(){j(J,0)};function I(b){T=b,$||($=!0,Z())}function O(b,S){A=j(function(){b(t.unstable_now())},S)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(b){b.callback=null},t.unstable_continueExecution=function(){f||x||(f=!0,I(M))},t.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<b?Math.floor(1e3/b):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return s(c)},t.unstable_next=function(b){switch(p){case 1:case 2:case 3:var S=3;break;default:S=p}var E=p;p=S;try{return b()}finally{p=E}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(b,S){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var E=p;p=b;try{return S()}finally{p=E}},t.unstable_scheduleCallback=function(b,S,E){var w=t.unstable_now();switch(typeof E=="object"&&E!==null?(E=E.delay,E=typeof E=="number"&&0<E?w+E:w):E=w,b){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=E+R,b={id:u++,callback:S,priorityLevel:b,startTime:E,expirationTime:R,sortIndex:-1},E>w?(b.sortIndex=E,e(d,b),s(c)===null&&b===s(d)&&(v?(h(A),A=-1):v=!0,O(C,E-w))):(b.sortIndex=R,e(c,b),f||x||(f=!0,I(M))),b},t.unstable_shouldYield=K,t.unstable_wrapCallback=function(b){var S=p;return function(){var E=p;p=S;try{return b.apply(this,arguments)}finally{p=E}}}})(Bd);qd.exports=Bd;var Rh=qd.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ih=N,ht=Rh;function W(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Hd=new Set,pn={};function Xr(t,e){ks(t,e),ks(t+"Capture",e)}function ks(t,e){for(pn[t]=e,t=0;t<e.length;t++)Hd.add(e[t])}var Jt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yi=Object.prototype.hasOwnProperty,Mh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ac={},ic={};function Uh(t){return Yi.call(ic,t)?!0:Yi.call(ac,t)?!1:Mh.test(t)?ic[t]=!0:(ac[t]=!0,!1)}function zh(t,e,s,n){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:s!==null?!s.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function qh(t,e,s,n){if(e===null||typeof e>"u"||zh(t,e,s,n))return!0;if(n)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function et(t,e,s,n,a,i,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=l}var Ve={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ve[t]=new et(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ve[e]=new et(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ve[t]=new et(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ve[t]=new et(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ve[t]=new et(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ve[t]=new et(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ve[t]=new et(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ve[t]=new et(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ve[t]=new et(t,5,!1,t.toLowerCase(),null,!1,!1)});var no=/[\-:]([a-z])/g;function ao(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(no,ao);Ve[e]=new et(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(no,ao);Ve[e]=new et(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(no,ao);Ve[e]=new et(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ve[t]=new et(t,1,!1,t.toLowerCase(),null,!1,!1)});Ve.xlinkHref=new et("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ve[t]=new et(t,1,!1,t.toLowerCase(),null,!0,!0)});function io(t,e,s,n){var a=Ve.hasOwnProperty(e)?Ve[e]:null;(a!==null?a.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qh(e,s,a,n)&&(s=null),n||a===null?Uh(e)&&(s===null?t.removeAttribute(e):t.setAttribute(e,""+s)):a.mustUseProperty?t[a.propertyName]=s===null?a.type===3?!1:"":s:(e=a.attributeName,n=a.attributeNamespace,s===null?t.removeAttribute(e):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,n?t.setAttributeNS(n,e,s):t.setAttribute(e,s))))}var tr=Ih.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Bn=Symbol.for("react.element"),is=Symbol.for("react.portal"),ls=Symbol.for("react.fragment"),lo=Symbol.for("react.strict_mode"),Zi=Symbol.for("react.profiler"),Vd=Symbol.for("react.provider"),Gd=Symbol.for("react.context"),oo=Symbol.for("react.forward_ref"),el=Symbol.for("react.suspense"),tl=Symbol.for("react.suspense_list"),co=Symbol.for("react.memo"),ir=Symbol.for("react.lazy"),Wd=Symbol.for("react.offscreen"),lc=Symbol.iterator;function qs(t){return t===null||typeof t!="object"?null:(t=lc&&t[lc]||t["@@iterator"],typeof t=="function"?t:null)}var Te=Object.assign,bi;function Js(t){if(bi===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);bi=e&&e[1]||""}return`
`+bi+t}var vi=!1;function ji(t,e){if(!t||vi)return"";vi=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var n=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){n=d}t.call(e.prototype)}else{try{throw Error()}catch(d){n=d}t()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=n.stack.split(`
`),l=a.length-1,o=i.length-1;1<=l&&0<=o&&a[l]!==i[o];)o--;for(;1<=l&&0<=o;l--,o--)if(a[l]!==i[o]){if(l!==1||o!==1)do if(l--,o--,0>o||a[l]!==i[o]){var c=`
`+a[l].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=l&&0<=o);break}}}finally{vi=!1,Error.prepareStackTrace=s}return(t=t?t.displayName||t.name:"")?Js(t):""}function Bh(t){switch(t.tag){case 5:return Js(t.type);case 16:return Js("Lazy");case 13:return Js("Suspense");case 19:return Js("SuspenseList");case 0:case 2:case 15:return t=ji(t.type,!1),t;case 11:return t=ji(t.type.render,!1),t;case 1:return t=ji(t.type,!0),t;default:return""}}function rl(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ls:return"Fragment";case is:return"Portal";case Zi:return"Profiler";case lo:return"StrictMode";case el:return"Suspense";case tl:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Gd:return(t.displayName||"Context")+".Consumer";case Vd:return(t._context.displayName||"Context")+".Provider";case oo:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case co:return e=t.displayName||null,e!==null?e:rl(t.type)||"Memo";case ir:e=t._payload,t=t._init;try{return rl(t(e))}catch{}}return null}function Hh(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rl(e);case 8:return e===lo?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function wr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Xd(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Vh(t){var e=Xd(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,i=s.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return a.call(this)},set:function(l){n=""+l,i.call(this,l)}}),Object.defineProperty(t,e,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(l){n=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Hn(t){t._valueTracker||(t._valueTracker=Vh(t))}function Kd(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var s=e.getValue(),n="";return t&&(n=Xd(t)?t.checked?"true":"false":t.value),t=n,t!==s?(e.setValue(t),!0):!1}function va(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function sl(t,e){var s=e.checked;return Te({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??t._wrapperState.initialChecked})}function oc(t,e){var s=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;s=wr(e.value!=null?e.value:s),t._wrapperState={initialChecked:n,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Qd(t,e){e=e.checked,e!=null&&io(t,"checked",e,!1)}function nl(t,e){Qd(t,e);var s=wr(e.value),n=e.type;if(s!=null)n==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+s):t.value!==""+s&&(t.value=""+s);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?al(t,e.type,s):e.hasOwnProperty("defaultValue")&&al(t,e.type,wr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function cc(t,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,s||e===t.value||(t.value=e),t.defaultValue=e}s=t.name,s!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,s!==""&&(t.name=s)}function al(t,e,s){(e!=="number"||va(t.ownerDocument)!==t)&&(s==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+s&&(t.defaultValue=""+s))}var Ys=Array.isArray;function ys(t,e,s,n){if(t=t.options,e){e={};for(var a=0;a<s.length;a++)e["$"+s[a]]=!0;for(s=0;s<t.length;s++)a=e.hasOwnProperty("$"+t[s].value),t[s].selected!==a&&(t[s].selected=a),a&&n&&(t[s].defaultSelected=!0)}else{for(s=""+wr(s),e=null,a=0;a<t.length;a++){if(t[a].value===s){t[a].selected=!0,n&&(t[a].defaultSelected=!0);return}e!==null||t[a].disabled||(e=t[a])}e!==null&&(e.selected=!0)}}function il(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(W(91));return Te({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function dc(t,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(W(92));if(Ys(s)){if(1<s.length)throw Error(W(93));s=s[0]}e=s}e==null&&(e=""),s=e}t._wrapperState={initialValue:wr(s)}}function Jd(t,e){var s=wr(e.value),n=wr(e.defaultValue);s!=null&&(s=""+s,s!==t.value&&(t.value=s),e.defaultValue==null&&t.defaultValue!==s&&(t.defaultValue=s)),n!=null&&(t.defaultValue=""+n)}function uc(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Yd(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ll(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Yd(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Vn,Zd=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,n,a){MSApp.execUnsafeLocalFunction(function(){return t(e,s,n,a)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Vn=Vn||document.createElement("div"),Vn.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Vn.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function gn(t,e){if(e){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=e;return}}t.textContent=e}var sn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Gh=["Webkit","ms","Moz","O"];Object.keys(sn).forEach(function(t){Gh.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),sn[e]=sn[t]})});function eu(t,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||sn.hasOwnProperty(t)&&sn[t]?(""+e).trim():e+"px"}function tu(t,e){t=t.style;for(var s in e)if(e.hasOwnProperty(s)){var n=s.indexOf("--")===0,a=eu(s,e[s],n);s==="float"&&(s="cssFloat"),n?t.setProperty(s,a):t[s]=a}}var Wh=Te({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ol(t,e){if(e){if(Wh[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(W(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(W(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(W(61))}if(e.style!=null&&typeof e.style!="object")throw Error(W(62))}}function cl(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dl=null;function uo(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ul=null,bs=null,vs=null;function mc(t){if(t=Rn(t)){if(typeof ul!="function")throw Error(W(280));var e=t.stateNode;e&&(e=Ya(e),ul(t.stateNode,t.type,e))}}function ru(t){bs?vs?vs.push(t):vs=[t]:bs=t}function su(){if(bs){var t=bs,e=vs;if(vs=bs=null,mc(t),e)for(t=0;t<e.length;t++)mc(e[t])}}function nu(t,e){return t(e)}function au(){}var wi=!1;function iu(t,e,s){if(wi)return t(e,s);wi=!0;try{return nu(t,e,s)}finally{wi=!1,(bs!==null||vs!==null)&&(au(),su())}}function yn(t,e){var s=t.stateNode;if(s===null)return null;var n=Ya(s);if(n===null)return null;s=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(W(231,e,typeof s));return s}var ml=!1;if(Jt)try{var Bs={};Object.defineProperty(Bs,"passive",{get:function(){ml=!0}}),window.addEventListener("test",Bs,Bs),window.removeEventListener("test",Bs,Bs)}catch{ml=!1}function Xh(t,e,s,n,a,i,l,o,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(s,d)}catch(u){this.onError(u)}}var nn=!1,ja=null,wa=!1,hl=null,Kh={onError:function(t){nn=!0,ja=t}};function Qh(t,e,s,n,a,i,l,o,c){nn=!1,ja=null,Xh.apply(Kh,arguments)}function Jh(t,e,s,n,a,i,l,o,c){if(Qh.apply(this,arguments),nn){if(nn){var d=ja;nn=!1,ja=null}else throw Error(W(198));wa||(wa=!0,hl=d)}}function Kr(t){var e=t,s=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(s=e.return),t=e.return;while(t)}return e.tag===3?s:null}function lu(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function hc(t){if(Kr(t)!==t)throw Error(W(188))}function Yh(t){var e=t.alternate;if(!e){if(e=Kr(t),e===null)throw Error(W(188));return e!==t?null:t}for(var s=t,n=e;;){var a=s.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){s=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===s)return hc(a),t;if(i===n)return hc(a),e;i=i.sibling}throw Error(W(188))}if(s.return!==n.return)s=a,n=i;else{for(var l=!1,o=a.child;o;){if(o===s){l=!0,s=a,n=i;break}if(o===n){l=!0,n=a,s=i;break}o=o.sibling}if(!l){for(o=i.child;o;){if(o===s){l=!0,s=i,n=a;break}if(o===n){l=!0,n=i,s=a;break}o=o.sibling}if(!l)throw Error(W(189))}}if(s.alternate!==n)throw Error(W(190))}if(s.tag!==3)throw Error(W(188));return s.stateNode.current===s?t:e}function ou(t){return t=Yh(t),t!==null?cu(t):null}function cu(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=cu(t);if(e!==null)return e;t=t.sibling}return null}var du=ht.unstable_scheduleCallback,xc=ht.unstable_cancelCallback,Zh=ht.unstable_shouldYield,ex=ht.unstable_requestPaint,Fe=ht.unstable_now,tx=ht.unstable_getCurrentPriorityLevel,mo=ht.unstable_ImmediatePriority,uu=ht.unstable_UserBlockingPriority,Na=ht.unstable_NormalPriority,rx=ht.unstable_LowPriority,mu=ht.unstable_IdlePriority,Xa=null,zt=null;function sx(t){if(zt&&typeof zt.onCommitFiberRoot=="function")try{zt.onCommitFiberRoot(Xa,t,void 0,(t.current.flags&128)===128)}catch{}}var Ft=Math.clz32?Math.clz32:ix,nx=Math.log,ax=Math.LN2;function ix(t){return t>>>=0,t===0?32:31-(nx(t)/ax|0)|0}var Gn=64,Wn=4194304;function Zs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function _a(t,e){var s=t.pendingLanes;if(s===0)return 0;var n=0,a=t.suspendedLanes,i=t.pingedLanes,l=s&268435455;if(l!==0){var o=l&~a;o!==0?n=Zs(o):(i&=l,i!==0&&(n=Zs(i)))}else l=s&~a,l!==0?n=Zs(l):i!==0&&(n=Zs(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&a)&&(a=n&-n,i=e&-e,a>=i||a===16&&(i&4194240)!==0))return e;if(n&4&&(n|=s&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)s=31-Ft(e),a=1<<s,n|=t[s],e&=~a;return n}function lx(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ox(t,e){for(var s=t.suspendedLanes,n=t.pingedLanes,a=t.expirationTimes,i=t.pendingLanes;0<i;){var l=31-Ft(i),o=1<<l,c=a[l];c===-1?(!(o&s)||o&n)&&(a[l]=lx(o,e)):c<=e&&(t.expiredLanes|=o),i&=~o}}function xl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function hu(){var t=Gn;return Gn<<=1,!(Gn&4194240)&&(Gn=64),t}function Ni(t){for(var e=[],s=0;31>s;s++)e.push(t);return e}function On(t,e,s){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ft(e),t[e]=s}function cx(t,e){var s=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<s;){var a=31-Ft(s),i=1<<a;e[a]=0,n[a]=-1,t[a]=-1,s&=~i}}function ho(t,e){var s=t.entangledLanes|=e;for(t=t.entanglements;s;){var n=31-Ft(s),a=1<<n;a&e|t[n]&e&&(t[n]|=e),s&=~a}}var pe=0;function xu(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var fu,xo,pu,gu,yu,fl=!1,Xn=[],xr=null,fr=null,pr=null,bn=new Map,vn=new Map,cr=[],dx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fc(t,e){switch(t){case"focusin":case"focusout":xr=null;break;case"dragenter":case"dragleave":fr=null;break;case"mouseover":case"mouseout":pr=null;break;case"pointerover":case"pointerout":bn.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":vn.delete(e.pointerId)}}function Hs(t,e,s,n,a,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:s,eventSystemFlags:n,nativeEvent:i,targetContainers:[a]},e!==null&&(e=Rn(e),e!==null&&xo(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),t)}function ux(t,e,s,n,a){switch(e){case"focusin":return xr=Hs(xr,t,e,s,n,a),!0;case"dragenter":return fr=Hs(fr,t,e,s,n,a),!0;case"mouseover":return pr=Hs(pr,t,e,s,n,a),!0;case"pointerover":var i=a.pointerId;return bn.set(i,Hs(bn.get(i)||null,t,e,s,n,a)),!0;case"gotpointercapture":return i=a.pointerId,vn.set(i,Hs(vn.get(i)||null,t,e,s,n,a)),!0}return!1}function bu(t){var e=$r(t.target);if(e!==null){var s=Kr(e);if(s!==null){if(e=s.tag,e===13){if(e=lu(s),e!==null){t.blockedOn=e,yu(t.priority,function(){pu(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function da(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var s=pl(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);dl=n,s.target.dispatchEvent(n),dl=null}else return e=Rn(s),e!==null&&xo(e),t.blockedOn=s,!1;e.shift()}return!0}function pc(t,e,s){da(t)&&s.delete(e)}function mx(){fl=!1,xr!==null&&da(xr)&&(xr=null),fr!==null&&da(fr)&&(fr=null),pr!==null&&da(pr)&&(pr=null),bn.forEach(pc),vn.forEach(pc)}function Vs(t,e){t.blockedOn===e&&(t.blockedOn=null,fl||(fl=!0,ht.unstable_scheduleCallback(ht.unstable_NormalPriority,mx)))}function jn(t){function e(a){return Vs(a,t)}if(0<Xn.length){Vs(Xn[0],t);for(var s=1;s<Xn.length;s++){var n=Xn[s];n.blockedOn===t&&(n.blockedOn=null)}}for(xr!==null&&Vs(xr,t),fr!==null&&Vs(fr,t),pr!==null&&Vs(pr,t),bn.forEach(e),vn.forEach(e),s=0;s<cr.length;s++)n=cr[s],n.blockedOn===t&&(n.blockedOn=null);for(;0<cr.length&&(s=cr[0],s.blockedOn===null);)bu(s),s.blockedOn===null&&cr.shift()}var js=tr.ReactCurrentBatchConfig,ka=!0;function hx(t,e,s,n){var a=pe,i=js.transition;js.transition=null;try{pe=1,fo(t,e,s,n)}finally{pe=a,js.transition=i}}function xx(t,e,s,n){var a=pe,i=js.transition;js.transition=null;try{pe=4,fo(t,e,s,n)}finally{pe=a,js.transition=i}}function fo(t,e,s,n){if(ka){var a=pl(t,e,s,n);if(a===null)Fi(t,e,n,Ca,s),fc(t,n);else if(ux(a,t,e,s,n))n.stopPropagation();else if(fc(t,n),e&4&&-1<dx.indexOf(t)){for(;a!==null;){var i=Rn(a);if(i!==null&&fu(i),i=pl(t,e,s,n),i===null&&Fi(t,e,n,Ca,s),i===a)break;a=i}a!==null&&n.stopPropagation()}else Fi(t,e,n,null,s)}}var Ca=null;function pl(t,e,s,n){if(Ca=null,t=uo(n),t=$r(t),t!==null)if(e=Kr(t),e===null)t=null;else if(s=e.tag,s===13){if(t=lu(e),t!==null)return t;t=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ca=t,null}function vu(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tx()){case mo:return 1;case uu:return 4;case Na:case rx:return 16;case mu:return 536870912;default:return 16}default:return 16}}var mr=null,po=null,ua=null;function ju(){if(ua)return ua;var t,e=po,s=e.length,n,a="value"in mr?mr.value:mr.textContent,i=a.length;for(t=0;t<s&&e[t]===a[t];t++);var l=s-t;for(n=1;n<=l&&e[s-n]===a[i-n];n++);return ua=a.slice(t,1<n?1-n:void 0)}function ma(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Kn(){return!0}function gc(){return!1}function ft(t){function e(s,n,a,i,l){this._reactName=s,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=l,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(s=t[o],this[o]=s?s(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Kn:gc,this.isPropagationStopped=gc,this}return Te(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Kn)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Kn)},persist:function(){},isPersistent:Kn}),e}var Rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},go=ft(Rs),$n=Te({},Rs,{view:0,detail:0}),fx=ft($n),_i,ki,Gs,Ka=Te({},$n,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yo,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Gs&&(Gs&&t.type==="mousemove"?(_i=t.screenX-Gs.screenX,ki=t.screenY-Gs.screenY):ki=_i=0,Gs=t),_i)},movementY:function(t){return"movementY"in t?t.movementY:ki}}),yc=ft(Ka),px=Te({},Ka,{dataTransfer:0}),gx=ft(px),yx=Te({},$n,{relatedTarget:0}),Ci=ft(yx),bx=Te({},Rs,{animationName:0,elapsedTime:0,pseudoElement:0}),vx=ft(bx),jx=Te({},Rs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),wx=ft(jx),Nx=Te({},Rs,{data:0}),bc=ft(Nx),_x={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sx(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Cx[t])?!!e[t]:!1}function yo(){return Sx}var Ex=Te({},$n,{key:function(t){if(t.key){var e=_x[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ma(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kx[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yo,charCode:function(t){return t.type==="keypress"?ma(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ma(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Px=ft(Ex),Tx=Te({},Ka,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vc=ft(Tx),Dx=Te({},$n,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yo}),Lx=ft(Dx),Fx=Te({},Rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ax=ft(Fx),Ox=Te({},Ka,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),$x=ft(Ox),Rx=[9,13,27,32],bo=Jt&&"CompositionEvent"in window,an=null;Jt&&"documentMode"in document&&(an=document.documentMode);var Ix=Jt&&"TextEvent"in window&&!an,wu=Jt&&(!bo||an&&8<an&&11>=an),jc=" ",wc=!1;function Nu(t,e){switch(t){case"keyup":return Rx.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _u(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var os=!1;function Mx(t,e){switch(t){case"compositionend":return _u(e);case"keypress":return e.which!==32?null:(wc=!0,jc);case"textInput":return t=e.data,t===jc&&wc?null:t;default:return null}}function Ux(t,e){if(os)return t==="compositionend"||!bo&&Nu(t,e)?(t=ju(),ua=po=mr=null,os=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return wu&&e.locale!=="ko"?null:e.data;default:return null}}var zx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!zx[t.type]:e==="textarea"}function ku(t,e,s,n){ru(n),e=Sa(e,"onChange"),0<e.length&&(s=new go("onChange","change",null,s,n),t.push({event:s,listeners:e}))}var ln=null,wn=null;function qx(t){$u(t,0)}function Qa(t){var e=us(t);if(Kd(e))return t}function Bx(t,e){if(t==="change")return e}var Cu=!1;if(Jt){var Si;if(Jt){var Ei="oninput"in document;if(!Ei){var _c=document.createElement("div");_c.setAttribute("oninput","return;"),Ei=typeof _c.oninput=="function"}Si=Ei}else Si=!1;Cu=Si&&(!document.documentMode||9<document.documentMode)}function kc(){ln&&(ln.detachEvent("onpropertychange",Su),wn=ln=null)}function Su(t){if(t.propertyName==="value"&&Qa(wn)){var e=[];ku(e,wn,t,uo(t)),iu(qx,e)}}function Hx(t,e,s){t==="focusin"?(kc(),ln=e,wn=s,ln.attachEvent("onpropertychange",Su)):t==="focusout"&&kc()}function Vx(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Qa(wn)}function Gx(t,e){if(t==="click")return Qa(e)}function Wx(t,e){if(t==="input"||t==="change")return Qa(e)}function Xx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ot=typeof Object.is=="function"?Object.is:Xx;function Nn(t,e){if(Ot(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var a=s[n];if(!Yi.call(e,a)||!Ot(t[a],e[a]))return!1}return!0}function Cc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sc(t,e){var s=Cc(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=e&&n>=e)return{node:s,offset:e-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Cc(s)}}function Eu(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Eu(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Pu(){for(var t=window,e=va();e instanceof t.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)t=e.contentWindow;else break;e=va(t.document)}return e}function vo(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Kx(t){var e=Pu(),s=t.focusedElem,n=t.selectionRange;if(e!==s&&s&&s.ownerDocument&&Eu(s.ownerDocument.documentElement,s)){if(n!==null&&vo(s)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(t,s.value.length);else if(t=(e=s.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var a=s.textContent.length,i=Math.min(n.start,a);n=n.end===void 0?i:Math.min(n.end,a),!t.extend&&i>n&&(a=n,n=i,i=a),a=Sc(s,i);var l=Sc(s,n);a&&l&&(t.rangeCount!==1||t.anchorNode!==a.node||t.anchorOffset!==a.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(a.node,a.offset),t.removeAllRanges(),i>n?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=s;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)t=e[s],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Qx=Jt&&"documentMode"in document&&11>=document.documentMode,cs=null,gl=null,on=null,yl=!1;function Ec(t,e,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;yl||cs==null||cs!==va(n)||(n=cs,"selectionStart"in n&&vo(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),on&&Nn(on,n)||(on=n,n=Sa(gl,"onSelect"),0<n.length&&(e=new go("onSelect","select",null,e,s),t.push({event:e,listeners:n}),e.target=cs)))}function Qn(t,e){var s={};return s[t.toLowerCase()]=e.toLowerCase(),s["Webkit"+t]="webkit"+e,s["Moz"+t]="moz"+e,s}var ds={animationend:Qn("Animation","AnimationEnd"),animationiteration:Qn("Animation","AnimationIteration"),animationstart:Qn("Animation","AnimationStart"),transitionend:Qn("Transition","TransitionEnd")},Pi={},Tu={};Jt&&(Tu=document.createElement("div").style,"AnimationEvent"in window||(delete ds.animationend.animation,delete ds.animationiteration.animation,delete ds.animationstart.animation),"TransitionEvent"in window||delete ds.transitionend.transition);function Ja(t){if(Pi[t])return Pi[t];if(!ds[t])return t;var e=ds[t],s;for(s in e)if(e.hasOwnProperty(s)&&s in Tu)return Pi[t]=e[s];return t}var Du=Ja("animationend"),Lu=Ja("animationiteration"),Fu=Ja("animationstart"),Au=Ja("transitionend"),Ou=new Map,Pc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(t,e){Ou.set(t,e),Xr(e,[t])}for(var Ti=0;Ti<Pc.length;Ti++){var Di=Pc[Ti],Jx=Di.toLowerCase(),Yx=Di[0].toUpperCase()+Di.slice(1);kr(Jx,"on"+Yx)}kr(Du,"onAnimationEnd");kr(Lu,"onAnimationIteration");kr(Fu,"onAnimationStart");kr("dblclick","onDoubleClick");kr("focusin","onFocus");kr("focusout","onBlur");kr(Au,"onTransitionEnd");ks("onMouseEnter",["mouseout","mouseover"]);ks("onMouseLeave",["mouseout","mouseover"]);ks("onPointerEnter",["pointerout","pointerover"]);ks("onPointerLeave",["pointerout","pointerover"]);Xr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var en="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zx=new Set("cancel close invalid load scroll toggle".split(" ").concat(en));function Tc(t,e,s){var n=t.type||"unknown-event";t.currentTarget=s,Jh(n,e,void 0,t),t.currentTarget=null}function $u(t,e){e=(e&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],a=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var l=n.length-1;0<=l;l--){var o=n[l],c=o.instance,d=o.currentTarget;if(o=o.listener,c!==i&&a.isPropagationStopped())break e;Tc(a,o,d),i=c}else for(l=0;l<n.length;l++){if(o=n[l],c=o.instance,d=o.currentTarget,o=o.listener,c!==i&&a.isPropagationStopped())break e;Tc(a,o,d),i=c}}}if(wa)throw t=hl,wa=!1,hl=null,t}function Ne(t,e){var s=e[Nl];s===void 0&&(s=e[Nl]=new Set);var n=t+"__bubble";s.has(n)||(Ru(e,t,2,!1),s.add(n))}function Li(t,e,s){var n=0;e&&(n|=4),Ru(s,t,n,e)}var Jn="_reactListening"+Math.random().toString(36).slice(2);function _n(t){if(!t[Jn]){t[Jn]=!0,Hd.forEach(function(s){s!=="selectionchange"&&(Zx.has(s)||Li(s,!1,t),Li(s,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Jn]||(e[Jn]=!0,Li("selectionchange",!1,e))}}function Ru(t,e,s,n){switch(vu(e)){case 1:var a=hx;break;case 4:a=xx;break;default:a=fo}s=a.bind(null,e,s,t),a=void 0,!ml||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),n?a!==void 0?t.addEventListener(e,s,{capture:!0,passive:a}):t.addEventListener(e,s,!0):a!==void 0?t.addEventListener(e,s,{passive:a}):t.addEventListener(e,s,!1)}function Fi(t,e,s,n,a){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var l=n.tag;if(l===3||l===4){var o=n.stateNode.containerInfo;if(o===a||o.nodeType===8&&o.parentNode===a)break;if(l===4)for(l=n.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;l=l.return}for(;o!==null;){if(l=$r(o),l===null)return;if(c=l.tag,c===5||c===6){n=i=l;continue e}o=o.parentNode}}n=n.return}iu(function(){var d=i,u=uo(s),m=[];e:{var p=Ou.get(t);if(p!==void 0){var x=go,f=t;switch(t){case"keypress":if(ma(s)===0)break e;case"keydown":case"keyup":x=Px;break;case"focusin":f="focus",x=Ci;break;case"focusout":f="blur",x=Ci;break;case"beforeblur":case"afterblur":x=Ci;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=yc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=gx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=Lx;break;case Du:case Lu:case Fu:x=vx;break;case Au:x=Ax;break;case"scroll":x=fx;break;case"wheel":x=$x;break;case"copy":case"cut":case"paste":x=wx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=vc}var v=(e&4)!==0,j=!v&&t==="scroll",h=v?p!==null?p+"Capture":null:p;v=[];for(var y=d,g;y!==null;){g=y;var C=g.stateNode;if(g.tag===5&&C!==null&&(g=C,h!==null&&(C=yn(y,h),C!=null&&v.push(kn(y,C,g)))),j)break;y=y.return}0<v.length&&(p=new x(p,f,null,s,u),m.push({event:p,listeners:v}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",p&&s!==dl&&(f=s.relatedTarget||s.fromElement)&&($r(f)||f[Yt]))break e;if((x||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,x?(f=s.relatedTarget||s.toElement,x=d,f=f?$r(f):null,f!==null&&(j=Kr(f),f!==j||f.tag!==5&&f.tag!==6)&&(f=null)):(x=null,f=d),x!==f)){if(v=yc,C="onMouseLeave",h="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(v=vc,C="onPointerLeave",h="onPointerEnter",y="pointer"),j=x==null?p:us(x),g=f==null?p:us(f),p=new v(C,y+"leave",x,s,u),p.target=j,p.relatedTarget=g,C=null,$r(u)===d&&(v=new v(h,y+"enter",f,s,u),v.target=g,v.relatedTarget=j,C=v),j=C,x&&f)t:{for(v=x,h=f,y=0,g=v;g;g=Yr(g))y++;for(g=0,C=h;C;C=Yr(C))g++;for(;0<y-g;)v=Yr(v),y--;for(;0<g-y;)h=Yr(h),g--;for(;y--;){if(v===h||h!==null&&v===h.alternate)break t;v=Yr(v),h=Yr(h)}v=null}else v=null;x!==null&&Dc(m,p,x,v,!1),f!==null&&j!==null&&Dc(m,j,f,v,!0)}}e:{if(p=d?us(d):window,x=p.nodeName&&p.nodeName.toLowerCase(),x==="select"||x==="input"&&p.type==="file")var M=Bx;else if(Nc(p))if(Cu)M=Wx;else{M=Vx;var $=Hx}else(x=p.nodeName)&&x.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(M=Gx);if(M&&(M=M(t,d))){ku(m,M,s,u);break e}$&&$(t,p,d),t==="focusout"&&($=p._wrapperState)&&$.controlled&&p.type==="number"&&al(p,"number",p.value)}switch($=d?us(d):window,t){case"focusin":(Nc($)||$.contentEditable==="true")&&(cs=$,gl=d,on=null);break;case"focusout":on=gl=cs=null;break;case"mousedown":yl=!0;break;case"contextmenu":case"mouseup":case"dragend":yl=!1,Ec(m,s,u);break;case"selectionchange":if(Qx)break;case"keydown":case"keyup":Ec(m,s,u)}var T;if(bo)e:{switch(t){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else os?Nu(t,s)&&(A="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(A="onCompositionStart");A&&(wu&&s.locale!=="ko"&&(os||A!=="onCompositionStart"?A==="onCompositionEnd"&&os&&(T=ju()):(mr=u,po="value"in mr?mr.value:mr.textContent,os=!0)),$=Sa(d,A),0<$.length&&(A=new bc(A,t,null,s,u),m.push({event:A,listeners:$}),T?A.data=T:(T=_u(s),T!==null&&(A.data=T)))),(T=Ix?Mx(t,s):Ux(t,s))&&(d=Sa(d,"onBeforeInput"),0<d.length&&(u=new bc("onBeforeInput","beforeinput",null,s,u),m.push({event:u,listeners:d}),u.data=T))}$u(m,e)})}function kn(t,e,s){return{instance:t,listener:e,currentTarget:s}}function Sa(t,e){for(var s=e+"Capture",n=[];t!==null;){var a=t,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=yn(t,s),i!=null&&n.unshift(kn(t,i,a)),i=yn(t,e),i!=null&&n.push(kn(t,i,a))),t=t.return}return n}function Yr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Dc(t,e,s,n,a){for(var i=e._reactName,l=[];s!==null&&s!==n;){var o=s,c=o.alternate,d=o.stateNode;if(c!==null&&c===n)break;o.tag===5&&d!==null&&(o=d,a?(c=yn(s,i),c!=null&&l.unshift(kn(s,c,o))):a||(c=yn(s,i),c!=null&&l.push(kn(s,c,o)))),s=s.return}l.length!==0&&t.push({event:e,listeners:l})}var ef=/\r\n?/g,tf=/\u0000|\uFFFD/g;function Lc(t){return(typeof t=="string"?t:""+t).replace(ef,`
`).replace(tf,"")}function Yn(t,e,s){if(e=Lc(e),Lc(t)!==e&&s)throw Error(W(425))}function Ea(){}var bl=null,vl=null;function jl(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var wl=typeof setTimeout=="function"?setTimeout:void 0,rf=typeof clearTimeout=="function"?clearTimeout:void 0,Fc=typeof Promise=="function"?Promise:void 0,sf=typeof queueMicrotask=="function"?queueMicrotask:typeof Fc<"u"?function(t){return Fc.resolve(null).then(t).catch(nf)}:wl;function nf(t){setTimeout(function(){throw t})}function Ai(t,e){var s=e,n=0;do{var a=s.nextSibling;if(t.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(n===0){t.removeChild(a),jn(e);return}n--}else s!=="$"&&s!=="$?"&&s!=="$!"||n++;s=a}while(s);jn(e)}function gr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ac(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return t;e--}else s==="/$"&&e++}t=t.previousSibling}return null}var Is=Math.random().toString(36).slice(2),Mt="__reactFiber$"+Is,Cn="__reactProps$"+Is,Yt="__reactContainer$"+Is,Nl="__reactEvents$"+Is,af="__reactListeners$"+Is,lf="__reactHandles$"+Is;function $r(t){var e=t[Mt];if(e)return e;for(var s=t.parentNode;s;){if(e=s[Yt]||s[Mt]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(t=Ac(t);t!==null;){if(s=t[Mt])return s;t=Ac(t)}return e}t=s,s=t.parentNode}return null}function Rn(t){return t=t[Mt]||t[Yt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function us(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(W(33))}function Ya(t){return t[Cn]||null}var _l=[],ms=-1;function Cr(t){return{current:t}}function _e(t){0>ms||(t.current=_l[ms],_l[ms]=null,ms--)}function je(t,e){ms++,_l[ms]=t.current,t.current=e}var Nr={},Qe=Cr(Nr),at=Cr(!1),qr=Nr;function Cs(t,e){var s=t.type.contextTypes;if(!s)return Nr;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in s)a[i]=e[i];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function it(t){return t=t.childContextTypes,t!=null}function Pa(){_e(at),_e(Qe)}function Oc(t,e,s){if(Qe.current!==Nr)throw Error(W(168));je(Qe,e),je(at,s)}function Iu(t,e,s){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return s;n=n.getChildContext();for(var a in n)if(!(a in e))throw Error(W(108,Hh(t)||"Unknown",a));return Te({},s,n)}function Ta(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Nr,qr=Qe.current,je(Qe,t),je(at,at.current),!0}function $c(t,e,s){var n=t.stateNode;if(!n)throw Error(W(169));s?(t=Iu(t,e,qr),n.__reactInternalMemoizedMergedChildContext=t,_e(at),_e(Qe),je(Qe,t)):_e(at),je(at,s)}var Wt=null,Za=!1,Oi=!1;function Mu(t){Wt===null?Wt=[t]:Wt.push(t)}function of(t){Za=!0,Mu(t)}function Sr(){if(!Oi&&Wt!==null){Oi=!0;var t=0,e=pe;try{var s=Wt;for(pe=1;t<s.length;t++){var n=s[t];do n=n(!0);while(n!==null)}Wt=null,Za=!1}catch(a){throw Wt!==null&&(Wt=Wt.slice(t+1)),du(mo,Sr),a}finally{pe=e,Oi=!1}}return null}var hs=[],xs=0,Da=null,La=0,pt=[],gt=0,Br=null,Xt=1,Kt="";function Lr(t,e){hs[xs++]=La,hs[xs++]=Da,Da=t,La=e}function Uu(t,e,s){pt[gt++]=Xt,pt[gt++]=Kt,pt[gt++]=Br,Br=t;var n=Xt;t=Kt;var a=32-Ft(n)-1;n&=~(1<<a),s+=1;var i=32-Ft(e)+a;if(30<i){var l=a-a%5;i=(n&(1<<l)-1).toString(32),n>>=l,a-=l,Xt=1<<32-Ft(e)+a|s<<a|n,Kt=i+t}else Xt=1<<i|s<<a|n,Kt=t}function jo(t){t.return!==null&&(Lr(t,1),Uu(t,1,0))}function wo(t){for(;t===Da;)Da=hs[--xs],hs[xs]=null,La=hs[--xs],hs[xs]=null;for(;t===Br;)Br=pt[--gt],pt[gt]=null,Kt=pt[--gt],pt[gt]=null,Xt=pt[--gt],pt[gt]=null}var ut=null,dt=null,Ce=!1,Dt=null;function zu(t,e){var s=yt(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=t,e=t.deletions,e===null?(t.deletions=[s],t.flags|=16):e.push(s)}function Rc(t,e){switch(t.tag){case 5:var s=t.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ut=t,dt=gr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ut=t,dt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=Br!==null?{id:Xt,overflow:Kt}:null,t.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=yt(18,null,null,0),s.stateNode=e,s.return=t,t.child=s,ut=t,dt=null,!0):!1;default:return!1}}function kl(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Cl(t){if(Ce){var e=dt;if(e){var s=e;if(!Rc(t,e)){if(kl(t))throw Error(W(418));e=gr(s.nextSibling);var n=ut;e&&Rc(t,e)?zu(n,s):(t.flags=t.flags&-4097|2,Ce=!1,ut=t)}}else{if(kl(t))throw Error(W(418));t.flags=t.flags&-4097|2,Ce=!1,ut=t}}}function Ic(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ut=t}function Zn(t){if(t!==ut)return!1;if(!Ce)return Ic(t),Ce=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!jl(t.type,t.memoizedProps)),e&&(e=dt)){if(kl(t))throw qu(),Error(W(418));for(;e;)zu(t,e),e=gr(e.nextSibling)}if(Ic(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(W(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"){if(e===0){dt=gr(t.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}t=t.nextSibling}dt=null}}else dt=ut?gr(t.stateNode.nextSibling):null;return!0}function qu(){for(var t=dt;t;)t=gr(t.nextSibling)}function Ss(){dt=ut=null,Ce=!1}function No(t){Dt===null?Dt=[t]:Dt.push(t)}var cf=tr.ReactCurrentBatchConfig;function Ws(t,e,s){if(t=s.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(W(309));var n=s.stateNode}if(!n)throw Error(W(147,t));var a=n,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(l){var o=a.refs;l===null?delete o[i]:o[i]=l},e._stringRef=i,e)}if(typeof t!="string")throw Error(W(284));if(!s._owner)throw Error(W(290,t))}return t}function ea(t,e){throw t=Object.prototype.toString.call(e),Error(W(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Mc(t){var e=t._init;return e(t._payload)}function Bu(t){function e(h,y){if(t){var g=h.deletions;g===null?(h.deletions=[y],h.flags|=16):g.push(y)}}function s(h,y){if(!t)return null;for(;y!==null;)e(h,y),y=y.sibling;return null}function n(h,y){for(h=new Map;y!==null;)y.key!==null?h.set(y.key,y):h.set(y.index,y),y=y.sibling;return h}function a(h,y){return h=jr(h,y),h.index=0,h.sibling=null,h}function i(h,y,g){return h.index=g,t?(g=h.alternate,g!==null?(g=g.index,g<y?(h.flags|=2,y):g):(h.flags|=2,y)):(h.flags|=1048576,y)}function l(h){return t&&h.alternate===null&&(h.flags|=2),h}function o(h,y,g,C){return y===null||y.tag!==6?(y=qi(g,h.mode,C),y.return=h,y):(y=a(y,g),y.return=h,y)}function c(h,y,g,C){var M=g.type;return M===ls?u(h,y,g.props.children,C,g.key):y!==null&&(y.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===ir&&Mc(M)===y.type)?(C=a(y,g.props),C.ref=Ws(h,y,g),C.return=h,C):(C=ba(g.type,g.key,g.props,null,h.mode,C),C.ref=Ws(h,y,g),C.return=h,C)}function d(h,y,g,C){return y===null||y.tag!==4||y.stateNode.containerInfo!==g.containerInfo||y.stateNode.implementation!==g.implementation?(y=Bi(g,h.mode,C),y.return=h,y):(y=a(y,g.children||[]),y.return=h,y)}function u(h,y,g,C,M){return y===null||y.tag!==7?(y=Ur(g,h.mode,C,M),y.return=h,y):(y=a(y,g),y.return=h,y)}function m(h,y,g){if(typeof y=="string"&&y!==""||typeof y=="number")return y=qi(""+y,h.mode,g),y.return=h,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Bn:return g=ba(y.type,y.key,y.props,null,h.mode,g),g.ref=Ws(h,null,y),g.return=h,g;case is:return y=Bi(y,h.mode,g),y.return=h,y;case ir:var C=y._init;return m(h,C(y._payload),g)}if(Ys(y)||qs(y))return y=Ur(y,h.mode,g,null),y.return=h,y;ea(h,y)}return null}function p(h,y,g,C){var M=y!==null?y.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return M!==null?null:o(h,y,""+g,C);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Bn:return g.key===M?c(h,y,g,C):null;case is:return g.key===M?d(h,y,g,C):null;case ir:return M=g._init,p(h,y,M(g._payload),C)}if(Ys(g)||qs(g))return M!==null?null:u(h,y,g,C,null);ea(h,g)}return null}function x(h,y,g,C,M){if(typeof C=="string"&&C!==""||typeof C=="number")return h=h.get(g)||null,o(y,h,""+C,M);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Bn:return h=h.get(C.key===null?g:C.key)||null,c(y,h,C,M);case is:return h=h.get(C.key===null?g:C.key)||null,d(y,h,C,M);case ir:var $=C._init;return x(h,y,g,$(C._payload),M)}if(Ys(C)||qs(C))return h=h.get(g)||null,u(y,h,C,M,null);ea(y,C)}return null}function f(h,y,g,C){for(var M=null,$=null,T=y,A=y=0,D=null;T!==null&&A<g.length;A++){T.index>A?(D=T,T=null):D=T.sibling;var q=p(h,T,g[A],C);if(q===null){T===null&&(T=D);break}t&&T&&q.alternate===null&&e(h,T),y=i(q,y,A),$===null?M=q:$.sibling=q,$=q,T=D}if(A===g.length)return s(h,T),Ce&&Lr(h,A),M;if(T===null){for(;A<g.length;A++)T=m(h,g[A],C),T!==null&&(y=i(T,y,A),$===null?M=T:$.sibling=T,$=T);return Ce&&Lr(h,A),M}for(T=n(h,T);A<g.length;A++)D=x(T,h,A,g[A],C),D!==null&&(t&&D.alternate!==null&&T.delete(D.key===null?A:D.key),y=i(D,y,A),$===null?M=D:$.sibling=D,$=D);return t&&T.forEach(function(K){return e(h,K)}),Ce&&Lr(h,A),M}function v(h,y,g,C){var M=qs(g);if(typeof M!="function")throw Error(W(150));if(g=M.call(g),g==null)throw Error(W(151));for(var $=M=null,T=y,A=y=0,D=null,q=g.next();T!==null&&!q.done;A++,q=g.next()){T.index>A?(D=T,T=null):D=T.sibling;var K=p(h,T,q.value,C);if(K===null){T===null&&(T=D);break}t&&T&&K.alternate===null&&e(h,T),y=i(K,y,A),$===null?M=K:$.sibling=K,$=K,T=D}if(q.done)return s(h,T),Ce&&Lr(h,A),M;if(T===null){for(;!q.done;A++,q=g.next())q=m(h,q.value,C),q!==null&&(y=i(q,y,A),$===null?M=q:$.sibling=q,$=q);return Ce&&Lr(h,A),M}for(T=n(h,T);!q.done;A++,q=g.next())q=x(T,h,A,q.value,C),q!==null&&(t&&q.alternate!==null&&T.delete(q.key===null?A:q.key),y=i(q,y,A),$===null?M=q:$.sibling=q,$=q);return t&&T.forEach(function(J){return e(h,J)}),Ce&&Lr(h,A),M}function j(h,y,g,C){if(typeof g=="object"&&g!==null&&g.type===ls&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case Bn:e:{for(var M=g.key,$=y;$!==null;){if($.key===M){if(M=g.type,M===ls){if($.tag===7){s(h,$.sibling),y=a($,g.props.children),y.return=h,h=y;break e}}else if($.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===ir&&Mc(M)===$.type){s(h,$.sibling),y=a($,g.props),y.ref=Ws(h,$,g),y.return=h,h=y;break e}s(h,$);break}else e(h,$);$=$.sibling}g.type===ls?(y=Ur(g.props.children,h.mode,C,g.key),y.return=h,h=y):(C=ba(g.type,g.key,g.props,null,h.mode,C),C.ref=Ws(h,y,g),C.return=h,h=C)}return l(h);case is:e:{for($=g.key;y!==null;){if(y.key===$)if(y.tag===4&&y.stateNode.containerInfo===g.containerInfo&&y.stateNode.implementation===g.implementation){s(h,y.sibling),y=a(y,g.children||[]),y.return=h,h=y;break e}else{s(h,y);break}else e(h,y);y=y.sibling}y=Bi(g,h.mode,C),y.return=h,h=y}return l(h);case ir:return $=g._init,j(h,y,$(g._payload),C)}if(Ys(g))return f(h,y,g,C);if(qs(g))return v(h,y,g,C);ea(h,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,y!==null&&y.tag===6?(s(h,y.sibling),y=a(y,g),y.return=h,h=y):(s(h,y),y=qi(g,h.mode,C),y.return=h,h=y),l(h)):s(h,y)}return j}var Es=Bu(!0),Hu=Bu(!1),Fa=Cr(null),Aa=null,fs=null,_o=null;function ko(){_o=fs=Aa=null}function Co(t){var e=Fa.current;_e(Fa),t._currentValue=e}function Sl(t,e,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===s)break;t=t.return}}function ws(t,e){Aa=t,_o=fs=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(nt=!0),t.firstContext=null)}function wt(t){var e=t._currentValue;if(_o!==t)if(t={context:t,memoizedValue:e,next:null},fs===null){if(Aa===null)throw Error(W(308));fs=t,Aa.dependencies={lanes:0,firstContext:t}}else fs=fs.next=t;return e}var Rr=null;function So(t){Rr===null?Rr=[t]:Rr.push(t)}function Vu(t,e,s,n){var a=e.interleaved;return a===null?(s.next=s,So(e)):(s.next=a.next,a.next=s),e.interleaved=s,Zt(t,n)}function Zt(t,e){t.lanes|=e;var s=t.alternate;for(s!==null&&(s.lanes|=e),s=t,t=t.return;t!==null;)t.childLanes|=e,s=t.alternate,s!==null&&(s.childLanes|=e),s=t,t=t.return;return s.tag===3?s.stateNode:null}var lr=!1;function Eo(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gu(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Qt(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function yr(t,e,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,xe&2){var a=n.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),n.pending=e,Zt(t,s)}return a=n.interleaved,a===null?(e.next=e,So(n)):(e.next=a.next,a.next=e),n.interleaved=e,Zt(t,s)}function ha(t,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,ho(t,s)}}function Uc(t,e){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var a=null,i=null;if(s=s.firstBaseUpdate,s!==null){do{var l={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};i===null?a=i=l:i=i.next=l,s=s.next}while(s!==null);i===null?a=i=e:i=i.next=e}else a=i=e;s={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=e:t.next=e,s.lastBaseUpdate=e}function Oa(t,e,s,n){var a=t.updateQueue;lr=!1;var i=a.firstBaseUpdate,l=a.lastBaseUpdate,o=a.shared.pending;if(o!==null){a.shared.pending=null;var c=o,d=c.next;c.next=null,l===null?i=d:l.next=d,l=c;var u=t.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==l&&(o===null?u.firstBaseUpdate=d:o.next=d,u.lastBaseUpdate=c))}if(i!==null){var m=a.baseState;l=0,u=d=c=null,o=i;do{var p=o.lane,x=o.eventTime;if((n&p)===p){u!==null&&(u=u.next={eventTime:x,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=t,v=o;switch(p=e,x=s,v.tag){case 1:if(f=v.payload,typeof f=="function"){m=f.call(x,m,p);break e}m=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=v.payload,p=typeof f=="function"?f.call(x,m,p):f,p==null)break e;m=Te({},m,p);break e;case 2:lr=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,p=a.effects,p===null?a.effects=[o]:p.push(o))}else x={eventTime:x,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(d=u=x,c=m):u=u.next=x,l|=p;if(o=o.next,o===null){if(o=a.shared.pending,o===null)break;p=o,o=p.next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}while(!0);if(u===null&&(c=m),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=u,e=a.shared.interleaved,e!==null){a=e;do l|=a.lane,a=a.next;while(a!==e)}else i===null&&(a.shared.lanes=0);Vr|=l,t.lanes=l,t.memoizedState=m}}function zc(t,e,s){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],a=n.callback;if(a!==null){if(n.callback=null,n=s,typeof a!="function")throw Error(W(191,a));a.call(n)}}}var In={},qt=Cr(In),Sn=Cr(In),En=Cr(In);function Ir(t){if(t===In)throw Error(W(174));return t}function Po(t,e){switch(je(En,e),je(Sn,t),je(qt,In),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ll(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ll(e,t)}_e(qt),je(qt,e)}function Ps(){_e(qt),_e(Sn),_e(En)}function Wu(t){Ir(En.current);var e=Ir(qt.current),s=ll(e,t.type);e!==s&&(je(Sn,t),je(qt,s))}function To(t){Sn.current===t&&(_e(qt),_e(Sn))}var Ee=Cr(0);function $a(t){for(var e=t;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var $i=[];function Do(){for(var t=0;t<$i.length;t++)$i[t]._workInProgressVersionPrimary=null;$i.length=0}var xa=tr.ReactCurrentDispatcher,Ri=tr.ReactCurrentBatchConfig,Hr=0,Pe=null,Re=null,ze=null,Ra=!1,cn=!1,Pn=0,df=0;function Ge(){throw Error(W(321))}function Lo(t,e){if(e===null)return!1;for(var s=0;s<e.length&&s<t.length;s++)if(!Ot(t[s],e[s]))return!1;return!0}function Fo(t,e,s,n,a,i){if(Hr=i,Pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xa.current=t===null||t.memoizedState===null?xf:ff,t=s(n,a),cn){i=0;do{if(cn=!1,Pn=0,25<=i)throw Error(W(301));i+=1,ze=Re=null,e.updateQueue=null,xa.current=pf,t=s(n,a)}while(cn)}if(xa.current=Ia,e=Re!==null&&Re.next!==null,Hr=0,ze=Re=Pe=null,Ra=!1,e)throw Error(W(300));return t}function Ao(){var t=Pn!==0;return Pn=0,t}function It(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ze===null?Pe.memoizedState=ze=t:ze=ze.next=t,ze}function Nt(){if(Re===null){var t=Pe.alternate;t=t!==null?t.memoizedState:null}else t=Re.next;var e=ze===null?Pe.memoizedState:ze.next;if(e!==null)ze=e,Re=t;else{if(t===null)throw Error(W(310));Re=t,t={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},ze===null?Pe.memoizedState=ze=t:ze=ze.next=t}return ze}function Tn(t,e){return typeof e=="function"?e(t):e}function Ii(t){var e=Nt(),s=e.queue;if(s===null)throw Error(W(311));s.lastRenderedReducer=t;var n=Re,a=n.baseQueue,i=s.pending;if(i!==null){if(a!==null){var l=a.next;a.next=i.next,i.next=l}n.baseQueue=a=i,s.pending=null}if(a!==null){i=a.next,n=n.baseState;var o=l=null,c=null,d=i;do{var u=d.lane;if((Hr&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:t(n,d.action);else{var m={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(o=c=m,l=n):c=c.next=m,Pe.lanes|=u,Vr|=u}d=d.next}while(d!==null&&d!==i);c===null?l=n:c.next=o,Ot(n,e.memoizedState)||(nt=!0),e.memoizedState=n,e.baseState=l,e.baseQueue=c,s.lastRenderedState=n}if(t=s.interleaved,t!==null){a=t;do i=a.lane,Pe.lanes|=i,Vr|=i,a=a.next;while(a!==t)}else a===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function Mi(t){var e=Nt(),s=e.queue;if(s===null)throw Error(W(311));s.lastRenderedReducer=t;var n=s.dispatch,a=s.pending,i=e.memoizedState;if(a!==null){s.pending=null;var l=a=a.next;do i=t(i,l.action),l=l.next;while(l!==a);Ot(i,e.memoizedState)||(nt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),s.lastRenderedState=i}return[i,n]}function Xu(){}function Ku(t,e){var s=Pe,n=Nt(),a=e(),i=!Ot(n.memoizedState,a);if(i&&(n.memoizedState=a,nt=!0),n=n.queue,Oo(Yu.bind(null,s,n,t),[t]),n.getSnapshot!==e||i||ze!==null&&ze.memoizedState.tag&1){if(s.flags|=2048,Dn(9,Ju.bind(null,s,n,a,e),void 0,null),qe===null)throw Error(W(349));Hr&30||Qu(s,e,a)}return a}function Qu(t,e,s){t.flags|=16384,t={getSnapshot:e,value:s},e=Pe.updateQueue,e===null?(e={lastEffect:null,stores:null},Pe.updateQueue=e,e.stores=[t]):(s=e.stores,s===null?e.stores=[t]:s.push(t))}function Ju(t,e,s,n){e.value=s,e.getSnapshot=n,Zu(e)&&em(t)}function Yu(t,e,s){return s(function(){Zu(e)&&em(t)})}function Zu(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!Ot(t,s)}catch{return!0}}function em(t){var e=Zt(t,1);e!==null&&At(e,t,1,-1)}function qc(t){var e=It();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tn,lastRenderedState:t},e.queue=t,t=t.dispatch=hf.bind(null,Pe,t),[e.memoizedState,t]}function Dn(t,e,s,n){return t={tag:t,create:e,destroy:s,deps:n,next:null},e=Pe.updateQueue,e===null?(e={lastEffect:null,stores:null},Pe.updateQueue=e,e.lastEffect=t.next=t):(s=e.lastEffect,s===null?e.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,e.lastEffect=t)),t}function tm(){return Nt().memoizedState}function fa(t,e,s,n){var a=It();Pe.flags|=t,a.memoizedState=Dn(1|e,s,void 0,n===void 0?null:n)}function ei(t,e,s,n){var a=Nt();n=n===void 0?null:n;var i=void 0;if(Re!==null){var l=Re.memoizedState;if(i=l.destroy,n!==null&&Lo(n,l.deps)){a.memoizedState=Dn(e,s,i,n);return}}Pe.flags|=t,a.memoizedState=Dn(1|e,s,i,n)}function Bc(t,e){return fa(8390656,8,t,e)}function Oo(t,e){return ei(2048,8,t,e)}function rm(t,e){return ei(4,2,t,e)}function sm(t,e){return ei(4,4,t,e)}function nm(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function am(t,e,s){return s=s!=null?s.concat([t]):null,ei(4,4,nm.bind(null,e,t),s)}function $o(){}function im(t,e){var s=Nt();e=e===void 0?null:e;var n=s.memoizedState;return n!==null&&e!==null&&Lo(e,n[1])?n[0]:(s.memoizedState=[t,e],t)}function lm(t,e){var s=Nt();e=e===void 0?null:e;var n=s.memoizedState;return n!==null&&e!==null&&Lo(e,n[1])?n[0]:(t=t(),s.memoizedState=[t,e],t)}function om(t,e,s){return Hr&21?(Ot(s,e)||(s=hu(),Pe.lanes|=s,Vr|=s,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,nt=!0),t.memoizedState=s)}function uf(t,e){var s=pe;pe=s!==0&&4>s?s:4,t(!0);var n=Ri.transition;Ri.transition={};try{t(!1),e()}finally{pe=s,Ri.transition=n}}function cm(){return Nt().memoizedState}function mf(t,e,s){var n=vr(t);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},dm(t))um(e,s);else if(s=Vu(t,e,s,n),s!==null){var a=Ye();At(s,t,n,a),mm(s,e,n)}}function hf(t,e,s){var n=vr(t),a={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if(dm(t))um(e,a);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var l=e.lastRenderedState,o=i(l,s);if(a.hasEagerState=!0,a.eagerState=o,Ot(o,l)){var c=e.interleaved;c===null?(a.next=a,So(e)):(a.next=c.next,c.next=a),e.interleaved=a;return}}catch{}finally{}s=Vu(t,e,a,n),s!==null&&(a=Ye(),At(s,t,n,a),mm(s,e,n))}}function dm(t){var e=t.alternate;return t===Pe||e!==null&&e===Pe}function um(t,e){cn=Ra=!0;var s=t.pending;s===null?e.next=e:(e.next=s.next,s.next=e),t.pending=e}function mm(t,e,s){if(s&4194240){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,ho(t,s)}}var Ia={readContext:wt,useCallback:Ge,useContext:Ge,useEffect:Ge,useImperativeHandle:Ge,useInsertionEffect:Ge,useLayoutEffect:Ge,useMemo:Ge,useReducer:Ge,useRef:Ge,useState:Ge,useDebugValue:Ge,useDeferredValue:Ge,useTransition:Ge,useMutableSource:Ge,useSyncExternalStore:Ge,useId:Ge,unstable_isNewReconciler:!1},xf={readContext:wt,useCallback:function(t,e){return It().memoizedState=[t,e===void 0?null:e],t},useContext:wt,useEffect:Bc,useImperativeHandle:function(t,e,s){return s=s!=null?s.concat([t]):null,fa(4194308,4,nm.bind(null,e,t),s)},useLayoutEffect:function(t,e){return fa(4194308,4,t,e)},useInsertionEffect:function(t,e){return fa(4,2,t,e)},useMemo:function(t,e){var s=It();return e=e===void 0?null:e,t=t(),s.memoizedState=[t,e],t},useReducer:function(t,e,s){var n=It();return e=s!==void 0?s(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=mf.bind(null,Pe,t),[n.memoizedState,t]},useRef:function(t){var e=It();return t={current:t},e.memoizedState=t},useState:qc,useDebugValue:$o,useDeferredValue:function(t){return It().memoizedState=t},useTransition:function(){var t=qc(!1),e=t[0];return t=uf.bind(null,t[1]),It().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,s){var n=Pe,a=It();if(Ce){if(s===void 0)throw Error(W(407));s=s()}else{if(s=e(),qe===null)throw Error(W(349));Hr&30||Qu(n,e,s)}a.memoizedState=s;var i={value:s,getSnapshot:e};return a.queue=i,Bc(Yu.bind(null,n,i,t),[t]),n.flags|=2048,Dn(9,Ju.bind(null,n,i,s,e),void 0,null),s},useId:function(){var t=It(),e=qe.identifierPrefix;if(Ce){var s=Kt,n=Xt;s=(n&~(1<<32-Ft(n)-1)).toString(32)+s,e=":"+e+"R"+s,s=Pn++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=df++,e=":"+e+"r"+s.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ff={readContext:wt,useCallback:im,useContext:wt,useEffect:Oo,useImperativeHandle:am,useInsertionEffect:rm,useLayoutEffect:sm,useMemo:lm,useReducer:Ii,useRef:tm,useState:function(){return Ii(Tn)},useDebugValue:$o,useDeferredValue:function(t){var e=Nt();return om(e,Re.memoizedState,t)},useTransition:function(){var t=Ii(Tn)[0],e=Nt().memoizedState;return[t,e]},useMutableSource:Xu,useSyncExternalStore:Ku,useId:cm,unstable_isNewReconciler:!1},pf={readContext:wt,useCallback:im,useContext:wt,useEffect:Oo,useImperativeHandle:am,useInsertionEffect:rm,useLayoutEffect:sm,useMemo:lm,useReducer:Mi,useRef:tm,useState:function(){return Mi(Tn)},useDebugValue:$o,useDeferredValue:function(t){var e=Nt();return Re===null?e.memoizedState=t:om(e,Re.memoizedState,t)},useTransition:function(){var t=Mi(Tn)[0],e=Nt().memoizedState;return[t,e]},useMutableSource:Xu,useSyncExternalStore:Ku,useId:cm,unstable_isNewReconciler:!1};function Et(t,e){if(t&&t.defaultProps){e=Te({},e),t=t.defaultProps;for(var s in t)e[s]===void 0&&(e[s]=t[s]);return e}return e}function El(t,e,s,n){e=t.memoizedState,s=s(n,e),s=s==null?e:Te({},e,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var ti={isMounted:function(t){return(t=t._reactInternals)?Kr(t)===t:!1},enqueueSetState:function(t,e,s){t=t._reactInternals;var n=Ye(),a=vr(t),i=Qt(n,a);i.payload=e,s!=null&&(i.callback=s),e=yr(t,i,a),e!==null&&(At(e,t,a,n),ha(e,t,a))},enqueueReplaceState:function(t,e,s){t=t._reactInternals;var n=Ye(),a=vr(t),i=Qt(n,a);i.tag=1,i.payload=e,s!=null&&(i.callback=s),e=yr(t,i,a),e!==null&&(At(e,t,a,n),ha(e,t,a))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var s=Ye(),n=vr(t),a=Qt(s,n);a.tag=2,e!=null&&(a.callback=e),e=yr(t,a,n),e!==null&&(At(e,t,n,s),ha(e,t,n))}};function Hc(t,e,s,n,a,i,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,i,l):e.prototype&&e.prototype.isPureReactComponent?!Nn(s,n)||!Nn(a,i):!0}function hm(t,e,s){var n=!1,a=Nr,i=e.contextType;return typeof i=="object"&&i!==null?i=wt(i):(a=it(e)?qr:Qe.current,n=e.contextTypes,i=(n=n!=null)?Cs(t,a):Nr),e=new e(s,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ti,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=a,t.__reactInternalMemoizedMaskedChildContext=i),e}function Vc(t,e,s,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,n),e.state!==t&&ti.enqueueReplaceState(e,e.state,null)}function Pl(t,e,s,n){var a=t.stateNode;a.props=s,a.state=t.memoizedState,a.refs={},Eo(t);var i=e.contextType;typeof i=="object"&&i!==null?a.context=wt(i):(i=it(e)?qr:Qe.current,a.context=Cs(t,i)),a.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(El(t,e,i,s),a.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(e=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),e!==a.state&&ti.enqueueReplaceState(a,a.state,null),Oa(t,s,a,n),a.state=t.memoizedState),typeof a.componentDidMount=="function"&&(t.flags|=4194308)}function Ts(t,e){try{var s="",n=e;do s+=Bh(n),n=n.return;while(n);var a=s}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:a,digest:null}}function Ui(t,e,s){return{value:t,source:null,stack:s??null,digest:e??null}}function Tl(t,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var gf=typeof WeakMap=="function"?WeakMap:Map;function xm(t,e,s){s=Qt(-1,s),s.tag=3,s.payload={element:null};var n=e.value;return s.callback=function(){Ua||(Ua=!0,Ul=n),Tl(t,e)},s}function fm(t,e,s){s=Qt(-1,s),s.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var a=e.value;s.payload=function(){return n(a)},s.callback=function(){Tl(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(s.callback=function(){Tl(t,e),typeof n!="function"&&(br===null?br=new Set([this]):br.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),s}function Gc(t,e,s){var n=t.pingCache;if(n===null){n=t.pingCache=new gf;var a=new Set;n.set(e,a)}else a=n.get(e),a===void 0&&(a=new Set,n.set(e,a));a.has(s)||(a.add(s),t=Df.bind(null,t,e,s),e.then(t,t))}function Wc(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Xc(t,e,s,n,a){return t.mode&1?(t.flags|=65536,t.lanes=a,t):(t===e?t.flags|=65536:(t.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=Qt(-1,1),e.tag=2,yr(s,e,1))),s.lanes|=1),t)}var yf=tr.ReactCurrentOwner,nt=!1;function Je(t,e,s,n){e.child=t===null?Hu(e,null,s,n):Es(e,t.child,s,n)}function Kc(t,e,s,n,a){s=s.render;var i=e.ref;return ws(e,a),n=Fo(t,e,s,n,i,a),s=Ao(),t!==null&&!nt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~a,er(t,e,a)):(Ce&&s&&jo(e),e.flags|=1,Je(t,e,n,a),e.child)}function Qc(t,e,s,n,a){if(t===null){var i=s.type;return typeof i=="function"&&!Ho(i)&&i.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=i,pm(t,e,i,n,a)):(t=ba(s.type,null,n,e,e.mode,a),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&a)){var l=i.memoizedProps;if(s=s.compare,s=s!==null?s:Nn,s(l,n)&&t.ref===e.ref)return er(t,e,a)}return e.flags|=1,t=jr(i,n),t.ref=e.ref,t.return=e,e.child=t}function pm(t,e,s,n,a){if(t!==null){var i=t.memoizedProps;if(Nn(i,n)&&t.ref===e.ref)if(nt=!1,e.pendingProps=n=i,(t.lanes&a)!==0)t.flags&131072&&(nt=!0);else return e.lanes=t.lanes,er(t,e,a)}return Dl(t,e,s,n,a)}function gm(t,e,s){var n=e.pendingProps,a=n.children,i=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},je(gs,ct),ct|=s;else{if(!(s&1073741824))return t=i!==null?i.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,je(gs,ct),ct|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:s,je(gs,ct),ct|=n}else i!==null?(n=i.baseLanes|s,e.memoizedState=null):n=s,je(gs,ct),ct|=n;return Je(t,e,a,s),e.child}function ym(t,e){var s=e.ref;(t===null&&s!==null||t!==null&&t.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function Dl(t,e,s,n,a){var i=it(s)?qr:Qe.current;return i=Cs(e,i),ws(e,a),s=Fo(t,e,s,n,i,a),n=Ao(),t!==null&&!nt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~a,er(t,e,a)):(Ce&&n&&jo(e),e.flags|=1,Je(t,e,s,a),e.child)}function Jc(t,e,s,n,a){if(it(s)){var i=!0;Ta(e)}else i=!1;if(ws(e,a),e.stateNode===null)pa(t,e),hm(e,s,n),Pl(e,s,n,a),n=!0;else if(t===null){var l=e.stateNode,o=e.memoizedProps;l.props=o;var c=l.context,d=s.contextType;typeof d=="object"&&d!==null?d=wt(d):(d=it(s)?qr:Qe.current,d=Cs(e,d));var u=s.getDerivedStateFromProps,m=typeof u=="function"||typeof l.getSnapshotBeforeUpdate=="function";m||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==n||c!==d)&&Vc(e,l,n,d),lr=!1;var p=e.memoizedState;l.state=p,Oa(e,n,l,a),c=e.memoizedState,o!==n||p!==c||at.current||lr?(typeof u=="function"&&(El(e,s,u,n),c=e.memoizedState),(o=lr||Hc(e,s,o,n,p,c,d))?(m||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),l.props=n,l.state=c,l.context=d,n=o):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{l=e.stateNode,Gu(t,e),o=e.memoizedProps,d=e.type===e.elementType?o:Et(e.type,o),l.props=d,m=e.pendingProps,p=l.context,c=s.contextType,typeof c=="object"&&c!==null?c=wt(c):(c=it(s)?qr:Qe.current,c=Cs(e,c));var x=s.getDerivedStateFromProps;(u=typeof x=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==m||p!==c)&&Vc(e,l,n,c),lr=!1,p=e.memoizedState,l.state=p,Oa(e,n,l,a);var f=e.memoizedState;o!==m||p!==f||at.current||lr?(typeof x=="function"&&(El(e,s,x,n),f=e.memoizedState),(d=lr||Hc(e,s,d,n,p,f,c)||!1)?(u||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(n,f,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(n,f,c)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),l.props=n,l.state=f,l.context=c,n=d):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),n=!1)}return Ll(t,e,s,n,i,a)}function Ll(t,e,s,n,a,i){ym(t,e);var l=(e.flags&128)!==0;if(!n&&!l)return a&&$c(e,s,!1),er(t,e,i);n=e.stateNode,yf.current=e;var o=l&&typeof s.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&l?(e.child=Es(e,t.child,null,i),e.child=Es(e,null,o,i)):Je(t,e,o,i),e.memoizedState=n.state,a&&$c(e,s,!0),e.child}function bm(t){var e=t.stateNode;e.pendingContext?Oc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Oc(t,e.context,!1),Po(t,e.containerInfo)}function Yc(t,e,s,n,a){return Ss(),No(a),e.flags|=256,Je(t,e,s,n),e.child}var Fl={dehydrated:null,treeContext:null,retryLane:0};function Al(t){return{baseLanes:t,cachePool:null,transitions:null}}function vm(t,e,s){var n=e.pendingProps,a=Ee.current,i=!1,l=(e.flags&128)!==0,o;if((o=l)||(o=t!==null&&t.memoizedState===null?!1:(a&2)!==0),o?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(a|=1),je(Ee,a&1),t===null)return Cl(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=n.children,t=n.fallback,i?(n=e.mode,i=e.child,l={mode:"hidden",children:l},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=l):i=ni(l,n,0,null),t=Ur(t,n,s,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Al(s),e.memoizedState=Fl,t):Ro(e,l));if(a=t.memoizedState,a!==null&&(o=a.dehydrated,o!==null))return bf(t,e,l,n,o,a,s);if(i){i=n.fallback,l=e.mode,a=t.child,o=a.sibling;var c={mode:"hidden",children:n.children};return!(l&1)&&e.child!==a?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=jr(a,c),n.subtreeFlags=a.subtreeFlags&14680064),o!==null?i=jr(o,i):(i=Ur(i,l,s,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,l=t.child.memoizedState,l=l===null?Al(s):{baseLanes:l.baseLanes|s,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=t.childLanes&~s,e.memoizedState=Fl,n}return i=t.child,t=i.sibling,n=jr(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=s),n.return=e,n.sibling=null,t!==null&&(s=e.deletions,s===null?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=n,e.memoizedState=null,n}function Ro(t,e){return e=ni({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ta(t,e,s,n){return n!==null&&No(n),Es(e,t.child,null,s),t=Ro(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function bf(t,e,s,n,a,i,l){if(s)return e.flags&256?(e.flags&=-257,n=Ui(Error(W(422))),ta(t,e,l,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=n.fallback,a=e.mode,n=ni({mode:"visible",children:n.children},a,0,null),i=Ur(i,a,l,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&Es(e,t.child,null,l),e.child.memoizedState=Al(l),e.memoizedState=Fl,i);if(!(e.mode&1))return ta(t,e,l,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var o=n.dgst;return n=o,i=Error(W(419)),n=Ui(i,n,void 0),ta(t,e,l,n)}if(o=(l&t.childLanes)!==0,nt||o){if(n=qe,n!==null){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|l)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Zt(t,a),At(n,t,a,-1))}return Bo(),n=Ui(Error(W(421))),ta(t,e,l,n)}return a.data==="$?"?(e.flags|=128,e.child=t.child,e=Lf.bind(null,t),a._reactRetry=e,null):(t=i.treeContext,dt=gr(a.nextSibling),ut=e,Ce=!0,Dt=null,t!==null&&(pt[gt++]=Xt,pt[gt++]=Kt,pt[gt++]=Br,Xt=t.id,Kt=t.overflow,Br=e),e=Ro(e,n.children),e.flags|=4096,e)}function Zc(t,e,s){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Sl(t.return,e,s)}function zi(t,e,s,n,a){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:a}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=s,i.tailMode=a)}function jm(t,e,s){var n=e.pendingProps,a=n.revealOrder,i=n.tail;if(Je(t,e,n.children,s),n=Ee.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Zc(t,s,e);else if(t.tag===19)Zc(t,s,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(je(Ee,n),!(e.mode&1))e.memoizedState=null;else switch(a){case"forwards":for(s=e.child,a=null;s!==null;)t=s.alternate,t!==null&&$a(t)===null&&(a=s),s=s.sibling;s=a,s===null?(a=e.child,e.child=null):(a=s.sibling,s.sibling=null),zi(e,!1,a,s,i);break;case"backwards":for(s=null,a=e.child,e.child=null;a!==null;){if(t=a.alternate,t!==null&&$a(t)===null){e.child=a;break}t=a.sibling,a.sibling=s,s=a,a=t}zi(e,!0,s,null,i);break;case"together":zi(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function pa(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function er(t,e,s){if(t!==null&&(e.dependencies=t.dependencies),Vr|=e.lanes,!(s&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(W(153));if(e.child!==null){for(t=e.child,s=jr(t,t.pendingProps),e.child=s,s.return=e;t.sibling!==null;)t=t.sibling,s=s.sibling=jr(t,t.pendingProps),s.return=e;s.sibling=null}return e.child}function vf(t,e,s){switch(e.tag){case 3:bm(e),Ss();break;case 5:Wu(e);break;case 1:it(e.type)&&Ta(e);break;case 4:Po(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,a=e.memoizedProps.value;je(Fa,n._currentValue),n._currentValue=a;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(je(Ee,Ee.current&1),e.flags|=128,null):s&e.child.childLanes?vm(t,e,s):(je(Ee,Ee.current&1),t=er(t,e,s),t!==null?t.sibling:null);je(Ee,Ee.current&1);break;case 19:if(n=(s&e.childLanes)!==0,t.flags&128){if(n)return jm(t,e,s);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),je(Ee,Ee.current),n)break;return null;case 22:case 23:return e.lanes=0,gm(t,e,s)}return er(t,e,s)}var wm,Ol,Nm,_m;wm=function(t,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)t.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Ol=function(){};Nm=function(t,e,s,n){var a=t.memoizedProps;if(a!==n){t=e.stateNode,Ir(qt.current);var i=null;switch(s){case"input":a=sl(t,a),n=sl(t,n),i=[];break;case"select":a=Te({},a,{value:void 0}),n=Te({},n,{value:void 0}),i=[];break;case"textarea":a=il(t,a),n=il(t,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=Ea)}ol(s,n);var l;s=null;for(d in a)if(!n.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var o=a[d];for(l in o)o.hasOwnProperty(l)&&(s||(s={}),s[l]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(pn.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in n){var c=n[d];if(o=a!=null?a[d]:void 0,n.hasOwnProperty(d)&&c!==o&&(c!=null||o!=null))if(d==="style")if(o){for(l in o)!o.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(s||(s={}),s[l]="");for(l in c)c.hasOwnProperty(l)&&o[l]!==c[l]&&(s||(s={}),s[l]=c[l])}else s||(i||(i=[]),i.push(d,s)),s=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(pn.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Ne("scroll",t),i||o===c||(i=[])):(i=i||[]).push(d,c))}s&&(i=i||[]).push("style",s);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};_m=function(t,e,s,n){s!==n&&(e.flags|=4)};function Xs(t,e){if(!Ce)switch(t.tailMode){case"hidden":e=t.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function We(t){var e=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(e)for(var a=t.child;a!==null;)s|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=t,a=a.sibling;else for(a=t.child;a!==null;)s|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=t,a=a.sibling;return t.subtreeFlags|=n,t.childLanes=s,e}function jf(t,e,s){var n=e.pendingProps;switch(wo(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return We(e),null;case 1:return it(e.type)&&Pa(),We(e),null;case 3:return n=e.stateNode,Ps(),_e(at),_e(Qe),Do(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Zn(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Dt!==null&&(Bl(Dt),Dt=null))),Ol(t,e),We(e),null;case 5:To(e);var a=Ir(En.current);if(s=e.type,t!==null&&e.stateNode!=null)Nm(t,e,s,n,a),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(W(166));return We(e),null}if(t=Ir(qt.current),Zn(e)){n=e.stateNode,s=e.type;var i=e.memoizedProps;switch(n[Mt]=e,n[Cn]=i,t=(e.mode&1)!==0,s){case"dialog":Ne("cancel",n),Ne("close",n);break;case"iframe":case"object":case"embed":Ne("load",n);break;case"video":case"audio":for(a=0;a<en.length;a++)Ne(en[a],n);break;case"source":Ne("error",n);break;case"img":case"image":case"link":Ne("error",n),Ne("load",n);break;case"details":Ne("toggle",n);break;case"input":oc(n,i),Ne("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Ne("invalid",n);break;case"textarea":dc(n,i),Ne("invalid",n)}ol(s,i),a=null;for(var l in i)if(i.hasOwnProperty(l)){var o=i[l];l==="children"?typeof o=="string"?n.textContent!==o&&(i.suppressHydrationWarning!==!0&&Yn(n.textContent,o,t),a=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&Yn(n.textContent,o,t),a=["children",""+o]):pn.hasOwnProperty(l)&&o!=null&&l==="onScroll"&&Ne("scroll",n)}switch(s){case"input":Hn(n),cc(n,i,!0);break;case"textarea":Hn(n),uc(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=Ea)}n=a,e.updateQueue=n,n!==null&&(e.flags|=4)}else{l=a.nodeType===9?a:a.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Yd(s)),t==="http://www.w3.org/1999/xhtml"?s==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=l.createElement(s,{is:n.is}):(t=l.createElement(s),s==="select"&&(l=t,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):t=l.createElementNS(t,s),t[Mt]=e,t[Cn]=n,wm(t,e,!1,!1),e.stateNode=t;e:{switch(l=cl(s,n),s){case"dialog":Ne("cancel",t),Ne("close",t),a=n;break;case"iframe":case"object":case"embed":Ne("load",t),a=n;break;case"video":case"audio":for(a=0;a<en.length;a++)Ne(en[a],t);a=n;break;case"source":Ne("error",t),a=n;break;case"img":case"image":case"link":Ne("error",t),Ne("load",t),a=n;break;case"details":Ne("toggle",t),a=n;break;case"input":oc(t,n),a=sl(t,n),Ne("invalid",t);break;case"option":a=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},a=Te({},n,{value:void 0}),Ne("invalid",t);break;case"textarea":dc(t,n),a=il(t,n),Ne("invalid",t);break;default:a=n}ol(s,a),o=a;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?tu(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Zd(t,c)):i==="children"?typeof c=="string"?(s!=="textarea"||c!=="")&&gn(t,c):typeof c=="number"&&gn(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(pn.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Ne("scroll",t):c!=null&&io(t,i,c,l))}switch(s){case"input":Hn(t),cc(t,n,!1);break;case"textarea":Hn(t),uc(t);break;case"option":n.value!=null&&t.setAttribute("value",""+wr(n.value));break;case"select":t.multiple=!!n.multiple,i=n.value,i!=null?ys(t,!!n.multiple,i,!1):n.defaultValue!=null&&ys(t,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(t.onclick=Ea)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return We(e),null;case 6:if(t&&e.stateNode!=null)_m(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(W(166));if(s=Ir(En.current),Ir(qt.current),Zn(e)){if(n=e.stateNode,s=e.memoizedProps,n[Mt]=e,(i=n.nodeValue!==s)&&(t=ut,t!==null))switch(t.tag){case 3:Yn(n.nodeValue,s,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Yn(n.nodeValue,s,(t.mode&1)!==0)}i&&(e.flags|=4)}else n=(s.nodeType===9?s:s.ownerDocument).createTextNode(n),n[Mt]=e,e.stateNode=n}return We(e),null;case 13:if(_e(Ee),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ce&&dt!==null&&e.mode&1&&!(e.flags&128))qu(),Ss(),e.flags|=98560,i=!1;else if(i=Zn(e),n!==null&&n.dehydrated!==null){if(t===null){if(!i)throw Error(W(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(W(317));i[Mt]=e}else Ss(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;We(e),i=!1}else Dt!==null&&(Bl(Dt),Dt=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||Ee.current&1?Ie===0&&(Ie=3):Bo())),e.updateQueue!==null&&(e.flags|=4),We(e),null);case 4:return Ps(),Ol(t,e),t===null&&_n(e.stateNode.containerInfo),We(e),null;case 10:return Co(e.type._context),We(e),null;case 17:return it(e.type)&&Pa(),We(e),null;case 19:if(_e(Ee),i=e.memoizedState,i===null)return We(e),null;if(n=(e.flags&128)!==0,l=i.rendering,l===null)if(n)Xs(i,!1);else{if(Ie!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=$a(t),l!==null){for(e.flags|=128,Xs(i,!1),n=l.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=s,s=e.child;s!==null;)i=s,t=n,i.flags&=14680066,l=i.alternate,l===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,t=l.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),s=s.sibling;return je(Ee,Ee.current&1|2),e.child}t=t.sibling}i.tail!==null&&Fe()>Ds&&(e.flags|=128,n=!0,Xs(i,!1),e.lanes=4194304)}else{if(!n)if(t=$a(l),t!==null){if(e.flags|=128,n=!0,s=t.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),Xs(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!Ce)return We(e),null}else 2*Fe()-i.renderingStartTime>Ds&&s!==1073741824&&(e.flags|=128,n=!0,Xs(i,!1),e.lanes=4194304);i.isBackwards?(l.sibling=e.child,e.child=l):(s=i.last,s!==null?s.sibling=l:e.child=l,i.last=l)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Fe(),e.sibling=null,s=Ee.current,je(Ee,n?s&1|2:s&1),e):(We(e),null);case 22:case 23:return qo(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?ct&1073741824&&(We(e),e.subtreeFlags&6&&(e.flags|=8192)):We(e),null;case 24:return null;case 25:return null}throw Error(W(156,e.tag))}function wf(t,e){switch(wo(e),e.tag){case 1:return it(e.type)&&Pa(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ps(),_e(at),_e(Qe),Do(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return To(e),null;case 13:if(_e(Ee),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(W(340));Ss()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return _e(Ee),null;case 4:return Ps(),null;case 10:return Co(e.type._context),null;case 22:case 23:return qo(),null;case 24:return null;default:return null}}var ra=!1,Ke=!1,Nf=typeof WeakSet=="function"?WeakSet:Set,re=null;function ps(t,e){var s=t.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(n){De(t,e,n)}else s.current=null}function $l(t,e,s){try{s()}catch(n){De(t,e,n)}}var ed=!1;function _f(t,e){if(bl=ka,t=Pu(),vo(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var a=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{s.nodeType,i.nodeType}catch{s=null;break e}var l=0,o=-1,c=-1,d=0,u=0,m=t,p=null;t:for(;;){for(var x;m!==s||a!==0&&m.nodeType!==3||(o=l+a),m!==i||n!==0&&m.nodeType!==3||(c=l+n),m.nodeType===3&&(l+=m.nodeValue.length),(x=m.firstChild)!==null;)p=m,m=x;for(;;){if(m===t)break t;if(p===s&&++d===a&&(o=l),p===i&&++u===n&&(c=l),(x=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=x}s=o===-1||c===-1?null:{start:o,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(vl={focusedElem:t,selectionRange:s},ka=!1,re=e;re!==null;)if(e=re,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,re=t;else for(;re!==null;){e=re;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var v=f.memoizedProps,j=f.memoizedState,h=e.stateNode,y=h.getSnapshotBeforeUpdate(e.elementType===e.type?v:Et(e.type,v),j);h.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(W(163))}}catch(C){De(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,re=t;break}re=e.return}return f=ed,ed=!1,f}function dn(t,e,s){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&t)===t){var i=a.destroy;a.destroy=void 0,i!==void 0&&$l(e,s,i)}a=a.next}while(a!==n)}}function ri(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&t)===t){var n=s.create;s.destroy=n()}s=s.next}while(s!==e)}}function Rl(t){var e=t.ref;if(e!==null){var s=t.stateNode;switch(t.tag){case 5:t=s;break;default:t=s}typeof e=="function"?e(t):e.current=t}}function km(t){var e=t.alternate;e!==null&&(t.alternate=null,km(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Mt],delete e[Cn],delete e[Nl],delete e[af],delete e[lf])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Cm(t){return t.tag===5||t.tag===3||t.tag===4}function td(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Cm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Il(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(t,e):s.insertBefore(t,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(t,s)):(e=s,e.appendChild(t)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=Ea));else if(n!==4&&(t=t.child,t!==null))for(Il(t,e,s),t=t.sibling;t!==null;)Il(t,e,s),t=t.sibling}function Ml(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.insertBefore(t,e):s.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Ml(t,e,s),t=t.sibling;t!==null;)Ml(t,e,s),t=t.sibling}var Be=null,Pt=!1;function sr(t,e,s){for(s=s.child;s!==null;)Sm(t,e,s),s=s.sibling}function Sm(t,e,s){if(zt&&typeof zt.onCommitFiberUnmount=="function")try{zt.onCommitFiberUnmount(Xa,s)}catch{}switch(s.tag){case 5:Ke||ps(s,e);case 6:var n=Be,a=Pt;Be=null,sr(t,e,s),Be=n,Pt=a,Be!==null&&(Pt?(t=Be,s=s.stateNode,t.nodeType===8?t.parentNode.removeChild(s):t.removeChild(s)):Be.removeChild(s.stateNode));break;case 18:Be!==null&&(Pt?(t=Be,s=s.stateNode,t.nodeType===8?Ai(t.parentNode,s):t.nodeType===1&&Ai(t,s),jn(t)):Ai(Be,s.stateNode));break;case 4:n=Be,a=Pt,Be=s.stateNode.containerInfo,Pt=!0,sr(t,e,s),Be=n,Pt=a;break;case 0:case 11:case 14:case 15:if(!Ke&&(n=s.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var i=a,l=i.destroy;i=i.tag,l!==void 0&&(i&2||i&4)&&$l(s,e,l),a=a.next}while(a!==n)}sr(t,e,s);break;case 1:if(!Ke&&(ps(s,e),n=s.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(o){De(s,e,o)}sr(t,e,s);break;case 21:sr(t,e,s);break;case 22:s.mode&1?(Ke=(n=Ke)||s.memoizedState!==null,sr(t,e,s),Ke=n):sr(t,e,s);break;default:sr(t,e,s)}}function rd(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var s=t.stateNode;s===null&&(s=t.stateNode=new Nf),e.forEach(function(n){var a=Ff.bind(null,t,n);s.has(n)||(s.add(n),n.then(a,a))})}}function Ct(t,e){var s=e.deletions;if(s!==null)for(var n=0;n<s.length;n++){var a=s[n];try{var i=t,l=e,o=l;e:for(;o!==null;){switch(o.tag){case 5:Be=o.stateNode,Pt=!1;break e;case 3:Be=o.stateNode.containerInfo,Pt=!0;break e;case 4:Be=o.stateNode.containerInfo,Pt=!0;break e}o=o.return}if(Be===null)throw Error(W(160));Sm(i,l,a),Be=null,Pt=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){De(a,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Em(e,t),e=e.sibling}function Em(t,e){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ct(e,t),Rt(t),n&4){try{dn(3,t,t.return),ri(3,t)}catch(v){De(t,t.return,v)}try{dn(5,t,t.return)}catch(v){De(t,t.return,v)}}break;case 1:Ct(e,t),Rt(t),n&512&&s!==null&&ps(s,s.return);break;case 5:if(Ct(e,t),Rt(t),n&512&&s!==null&&ps(s,s.return),t.flags&32){var a=t.stateNode;try{gn(a,"")}catch(v){De(t,t.return,v)}}if(n&4&&(a=t.stateNode,a!=null)){var i=t.memoizedProps,l=s!==null?s.memoizedProps:i,o=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&Qd(a,i),cl(o,l);var d=cl(o,i);for(l=0;l<c.length;l+=2){var u=c[l],m=c[l+1];u==="style"?tu(a,m):u==="dangerouslySetInnerHTML"?Zd(a,m):u==="children"?gn(a,m):io(a,u,m,d)}switch(o){case"input":nl(a,i);break;case"textarea":Jd(a,i);break;case"select":var p=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?ys(a,!!i.multiple,x,!1):p!==!!i.multiple&&(i.defaultValue!=null?ys(a,!!i.multiple,i.defaultValue,!0):ys(a,!!i.multiple,i.multiple?[]:"",!1))}a[Cn]=i}catch(v){De(t,t.return,v)}}break;case 6:if(Ct(e,t),Rt(t),n&4){if(t.stateNode===null)throw Error(W(162));a=t.stateNode,i=t.memoizedProps;try{a.nodeValue=i}catch(v){De(t,t.return,v)}}break;case 3:if(Ct(e,t),Rt(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{jn(e.containerInfo)}catch(v){De(t,t.return,v)}break;case 4:Ct(e,t),Rt(t);break;case 13:Ct(e,t),Rt(t),a=t.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(Uo=Fe())),n&4&&rd(t);break;case 22:if(u=s!==null&&s.memoizedState!==null,t.mode&1?(Ke=(d=Ke)||u,Ct(e,t),Ke=d):Ct(e,t),Rt(t),n&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(re=t,u=t.child;u!==null;){for(m=re=u;re!==null;){switch(p=re,x=p.child,p.tag){case 0:case 11:case 14:case 15:dn(4,p,p.return);break;case 1:ps(p,p.return);var f=p.stateNode;if(typeof f.componentWillUnmount=="function"){n=p,s=p.return;try{e=n,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(v){De(n,s,v)}}break;case 5:ps(p,p.return);break;case 22:if(p.memoizedState!==null){nd(m);continue}}x!==null?(x.return=p,re=x):nd(m)}u=u.sibling}e:for(u=null,m=t;;){if(m.tag===5){if(u===null){u=m;try{a=m.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=m.stateNode,c=m.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=eu("display",l))}catch(v){De(t,t.return,v)}}}else if(m.tag===6){if(u===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(v){De(t,t.return,v)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;u===m&&(u=null),m=m.return}u===m&&(u=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Ct(e,t),Rt(t),n&4&&rd(t);break;case 21:break;default:Ct(e,t),Rt(t)}}function Rt(t){var e=t.flags;if(e&2){try{e:{for(var s=t.return;s!==null;){if(Cm(s)){var n=s;break e}s=s.return}throw Error(W(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(gn(a,""),n.flags&=-33);var i=td(t);Ml(t,i,a);break;case 3:case 4:var l=n.stateNode.containerInfo,o=td(t);Il(t,o,l);break;default:throw Error(W(161))}}catch(c){De(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function kf(t,e,s){re=t,Pm(t)}function Pm(t,e,s){for(var n=(t.mode&1)!==0;re!==null;){var a=re,i=a.child;if(a.tag===22&&n){var l=a.memoizedState!==null||ra;if(!l){var o=a.alternate,c=o!==null&&o.memoizedState!==null||Ke;o=ra;var d=Ke;if(ra=l,(Ke=c)&&!d)for(re=a;re!==null;)l=re,c=l.child,l.tag===22&&l.memoizedState!==null?ad(a):c!==null?(c.return=l,re=c):ad(a);for(;i!==null;)re=i,Pm(i),i=i.sibling;re=a,ra=o,Ke=d}sd(t)}else a.subtreeFlags&8772&&i!==null?(i.return=a,re=i):sd(t)}}function sd(t){for(;re!==null;){var e=re;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ke||ri(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Ke)if(s===null)n.componentDidMount();else{var a=e.elementType===e.type?s.memoizedProps:Et(e.type,s.memoizedProps);n.componentDidUpdate(a,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&zc(e,i,n);break;case 3:var l=e.updateQueue;if(l!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}zc(e,l,s)}break;case 5:var o=e.stateNode;if(s===null&&e.flags&4){s=o;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var m=u.dehydrated;m!==null&&jn(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(W(163))}Ke||e.flags&512&&Rl(e)}catch(p){De(e,e.return,p)}}if(e===t){re=null;break}if(s=e.sibling,s!==null){s.return=e.return,re=s;break}re=e.return}}function nd(t){for(;re!==null;){var e=re;if(e===t){re=null;break}var s=e.sibling;if(s!==null){s.return=e.return,re=s;break}re=e.return}}function ad(t){for(;re!==null;){var e=re;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{ri(4,e)}catch(c){De(e,s,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var a=e.return;try{n.componentDidMount()}catch(c){De(e,a,c)}}var i=e.return;try{Rl(e)}catch(c){De(e,i,c)}break;case 5:var l=e.return;try{Rl(e)}catch(c){De(e,l,c)}}}catch(c){De(e,e.return,c)}if(e===t){re=null;break}var o=e.sibling;if(o!==null){o.return=e.return,re=o;break}re=e.return}}var Cf=Math.ceil,Ma=tr.ReactCurrentDispatcher,Io=tr.ReactCurrentOwner,bt=tr.ReactCurrentBatchConfig,xe=0,qe=null,Oe=null,He=0,ct=0,gs=Cr(0),Ie=0,Ln=null,Vr=0,si=0,Mo=0,un=null,rt=null,Uo=0,Ds=1/0,Vt=null,Ua=!1,Ul=null,br=null,sa=!1,hr=null,za=0,mn=0,zl=null,ga=-1,ya=0;function Ye(){return xe&6?Fe():ga!==-1?ga:ga=Fe()}function vr(t){return t.mode&1?xe&2&&He!==0?He&-He:cf.transition!==null?(ya===0&&(ya=hu()),ya):(t=pe,t!==0||(t=window.event,t=t===void 0?16:vu(t.type)),t):1}function At(t,e,s,n){if(50<mn)throw mn=0,zl=null,Error(W(185));On(t,s,n),(!(xe&2)||t!==qe)&&(t===qe&&(!(xe&2)&&(si|=s),Ie===4&&dr(t,He)),lt(t,n),s===1&&xe===0&&!(e.mode&1)&&(Ds=Fe()+500,Za&&Sr()))}function lt(t,e){var s=t.callbackNode;ox(t,e);var n=_a(t,t===qe?He:0);if(n===0)s!==null&&xc(s),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(s!=null&&xc(s),e===1)t.tag===0?of(id.bind(null,t)):Mu(id.bind(null,t)),sf(function(){!(xe&6)&&Sr()}),s=null;else{switch(xu(n)){case 1:s=mo;break;case 4:s=uu;break;case 16:s=Na;break;case 536870912:s=mu;break;default:s=Na}s=Rm(s,Tm.bind(null,t))}t.callbackPriority=e,t.callbackNode=s}}function Tm(t,e){if(ga=-1,ya=0,xe&6)throw Error(W(327));var s=t.callbackNode;if(Ns()&&t.callbackNode!==s)return null;var n=_a(t,t===qe?He:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=qa(t,n);else{e=n;var a=xe;xe|=2;var i=Lm();(qe!==t||He!==e)&&(Vt=null,Ds=Fe()+500,Mr(t,e));do try{Pf();break}catch(o){Dm(t,o)}while(!0);ko(),Ma.current=i,xe=a,Oe!==null?e=0:(qe=null,He=0,e=Ie)}if(e!==0){if(e===2&&(a=xl(t),a!==0&&(n=a,e=ql(t,a))),e===1)throw s=Ln,Mr(t,0),dr(t,n),lt(t,Fe()),s;if(e===6)dr(t,n);else{if(a=t.current.alternate,!(n&30)&&!Sf(a)&&(e=qa(t,n),e===2&&(i=xl(t),i!==0&&(n=i,e=ql(t,i))),e===1))throw s=Ln,Mr(t,0),dr(t,n),lt(t,Fe()),s;switch(t.finishedWork=a,t.finishedLanes=n,e){case 0:case 1:throw Error(W(345));case 2:Fr(t,rt,Vt);break;case 3:if(dr(t,n),(n&130023424)===n&&(e=Uo+500-Fe(),10<e)){if(_a(t,0)!==0)break;if(a=t.suspendedLanes,(a&n)!==n){Ye(),t.pingedLanes|=t.suspendedLanes&a;break}t.timeoutHandle=wl(Fr.bind(null,t,rt,Vt),e);break}Fr(t,rt,Vt);break;case 4:if(dr(t,n),(n&4194240)===n)break;for(e=t.eventTimes,a=-1;0<n;){var l=31-Ft(n);i=1<<l,l=e[l],l>a&&(a=l),n&=~i}if(n=a,n=Fe()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Cf(n/1960))-n,10<n){t.timeoutHandle=wl(Fr.bind(null,t,rt,Vt),n);break}Fr(t,rt,Vt);break;case 5:Fr(t,rt,Vt);break;default:throw Error(W(329))}}}return lt(t,Fe()),t.callbackNode===s?Tm.bind(null,t):null}function ql(t,e){var s=un;return t.current.memoizedState.isDehydrated&&(Mr(t,e).flags|=256),t=qa(t,e),t!==2&&(e=rt,rt=s,e!==null&&Bl(e)),t}function Bl(t){rt===null?rt=t:rt.push.apply(rt,t)}function Sf(t){for(var e=t;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var n=0;n<s.length;n++){var a=s[n],i=a.getSnapshot;a=a.value;try{if(!Ot(i(),a))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function dr(t,e){for(e&=~Mo,e&=~si,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var s=31-Ft(e),n=1<<s;t[s]=-1,e&=~n}}function id(t){if(xe&6)throw Error(W(327));Ns();var e=_a(t,0);if(!(e&1))return lt(t,Fe()),null;var s=qa(t,e);if(t.tag!==0&&s===2){var n=xl(t);n!==0&&(e=n,s=ql(t,n))}if(s===1)throw s=Ln,Mr(t,0),dr(t,e),lt(t,Fe()),s;if(s===6)throw Error(W(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Fr(t,rt,Vt),lt(t,Fe()),null}function zo(t,e){var s=xe;xe|=1;try{return t(e)}finally{xe=s,xe===0&&(Ds=Fe()+500,Za&&Sr())}}function Gr(t){hr!==null&&hr.tag===0&&!(xe&6)&&Ns();var e=xe;xe|=1;var s=bt.transition,n=pe;try{if(bt.transition=null,pe=1,t)return t()}finally{pe=n,bt.transition=s,xe=e,!(xe&6)&&Sr()}}function qo(){ct=gs.current,_e(gs)}function Mr(t,e){t.finishedWork=null,t.finishedLanes=0;var s=t.timeoutHandle;if(s!==-1&&(t.timeoutHandle=-1,rf(s)),Oe!==null)for(s=Oe.return;s!==null;){var n=s;switch(wo(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Pa();break;case 3:Ps(),_e(at),_e(Qe),Do();break;case 5:To(n);break;case 4:Ps();break;case 13:_e(Ee);break;case 19:_e(Ee);break;case 10:Co(n.type._context);break;case 22:case 23:qo()}s=s.return}if(qe=t,Oe=t=jr(t.current,null),He=ct=e,Ie=0,Ln=null,Mo=si=Vr=0,rt=un=null,Rr!==null){for(e=0;e<Rr.length;e++)if(s=Rr[e],n=s.interleaved,n!==null){s.interleaved=null;var a=n.next,i=s.pending;if(i!==null){var l=i.next;i.next=a,n.next=l}s.pending=n}Rr=null}return t}function Dm(t,e){do{var s=Oe;try{if(ko(),xa.current=Ia,Ra){for(var n=Pe.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}Ra=!1}if(Hr=0,ze=Re=Pe=null,cn=!1,Pn=0,Io.current=null,s===null||s.return===null){Ie=1,Ln=e,Oe=null;break}e:{var i=t,l=s.return,o=s,c=e;if(e=He,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=o,m=u.tag;if(!(u.mode&1)&&(m===0||m===11||m===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var x=Wc(l);if(x!==null){x.flags&=-257,Xc(x,l,o,i,e),x.mode&1&&Gc(i,d,e),e=x,c=d;var f=e.updateQueue;if(f===null){var v=new Set;v.add(c),e.updateQueue=v}else f.add(c);break e}else{if(!(e&1)){Gc(i,d,e),Bo();break e}c=Error(W(426))}}else if(Ce&&o.mode&1){var j=Wc(l);if(j!==null){!(j.flags&65536)&&(j.flags|=256),Xc(j,l,o,i,e),No(Ts(c,o));break e}}i=c=Ts(c,o),Ie!==4&&(Ie=2),un===null?un=[i]:un.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var h=xm(i,c,e);Uc(i,h);break e;case 1:o=c;var y=i.type,g=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(br===null||!br.has(g)))){i.flags|=65536,e&=-e,i.lanes|=e;var C=fm(i,o,e);Uc(i,C);break e}}i=i.return}while(i!==null)}Am(s)}catch(M){e=M,Oe===s&&s!==null&&(Oe=s=s.return);continue}break}while(!0)}function Lm(){var t=Ma.current;return Ma.current=Ia,t===null?Ia:t}function Bo(){(Ie===0||Ie===3||Ie===2)&&(Ie=4),qe===null||!(Vr&268435455)&&!(si&268435455)||dr(qe,He)}function qa(t,e){var s=xe;xe|=2;var n=Lm();(qe!==t||He!==e)&&(Vt=null,Mr(t,e));do try{Ef();break}catch(a){Dm(t,a)}while(!0);if(ko(),xe=s,Ma.current=n,Oe!==null)throw Error(W(261));return qe=null,He=0,Ie}function Ef(){for(;Oe!==null;)Fm(Oe)}function Pf(){for(;Oe!==null&&!Zh();)Fm(Oe)}function Fm(t){var e=$m(t.alternate,t,ct);t.memoizedProps=t.pendingProps,e===null?Am(t):Oe=e,Io.current=null}function Am(t){var e=t;do{var s=e.alternate;if(t=e.return,e.flags&32768){if(s=wf(s,e),s!==null){s.flags&=32767,Oe=s;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ie=6,Oe=null;return}}else if(s=jf(s,e,ct),s!==null){Oe=s;return}if(e=e.sibling,e!==null){Oe=e;return}Oe=e=t}while(e!==null);Ie===0&&(Ie=5)}function Fr(t,e,s){var n=pe,a=bt.transition;try{bt.transition=null,pe=1,Tf(t,e,s,n)}finally{bt.transition=a,pe=n}return null}function Tf(t,e,s,n){do Ns();while(hr!==null);if(xe&6)throw Error(W(327));s=t.finishedWork;var a=t.finishedLanes;if(s===null)return null;if(t.finishedWork=null,t.finishedLanes=0,s===t.current)throw Error(W(177));t.callbackNode=null,t.callbackPriority=0;var i=s.lanes|s.childLanes;if(cx(t,i),t===qe&&(Oe=qe=null,He=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||sa||(sa=!0,Rm(Na,function(){return Ns(),null})),i=(s.flags&15990)!==0,s.subtreeFlags&15990||i){i=bt.transition,bt.transition=null;var l=pe;pe=1;var o=xe;xe|=4,Io.current=null,_f(t,s),Em(s,t),Kx(vl),ka=!!bl,vl=bl=null,t.current=s,kf(s),ex(),xe=o,pe=l,bt.transition=i}else t.current=s;if(sa&&(sa=!1,hr=t,za=a),i=t.pendingLanes,i===0&&(br=null),sx(s.stateNode),lt(t,Fe()),e!==null)for(n=t.onRecoverableError,s=0;s<e.length;s++)a=e[s],n(a.value,{componentStack:a.stack,digest:a.digest});if(Ua)throw Ua=!1,t=Ul,Ul=null,t;return za&1&&t.tag!==0&&Ns(),i=t.pendingLanes,i&1?t===zl?mn++:(mn=0,zl=t):mn=0,Sr(),null}function Ns(){if(hr!==null){var t=xu(za),e=bt.transition,s=pe;try{if(bt.transition=null,pe=16>t?16:t,hr===null)var n=!1;else{if(t=hr,hr=null,za=0,xe&6)throw Error(W(331));var a=xe;for(xe|=4,re=t.current;re!==null;){var i=re,l=i.child;if(re.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var d=o[c];for(re=d;re!==null;){var u=re;switch(u.tag){case 0:case 11:case 15:dn(8,u,i)}var m=u.child;if(m!==null)m.return=u,re=m;else for(;re!==null;){u=re;var p=u.sibling,x=u.return;if(km(u),u===d){re=null;break}if(p!==null){p.return=x,re=p;break}re=x}}}var f=i.alternate;if(f!==null){var v=f.child;if(v!==null){f.child=null;do{var j=v.sibling;v.sibling=null,v=j}while(v!==null)}}re=i}}if(i.subtreeFlags&2064&&l!==null)l.return=i,re=l;else e:for(;re!==null;){if(i=re,i.flags&2048)switch(i.tag){case 0:case 11:case 15:dn(9,i,i.return)}var h=i.sibling;if(h!==null){h.return=i.return,re=h;break e}re=i.return}}var y=t.current;for(re=y;re!==null;){l=re;var g=l.child;if(l.subtreeFlags&2064&&g!==null)g.return=l,re=g;else e:for(l=y;re!==null;){if(o=re,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:ri(9,o)}}catch(M){De(o,o.return,M)}if(o===l){re=null;break e}var C=o.sibling;if(C!==null){C.return=o.return,re=C;break e}re=o.return}}if(xe=a,Sr(),zt&&typeof zt.onPostCommitFiberRoot=="function")try{zt.onPostCommitFiberRoot(Xa,t)}catch{}n=!0}return n}finally{pe=s,bt.transition=e}}return!1}function ld(t,e,s){e=Ts(s,e),e=xm(t,e,1),t=yr(t,e,1),e=Ye(),t!==null&&(On(t,1,e),lt(t,e))}function De(t,e,s){if(t.tag===3)ld(t,t,s);else for(;e!==null;){if(e.tag===3){ld(e,t,s);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(br===null||!br.has(n))){t=Ts(s,t),t=fm(e,t,1),e=yr(e,t,1),t=Ye(),e!==null&&(On(e,1,t),lt(e,t));break}}e=e.return}}function Df(t,e,s){var n=t.pingCache;n!==null&&n.delete(e),e=Ye(),t.pingedLanes|=t.suspendedLanes&s,qe===t&&(He&s)===s&&(Ie===4||Ie===3&&(He&130023424)===He&&500>Fe()-Uo?Mr(t,0):Mo|=s),lt(t,e)}function Om(t,e){e===0&&(t.mode&1?(e=Wn,Wn<<=1,!(Wn&130023424)&&(Wn=4194304)):e=1);var s=Ye();t=Zt(t,e),t!==null&&(On(t,e,s),lt(t,s))}function Lf(t){var e=t.memoizedState,s=0;e!==null&&(s=e.retryLane),Om(t,s)}function Ff(t,e){var s=0;switch(t.tag){case 13:var n=t.stateNode,a=t.memoizedState;a!==null&&(s=a.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(W(314))}n!==null&&n.delete(e),Om(t,s)}var $m;$m=function(t,e,s){if(t!==null)if(t.memoizedProps!==e.pendingProps||at.current)nt=!0;else{if(!(t.lanes&s)&&!(e.flags&128))return nt=!1,vf(t,e,s);nt=!!(t.flags&131072)}else nt=!1,Ce&&e.flags&1048576&&Uu(e,La,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;pa(t,e),t=e.pendingProps;var a=Cs(e,Qe.current);ws(e,s),a=Fo(null,e,n,t,a,s);var i=Ao();return e.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,it(n)?(i=!0,Ta(e)):i=!1,e.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,Eo(e),a.updater=ti,e.stateNode=a,a._reactInternals=e,Pl(e,n,t,s),e=Ll(null,e,n,!0,i,s)):(e.tag=0,Ce&&i&&jo(e),Je(null,e,a,s),e=e.child),e;case 16:n=e.elementType;e:{switch(pa(t,e),t=e.pendingProps,a=n._init,n=a(n._payload),e.type=n,a=e.tag=Of(n),t=Et(n,t),a){case 0:e=Dl(null,e,n,t,s);break e;case 1:e=Jc(null,e,n,t,s);break e;case 11:e=Kc(null,e,n,t,s);break e;case 14:e=Qc(null,e,n,Et(n.type,t),s);break e}throw Error(W(306,n,""))}return e;case 0:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:Et(n,a),Dl(t,e,n,a,s);case 1:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:Et(n,a),Jc(t,e,n,a,s);case 3:e:{if(bm(e),t===null)throw Error(W(387));n=e.pendingProps,i=e.memoizedState,a=i.element,Gu(t,e),Oa(e,n,null,s);var l=e.memoizedState;if(n=l.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){a=Ts(Error(W(423)),e),e=Yc(t,e,n,s,a);break e}else if(n!==a){a=Ts(Error(W(424)),e),e=Yc(t,e,n,s,a);break e}else for(dt=gr(e.stateNode.containerInfo.firstChild),ut=e,Ce=!0,Dt=null,s=Hu(e,null,n,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ss(),n===a){e=er(t,e,s);break e}Je(t,e,n,s)}e=e.child}return e;case 5:return Wu(e),t===null&&Cl(e),n=e.type,a=e.pendingProps,i=t!==null?t.memoizedProps:null,l=a.children,jl(n,a)?l=null:i!==null&&jl(n,i)&&(e.flags|=32),ym(t,e),Je(t,e,l,s),e.child;case 6:return t===null&&Cl(e),null;case 13:return vm(t,e,s);case 4:return Po(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Es(e,null,n,s):Je(t,e,n,s),e.child;case 11:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:Et(n,a),Kc(t,e,n,a,s);case 7:return Je(t,e,e.pendingProps,s),e.child;case 8:return Je(t,e,e.pendingProps.children,s),e.child;case 12:return Je(t,e,e.pendingProps.children,s),e.child;case 10:e:{if(n=e.type._context,a=e.pendingProps,i=e.memoizedProps,l=a.value,je(Fa,n._currentValue),n._currentValue=l,i!==null)if(Ot(i.value,l)){if(i.children===a.children&&!at.current){e=er(t,e,s);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){l=i.child;for(var c=o.firstContext;c!==null;){if(c.context===n){if(i.tag===1){c=Qt(-1,s&-s),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=s,c=i.alternate,c!==null&&(c.lanes|=s),Sl(i.return,s,e),o.lanes|=s;break}c=c.next}}else if(i.tag===10)l=i.type===e.type?null:i.child;else if(i.tag===18){if(l=i.return,l===null)throw Error(W(341));l.lanes|=s,o=l.alternate,o!==null&&(o.lanes|=s),Sl(l,s,e),l=i.sibling}else l=i.child;if(l!==null)l.return=i;else for(l=i;l!==null;){if(l===e){l=null;break}if(i=l.sibling,i!==null){i.return=l.return,l=i;break}l=l.return}i=l}Je(t,e,a.children,s),e=e.child}return e;case 9:return a=e.type,n=e.pendingProps.children,ws(e,s),a=wt(a),n=n(a),e.flags|=1,Je(t,e,n,s),e.child;case 14:return n=e.type,a=Et(n,e.pendingProps),a=Et(n.type,a),Qc(t,e,n,a,s);case 15:return pm(t,e,e.type,e.pendingProps,s);case 17:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:Et(n,a),pa(t,e),e.tag=1,it(n)?(t=!0,Ta(e)):t=!1,ws(e,s),hm(e,n,a),Pl(e,n,a,s),Ll(null,e,n,!0,t,s);case 19:return jm(t,e,s);case 22:return gm(t,e,s)}throw Error(W(156,e.tag))};function Rm(t,e){return du(t,e)}function Af(t,e,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yt(t,e,s,n){return new Af(t,e,s,n)}function Ho(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Of(t){if(typeof t=="function")return Ho(t)?1:0;if(t!=null){if(t=t.$$typeof,t===oo)return 11;if(t===co)return 14}return 2}function jr(t,e){var s=t.alternate;return s===null?(s=yt(t.tag,e,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=e,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&14680064,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s}function ba(t,e,s,n,a,i){var l=2;if(n=t,typeof t=="function")Ho(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case ls:return Ur(s.children,a,i,e);case lo:l=8,a|=8;break;case Zi:return t=yt(12,s,e,a|2),t.elementType=Zi,t.lanes=i,t;case el:return t=yt(13,s,e,a),t.elementType=el,t.lanes=i,t;case tl:return t=yt(19,s,e,a),t.elementType=tl,t.lanes=i,t;case Wd:return ni(s,a,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Vd:l=10;break e;case Gd:l=9;break e;case oo:l=11;break e;case co:l=14;break e;case ir:l=16,n=null;break e}throw Error(W(130,t==null?t:typeof t,""))}return e=yt(l,s,e,a),e.elementType=t,e.type=n,e.lanes=i,e}function Ur(t,e,s,n){return t=yt(7,t,n,e),t.lanes=s,t}function ni(t,e,s,n){return t=yt(22,t,n,e),t.elementType=Wd,t.lanes=s,t.stateNode={isHidden:!1},t}function qi(t,e,s){return t=yt(6,t,null,e),t.lanes=s,t}function Bi(t,e,s){return e=yt(4,t.children!==null?t.children:[],t.key,e),e.lanes=s,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function $f(t,e,s,n,a){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ni(0),this.expirationTimes=Ni(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ni(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Vo(t,e,s,n,a,i,l,o,c){return t=new $f(t,e,s,o,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=yt(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Eo(i),t}function Rf(t,e,s){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:is,key:n==null?null:""+n,children:t,containerInfo:e,implementation:s}}function Im(t){if(!t)return Nr;t=t._reactInternals;e:{if(Kr(t)!==t||t.tag!==1)throw Error(W(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(it(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(W(171))}if(t.tag===1){var s=t.type;if(it(s))return Iu(t,s,e)}return e}function Mm(t,e,s,n,a,i,l,o,c){return t=Vo(s,n,!0,t,a,i,l,o,c),t.context=Im(null),s=t.current,n=Ye(),a=vr(s),i=Qt(n,a),i.callback=e??null,yr(s,i,a),t.current.lanes=a,On(t,a,n),lt(t,n),t}function ai(t,e,s,n){var a=e.current,i=Ye(),l=vr(a);return s=Im(s),e.context===null?e.context=s:e.pendingContext=s,e=Qt(i,l),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=yr(a,e,l),t!==null&&(At(t,a,l,i),ha(t,a,l)),l}function Ba(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function od(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<e?s:e}}function Go(t,e){od(t,e),(t=t.alternate)&&od(t,e)}function If(){return null}var Um=typeof reportError=="function"?reportError:function(t){console.error(t)};function Wo(t){this._internalRoot=t}ii.prototype.render=Wo.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(W(409));ai(t,e,null,null)};ii.prototype.unmount=Wo.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Gr(function(){ai(null,t,null,null)}),e[Yt]=null}};function ii(t){this._internalRoot=t}ii.prototype.unstable_scheduleHydration=function(t){if(t){var e=gu();t={blockedOn:null,target:t,priority:e};for(var s=0;s<cr.length&&e!==0&&e<cr[s].priority;s++);cr.splice(s,0,t),s===0&&bu(t)}};function Xo(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function li(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function cd(){}function Mf(t,e,s,n,a){if(a){if(typeof n=="function"){var i=n;n=function(){var d=Ba(l);i.call(d)}}var l=Mm(e,n,t,0,null,!1,!1,"",cd);return t._reactRootContainer=l,t[Yt]=l.current,_n(t.nodeType===8?t.parentNode:t),Gr(),l}for(;a=t.lastChild;)t.removeChild(a);if(typeof n=="function"){var o=n;n=function(){var d=Ba(c);o.call(d)}}var c=Vo(t,0,!1,null,null,!1,!1,"",cd);return t._reactRootContainer=c,t[Yt]=c.current,_n(t.nodeType===8?t.parentNode:t),Gr(function(){ai(e,c,s,n)}),c}function oi(t,e,s,n,a){var i=s._reactRootContainer;if(i){var l=i;if(typeof a=="function"){var o=a;a=function(){var c=Ba(l);o.call(c)}}ai(e,l,t,a)}else l=Mf(s,e,t,a,n);return Ba(l)}fu=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var s=Zs(e.pendingLanes);s!==0&&(ho(e,s|1),lt(e,Fe()),!(xe&6)&&(Ds=Fe()+500,Sr()))}break;case 13:Gr(function(){var n=Zt(t,1);if(n!==null){var a=Ye();At(n,t,1,a)}}),Go(t,1)}};xo=function(t){if(t.tag===13){var e=Zt(t,134217728);if(e!==null){var s=Ye();At(e,t,134217728,s)}Go(t,134217728)}};pu=function(t){if(t.tag===13){var e=vr(t),s=Zt(t,e);if(s!==null){var n=Ye();At(s,t,e,n)}Go(t,e)}};gu=function(){return pe};yu=function(t,e){var s=pe;try{return pe=t,e()}finally{pe=s}};ul=function(t,e,s){switch(e){case"input":if(nl(t,s),e=s.name,s.type==="radio"&&e!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var n=s[e];if(n!==t&&n.form===t.form){var a=Ya(n);if(!a)throw Error(W(90));Kd(n),nl(n,a)}}}break;case"textarea":Jd(t,s);break;case"select":e=s.value,e!=null&&ys(t,!!s.multiple,e,!1)}};nu=zo;au=Gr;var Uf={usingClientEntryPoint:!1,Events:[Rn,us,Ya,ru,su,zo]},Ks={findFiberByHostInstance:$r,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zf={bundleType:Ks.bundleType,version:Ks.version,rendererPackageName:Ks.rendererPackageName,rendererConfig:Ks.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ou(t),t===null?null:t.stateNode},findFiberByHostInstance:Ks.findFiberByHostInstance||If,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var na=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!na.isDisabled&&na.supportsFiber)try{Xa=na.inject(zf),zt=na}catch{}}xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Uf;xt.createPortal=function(t,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Xo(e))throw Error(W(200));return Rf(t,e,null,s)};xt.createRoot=function(t,e){if(!Xo(t))throw Error(W(299));var s=!1,n="",a=Um;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(a=e.onRecoverableError)),e=Vo(t,1,!1,null,null,s,!1,n,a),t[Yt]=e.current,_n(t.nodeType===8?t.parentNode:t),new Wo(e)};xt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(W(188)):(t=Object.keys(t).join(","),Error(W(268,t)));return t=ou(e),t=t===null?null:t.stateNode,t};xt.flushSync=function(t){return Gr(t)};xt.hydrate=function(t,e,s){if(!li(e))throw Error(W(200));return oi(null,t,e,!0,s)};xt.hydrateRoot=function(t,e,s){if(!Xo(t))throw Error(W(405));var n=s!=null&&s.hydratedSources||null,a=!1,i="",l=Um;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(i=s.identifierPrefix),s.onRecoverableError!==void 0&&(l=s.onRecoverableError)),e=Mm(e,null,t,1,s??null,a,!1,i,l),t[Yt]=e.current,_n(t),n)for(t=0;t<n.length;t++)s=n[t],a=s._getVersion,a=a(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,a]:e.mutableSourceEagerHydrationData.push(s,a);return new ii(e)};xt.render=function(t,e,s){if(!li(e))throw Error(W(200));return oi(null,t,e,!1,s)};xt.unmountComponentAtNode=function(t){if(!li(t))throw Error(W(40));return t._reactRootContainer?(Gr(function(){oi(null,null,t,!1,function(){t._reactRootContainer=null,t[Yt]=null})}),!0):!1};xt.unstable_batchedUpdates=zo;xt.unstable_renderSubtreeIntoContainer=function(t,e,s,n){if(!li(s))throw Error(W(200));if(t==null||t._reactInternals===void 0)throw Error(W(38));return oi(t,e,s,!1,n)};xt.version="18.3.1-next-f1338f8080-20240426";function zm(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(zm)}catch(t){console.error(t)}}zm(),zd.exports=xt;var qf=zd.exports,qm,dd=qf;qm=dd.createRoot,dd.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Bf={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hf=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),fe=(t,e)=>{const s=N.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:o="",children:c,...d},u)=>N.createElement("svg",{ref:u,...Bf,width:a,height:a,stroke:n,strokeWidth:l?Number(i)*24/Number(a):i,className:["lucide",`lucide-${Hf(t)}`,o].join(" "),...d},[...e.map(([m,p])=>N.createElement(m,p)),...Array.isArray(c)?c:[c]]));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=fe("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=fe("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=fe("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=fe("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=fe("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=fe("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=fe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=fe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=fe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=fe("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=fe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hi=fe("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=fe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=fe("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=fe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=fe("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gf=fe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=fe("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=fe("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=fe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=fe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=fe("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=fe("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=fe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=fe("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wf=fe("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=fe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xf=fe("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=fe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=fe("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kf=fe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=fe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=fe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Qf="modulepreload",Jf=function(t){return"/"+t},ud={},Mn=function(e,s,n){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),o=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(c=>{if(c=Jf(c),c in ud)return;ud[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":Qf,d||(m.as="script"),m.crossOrigin="",m.href=c,o&&m.setAttribute("nonce",o),document.head.appendChild(m),d)return new Promise((p,x)=>{m.addEventListener("load",p),m.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return a.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},Yf=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>Mn(async()=>{const{default:n}=await Promise.resolve().then(()=>Ms);return{default:n}},void 0).then(({default:n})=>n(...s)):e=fetch,(...s)=>e(...s)};class Jo extends Error{constructor(e,s="FunctionsError",n){super(e),this.name=s,this.context=n}}class Zf extends Jo{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class md extends Jo{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class hd extends Jo{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Vl;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Vl||(Vl={}));var ep=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};class tp{constructor(e,{headers:s={},customFetch:n,region:a=Vl.Any}={}){this.url=e,this.headers=s,this.region=a,this.fetch=Yf(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,s={}){var n;return ep(this,void 0,void 0,function*(){try{const{headers:a,method:i,body:l}=s;let o={},{region:c}=s;c||(c=this.region);const d=new URL(`${this.url}/${e}`);c&&c!=="any"&&(o["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let u;l&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=l):typeof l=="string"?(o["Content-Type"]="text/plain",u=l):typeof FormData<"u"&&l instanceof FormData?u=l:(o["Content-Type"]="application/json",u=JSON.stringify(l)));const m=yield this.fetch(d.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),a),body:u}).catch(v=>{throw new Zf(v)}),p=m.headers.get("x-relay-error");if(p&&p==="true")throw new md(m);if(!m.ok)throw new hd(m);let x=((n=m.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),f;return x==="application/json"?f=yield m.json():x==="application/octet-stream"?f=yield m.blob():x==="text/event-stream"?f=m:x==="multipart/form-data"?f=yield m.formData():f=yield m.text(),{data:f,error:null,response:m}}catch(a){return{data:null,error:a,response:a instanceof hd||a instanceof md?a.context:void 0}}})}}var st={},Yo={},ci={},Un={},di={},ui={},rp=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Os=rp();const sp=Os.fetch,Bm=Os.fetch.bind(Os),Hm=Os.Headers,np=Os.Request,ap=Os.Response,Ms=Object.freeze(Object.defineProperty({__proto__:null,Headers:Hm,Request:np,Response:ap,default:Bm,fetch:sp},Symbol.toStringTag,{value:"Module"})),ip=fh(Ms);var mi={};Object.defineProperty(mi,"__esModule",{value:!0});let lp=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};mi.default=lp;var Vm=jt&&jt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ui,"__esModule",{value:!0});const op=Vm(ip),cp=Vm(mi);let dp=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=op.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,s){return this.headers=Object.assign({},this.headers),this.headers[e]=s,this}then(e,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let a=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var l,o,c;let d=null,u=null,m=null,p=i.status,x=i.statusText;if(i.ok){if(this.method!=="HEAD"){const h=await i.text();h===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=h:u=JSON.parse(h))}const v=(l=this.headers.Prefer)===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),j=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");v&&j&&j.length>1&&(m=parseInt(j[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,m=null,p=406,x="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const v=await i.text();try{d=JSON.parse(v),Array.isArray(d)&&i.status===404&&(u=[],d=null,p=200,x="OK")}catch{i.status===404&&v===""?(p=204,x="No Content"):d={message:v}}if(d&&this.isMaybeSingle&&(!((c=d==null?void 0:d.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,p=200,x="OK"),d&&this.shouldThrowOnError)throw new cp.default(d)}return{error:d,data:u,count:m,status:p,statusText:x}});return this.shouldThrowOnError||(a=a.catch(i=>{var l,o,c;return{error:{message:`${(l=i==null?void 0:i.name)!==null&&l!==void 0?l:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),a.then(e,s)}returns(){return this}overrideTypes(){return this}};ui.default=dp;var up=jt&&jt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(di,"__esModule",{value:!0});const mp=up(ui);let hp=class extends mp.default{select(e){let s=!1;const n=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:s=!0,nullsFirst:n,foreignTable:a,referencedTable:i=a}={}){const l=i?`${i}.order`:"order",o=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${o?`${o},`:""}${e}.${s?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:s,referencedTable:n=s}={}){const a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${e}`),this}range(e,s,{foreignTable:n,referencedTable:a=n}={}){const i=typeof a>"u"?"offset":`${a}.offset`,l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(l,`${s-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:s=!1,settings:n=!1,buffers:a=!1,wal:i=!1,format:l="text"}={}){var o;const c=[e?"analyze":null,s?"verbose":null,n?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${d}"; options=${c};`,l==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};di.default=hp;var xp=jt&&jt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Un,"__esModule",{value:!0});const fp=xp(di);let pp=class extends fp.default{eq(e,s){return this.url.searchParams.append(e,`eq.${s}`),this}neq(e,s){return this.url.searchParams.append(e,`neq.${s}`),this}gt(e,s){return this.url.searchParams.append(e,`gt.${s}`),this}gte(e,s){return this.url.searchParams.append(e,`gte.${s}`),this}lt(e,s){return this.url.searchParams.append(e,`lt.${s}`),this}lte(e,s){return this.url.searchParams.append(e,`lte.${s}`),this}like(e,s){return this.url.searchParams.append(e,`like.${s}`),this}likeAllOf(e,s){return this.url.searchParams.append(e,`like(all).{${s.join(",")}}`),this}likeAnyOf(e,s){return this.url.searchParams.append(e,`like(any).{${s.join(",")}}`),this}ilike(e,s){return this.url.searchParams.append(e,`ilike.${s}`),this}ilikeAllOf(e,s){return this.url.searchParams.append(e,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(e,s){return this.url.searchParams.append(e,`ilike(any).{${s.join(",")}}`),this}is(e,s){return this.url.searchParams.append(e,`is.${s}`),this}in(e,s){const n=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cs.{${s.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(s)}`),this}containedBy(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cd.{${s.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(s)}`),this}rangeGt(e,s){return this.url.searchParams.append(e,`sr.${s}`),this}rangeGte(e,s){return this.url.searchParams.append(e,`nxl.${s}`),this}rangeLt(e,s){return this.url.searchParams.append(e,`sl.${s}`),this}rangeLte(e,s){return this.url.searchParams.append(e,`nxr.${s}`),this}rangeAdjacent(e,s){return this.url.searchParams.append(e,`adj.${s}`),this}overlaps(e,s){return typeof s=="string"?this.url.searchParams.append(e,`ov.${s}`):this.url.searchParams.append(e,`ov.{${s.join(",")}}`),this}textSearch(e,s,{config:n,type:a}={}){let i="";a==="plain"?i="pl":a==="phrase"?i="ph":a==="websearch"&&(i="w");const l=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${i}fts${l}.${s}`),this}match(e){return Object.entries(e).forEach(([s,n])=>{this.url.searchParams.append(s,`eq.${n}`)}),this}not(e,s,n){return this.url.searchParams.append(e,`not.${s}.${n}`),this}or(e,{foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.or`:"or";return this.url.searchParams.append(a,`(${e})`),this}filter(e,s,n){return this.url.searchParams.append(e,`${s}.${n}`),this}};Un.default=pp;var gp=jt&&jt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ci,"__esModule",{value:!0});const Qs=gp(Un);let yp=class{constructor(e,{headers:s={},schema:n,fetch:a}){this.url=e,this.headers=s,this.schema=n,this.fetch=a}select(e,{head:s=!1,count:n}={}){const a=s?"HEAD":"GET";let i=!1;const l=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",l),n&&(this.headers.Prefer=`count=${n}`),new Qs.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:s,defaultToNull:n=!0}={}){const a="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),s&&i.push(`count=${s}`),n||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const l=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(l.length>0){const o=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new Qs.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:s,ignoreDuplicates:n=!1,count:a,defaultToNull:i=!0}={}){const l="POST",o=[`resolution=${n?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&o.push(this.headers.Prefer),a&&o.push(`count=${a}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const c=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new Qs.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:s}={}){const n="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new Qs.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const s="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new Qs.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};ci.default=yp;var hi={},xi={};Object.defineProperty(xi,"__esModule",{value:!0});xi.version=void 0;xi.version="0.0.0-automated";Object.defineProperty(hi,"__esModule",{value:!0});hi.DEFAULT_HEADERS=void 0;const bp=xi;hi.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${bp.version}`};var Gm=jt&&jt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Yo,"__esModule",{value:!0});const vp=Gm(ci),jp=Gm(Un),wp=hi;let Np=class Wm{constructor(e,{headers:s={},schema:n,fetch:a}={}){this.url=e,this.headers=Object.assign(Object.assign({},wp.DEFAULT_HEADERS),s),this.schemaName=n,this.fetch=a}from(e){const s=new URL(`${this.url}/${e}`);return new vp.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Wm(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,s={},{head:n=!1,get:a=!1,count:i}={}){let l;const o=new URL(`${this.url}/rpc/${e}`);let c;n||a?(l=n?"HEAD":"GET",Object.entries(s).filter(([u,m])=>m!==void 0).map(([u,m])=>[u,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([u,m])=>{o.searchParams.append(u,m)})):(l="POST",c=s);const d=Object.assign({},this.headers);return i&&(d.Prefer=`count=${i}`),new jp.default({method:l,url:o,headers:d,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};Yo.default=Np;var Us=jt&&jt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(st,"__esModule",{value:!0});st.PostgrestError=st.PostgrestBuilder=st.PostgrestTransformBuilder=st.PostgrestFilterBuilder=st.PostgrestQueryBuilder=st.PostgrestClient=void 0;const Xm=Us(Yo);st.PostgrestClient=Xm.default;const Km=Us(ci);st.PostgrestQueryBuilder=Km.default;const Qm=Us(Un);st.PostgrestFilterBuilder=Qm.default;const Jm=Us(di);st.PostgrestTransformBuilder=Jm.default;const Ym=Us(ui);st.PostgrestBuilder=Ym.default;const Zm=Us(mi);st.PostgrestError=Zm.default;var _p=st.default={PostgrestClient:Xm.default,PostgrestQueryBuilder:Km.default,PostgrestFilterBuilder:Qm.default,PostgrestTransformBuilder:Jm.default,PostgrestBuilder:Ym.default,PostgrestError:Zm.default};const{PostgrestClient:kp,PostgrestQueryBuilder:Vg,PostgrestFilterBuilder:Gg,PostgrestTransformBuilder:Wg,PostgrestBuilder:Xg,PostgrestError:Kg}=_p;function Cp(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Sp=Cp(),Ep="2.11.15",Pp=`realtime-js/${Ep}`,Tp="1.0.0",eh=1e4,Dp=1e3;var xn;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(xn||(xn={}));var Xe;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Xe||(Xe={}));var Tt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Tt||(Tt={}));var Gl;(function(t){t.websocket="websocket"})(Gl||(Gl={}));var Or;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Or||(Or={}));class Lp{constructor(){this.HEADER_LENGTH=1}decode(e,s){return e.constructor===ArrayBuffer?s(this._binaryDecode(e)):s(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const s=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,s,n)}_decodeBroadcast(e,s,n){const a=s.getUint8(1),i=s.getUint8(2);let l=this.HEADER_LENGTH+2;const o=n.decode(e.slice(l,l+a));l=l+a;const c=n.decode(e.slice(l,l+i));l=l+i;const d=JSON.parse(n.decode(e.slice(l,e.byteLength)));return{ref:null,topic:o,event:c,payload:d}}}class th{constructor(e,s){this.callback=e,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ve;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ve||(ve={}));const xd=(t,e,s={})=>{var n;const a=(n=s.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((i,l)=>(i[l]=Fp(l,t,e,a),i),{})},Fp=(t,e,s,n)=>{const a=e.find(o=>o.name===t),i=a==null?void 0:a.type,l=s[t];return i&&!n.includes(i)?rh(i,l):Wl(l)},rh=(t,e)=>{if(t.charAt(0)==="_"){const s=t.slice(1,t.length);return Rp(e,s)}switch(t){case ve.bool:return Ap(e);case ve.float4:case ve.float8:case ve.int2:case ve.int4:case ve.int8:case ve.numeric:case ve.oid:return Op(e);case ve.json:case ve.jsonb:return $p(e);case ve.timestamp:return Ip(e);case ve.abstime:case ve.date:case ve.daterange:case ve.int4range:case ve.int8range:case ve.money:case ve.reltime:case ve.text:case ve.time:case ve.timestamptz:case ve.timetz:case ve.tsrange:case ve.tstzrange:return Wl(e);default:return Wl(e)}},Wl=t=>t,Ap=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Op=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},$p=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},Rp=(t,e)=>{if(typeof t!="string")return t;const s=t.length-1,n=t[s];if(t[0]==="{"&&n==="}"){let i;const l=t.slice(1,s);try{i=JSON.parse("["+l+"]")}catch{i=l?l.split(","):[]}return i.map(o=>rh(e,o))}return t},Ip=t=>typeof t=="string"?t.replace(" ","T"):t,sh=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Vi{constructor(e,s,n={},a=eh){this.channel=e,this.event=s,this.payload=n,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,s){var n;return this._hasReceived(e)&&s((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:s}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(s))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var fd;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(fd||(fd={}));class fn{constructor(e,s){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},a=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=fn.syncState(this.state,a,i,l),this.pendingDiffs.forEach(c=>{this.state=fn.syncDiff(this.state,c,i,l)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},a=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=fn.syncDiff(this.state,a,i,l),o())}),this.onJoin((a,i,l)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:l})}),this.onLeave((a,i,l)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:l})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,s,n,a){const i=this.cloneDeep(e),l=this.transformState(s),o={},c={};return this.map(i,(d,u)=>{l[d]||(c[d]=u)}),this.map(l,(d,u)=>{const m=i[d];if(m){const p=u.map(j=>j.presence_ref),x=m.map(j=>j.presence_ref),f=u.filter(j=>x.indexOf(j.presence_ref)<0),v=m.filter(j=>p.indexOf(j.presence_ref)<0);f.length>0&&(o[d]=f),v.length>0&&(c[d]=v)}else o[d]=u}),this.syncDiff(i,{joins:o,leaves:c},n,a)}static syncDiff(e,s,n,a){const{joins:i,leaves:l}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return n||(n=()=>{}),a||(a=()=>{}),this.map(i,(o,c)=>{var d;const u=(d=e[o])!==null&&d!==void 0?d:[];if(e[o]=this.cloneDeep(c),u.length>0){const m=e[o].map(x=>x.presence_ref),p=u.filter(x=>m.indexOf(x.presence_ref)<0);e[o].unshift(...p)}n(o,u,c)}),this.map(l,(o,c)=>{let d=e[o];if(!d)return;const u=c.map(m=>m.presence_ref);d=d.filter(m=>u.indexOf(m.presence_ref)<0),e[o]=d,a(o,d,c),d.length===0&&delete e[o]}),e}static map(e,s){return Object.getOwnPropertyNames(e).map(n=>s(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((s,n)=>{const a=e[n];return"metas"in a?s[n]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[n]=a,s},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var pd;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(pd||(pd={}));var gd;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(gd||(gd={}));var Gt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Gt||(Gt={}));class Zo{constructor(e,s={config:{}},n){this.topic=e,this.params=s,this.socket=n,this.bindings={},this.state=Xe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new Vi(this,Tt.join,this.params,this.timeout),this.rejoinTimer=new th(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Xe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Xe.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Xe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Xe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Tt.reply,{},(a,i)=>{this._trigger(this._replyEventName(i),a)}),this.presence=new fn(this),this.broadcastEndpointURL=sh(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,s=this.timeout){var n,a;if(this.socket.isConnected()||this.socket.connect(),this.state==Xe.closed){const{config:{broadcast:i,presence:l,private:o}}=this.params;this._onError(u=>e==null?void 0:e(Gt.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(Gt.CLOSED));const c={},d={broadcast:i,presence:l,postgres_changes:(a=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&a!==void 0?a:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:u})=>{var m;if(this.socket.setAuth(),u===void 0){e==null||e(Gt.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,x=(m=p==null?void 0:p.length)!==null&&m!==void 0?m:0,f=[];for(let v=0;v<x;v++){const j=p[v],{filter:{event:h,schema:y,table:g,filter:C}}=j,M=u&&u[v];if(M&&M.event===h&&M.schema===y&&M.table===g&&M.filter===C)f.push(Object.assign(Object.assign({},j),{id:M.id}));else{this.unsubscribe(),this.state=Xe.errored,e==null||e(Gt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e(Gt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Xe.errored,e==null||e(Gt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Gt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,s={}){return await this.send({type:"presence",event:"track",payload:e},s.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,s,n){return this._on(e,s,n)}async send(e,s={}){var n,a;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:l}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:l,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var l,o,c;const d=this._push(e.type,e,s.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(l=this.params)===null||l===void 0?void 0:l.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Xe.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Tt.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(a=>{n=new Vi(this,Tt.leave,{},e),n.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,s,n){const a=new AbortController,i=setTimeout(()=>a.abort(),n),l=await this.socket.fetch(e,Object.assign(Object.assign({},s),{signal:a.signal}));return clearTimeout(i),l}_push(e,s,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Vi(this,e,s,n);return this._canPush()?a.send():(a.startTimeout(),this.pushBuffer.push(a)),a}_onMessage(e,s,n){return s}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,s,n){var a,i;const l=e.toLocaleLowerCase(),{close:o,error:c,leave:d,join:u}=Tt;if(n&&[o,c,d,u].indexOf(l)>=0&&n!==this._joinRef())return;let p=this._onMessage(l,s,n);if(s&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(l)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(x=>{var f,v,j;return((f=x.filter)===null||f===void 0?void 0:f.event)==="*"||((j=(v=x.filter)===null||v===void 0?void 0:v.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===l}).map(x=>x.callback(p,n)):(i=this.bindings[l])===null||i===void 0||i.filter(x=>{var f,v,j,h,y,g;if(["broadcast","presence","postgres_changes"].includes(l))if("id"in x){const C=x.id,M=(f=x.filter)===null||f===void 0?void 0:f.event;return C&&((v=s.ids)===null||v===void 0?void 0:v.includes(C))&&(M==="*"||(M==null?void 0:M.toLocaleLowerCase())===((j=s.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const C=(y=(h=x==null?void 0:x.filter)===null||h===void 0?void 0:h.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return C==="*"||C===((g=s==null?void 0:s.event)===null||g===void 0?void 0:g.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===l}).map(x=>{if(typeof p=="object"&&"ids"in p){const f=p.data,{schema:v,table:j,commit_timestamp:h,type:y,errors:g}=f;p=Object.assign(Object.assign({},{schema:v,table:j,commit_timestamp:h,eventType:y,new:{},old:{},errors:g}),this._getPayloadRecords(f))}x.callback(p,n)})}_isClosed(){return this.state===Xe.closed}_isJoined(){return this.state===Xe.joined}_isJoining(){return this.state===Xe.joining}_isLeaving(){return this.state===Xe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,s,n){const a=e.toLocaleLowerCase(),i={type:a,filter:s,callback:n};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(e,s){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Zo.isEqual(a.filter,s))}),this}static isEqual(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const n in e)if(e[n]!==s[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Tt.close,{},e)}_onError(e){this._on(Tt.error,{},s=>e(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Xe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const s={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(s.new=xd(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(s.old=xd(e.columns,e.old_record)),s}}const yd=()=>{},Mp=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Up{constructor(e,s){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=eh,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=yd,this.ref=0,this.logger=yd,this.conn=null,this.sendBuffer=[],this.serializer=new Lp,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let l;return i?l=i:typeof fetch>"u"?l=(...o)=>Mn(async()=>{const{default:c}=await Promise.resolve().then(()=>Ms);return{default:c}},void 0).then(({default:c})=>c(...o)):l=fetch,(...o)=>l(...o)},this.endPoint=`${e}/${Gl.websocket}`,this.httpEndpoint=sh(e),s!=null&&s.transport?this.transport=s.transport:this.transport=null,s!=null&&s.params&&(this.params=s.params),s!=null&&s.timeout&&(this.timeout=s.timeout),s!=null&&s.logger&&(this.logger=s.logger),(s!=null&&s.logLevel||s!=null&&s.log_level)&&(this.logLevel=s.logLevel||s.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),s!=null&&s.heartbeatIntervalMs&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const a=(n=s==null?void 0:s.params)===null||n===void 0?void 0:n.apikey;if(a&&(this.accessTokenValue=a,this.apiKey=a),this.reconnectAfterMs=s!=null&&s.reconnectAfterMs?s.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=s!=null&&s.encode?s.encode:(i,l)=>l(JSON.stringify(i)),this.decode=s!=null&&s.decode?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new th(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(s==null?void 0:s.fetch),s!=null&&s.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(s==null?void 0:s.worker)||!1,this.workerUrl=s==null?void 0:s.workerUrl}this.accessToken=(s==null?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Sp),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Tp}))}disconnect(e,s){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,s??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const s=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const e=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,s,n){this.logger(e,s,n)}connectionState(){switch(this.conn&&this.conn.readyState){case xn.connecting:return Or.Connecting;case xn.open:return Or.Open;case xn.closing:return Or.Closing;default:return Or.Closed}}isConnected(){return this.connectionState()===Or.Open}channel(e,s={config:{}}){const n=`realtime:${e}`,a=this.getChannels().find(i=>i.topic===n);if(a)return a;{const i=new Zo(`realtime:${e}`,s,this);return this.channels.push(i),i}}push(e){const{topic:s,event:n,payload:a,ref:i}=e,l=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${s} ${n} (${i})`,a),this.isConnected()?l():this.sendBuffer.push(l)}async setAuth(e=null){let s=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(n=>{const a={access_token:s,version:Pp};s&&n.updateJoinPayload(a),n.joinedOnce&&n._isJoined()&&n._push(Tt.access_token,{access_token:s})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Dp,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let s=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${e}"`),s.unsubscribe())}_remove(e){this.channels=this.channels.filter(s=>s.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,s=>{let{topic:n,event:a,payload:i,ref:l}=s;n==="phoenix"&&a==="phx_reply"&&this.heartbeatCallback(s.payload.status=="ok"?"ok":"error"),l&&l===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${n} ${a} ${l&&"("+l+")"||""}`,i),Array.from(this.channels).filter(o=>o._isMember(n)).forEach(o=>o._trigger(a,i,l)),this.stateChangeCallbacks.message.forEach(o=>o(s))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(s=>s(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(s=>s(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Tt.error))}_appendParams(e,s){if(Object.keys(s).length===0)return e;const n=e.match(/\?/)?"&":"?",a=new URLSearchParams(s);return`${e}${n}${a}`}_workerObjectUrl(e){let s;if(e)s=e;else{const n=new Blob([Mp],{type:"application/javascript"});s=URL.createObjectURL(n)}return s}}class ec extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ue(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class zp extends ec{constructor(e,s){super(e),this.name="StorageApiError",this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Xl extends ec{constructor(e,s){super(e),this.name="StorageUnknownError",this.originalError=s}}var qp=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};const nh=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>Mn(async()=>{const{default:n}=await Promise.resolve().then(()=>Ms);return{default:n}},void 0).then(({default:n})=>n(...s)):e=fetch,(...s)=>e(...s)},Bp=()=>qp(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Mn(()=>Promise.resolve().then(()=>Ms),void 0)).Response:Response}),Kl=t=>{if(Array.isArray(t))return t.map(s=>Kl(s));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([s,n])=>{const a=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[a]=Kl(n)}),e};var Jr=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};const Gi=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Hp=(t,e,s)=>Jr(void 0,void 0,void 0,function*(){const n=yield Bp();t instanceof n&&!(s!=null&&s.noResolveJson)?t.json().then(a=>{e(new zp(Gi(a),t.status||500))}).catch(a=>{e(new Xl(Gi(a),a))}):e(new Xl(Gi(t),t))}),Vp=(t,e,s,n)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n&&(a.body=JSON.stringify(n)),Object.assign(Object.assign({},a),s))};function zn(t,e,s,n,a,i){return Jr(this,void 0,void 0,function*(){return new Promise((l,o)=>{t(s,Vp(e,n,a,i)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>l(c)).catch(c=>Hp(c,o,n))})})}function Va(t,e,s,n){return Jr(this,void 0,void 0,function*(){return zn(t,"GET",e,s,n)})}function or(t,e,s,n,a){return Jr(this,void 0,void 0,function*(){return zn(t,"POST",e,n,a,s)})}function Gp(t,e,s,n,a){return Jr(this,void 0,void 0,function*(){return zn(t,"PUT",e,n,a,s)})}function Wp(t,e,s,n){return Jr(this,void 0,void 0,function*(){return zn(t,"HEAD",e,Object.assign(Object.assign({},s),{noResolveJson:!0}),n)})}function ah(t,e,s,n,a){return Jr(this,void 0,void 0,function*(){return zn(t,"DELETE",e,n,a,s)})}var tt=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};const Xp={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},bd={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Kp{constructor(e,s={},n,a){this.url=e,this.headers=s,this.bucketId=n,this.fetch=nh(a)}uploadOrUpdate(e,s,n,a){return tt(this,void 0,void 0,function*(){try{let i;const l=Object.assign(Object.assign({},bd),a);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(l.upsert)});const c=l.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=n,o["cache-control"]=`max-age=${l.cacheControl}`,o["content-type"]=l.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a!=null&&a.headers&&(o=Object.assign(Object.assign({},o),a.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),m=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:o},l!=null&&l.duplex?{duplex:l.duplex}:{})),p=yield m.json();return m.ok?{data:{path:d,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(Ue(i))return{data:null,error:i};throw i}})}upload(e,s,n){return tt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,s,n)})}uploadToSignedUrl(e,s,n,a){return tt(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),l=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${l}`);o.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:bd.upsert},a),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const m=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),p=yield m.json();return m.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(c){if(Ue(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,s){return tt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const a=Object.assign({},this.headers);s!=null&&s.upsert&&(a["x-upsert"]="true");const i=yield or(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:a}),l=new URL(this.url+i.url),o=l.searchParams.get("token");if(!o)throw new ec("No token returned by API");return{data:{signedUrl:l.toString(),path:e,token:o},error:null}}catch(n){if(Ue(n))return{data:null,error:n};throw n}})}update(e,s,n){return tt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,s,n)})}move(e,s,n){return tt(this,void 0,void 0,function*(){try{return{data:yield or(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}copy(e,s,n){return tt(this,void 0,void 0,function*(){try{return{data:{path:(yield or(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}createSignedUrl(e,s,n){return tt(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),i=yield or(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:s},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const l=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${l}`)},{data:i,error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}createSignedUrls(e,s,n){return tt(this,void 0,void 0,function*(){try{const a=yield or(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:e},{headers:this.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:a.map(l=>Object.assign(Object.assign({},l),{signedUrl:l.signedURL?encodeURI(`${this.url}${l.signedURL}${i}`):null})),error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}download(e,s){return tt(this,void 0,void 0,function*(){const a=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),l=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Va(this.fetch,`${this.url}/${a}/${o}${l}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(Ue(o))return{data:null,error:o};throw o}})}info(e){return tt(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{const n=yield Va(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:Kl(n),error:null}}catch(n){if(Ue(n))return{data:null,error:n};throw n}})}exists(e){return tt(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{return yield Wp(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Ue(n)&&n instanceof Xl){const a=n.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,s){const n=this._getFinalPath(e),a=[],i=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&a.push(i);const o=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&a.push(c);let d=a.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${d}`)}}}remove(e){return tt(this,void 0,void 0,function*(){try{return{data:yield ah(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(s){if(Ue(s))return{data:null,error:s};throw s}})}list(e,s,n){return tt(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},Xp),s),{prefix:e||""});return{data:yield or(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},n),error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const s=[];return e.width&&s.push(`width=${e.width}`),e.height&&s.push(`height=${e.height}`),e.resize&&s.push(`resize=${e.resize}`),e.format&&s.push(`format=${e.format}`),e.quality&&s.push(`quality=${e.quality}`),s.join("&")}}const Qp="2.7.1",Jp={"X-Client-Info":`storage-js/${Qp}`};var Zr=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};class Yp{constructor(e,s={},n){this.url=e,this.headers=Object.assign(Object.assign({},Jp),s),this.fetch=nh(n)}listBuckets(){return Zr(this,void 0,void 0,function*(){try{return{data:yield Va(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ue(e))return{data:null,error:e};throw e}})}getBucket(e){return Zr(this,void 0,void 0,function*(){try{return{data:yield Va(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(s){if(Ue(s))return{data:null,error:s};throw s}})}createBucket(e,s={public:!1}){return Zr(this,void 0,void 0,function*(){try{return{data:yield or(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Ue(n))return{data:null,error:n};throw n}})}updateBucket(e,s){return Zr(this,void 0,void 0,function*(){try{return{data:yield Gp(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Ue(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Zr(this,void 0,void 0,function*(){try{return{data:yield or(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(Ue(s))return{data:null,error:s};throw s}})}deleteBucket(e){return Zr(this,void 0,void 0,function*(){try{return{data:yield ah(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(s){if(Ue(s))return{data:null,error:s};throw s}})}}class Zp extends Yp{constructor(e,s={},n){super(e,s,n)}from(e){return new Kp(this.url,this.headers,e,this.fetch)}}const e0="2.52.0";let rn="";typeof Deno<"u"?rn="deno":typeof document<"u"?rn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?rn="react-native":rn="node";const t0={"X-Client-Info":`supabase-js-${rn}/${e0}`},r0={headers:t0},s0={schema:"public"},n0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},a0={};var i0=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};const l0=t=>{let e;return t?e=t:typeof fetch>"u"?e=Bm:e=fetch,(...s)=>e(...s)},o0=()=>typeof Headers>"u"?Hm:Headers,c0=(t,e,s)=>{const n=l0(s),a=o0();return(i,l)=>i0(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:t;let d=new a(l==null?void 0:l.headers);return d.has("apikey")||d.set("apikey",t),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(i,Object.assign(Object.assign({},l),{headers:d}))})};var d0=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};function u0(t){return t.endsWith("/")?t:t+"/"}function m0(t,e){var s,n;const{db:a,auth:i,realtime:l,global:o}=t,{db:c,auth:d,realtime:u,global:m}=e,p={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),l),global:Object.assign(Object.assign(Object.assign({},m),o),{headers:Object.assign(Object.assign({},(s=m==null?void 0:m.headers)!==null&&s!==void 0?s:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>d0(this,void 0,void 0,function*(){return""})};return t.accessToken?p.accessToken=t.accessToken:delete p.accessToken,p}const ih="2.71.1",ns=30*1e3,Ql=3,Wi=Ql*ns,h0="http://localhost:9999",x0="supabase.auth.token",f0={"X-Client-Info":`gotrue-js/${ih}`},Jl="X-Supabase-Api-Version",lh={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},p0=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,g0=10*60*1e3;class tc extends Error{constructor(e,s,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=n}}function de(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class y0 extends tc{constructor(e,s,n){super(e,s,n),this.name="AuthApiError",this.status=s,this.code=n}}function b0(t){return de(t)&&t.name==="AuthApiError"}class oh extends tc{constructor(e,s){super(e),this.name="AuthUnknownError",this.originalError=s}}class Er extends tc{constructor(e,s,n,a){super(e,n,a),this.name=s,this.status=n}}class ar extends Er{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function v0(t){return de(t)&&t.name==="AuthSessionMissingError"}class aa extends Er{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ia extends Er{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class la extends Er{constructor(e,s=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function j0(t){return de(t)&&t.name==="AuthImplicitGrantRedirectError"}class vd extends Er{constructor(e,s=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Yl extends Er{constructor(e,s){super(e,"AuthRetryableFetchError",s,void 0)}}function Xi(t){return de(t)&&t.name==="AuthRetryableFetchError"}class jd extends Er{constructor(e,s,n){super(e,"AuthWeakPasswordError",s,"weak_password"),this.reasons=n}}class Zl extends Er{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ga="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),wd=` 	
\r=`.split(""),w0=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<wd.length;e+=1)t[wd[e].charCodeAt(0)]=-2;for(let e=0;e<Ga.length;e+=1)t[Ga[e].charCodeAt(0)]=e;return t})();function Nd(t,e,s){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;s(Ga[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;s(Ga[n]),e.queuedBits-=6}}function ch(t,e,s){const n=w0[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)s(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function _d(t){const e=[],s=l=>{e.push(String.fromCodePoint(l))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=l=>{k0(l,n,s)};for(let l=0;l<t.length;l+=1)ch(t.charCodeAt(l),a,i);return e.join("")}function N0(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function _0(t,e){for(let s=0;s<t.length;s+=1){let n=t.charCodeAt(s);if(n>55295&&n<=56319){const a=(n-55296)*1024&65535;n=(t.charCodeAt(s+1)-56320&65535|a)+65536,s+=1}N0(n,e)}}function k0(t,e,s){if(e.utf8seq===0){if(t<=127){s(t);return}for(let n=1;n<6;n+=1)if(!(t>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&s(e.codepoint)}}function C0(t){const e=[],s={queue:0,queuedBits:0},n=a=>{e.push(a)};for(let a=0;a<t.length;a+=1)ch(t.charCodeAt(a),s,n);return new Uint8Array(e)}function S0(t){const e=[];return _0(t,s=>e.push(s)),new Uint8Array(e)}function E0(t){const e=[],s={queue:0,queuedBits:0},n=a=>{e.push(a)};return t.forEach(a=>Nd(a,s,n)),Nd(null,s,n),e.join("")}function P0(t){return Math.round(Date.now()/1e3)+t}function T0(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const St=()=>typeof window<"u"&&typeof document<"u",Tr={tested:!1,writable:!1},dh=()=>{if(!St())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Tr.tested)return Tr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Tr.tested=!0,Tr.writable=!0}catch{Tr.tested=!0,Tr.writable=!1}return Tr.writable};function D0(t){const e={},s=new URL(t);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((a,i)=>{e[i]=a})}catch{}return s.searchParams.forEach((n,a)=>{e[a]=n}),e}const uh=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>Mn(async()=>{const{default:n}=await Promise.resolve().then(()=>Ms);return{default:n}},void 0).then(({default:n})=>n(...s)):e=fetch,(...s)=>e(...s)},L0=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",as=async(t,e,s)=>{await t.setItem(e,JSON.stringify(s))},Dr=async(t,e)=>{const s=await t.getItem(e);if(!s)return null;try{return JSON.parse(s)}catch{return s}},nr=async(t,e)=>{await t.removeItem(e)};class fi{constructor(){this.promise=new fi.promiseConstructor((e,s)=>{this.resolve=e,this.reject=s})}}fi.promiseConstructor=Promise;function Ki(t){const e=t.split(".");if(e.length!==3)throw new Zl("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!p0.test(e[n]))throw new Zl("JWT not in base64url format");return{header:JSON.parse(_d(e[0])),payload:JSON.parse(_d(e[1])),signature:C0(e[2]),raw:{header:e[0],payload:e[1]}}}async function F0(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function A0(t,e){return new Promise((n,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const l=await t(i);if(!e(i,null,l)){n(l);return}}catch(l){if(!e(i,l)){a(l);return}}})()})}function O0(t){return("0"+t.toString(16)).substr(-2)}function $0(){const e=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=s.length;let a="";for(let i=0;i<56;i++)a+=s.charAt(Math.floor(Math.random()*n));return a}return crypto.getRandomValues(e),Array.from(e,O0).join("")}async function R0(t){const s=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",s),a=new Uint8Array(n);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function I0(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const s=await R0(t);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function es(t,e,s=!1){const n=$0();let a=n;s&&(a+="/PASSWORD_RECOVERY"),await as(t,`${e}-code-verifier`,a);const i=await I0(n);return[i,n===i?"plain":"s256"]}const M0=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function U0(t){const e=t.headers.get(Jl);if(!e||!e.match(M0))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function z0(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function q0(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const B0=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ts(t){if(!B0.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Qi(){const t={};return new Proxy(t,{get:(e,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const n=s.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function kd(t){return JSON.parse(JSON.stringify(t))}var H0=function(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(s[n[a]]=t[n[a]]);return s};const Ar=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),V0=[502,503,504];async function Cd(t){var e;if(!L0(t))throw new Yl(Ar(t),0);if(V0.includes(t.status))throw new Yl(Ar(t),t.status);let s;try{s=await t.json()}catch(i){throw new oh(Ar(i),i)}let n;const a=U0(t);if(a&&a.getTime()>=lh["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?n=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(n=s.error_code),n){if(n==="weak_password")throw new jd(Ar(s),t.status,((e=s.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new ar}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,l)=>i&&typeof l=="string",!0))throw new jd(Ar(s),t.status,s.weak_password.reasons);throw new y0(Ar(s),t.status||500,n)}const G0=(t,e,s,n)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),s))};async function me(t,e,s,n){var a;const i=Object.assign({},n==null?void 0:n.headers);i[Jl]||(i[Jl]=lh["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const l=(a=n==null?void 0:n.query)!==null&&a!==void 0?a:{};n!=null&&n.redirectTo&&(l.redirect_to=n.redirectTo);const o=Object.keys(l).length?"?"+new URLSearchParams(l).toString():"",c=await W0(t,e,s+o,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function W0(t,e,s,n,a,i){const l=G0(e,n,a,i);let o;try{o=await t(s,Object.assign({},l))}catch(c){throw console.error(c),new Yl(Ar(c),0)}if(o.ok||await Cd(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(c){await Cd(c)}}function Ht(t){var e;let s=null;J0(t)&&(s=Object.assign({},t),t.expires_at||(s.expires_at=P0(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:s,user:n},error:null}}function Sd(t){const e=Ht(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((s,n)=>s&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function ur(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function X0(t){return{data:t,error:null}}function K0(t){const{action_link:e,email_otp:s,hashed_token:n,redirect_to:a,verification_type:i}=t,l=H0(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:s,hashed_token:n,redirect_to:a,verification_type:i},c=Object.assign({},l);return{data:{properties:o,user:c},error:null}}function Q0(t){return t}function J0(t){return t.access_token&&t.refresh_token&&t.expires_in}const Ji=["global","local","others"];var Y0=function(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(s[n[a]]=t[n[a]]);return s};class Z0{constructor({url:e="",headers:s={},fetch:n}){this.url=e,this.headers=s,this.fetch=uh(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,s=Ji[0]){if(Ji.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ji.join(", ")}`);try{return await me(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,s={}){try{return await me(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:ur})}catch(n){if(de(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:s}=e,n=Y0(e,["options"]),a=Object.assign(Object.assign({},n),s);return"newEmail"in n&&(a.new_email=n==null?void 0:n.newEmail,delete a.newEmail),await me(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:K0,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(de(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(e){try{return await me(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ur})}catch(s){if(de(s))return{data:{user:null},error:s};throw s}}async listUsers(e){var s,n,a,i,l,o,c;try{const d={nextPage:null,lastPage:0,total:0},u=await me(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(s=e==null?void 0:e.page)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:"",per_page:(i=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Q0});if(u.error)throw u.error;const m=await u.json(),p=(l=u.headers.get("x-total-count"))!==null&&l!==void 0?l:0,x=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return x.length>0&&(x.forEach(f=>{const v=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(f.split(";")[1].split("=")[1]);d[`${j}Page`]=v}),d.total=parseInt(p)),{data:Object.assign(Object.assign({},m),d),error:null}}catch(d){if(de(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){ts(e);try{return await me(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ur})}catch(s){if(de(s))return{data:{user:null},error:s};throw s}}async updateUserById(e,s){ts(e);try{return await me(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:s,headers:this.headers,xform:ur})}catch(n){if(de(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,s=!1){ts(e);try{return await me(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:s},xform:ur})}catch(n){if(de(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){ts(e.userId);try{const{data:s,error:n}=await me(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:s,error:n}}catch(s){if(de(s))return{data:null,error:s};throw s}}async _deleteFactor(e){ts(e.userId),ts(e.id);try{return{data:await me(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}}}function Ed(t={}){return{getItem:e=>t[e]||null,setItem:(e,s)=>{t[e]=s},removeItem:e=>{delete t[e]}}}function eg(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const rs={debug:!!(globalThis&&dh()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class mh extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class tg extends mh{}async function rg(t,e,s){rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),rs.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async a=>{if(a){rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await s()}finally{rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(e===0)throw rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new tg(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(rs.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}eg();const sg={url:h0,storageKey:x0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:f0,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Pd(t,e,s){return await s()}const ss={};class Fn{constructor(e){var s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Fn.nextInstanceID,Fn.nextInstanceID+=1,this.instanceID>0&&St()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},sg),e);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Z0({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=uh(a.fetch),this.lock=a.lock||Pd,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:St()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=rg:this.lock=Pd,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:dh()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ed(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Ed(this.memoryStorage)),St()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,s;return(s=(e=ss[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(e){ss[this.storageKey]=Object.assign(Object.assign({},ss[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,s;return(s=(e=ss[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ss[this.storageKey]=Object.assign(Object.assign({},ss[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ih}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const s=D0(window.location.href);let n="none";if(this._isImplicitGrantCallback(s)?n="implicit":await this._isPKCECallback(s)&&(n="pkce"),St()&&this.detectSessionInUrl&&n!=="none"){const{data:a,error:i}=await this._getSessionFromURL(s,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),j0(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:l,redirectType:o}=a;return this._debug("#_initialize()","detected session in URL",l,"redirect type",o),await this._saveSession(l),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",l):await this._notifyAllSubscribers("SIGNED_IN",l)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return de(s)?{error:s}:{error:new oh("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var s,n,a;try{const i=await me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(a=e==null?void 0:e.options)===null||a===void 0?void 0:a.captchaToken}},xform:Ht}),{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(de(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var s,n,a;try{let i;if("email"in e){const{email:u,password:m,options:p}=e;let x=null,f=null;this.flowType==="pkce"&&([x,f]=await es(this.storage,this.storageKey)),i=await me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:u,password:m,data:(s=p==null?void 0:p.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:x,code_challenge_method:f},xform:Ht})}else if("phone"in e){const{phone:u,password:m,options:p}=e;i=await me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:m,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},channel:(a=p==null?void 0:p.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:Ht})}else throw new ia("You must provide either an email or phone number and a password");const{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(de(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let s;if("email"in e){const{email:i,password:l,options:o}=e;s=await me(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Sd})}else if("phone"in e){const{phone:i,password:l,options:o}=e;s=await me(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Sd})}else throw new ia("You must provide either an email or phone number and a password");const{data:n,error:a}=s;return a?{data:{user:null,session:null},error:a}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new aa}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:a})}catch(s){if(de(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(e){var s,n,a,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:s}=e;if(s==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(e){var s,n,a,i,l,o,c,d,u,m,p,x;let f,v;if("message"in e)f=e.message,v=e.signature;else{const{chain:j,wallet:h,statement:y,options:g}=e;let C;if(St())if(typeof h=="object")C=h;else{const $=window;if("solana"in $&&typeof $.solana=="object"&&("signIn"in $.solana&&typeof $.solana.signIn=="function"||"signMessage"in $.solana&&typeof $.solana.signMessage=="function"))C=$.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof h!="object"||!(g!=null&&g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=h}const M=new URL((s=g==null?void 0:g.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in C&&C.signIn){const $=await C.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},g==null?void 0:g.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),y?{statement:y}:null));let T;if(Array.isArray($)&&$[0]&&typeof $[0]=="object")T=$[0];else if($&&typeof $=="object"&&"signedMessage"in $&&"signature"in $)T=$;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)f=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),v=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in C)||typeof C.signMessage!="function"||!("publicKey"in C)||typeof C!="object"||!C.publicKey||!("toBase58"in C.publicKey)||typeof C.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${M.host} wants you to sign in with your Solana account:`,C.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(a=(n=g==null?void 0:g.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=g==null?void 0:g.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...!((l=g==null?void 0:g.signInWithSolana)===null||l===void 0)&&l.expirationTime?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...!((o=g==null?void 0:g.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...!((c=g==null?void 0:g.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...!((d=g==null?void 0:g.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...!((m=(u=g==null?void 0:g.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||m===void 0)&&m.length?["Resources",...g.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const $=await C.signMessage(new TextEncoder().encode(f),"utf8");if(!$||!($ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=$}}try{const{data:j,error:h}=await me(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:E0(v)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(x=e.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Ht});if(h)throw h;return!j||!j.session||!j.user?{data:{user:null,session:null},error:new aa}:(j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),{data:Object.assign({},j),error:h})}catch(j){if(de(j))return{data:{user:null,session:null},error:j};throw j}}async _exchangeCodeForSession(e){const s=await Dr(this.storage,`${this.storageKey}-code-verifier`),[n,a]=(s??"").split("/");try{const{data:i,error:l}=await me(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Ht});if(await nr(this.storage,`${this.storageKey}-code-verifier`),l)throw l;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new aa}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:l})}catch(i){if(de(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:s,provider:n,token:a,access_token:i,nonce:l}=e,o=await me(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:a,access_token:i,nonce:l,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Ht}),{data:c,error:d}=o;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new aa}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(de(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(e){var s,n,a,i,l;try{if("email"in e){const{email:o,options:c}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await es(this.storage,this.storageKey));const{error:m}=await me(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in e){const{phone:o,options:c}=e,{data:d,error:u}=await me(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(l=c==null?void 0:c.channel)!==null&&l!==void 0?l:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new ia("You must provide either an email or phone number.")}catch(o){if(de(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var s,n;try{let a,i;"options"in e&&(a=(s=e.options)===null||s===void 0?void 0:s.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:l,error:o}=await me(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:Ht});if(o)throw o;if(!l)throw new Error("An error occurred on token verification.");const c=l.session,d=l.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(de(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(e){var s,n,a;try{let i=null,l=null;return this.flowType==="pkce"&&([i,l]=await es(this.storage,this.storageKey)),await me(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(s=e.options)===null||s===void 0?void 0:s.redirectTo)!==null&&n!==void 0?n:void 0}),!((a=e==null?void 0:e.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:l}),headers:this.headers,xform:X0})}catch(i){if(de(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:s},error:n}=e;if(n)throw n;if(!s)throw new ar;const{error:a}=await me(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}})}catch(e){if(de(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const s=`${this.url}/resend`;if("email"in e){const{email:n,type:a,options:i}=e,{error:l}=await me(this.fetch,"POST",s,{headers:this.headers,body:{email:n,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:l}}else if("phone"in e){const{phone:n,type:a,options:i}=e,{data:l,error:o}=await me(this.fetch,"POST",s,{headers:this.headers,body:{phone:n,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:o}}throw new ia("You must provide either an email or phone number and a type")}catch(s){if(de(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(e,s){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await n,await s()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=s();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await e(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const s=await Dr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?e=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Wi:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const l=await Dr(this.userStorage,this.storageKey+"-user");l!=null&&l.user?e.user=l.user:e.user=Qi()}if(this.storage.isServer&&e.user){let l=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,d,u)=>(!l&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:e},error:null}}const{session:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await me(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ur}):await this._useSession(async s=>{var n,a,i;const{data:l,error:o}=s;if(o)throw o;return!(!((n=l.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ar}:await me(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=l.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:ur})})}catch(s){if(de(s))return v0(s)&&(await this._removeSession(),await nr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(e,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,s))}async _updateUser(e,s={}){try{return await this._useSession(async n=>{const{data:a,error:i}=n;if(i)throw i;if(!a.session)throw new ar;const l=a.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await es(this.storage,this.storageKey));const{data:d,error:u}=await me(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:l.access_token,xform:ur});if(u)throw u;return l.user=d.user,await this._saveSession(l),await this._notifyAllSubscribers("USER_UPDATED",l),{data:{user:l.user},error:null}})}catch(n){if(de(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ar;const s=Date.now()/1e3;let n=s,a=!0,i=null;const{payload:l}=Ki(e.access_token);if(l.exp&&(n=l.exp,a=n<=s),a){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:n-s,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(de(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async s=>{var n;if(!e){const{data:l,error:o}=s;if(o)throw o;e=(n=l.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new ar;const{session:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(de(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(e,s){try{if(!St())throw new la("No browser detected.");if(e.error||e.error_description||e.error_code)throw new la(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new vd("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new la("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new vd("No code detected.");const{data:y,error:g}=await this._exchangeCodeForSession(e.code);if(g)throw g;const C=new URL(window.location.href);return C.searchParams.delete("code"),window.history.replaceState(window.history.state,"",C.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:a,access_token:i,refresh_token:l,expires_in:o,expires_at:c,token_type:d}=e;if(!i||!o||!l||!d)throw new la("No session defined in URL");const u=Math.round(Date.now()/1e3),m=parseInt(o);let p=u+m;c&&(p=parseInt(c));const x=p-u;x*1e3<=ns&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${m}s`);const f=p-m;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,p,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,p,u);const{data:v,error:j}=await this._getUser(i);if(j)throw j;const h={provider_token:n,provider_refresh_token:a,access_token:i,expires_in:m,expires_at:p,refresh_token:l,token_type:d,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:h,redirectType:e.type},error:null}}catch(n){if(de(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const s=await Dr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&s)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async s=>{var n;const{data:a,error:i}=s;if(i)return{error:i};const l=(n=a.session)===null||n===void 0?void 0:n.access_token;if(l){const{error:o}=await this.admin.signOut(l,e);if(o&&!(b0(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await nr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const s=T0(),n={id:s,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async s=>{var n,a;try{const{data:{session:i},error:l}=s;if(l)throw l;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,s={}){let n=null,a=null;this.flowType==="pkce"&&([n,a]=await es(this.storage,this.storageKey,!0));try{return await me(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:a,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(de(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:s,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=s.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}}async linkIdentity(e){var s;try{const{data:n,error:a}=await this._useSession(async i=>{var l,o,c,d,u;const{data:m,error:p}=i;if(p)throw p;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(l=e.options)===null||l===void 0?void 0:l.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await me(this.fetch,"GET",x,{headers:this.headers,jwt:(u=(d=m.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(a)throw a;return St()&&!(!((s=e.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(de(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async s=>{var n,a;const{data:i,error:l}=s;if(l)throw l;return await me(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0})})}catch(s){if(de(s))return{data:null,error:s};throw s}}async _refreshAccessToken(e){const s=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{const n=Date.now();return await A0(async a=>(a>0&&await F0(200*Math.pow(2,a-1)),this._debug(s,"refreshing attempt",a),await me(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ht})),(a,i)=>{const l=200*Math.pow(2,a);return i&&Xi(i)&&Date.now()+l-n<ns})}catch(n){if(this._debug(s,"error",n),de(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(s,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,s){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",s,"url",n),St()&&!s.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,s;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const a=await Dr(this.storage,this.storageKey);if(a&&this.userStorage){let l=await Dr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!l&&(l={user:a.user},await as(this.userStorage,this.storageKey+"-user",l)),a.user=(e=l==null?void 0:l.user)!==null&&e!==void 0?e:Qi()}else if(a&&!a.user&&!a.user){const l=await Dr(this.storage,this.storageKey+"-user");l&&(l!=null&&l.user)?(a.user=l.user,await nr(this.storage,this.storageKey+"-user"),await as(this.storage,this.storageKey,a)):a.user=Qi()}if(this._debug(n,"session from storage",a),!this._isValidSession(a)){this._debug(n,"session is not valid"),a!==null&&await this._removeSession();return}const i=((s=a.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Wi;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${Wi}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:l}=await this._callRefreshToken(a.refresh_token);l&&(console.error(l),Xi(l)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",l),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:l,error:o}=await this._getUser(a.access_token);!o&&(l!=null&&l.user)?(a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(l){console.error("Error getting user data:",l),this._debug(n,"error getting user data, skipping SIGNED_IN notification",l)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(n,"error",a),console.error(a);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var s,n;if(!e)throw new ar;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new fi;const{data:i,error:l}=await this._refreshAccessToken(e);if(l)throw l;if(!i.session)throw new ar;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(a,"error",i),de(i)){const l={session:null,error:i};return Xi(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(l),l}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,s,n=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",s,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:s});const i=[],l=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,s)}catch(c){i.push(c)}});if(await Promise.all(l),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const s=Object.assign({},e),n=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&s.user&&await as(this.userStorage,this.storageKey+"-user",{user:s.user});const a=Object.assign({},s);delete a.user;const i=kd(a);await as(this.storage,this.storageKey,i)}else{const a=kd(s);await as(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await nr(this.storage,this.storageKey),await nr(this.storage,this.storageKey+"-code-verifier"),await nr(this.storage,this.storageKey+"-user"),this.userStorage&&await nr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&St()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ns);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async s=>{const{data:{session:n}}=s;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((n.expires_at*1e3-e)/ns);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${ns}ms, refresh threshold is ${Ql} ticks`),a<=Ql&&await this._callRefreshToken(n.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof mh)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!St()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const s=`#_onVisibilityChanged(${e})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,s,n){const a=[`provider=${encodeURIComponent(s)}`];if(n!=null&&n.redirectTo&&a.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&a.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,l]=await es(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(l)}`});a.push(o.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);a.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&a.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async s=>{var n;const{data:a,error:i}=s;return i?{data:null,error:i}:await me(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(de(s))return{data:null,error:s};throw s}}async _enroll(e){try{return await this._useSession(async s=>{var n,a;const{data:i,error:l}=s;if(l)return{data:null,error:l};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:d}=await me(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(de(s))return{data:null,error:s};throw s}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:i}=s;if(i)return{data:null,error:i};const{data:l,error:o}=await me(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:o})})}catch(s){if(de(s))return{data:null,error:s};throw s}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:i}=s;return i?{data:null,error:i}:await me(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(de(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(e){const{data:s,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:s.id,code:e.code})}async _listFactors(){const{data:{user:e},error:s}=await this.getUser();if(s)return{data:null,error:s};const n=(e==null?void 0:e.factors)||[],a=n.filter(l=>l.factor_type==="totp"&&l.status==="verified"),i=n.filter(l=>l.factor_type==="phone"&&l.status==="verified");return{data:{all:n,totp:a,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var s,n;const{data:{session:a},error:i}=e;if(i)return{data:null,error:i};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=Ki(a.access_token);let o=null;l.aal&&(o=l.aal);let c=o;((n=(s=a.user.factors)===null||s===void 0?void 0:s.filter(m=>m.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=l.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,s={keys:[]}){let n=s.keys.find(o=>o.kid===e);if(n)return n;const a=Date.now();if(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+g0>a)return n;const{data:i,error:l}=await me(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(l)throw l;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,n=i.keys.find(o=>o.kid===e),!n)?null:n}async getClaims(e,s={}){try{let n=e;if(!n){const{data:x,error:f}=await this.getSession();if(f||!x.session)return{data:null,error:f};n=x.session.access_token}const{header:a,payload:i,signature:l,raw:{header:o,payload:c}}=Ki(n);s!=null&&s.allowExpired||z0(i.exp);const d=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,s!=null&&s.keys?{keys:s.keys}:s==null?void 0:s.jwks);if(!d){const{error:x}=await this.getUser(n);if(x)throw x;return{data:{claims:i,header:a,signature:l},error:null}}const u=q0(a.alg),m=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,m,l,S0(`${o}.${c}`)))throw new Zl("Invalid JWT signature");return{data:{claims:i,header:a,signature:l},error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}}}Fn.nextInstanceID=0;const ng=Fn;class ag extends ng{constructor(e){super(e)}}var ig=function(t,e,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(m){l(m)}}function c(u){try{d(n.throw(u))}catch(m){l(m)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(t,e||[])).next())})};class lg{constructor(e,s,n){var a,i,l;if(this.supabaseUrl=e,this.supabaseKey=s,!e)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const o=u0(e),c=new URL(o);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:s0,realtime:a0,auth:Object.assign(Object.assign({},n0),{storageKey:d}),global:r0},m=m0(n??{},u);this.storageKey=(a=m.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=m.global.headers)!==null&&i!==void 0?i:{},m.accessToken?(this.accessToken=m.accessToken,this.auth=new Proxy({},{get:(p,x)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(x)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((l=m.auth)!==null&&l!==void 0?l:{},this.headers,m.global.fetch),this.fetch=c0(s,this._getAccessToken.bind(this),m.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},m.realtime)),this.rest=new kp(new URL("rest/v1",c).href,{headers:this.headers,schema:m.db.schema,fetch:this.fetch}),m.accessToken||this._listenForAuthEvents()}get functions(){return new tp(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Zp(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,s={},n={}){return this.rest.rpc(e,s,n)}channel(e,s={config:{}}){return this.realtime.channel(e,s)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,s;return ig(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(s=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&s!==void 0?s:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:s,detectSessionInUrl:n,storage:a,storageKey:i,flowType:l,lock:o,debug:c},d,u){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ag({url:this.authUrl.href,headers:Object.assign(Object.assign({},m),d),storageKey:i,autoRefreshToken:e,persistSession:s,detectSessionInUrl:n,storage:a,flowType:l,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Up(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,n)=>{this._handleTokenChanged(s,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,s,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const og=(t,e,s)=>new lg(t,e,s),cg="https://fkgjtogbggzdtcamlzzv.supabase.co",dg="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrZ2p0b2diZ2d6ZHRjYW1senp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNDIwMzQsImV4cCI6MjA2ODcxODAzNH0.wE6jDPQIODOgJcmgd0kWoJzZxUumEBXR85h5190dKyU",Q=og(cg,dg),ug=({onLogin:t})=>{const[e,s]=N.useState({email:"",password:""}),[n,a]=N.useState({}),[i,l]=N.useState(!1),o=u=>{const{name:m,value:p}=u.target;s(x=>({...x,[m]:p})),n[m]&&a(x=>({...x,[m]:""}))},c=()=>{const u={};return e.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(u.email="Format d'email invalide"):u.email="L'email est requis",e.password.trim()||(u.password="Le mot de passe est requis"),a(u),Object.keys(u).length===0},d=async u=>{if(u.preventDefault(),!!c()){l(!0),a({});try{const{data:m,error:p}=await Q.auth.signInWithPassword({email:e.email,password:e.password});if(p){p.message==="Invalid login credentials"?a({general:"Email ou mot de passe incorrect"}):a({general:"Erreur de connexion. Veuillez réessayer."});return}m.user&&t()}catch(m){console.error("Login error:",m),a({general:"Erreur de connexion. Veuillez réessayer."})}finally{l(!1)}}};return r.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[r.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:r.jsx("div",{className:"flex justify-center",children:r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD",className:"w-[250px]"})})}),r.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:r.jsx("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:r.jsxs("form",{onSubmit:d,className:"space-y-6",children:[n.general&&r.jsx("div",{className:"rounded-md bg-red-50 p-4",children:r.jsx("div",{className:"text-sm text-red-700",children:n.general})}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Adresse email"}),r.jsxs("div",{className:"mt-1",children:[r.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",value:e.email,onChange:o,className:`appearance-none block w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${n.email?"border-red-300":"border-gray-300"}`,placeholder:"Entrez votre email"}),n.email&&r.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.email})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Mot de passe"}),r.jsxs("div",{className:"mt-1",children:[r.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",value:e.password,onChange:o,className:`appearance-none block w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${n.password?"border-red-300":"border-gray-300"}`,placeholder:"Entrez votre mot de passe"}),n.password&&r.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.password})]})]}),r.jsx("div",{children:r.jsxs("button",{type:"submit",disabled:i,className:"w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Vf,{className:"w-5 h-5 mr-2"}),i?"Connexion...":"Se connecter"]})})]})})})]})},mg=({onNavigateToAdd:t,onNavigateToEdit:e,onNavigateToDetails:s})=>{const[n,a]=N.useState([]),[i,l]=N.useState(!0),[o,c]=N.useState(null),[d,u]=N.useState(1),[m,p]=N.useState(""),[x,f]=N.useState(20),[v,j]=N.useState({dateFrom:"",dateTo:""}),h=async()=>{try{l(!0),c(null);const{data:w,error:R}=await Q.from("clients").select(`
          id,
          numero_client,
          nom,
          prenom,
          societe,
          ice,
          email,
          telephone,
          credit_initial,
          chiffre_affaires,
          total_paiements,
          current_debt,
          available_credit,
          total_margin,
          created_at
        `).order("societe",{ascending:!0});if(R)throw R;const L=w||[];L.sort((U,se)=>(se.current_debt||0)-(U.current_debt||0)),a(L)}catch(w){console.error("Error fetching clients:",w),c("Erreur lors du chargement des clients")}finally{l(!1)}};ye.useEffect(()=>{h()},[]);const y=(w,R)=>{j(L=>({...L,[w]:R})),u(1)},g=()=>{p(""),j({dateFrom:"",dateTo:""}),u(1)},C=()=>m||v.dateFrom||v.dateTo,M=w=>{if(!v.dateFrom&&!v.dateTo)return!0;const R=w.split("T")[0],L=!v.dateFrom||R>=v.dateFrom,U=!v.dateTo||R<=v.dateTo;return L&&U},T=n.filter(w=>w.nom.toLowerCase().includes(m.toLowerCase())||w.prenom.toLowerCase().includes(m.toLowerCase())||w.societe.toLowerCase().includes(m.toLowerCase())||w.numero_client.toLowerCase().includes(m.toLowerCase())||w.email.toLowerCase().includes(m.toLowerCase())).filter(w=>M(w.created_at)),A=Math.ceil(T.length/x),D=(d-1)*x,q=D+x,K=T.slice(D,q),J=w=>{u(w)},Z=()=>{d>1&&u(d-1)},Y=()=>{d<A&&u(d+1)},V=w=>{f(w),u(1)},I=w=>{e(w)},O=()=>{const w=["Numéro Client","Nom","Prénom","Société","ICE","Email","Téléphone","Chiffre d'Affaires (DH)","Paiements (DH)","Crédit (DH)","Avance (DH)","Marge (DH)","Date Création"],R=T.map(k=>[k.numero_client,k.nom,k.prenom,k.societe,k.ice,k.email,k.telephone,k.chiffre_affaires.toFixed(2),k.total_paiements.toFixed(2),k.current_debt.toFixed(2),k.available_credit.toFixed(2),k.total_margin.toFixed(2),new Date(k.created_at).toLocaleDateString("fr-FR")]),L=b();R.push([`TOTAUX (${T.length} clients)`,"","","","","","",L.totalChiffreAffaires.toFixed(2),L.totalPaiements.toFixed(2),L.totalCredit.toFixed(2),L.totalAvance.toFixed(2),L.totalMarge.toFixed(2),""]);const U=[w,...R].map(k=>k.map(z=>`"${z}"`).join(",")).join(`
`),se=new Blob([U],{type:"text/csv;charset=utf-8;"}),P=document.createElement("a"),B=URL.createObjectURL(se);P.setAttribute("href",B),P.setAttribute("download",`clients_${new Date().toISOString().split("T")[0]}.csv`),P.style.visibility="hidden",document.body.appendChild(P),P.click(),document.body.removeChild(P)},b=()=>({totalChiffreAffaires:T.reduce((w,R)=>w+(R.chiffre_affaires||0),0),totalPaiements:T.reduce((w,R)=>w+(R.total_paiements||0),0),totalCredit:T.reduce((w,R)=>w+(R.current_debt||0),0),totalAvance:T.reduce((w,R)=>w+(R.available_credit||0),0),totalMarge:T.reduce((w,R)=>w+(R.total_margin||0),0),count:T.length}),S=b(),E=w=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(w)+" DH";return i?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des clients..."})]})}):o?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:o}),r.jsx("button",{onClick:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Clients"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos clients et leurs informations"})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:O,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(Qr,{className:"w-4 h-4"}),"Exporter CSV (",T.length,")"]}),r.jsxs("button",{onClick:()=>window.print(),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer (",T.length,")"]}),r.jsxs("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(vt,{className:"w-5 h-5"}),"Ajouter un client"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Chiffre d'Affaires"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:E(S.totalChiffreAffaires)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Total CA clients"})]}),r.jsx(mt,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Paiements"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:E(S.totalPaiements)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Total encaissé"})]}),r.jsx(_t,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Crédit"}),r.jsx("p",{className:"text-2xl font-bold text-red-600",children:E(S.totalCredit)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Dû par clients"})]}),r.jsx(Ls,{className:"w-8 h-8 text-red-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Avance à consommer"}),r.jsx("p",{className:"text-2xl font-bold text-purple-600",children:E(S.totalAvance)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Crédit disponible"})]}),r.jsx(Fs,{className:"w-8 h-8 text-purple-600"})]})})]}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un client...",value:m,onChange:w=>{p(w.target.value),u(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtres avancés"}),C()&&r.jsxs("button",{onClick:g,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:[r.jsx(Wr,{className:"w-4 h-4"}),"Effacer tous les filtres"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client depuis (début)"}),r.jsx("input",{type:"date",id:"date-from",value:v.dateFrom,onChange:w=>y("dateFrom",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client depuis (fin)"}),r.jsx("input",{type:"date",id:"date-to",value:v.dateTo,onChange:w=>y("dateTo",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:g,className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Effacer les filtres"})})]}),C()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:T.length})," client(s) trouvé(s) avec les filtres actifs"]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["CA total: ",E(S.totalChiffreAffaires)]})]})})]}),r.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro Client"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Nom & Prénom"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Société"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Téléphone"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Chiffre d'Affaires"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Paiements"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Crédit"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Avance à consommer"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.length>0?K.map(w=>r.jsxs("tr",{onClick:()=>s(w),className:"hover:bg-gray-50 transition-colors duration-150 cursor-pointer",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:w.numero_client}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[w.prenom," ",w.nom]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w.societe}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w.telephone}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E(w.chiffre_affaires)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:E(w.total_paiements)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-red-600",children:E(w.current_debt)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600",children:E(w.available_credit)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsx("button",{onClick:R=>{R.stopPropagation(),I(w)},className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors duration-200",children:"Modifier"})})]},w.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:9,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx($e,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:m?"Aucun client trouvé":"Aucun client disponible"}),!m&&r.jsx("button",{onClick:t,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Ajouter votre premier client"})]})})})})]})})}),A>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",D+1," à ",Math.min(q,T.length)," sur ",T.length," clients"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Éléments par page:"}),r.jsxs("select",{value:x,onChange:w=>V(Number(w.target.value)),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:20,children:"20"}),r.jsx("option",{value:50,children:"50"}),r.jsx("option",{value:100,children:"100"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:Z,disabled:d===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:A},(w,R)=>R+1).map(w=>r.jsx("button",{onClick:()=>J(w),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${d===w?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:w},w)),r.jsx("button",{onClick:Y,disabled:d===A,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"hidden print:block fixed inset-0 bg-white p-8",children:[r.jsxs("div",{className:"relative text-center border-b-2 border-gray-800 pb-6 mb-8",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"absolute top-0 left-0 h-24 w-auto"}),r.jsx("p",{className:"text-lg text-gray-700 mt-2",children:"LISTE DES CLIENTS"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")," |",T.length," client(s)"]})]}),r.jsxs("table",{className:"w-full border-collapse border border-gray-800",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"N° Client"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Nom & Prénom"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Société"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Téléphone"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"CA (DH)"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Paiements (DH)"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Crédit (DH)"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Avance (DH)"})]})}),r.jsx("tbody",{children:T.map(w=>r.jsxs("tr",{children:[r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:w.numero_client}),r.jsxs("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:[w.prenom," ",w.nom]}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:w.societe}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:w.telephone}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.chiffre_affaires)}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.total_paiements)}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.current_debt)}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.available_credit)})]},w.id))}),r.jsx("tfoot",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsxs("td",{className:"border border-gray-800 px-3 py-3 font-bold text-sm",colSpan:4,children:["TOTAUX (",T.length," clients)"]}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalChiffreAffaires)}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalPaiements)}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalCredit)}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalAvance)})]})})]}),r.jsx("div",{className:"absolute bottom-8 left-8 right-8 text-center text-xs text-gray-500 border-t border-gray-300 pt-4",children:r.jsxs("p",{children:["ANTURGOOD - Système de gestion | Document généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 1cm;
            size: A4 portrait;
          }
          
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          /* Hide everything by default */
          body * {
            visibility: hidden;
          }
          
          /* Show only the print content */
          .print\\:block,
          .print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print content */
          .print\\:block {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            padding: 1cm !important;
            background: white !important;
            color: black !important;
            font-size: 12pt !important;
            line-height: 1.4 !important;
          }
          
          /* Table styling for print */
          table {
            border-collapse: collapse !important;
            width: 100% !important;
            font-size: 10pt !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 4px !important;
          }
          
          /* Page breaks */
          tbody tr {
            page-break-inside: avoid;
          }
          
          thead {
            display: table-header-group;
          }
          
          tfoot {
            display: table-footer-group;
            page-break-inside: avoid;
          }
          
          /* Hide any remaining UI elements */
          nav, aside, button:not(.print\\:block button), .print\\:hidden {
            display: none !important;
          }
        }
      `})]})},hg=({onNavigateBack:t})=>{const[e,s]=N.useState({nom:"",prenom:"",societe:"",ice:"",email:"",telephone:""}),[n,a]=N.useState({}),[i,l]=N.useState(!1),[o,c]=N.useState(""),d=async()=>{try{const{data:x,error:f}=await Q.from("clients").select("numero_client").order("created_at",{ascending:!1}).limit(1);if(f)throw f;let v=1;if(x&&x.length>0){const j=x[0].numero_client.replace("CLT-","");v=parseInt(j)+1}return`CLT-${String(v).padStart(3,"0")}`}catch(x){return console.error("Error generating client number:",x),"CLT-001"}};ye.useEffect(()=>{d().then(c)},[]);const u=x=>{const{name:f,value:v}=x.target;s(j=>({...j,[f]:v})),n[f]&&a(j=>({...j,[f]:""}))},m=()=>{const x={};return e.prenom.trim()||(x.prenom="Le prénom est requis"),e.ice.trim()&&e.ice.length!==15?x.ice="Le numéro ICE doit contenir 15 chiffres":e.ice.trim()&&!/^\d+$/.test(e.ice)&&(x.ice="Le numéro ICE ne doit contenir que des chiffres"),e.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)&&(x.email="Format d'email invalide"),e.telephone.trim()?/^(\+212|0)[5-7]\d{8}$/.test(e.telephone.replace(/\s/g,""))||(x.telephone="Format de téléphone marocain invalide"):x.telephone="Le téléphone est requis",a(x),Object.keys(x).length===0},p=async x=>{var f,v;if(x.preventDefault(),!!m()){l(!0);try{const{data:j,error:h}=await Q.from("clients").insert([{numero_client:o,nom:e.nom.trim(),prenom:e.prenom.trim(),societe:e.societe.trim(),ice:e.ice.trim(),email:e.email.trim(),telephone:e.telephone.trim()}]).select();if(h)throw h;console.log("Client saved successfully:",j),s({nom:"",prenom:"",societe:"",ice:"",email:"",telephone:""}),t()}catch(j){console.error("Error saving client:",j),j.code==="23505"?(f=j.details)!=null&&f.includes("numero_client")?a({general:"Ce numéro client existe déjà"}):(v=j.details)!=null&&v.includes("ice")?a({ice:"Ce numéro ICE est déjà utilisé"}):a({general:"Ces informations existent déjà"}):a({general:"Erreur lors de l'enregistrement. Veuillez réessayer."})}finally{l(!1)}}};return o?r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Ajouter un client"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Créez un nouveau client dans le système"})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:p,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro Client"}),r.jsx("input",{type:"text",value:o,readOnly:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ce numéro sera généré automatiquement"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prenom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prénom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"prenom",name:"prenom",value:e.prenom,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.prenom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le prénom"}),n.prenom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.prenom})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"nom",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Nom"}),r.jsx("input",{type:"text",id:"nom",name:"nom",value:e.nom,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.nom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom"}),n.nom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.nom})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"societe",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Société"}),r.jsx("input",{type:"text",id:"societe",name:"societe",value:e.societe,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.societe?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom de la société"}),n.societe&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.societe})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ice",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro ICE"}),r.jsx("input",{type:"text",id:"ice",name:"ice",value:e.ice,onChange:u,maxLength:15,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 font-mono ${n.ice?"border-red-500":"border-gray-300"}`,placeholder:"000000000000000 (15 chiffres)"}),n.ice&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.ice}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Le numéro ICE doit contenir exactement 15 chiffres"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Email"}),r.jsx("input",{type:"email",id:"email",name:"email",value:e.email,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.email?"border-red-500":"border-gray-300"}`,placeholder:"exemple@email.com"}),n.email&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.email})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"telephone",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Téléphone ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"tel",id:"telephone",name:"telephone",value:e.telephone,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.telephone?"border-red-500":"border-gray-300"}`,placeholder:"+212 6 12 34 56 78"}),n.telephone&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.telephone}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: +212 6 XX XX XX XX ou 06 XX XX XX XX"})]})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:i,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),i?"Enregistrement...":"Enregistrer le client"]})]})})]})})})]}):r.jsx("div",{className:"min-h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500",children:"Chargement..."})})},xg=({onNavigateBack:t,client:e})=>{const[s,n]=N.useState({nom:e.nom,prenom:e.prenom,societe:e.societe,ice:e.ice,email:e.email,telephone:e.telephone}),[a,i]=N.useState({}),[l,o]=N.useState(!1),c=m=>{const{name:p,value:x}=m.target;n(f=>({...f,[p]:x})),a[p]&&i(f=>({...f,[p]:""}))},d=()=>{const m={};return s.nom.trim()||(m.nom="Le nom est requis"),s.prenom.trim()||(m.prenom="Le prénom est requis"),s.ice.trim()&&s.ice.length!==15?m.ice="Le numéro ICE doit contenir 15 chiffres":s.ice.trim()&&!/^\d+$/.test(s.ice)&&(m.ice="Le numéro ICE ne doit contenir que des chiffres"),s.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)&&(m.email="Format d'email invalide"),s.telephone.trim()?/^(\+212|0)[5-7]\d{8}$/.test(s.telephone.replace(/\s/g,""))||(m.telephone="Format de téléphone marocain invalide"):m.telephone="Le téléphone est requis",i(m),Object.keys(m).length===0},u=async m=>{var p;if(m.preventDefault(),!!d()){o(!0);try{const{data:x,error:f}=await Q.from("clients").update({nom:s.nom.trim(),prenom:s.prenom.trim(),societe:s.societe.trim(),ice:s.ice.trim(),email:s.email.trim(),telephone:s.telephone.trim()}).eq("id",e.id).select();if(f)throw f;console.log("Client updated successfully:",x),alert("Client modifié avec succès!"),t()}catch(x){console.error("Error updating client:",x),x.code==="23505"?(p=x.details)!=null&&p.includes("ice")?i({ice:"Ce numéro ICE est déjà utilisé par un autre client"}):i({general:"Ces informations existent déjà"}):i({general:"Erreur lors de la modification. Veuillez réessayer."})}finally{o(!1)}}};return r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier le client"}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Modifiez les informations du client ",e.numero_client]})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:u,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro Client"}),r.jsx("input",{type:"text",value:e.numero_client,readOnly:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prenom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prénom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"prenom",name:"prenom",value:s.prenom,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.prenom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le prénom"}),a.prenom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.prenom})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"nom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"nom",name:"nom",value:s.nom,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.nom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom"}),a.nom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.nom})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"societe",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Société"}),r.jsx("input",{type:"text",id:"societe",name:"societe",value:s.societe,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.societe?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom de la société"}),a.societe&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.societe})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ice",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro ICE"}),r.jsx("input",{type:"text",id:"ice",name:"ice",value:s.ice,onChange:c,maxLength:15,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 font-mono ${a.ice?"border-red-500":"border-gray-300"}`,placeholder:"000000000000000 (15 chiffres)"}),a.ice&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.ice}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Le numéro ICE doit contenir exactement 15 chiffres"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Email"}),r.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.email?"border-red-500":"border-gray-300"}`,placeholder:"exemple@email.com"}),a.email&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.email})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"telephone",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Téléphone ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"tel",id:"telephone",name:"telephone",value:s.telephone,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.telephone?"border-red-500":"border-gray-300"}`,placeholder:"+212 6 12 34 56 78"}),a.telephone&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.telephone}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: +212 6 XX XX XX XX ou 06 XX XX XX XX"})]})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:l,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),l?"Enregistrement...":"Modifier le client"]})]})})]})})})]})},fg=({onNavigateToAdd:t,onNavigateToEdit:e,onNavigateToDetails:s})=>{const[n,a]=N.useState([]),[i,l]=N.useState(!0),[o,c]=N.useState(null),[d,u]=N.useState(1),[m,p]=N.useState(""),[x,f]=N.useState(20),[v,j]=N.useState({dateFrom:"",dateTo:""}),h=async()=>{try{l(!0),c(null);const{data:w,error:R}=await Q.from("fournisseurs").select(`
          id,
          numero_fournisseur,
          nom,
          prenom,
          societe,
          ice,
          email,
          telephone,
          created_at,
          updated_at
        `).order("societe",{ascending:!0});if(R)throw R;const L=await Promise.all((w||[]).map(async U=>{const{data:se,error:P}=await Q.from("bon_de_commande").select("total_ht").eq("fournisseur_id",U.id).neq("statut","annulee");P&&console.error("Error fetching orders for supplier:",U.id,P);const{data:B,error:k}=await Q.from("paiements_fournisseurs").select("montant").eq("fournisseur_id",U.id);k&&console.error("Error fetching payments for supplier:",U.id,k);const z=(se||[]).reduce((ge,be)=>ge+(be.total_ht||0),0),ee=(B||[]).reduce((ge,be)=>ge+(be.montant||0),0),ne=z-ee,ie=Math.max(0,ne),ue=Math.max(0,-ne);return{...U,total_commandes:z,total_paiements:ee,current_debt:ie,available_credit:ue}}));L.sort((U,se)=>{const P=(se.current_debt||0)-(U.current_debt||0);return P!==0?P:(se.available_credit||0)-(U.available_credit||0)}),a(L)}catch(w){console.error("Error fetching fournisseurs:",w),c("Erreur lors du chargement des fournisseurs")}finally{l(!1)}};ye.useEffect(()=>{h()},[]);const y=(w,R)=>{j(L=>({...L,[w]:R})),u(1)},g=()=>{p(""),j({dateFrom:"",dateTo:""}),u(1)},C=()=>m||v.dateFrom||v.dateTo,M=w=>{if(!v.dateFrom&&!v.dateTo)return!0;const R=w.split("T")[0],L=!v.dateFrom||R>=v.dateFrom,U=!v.dateTo||R<=v.dateTo;return L&&U},T=n.filter(w=>w.nom.toLowerCase().includes(m.toLowerCase())||w.prenom.toLowerCase().includes(m.toLowerCase())||w.societe.toLowerCase().includes(m.toLowerCase())||w.numero_fournisseur.toLowerCase().includes(m.toLowerCase())||w.email.toLowerCase().includes(m.toLowerCase())).filter(w=>M(w.created_at)),A=Math.ceil(T.length/x),D=(d-1)*x,q=D+x,K=T.slice(D,q),J=w=>{u(w)},Z=()=>{d>1&&u(d-1)},Y=()=>{d<A&&u(d+1)},V=w=>{f(w),u(1)},I=w=>{e(w)},O=()=>{const w=["Numéro Fournisseur","Nom","Prénom","Société","ICE","Email","Téléphone","Total Commandes (DH)","Paiements (DH)","Crédit (DH)","Avance (DH)","Date Création"],R=T.map(k=>[k.numero_fournisseur,k.nom,k.prenom,k.societe,k.ice,k.email,k.telephone,k.total_commandes.toFixed(2),k.total_paiements.toFixed(2),k.current_debt.toFixed(2),k.available_credit.toFixed(2),new Date(k.created_at).toLocaleDateString("fr-FR")]),L=b();R.push([`TOTAUX (${T.length} fournisseurs)`,"","","","","","",L.totalCommandes.toFixed(2),L.totalPaiements.toFixed(2),L.totalCredit.toFixed(2),L.totalAvance.toFixed(2),""]);const U=[w,...R].map(k=>k.map(z=>`"${z}"`).join(",")).join(`
`),se=new Blob([U],{type:"text/csv;charset=utf-8;"}),P=document.createElement("a"),B=URL.createObjectURL(se);P.setAttribute("href",B),P.setAttribute("download",`fournisseurs_${new Date().toISOString().split("T")[0]}.csv`),P.style.visibility="hidden",document.body.appendChild(P),P.click(),document.body.removeChild(P)},b=()=>({totalCommandes:T.reduce((w,R)=>w+(R.total_commandes||0),0),totalPaiements:T.reduce((w,R)=>w+(R.total_paiements||0),0),totalCredit:T.reduce((w,R)=>w+(R.current_debt||0),0),totalAvance:T.reduce((w,R)=>w+(R.available_credit||0),0),count:T.length}),S=b(),E=w=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(w)+" DH";return i?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des fournisseurs..."})]})}):o?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:o}),r.jsx("button",{onClick:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Fournisseurs"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos fournisseurs et leurs informations"})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:O,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(Qr,{className:"w-4 h-4"}),"Exporter CSV (",T.length,")"]}),r.jsxs("button",{onClick:()=>window.print(),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer (",T.length,")"]}),r.jsxs("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(vt,{className:"w-5 h-5"}),"Ajouter un fournisseur"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Commandes"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:E(S.totalCommandes)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Montant commandé"})]}),r.jsx(mt,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Paiements"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:E(S.totalPaiements)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Total payé"})]}),r.jsx(_t,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Crédit Fournisseur"}),r.jsx("p",{className:"text-2xl font-bold text-red-600",children:E(S.totalCredit)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Dû aux fournisseurs"})]}),r.jsx(Ls,{className:"w-8 h-8 text-red-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Avance à consommer"}),r.jsx("p",{className:"text-2xl font-bold text-purple-600",children:E(S.totalAvance)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Crédit disponible"})]}),r.jsx(Fs,{className:"w-8 h-8 text-purple-600"})]})})]}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un fournisseur...",value:m,onChange:w=>{p(w.target.value),u(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtres avancés"}),C()&&r.jsxs("button",{onClick:g,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:[r.jsx(Wr,{className:"w-4 h-4"}),"Effacer tous les filtres"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Fournisseur depuis (début)"}),r.jsx("input",{type:"date",id:"date-from",value:v.dateFrom,onChange:w=>y("dateFrom",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Fournisseur depuis (fin)"}),r.jsx("input",{type:"date",id:"date-to",value:v.dateTo,onChange:w=>y("dateTo",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:g,className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Effacer les filtres"})})]}),C()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:T.length})," fournisseur(s) trouvé(s) avec les filtres actifs"]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Total commandes: ",E(S.totalCommandes)]})]})})]}),r.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro Fournisseur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Nom & Prénom"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Société"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Téléphone"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total Commandes"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Paiements"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Crédit Fournisseur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Avance à consommer"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.length>0?K.map(w=>r.jsxs("tr",{onClick:()=>s(w),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:w.numero_fournisseur}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[w.prenom," ",w.nom]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w.societe}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w.telephone}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E(w.total_commandes)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:E(w.total_paiements)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-red-600",children:E(w.current_debt)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-purple-600",children:E(w.available_credit)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsx("button",{onClick:R=>{R.stopPropagation(),I(w)},className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors duration-200",children:"Modifier"})})]},w.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:9,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx($e,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:m?"Aucun fournisseur trouvé":"Aucun fournisseur disponible"}),!m&&r.jsx("button",{onClick:t,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Ajouter votre premier fournisseur"})]})})})})]})})}),A>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",D+1," à ",Math.min(q,T.length)," sur ",T.length," fournisseurs"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Éléments par page:"}),r.jsxs("select",{value:x,onChange:w=>V(Number(w.target.value)),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:20,children:"20"}),r.jsx("option",{value:50,children:"50"}),r.jsx("option",{value:100,children:"100"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:Z,disabled:d===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:A},(w,R)=>R+1).map(w=>r.jsx("button",{onClick:()=>J(w),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${d===w?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:w},w)),r.jsx("button",{onClick:Y,disabled:d===A,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"hidden print:block fixed inset-0 bg-white p-8",children:[r.jsxs("div",{className:"relative text-center border-b-2 border-gray-800 pb-6 mb-8",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"absolute top-0 left-0 h-24 w-auto"}),r.jsx("p",{className:"text-lg text-gray-700 mt-2",children:"LISTE DES FOURNISSEURS"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")," |",T.length," fournisseur(s)"]})]}),r.jsxs("table",{className:"w-full border-collapse border border-gray-800",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"N° Fournisseur"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Nom & Prénom"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Société"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Téléphone"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Commandes (DH)"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Paiements (DH)"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Crédit (DH)"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Avance (DH)"})]})}),r.jsx("tbody",{children:T.map(w=>r.jsxs("tr",{children:[r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:w.numero_fournisseur}),r.jsxs("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:[w.prenom," ",w.nom]}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:w.societe}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:w.telephone}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.total_commandes)}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.total_paiements)}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.current_debt)}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:E(w.available_credit)})]},w.id))}),r.jsx("tfoot",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsxs("td",{className:"border border-gray-800 px-3 py-3 font-bold text-sm",colSpan:4,children:["TOTAUX (",T.length," fournisseurs)"]}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalCommandes)}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalPaiements)}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalCredit)}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:E(S.totalAvance)})]})})]}),r.jsx("div",{className:"absolute bottom-8 left-8 right-8 text-center text-xs text-gray-500 border-t border-gray-300 pt-4",children:r.jsxs("p",{children:["ANTURGOOD - Système de gestion | Document généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 1cm;
            size: A4 portrait;
          }
          
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          /* Hide everything by default */
          body * {
            visibility: hidden;
          }
          
          /* Show only the print content */
          .print\\:block,
          .print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print content */
          .print\\:block {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            padding: 1cm !important;
            background: white !important;
            color: black !important;
            font-size: 12pt !important;
            line-height: 1.4 !important;
          }
          
          /* Table styling for print */
          table {
            border-collapse: collapse !important;
            width: 100% !important;
            font-size: 10pt !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 4px !important;
          }
          
          /* Page breaks */
          tbody tr {
            page-break-inside: avoid;
          }
          
          thead {
            display: table-header-group;
          }
          
          tfoot {
            display: table-footer-group;
            page-break-inside: avoid;
          }
          
          /* Hide any remaining UI elements */
          nav, aside, button:not(.print\\:block button), .print\\:hidden {
            display: none !important;
          }
        }
      `})]})},pg=({onNavigateBack:t})=>{const[e,s]=N.useState({nom:"",prenom:"",societe:"",ice:"",email:"",telephone:""}),[n,a]=N.useState({}),[i,l]=N.useState(!1),[o,c]=N.useState(""),d=async()=>{try{const{data:x,error:f}=await Q.from("fournisseurs").select("numero_fournisseur").order("created_at",{ascending:!1}).limit(1);if(f)throw f;let v=1;if(x&&x.length>0){const j=x[0].numero_fournisseur.replace("FRS-","");v=parseInt(j)+1}return`FRS-${String(v).padStart(3,"0")}`}catch(x){return console.error("Error generating fournisseur number:",x),"FRS-001"}};ye.useEffect(()=>{d().then(c)},[]);const u=x=>{const{name:f,value:v}=x.target;s(j=>({...j,[f]:v})),n[f]&&a(j=>({...j,[f]:""}))},m=()=>{const x={};return e.nom.trim()||(x.nom="Le nom est requis"),e.prenom.trim()||(x.prenom="Le prénom est requis"),e.ice.trim()&&e.ice.length!==15?x.ice="Le numéro ICE doit contenir 15 chiffres":e.ice.trim()&&!/^\d+$/.test(e.ice)&&(x.ice="Le numéro ICE ne doit contenir que des chiffres"),e.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)&&(x.email="Format d'email invalide"),e.telephone.trim()?/^(\+212|0)[5-7]\d{8}$/.test(e.telephone.replace(/\s/g,""))||(x.telephone="Format de téléphone marocain invalide"):x.telephone="Le téléphone est requis",a(x),Object.keys(x).length===0},p=async x=>{var f,v;if(x.preventDefault(),!!m()){l(!0);try{const{data:j,error:h}=await Q.from("fournisseurs").insert([{numero_fournisseur:o,nom:e.nom.trim(),prenom:e.prenom.trim(),societe:e.societe.trim(),ice:e.ice.trim(),email:e.email.trim(),telephone:e.telephone.trim()}]).select();if(h)throw h;console.log("Fournisseur saved successfully:",j),s({nom:"",prenom:"",societe:"",ice:"",email:"",telephone:""}),t()}catch(j){console.error("Error saving fournisseur:",j),j.code==="23505"?(f=j.details)!=null&&f.includes("numero_fournisseur")?a({general:"Ce numéro fournisseur existe déjà"}):(v=j.details)!=null&&v.includes("ice")?a({ice:"Ce numéro ICE est déjà utilisé"}):a({general:"Ces informations existent déjà"}):a({general:"Erreur lors de l'enregistrement. Veuillez réessayer."})}finally{l(!1)}}};return o?r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Ajouter un fournisseur"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Créez un nouveau fournisseur dans le système"})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:p,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro Fournisseur"}),r.jsx("input",{type:"text",value:o,readOnly:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ce numéro sera généré automatiquement"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prenom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prénom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"prenom",name:"prenom",value:e.prenom,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.prenom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le prénom"}),n.prenom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.prenom})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"nom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"nom",name:"nom",value:e.nom,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.nom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom"}),n.nom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.nom})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"societe",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Société"}),r.jsx("input",{type:"text",id:"societe",name:"societe",value:e.societe,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.societe?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom de la société"}),n.societe&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.societe})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ice",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro ICE"}),r.jsx("input",{type:"text",id:"ice",name:"ice",value:e.ice,onChange:u,maxLength:15,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 font-mono ${n.ice?"border-red-500":"border-gray-300"}`,placeholder:"000000000000000 (15 chiffres)"}),n.ice&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.ice}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Le numéro ICE doit contenir exactement 15 chiffres"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Email"}),r.jsx("input",{type:"email",id:"email",name:"email",value:e.email,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.email?"border-red-500":"border-gray-300"}`,placeholder:"exemple@email.com"}),n.email&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.email})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"telephone",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Téléphone ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"tel",id:"telephone",name:"telephone",value:e.telephone,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.telephone?"border-red-500":"border-gray-300"}`,placeholder:"+212 6 12 34 56 78"}),n.telephone&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.telephone}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: +212 6 XX XX XX XX ou 06 XX XX XX XX"})]})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:i,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),i?"Enregistrement...":"Enregistrer le fournisseur"]})]})})]})})})]}):r.jsx("div",{className:"min-h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500",children:"Chargement..."})})},gg=({onNavigateBack:t,fournisseur:e})=>{const[s,n]=N.useState({nom:e.nom,prenom:e.prenom,societe:e.societe,ice:e.ice,email:e.email,telephone:e.telephone}),[a,i]=N.useState({}),[l,o]=N.useState(!1),c=m=>{const{name:p,value:x}=m.target;n(f=>({...f,[p]:x})),a[p]&&i(f=>({...f,[p]:""}))},d=()=>{const m={};return s.nom.trim()||(m.nom="Le nom est requis"),s.prenom.trim()||(m.prenom="Le prénom est requis"),s.ice.trim()&&s.ice.length!==15?m.ice="Le numéro ICE doit contenir 15 chiffres":s.ice.trim()&&!/^\d+$/.test(s.ice)&&(m.ice="Le numéro ICE ne doit contenir que des chiffres"),s.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)&&(m.email="Format d'email invalide"),s.telephone.trim()?/^(\+212|0)[5-7]\d{8}$/.test(s.telephone.replace(/\s/g,""))||(m.telephone="Format de téléphone marocain invalide"):m.telephone="Le téléphone est requis",i(m),Object.keys(m).length===0},u=async m=>{var p;if(m.preventDefault(),!!d()){o(!0);try{const{data:x,error:f}=await Q.from("fournisseurs").update({nom:s.nom.trim(),prenom:s.prenom.trim(),societe:s.societe.trim(),ice:s.ice.trim(),email:s.email.trim(),telephone:s.telephone.trim()}).eq("id",e.id).select();if(f)throw f;console.log("Fournisseur updated successfully:",x),t()}catch(x){console.error("Error updating fournisseur:",x),x.code==="23505"?(p=x.details)!=null&&p.includes("ice")?i({ice:"Ce numéro ICE est déjà utilisé par un autre fournisseur"}):i({general:"Ces informations existent déjà"}):i({general:"Erreur lors de la modification. Veuillez réessayer."})}finally{o(!1)}}};return r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier le fournisseur"}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Modifiez les informations du fournisseur ",e.numero_fournisseur]})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:u,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro Fournisseur"}),r.jsx("input",{type:"text",value:e.numero_fournisseur,readOnly:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prenom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prénom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"prenom",name:"prenom",value:s.prenom,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.prenom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le prénom"}),a.prenom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.prenom})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"nom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"nom",name:"nom",value:s.nom,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.nom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom"}),a.nom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.nom})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"societe",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Société"}),r.jsx("input",{type:"text",id:"societe",name:"societe",value:s.societe,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.societe?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom de la société"}),a.societe&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.societe})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ice",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro ICE"}),r.jsx("input",{type:"text",id:"ice",name:"ice",value:s.ice,onChange:c,maxLength:15,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 font-mono ${a.ice?"border-red-500":"border-gray-300"}`,placeholder:"000000000000000 (15 chiffres)"}),a.ice&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.ice}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Le numéro ICE doit contenir exactement 15 chiffres"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Email"}),r.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.email?"border-red-500":"border-gray-300"}`,placeholder:"exemple@email.com"}),a.email&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.email})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"telephone",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Téléphone ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"tel",id:"telephone",name:"telephone",value:s.telephone,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.telephone?"border-red-500":"border-gray-300"}`,placeholder:"+212 6 12 34 56 78"}),a.telephone&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.telephone}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: +212 6 XX XX XX XX ou 06 XX XX XX XX"})]})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:l,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),l?"Enregistrement...":"Modifier le fournisseur"]})]})})]})})})]})},yg=({onNavigateToAdd:t,onNavigateToEdit:e})=>{const[s,n]=N.useState([]),[a,i]=N.useState(!0),[l,o]=N.useState(null),[c,d]=N.useState(1),[u,m]=N.useState(""),p=10,x=async()=>{try{i(!0),o(null);const{data:A,error:D}=await Q.from("produits").select("*").order("created_at",{ascending:!1});if(D)throw D;n(A||[])}catch(A){console.error("Error fetching products:",A),o("Erreur lors du chargement des produits")}finally{i(!1)}};ye.useEffect(()=>{x()},[]);const f=s.filter(A=>A.nom_produit.toLowerCase().includes(u.toLowerCase())),v=Math.ceil(f.length/p),j=(c-1)*p,h=j+p,y=f.slice(j,h),g=A=>{d(A)},C=()=>{c>1&&d(c-1)},M=()=>{c<v&&d(c+1)},$=A=>{e(A)},T=A=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(A)+" DH";return a?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des produits..."})]})}):l?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:l}),r.jsx("button",{onClick:x,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Produits"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez votre catalogue de produits"})]}),r.jsxs("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(vt,{className:"w-5 h-5"}),"Ajouter un produit"]})]}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:u,onChange:A=>m(A.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Nom du Produit"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Prix d'Achat"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Prix de Vente"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Marge"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length>0?y.map(A=>{const D=A.prix_vente-A.prix_achat,q=A.prix_achat>0?D/A.prix_achat*100:0;return r.jsxs("tr",{onClick:()=>$(A),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.nom_produit})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(A.prix_achat)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(A.prix_vente)}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm text-gray-900",children:T(D)}),r.jsxs("div",{className:`text-xs ${q>=0?"text-green-600":"text-red-600"}`,children:[q>=0?"+":"",q.toFixed(1),"%"]})]})]},A.id)}):r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx($e,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:u?"Aucun produit trouvé":"Aucun produit disponible"}),!u&&r.jsx("button",{onClick:t,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Ajouter votre premier produit"})]})})})})]})})}),v>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",j+1," à ",Math.min(h,f.length)," sur ",f.length," produits"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:C,disabled:c===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:v},(A,D)=>D+1).map(A=>r.jsx("button",{onClick:()=>g(A),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${c===A?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:A},A)),r.jsx("button",{onClick:M,disabled:c===v,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]})]})},bg=({onNavigateBack:t})=>{const[e,s]=N.useState({nom_produit:"",prix_achat:"",prix_vente:"",unite:"unite",dimension_standard:"1"}),[n,a]=N.useState({}),[i,l]=N.useState(!1),o=f=>{const{name:v,value:j}=f.target;s(h=>({...h,[v]:j})),n[v]&&a(h=>({...h,[v]:""}))},c=()=>{const f={};return e.nom_produit.trim()||(f.nom_produit="Le nom du produit est requis"),e.prix_achat.trim()?(isNaN(Number(e.prix_achat))||Number(e.prix_achat)<0)&&(f.prix_achat="Le prix d'achat doit être un nombre positif"):f.prix_achat="Le prix d'achat est requis",e.prix_vente.trim()?(isNaN(Number(e.prix_vente))||Number(e.prix_vente)<0)&&(f.prix_vente="Le prix de vente doit être un nombre positif"):f.prix_vente="Le prix de vente est requis",e.unite.trim()||(f.unite="L'unité est requise"),e.dimension_standard.trim()?(isNaN(Number(e.dimension_standard))||Number(e.dimension_standard)<=0)&&(f.dimension_standard="La dimension standard doit être un nombre positif"):f.dimension_standard="La dimension standard est requise",a(f),Object.keys(f).length===0},d=async f=>{if(f.preventDefault(),!!c()){l(!0);try{const{data:v,error:j}=await Q.from("produits").insert([{nom_produit:e.nom_produit.trim(),prix_achat:Number(e.prix_achat),prix_vente:Number(e.prix_vente),unite:e.unite,dimension_standard:Number(e.dimension_standard)}]).select();if(j)throw j;console.log("Product saved successfully:",v),s({nom_produit:"",prix_achat:"",prix_vente:"",unite:"unite",dimension_standard:"1"}),t()}catch(v){console.error("Error saving product:",v),a({general:"Erreur lors de l'enregistrement. Veuillez réessayer."})}finally{l(!1)}}},u=f=>["ml","m2","kg","l","cm","m","g","t"].includes(f),m=f=>({unite:"Unité",ml:"ML",m2:"M²",kg:"KG",l:"L",pcs:"PCS",box:"Boîte",cm:"CM",m:"M",g:"G",t:"T"})[f]||f.toUpperCase(),x=(()=>{const f=Number(e.prix_achat),v=Number(e.prix_vente);if(f>0&&v>0){const j=v-f,h=j/f*100;return{margin:j,marginPercent:h}}return null})();return r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Ajouter un produit"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Créez un nouveau produit dans le catalogue"})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:d,className:"space-y-6",children:[n.general&&r.jsx("div",{className:"rounded-md bg-red-50 p-4",children:r.jsx("div",{className:"text-sm text-red-700",children:n.general})}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"nom_produit",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nom du Produit ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"nom_produit",name:"nom_produit",value:e.nom_produit,onChange:o,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.nom_produit?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom du produit"}),n.nom_produit&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.nom_produit})]}),r.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prix_achat",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prix d'Achat (MAD) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",id:"prix_achat",name:"prix_achat",value:e.prix_achat,onChange:o,step:"0.01",min:"0",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.prix_achat?"border-red-500":"border-gray-300"}`,placeholder:"0.00"}),n.prix_achat&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.prix_achat})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prix_vente",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prix de Vente (MAD) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",id:"prix_vente",name:"prix_vente",value:e.prix_vente,onChange:o,step:"0.01",min:"0",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.prix_vente?"border-red-500":"border-gray-300"}`,placeholder:"0.00"}),n.prix_vente&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.prix_vente})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"unite",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Unité ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"unite",name:"unite",value:e.unite,onChange:f=>s(v=>({...v,unite:f.target.value})),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.unite?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"unite",children:"Unité"}),r.jsx("option",{value:"ml",children:"Mètre linéaire (ML)"}),r.jsx("option",{value:"m2",children:"Mètre carré (M²)"}),r.jsx("option",{value:"kg",children:"Kilogramme (KG)"}),r.jsx("option",{value:"l",children:"Litre (L)"}),r.jsx("option",{value:"pcs",children:"Pièces (PCS)"}),r.jsx("option",{value:"box",children:"Boîte"}),r.jsx("option",{value:"cm",children:"Centimètre (CM)"}),r.jsx("option",{value:"m",children:"Mètre (M)"}),r.jsx("option",{value:"g",children:"Gramme (G)"}),r.jsx("option",{value:"t",children:"Tonne (T)"})]}),n.unite&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.unite})]})]}),u(e.unite)&&r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"dimension_standard",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Dimension Standard ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",id:"dimension_standard",name:"dimension_standard",value:e.dimension_standard,onChange:o,step:"0.01",min:"0.01",className:`w-32 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.dimension_standard?"border-red-500":"border-gray-300"}`,placeholder:"4.3"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[m(e.unite)," par pièce"]})]}),n.dimension_standard&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.dimension_standard}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dimension standard par pièce. Exemple: une poutrelle de 4.3m"})]}),x&&r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Aperçu de la marge"}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Marge unitaire:"}),r.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(x.margin)," DH"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Pourcentage de marge:"}),r.jsxs("span",{className:`ml-2 font-medium ${x.marginPercent>=0?"text-green-600":"text-red-600"}`,children:[x.marginPercent>=0?"+":"",x.marginPercent.toFixed(1),"%"]})]})]})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:i,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),i?"Enregistrement...":"Enregistrer le produit"]})]})})]})})})]})},vg=({onNavigateBack:t,product:e})=>{var v;const[s,n]=N.useState({nom_produit:e.nom_produit,prix_achat:e.prix_achat.toString(),prix_vente:e.prix_vente.toString(),unite:e.unite||"unite",dimension_standard:((v=e.dimension_standard)==null?void 0:v.toString())||"1"}),[a,i]=N.useState({}),[l,o]=N.useState(!1),c=j=>{const{name:h,value:y}=j.target;n(g=>({...g,[h]:y})),a[h]&&i(g=>({...g,[h]:""}))},d=()=>{const j={};return s.nom_produit.trim()||(j.nom_produit="Le nom du produit est requis"),s.prix_achat.trim()?(isNaN(Number(s.prix_achat))||Number(s.prix_achat)<0)&&(j.prix_achat="Le prix d'achat doit être un nombre positif"):j.prix_achat="Le prix d'achat est requis",s.prix_vente.trim()?(isNaN(Number(s.prix_vente))||Number(s.prix_vente)<0)&&(j.prix_vente="Le prix de vente doit être un nombre positif"):j.prix_vente="Le prix de vente est requis",s.unite.trim()||(j.unite="L'unité est requise"),s.dimension_standard.trim()?(isNaN(Number(s.dimension_standard))||Number(s.dimension_standard)<=0)&&(j.dimension_standard="La dimension standard doit être un nombre positif"):j.dimension_standard="La dimension standard est requise",i(j),Object.keys(j).length===0},u=async j=>{if(j.preventDefault(),!!d()){o(!0);try{const{data:h,error:y}=await Q.from("produits").update({nom_produit:s.nom_produit.trim(),prix_achat:Number(s.prix_achat),prix_vente:Number(s.prix_vente),unite:s.unite,dimension_standard:Number(s.dimension_standard)}).eq("id",e.id).select();if(y)throw y;console.log("Product updated successfully:",h),t()}catch(h){console.error("Error updating product:",h),i({general:"Erreur lors de la modification. Veuillez réessayer."})}finally{o(!1)}}},m=j=>["ml","m2","kg","l","cm","m","g","t"].includes(j),p=j=>({unite:"Unité",ml:"ML",m2:"M²",kg:"KG",l:"L",pcs:"PCS",box:"Boîte",cm:"CM",m:"M",g:"G",t:"T"})[j]||j.toUpperCase(),f=(()=>{const j=Number(s.prix_achat),h=Number(s.prix_vente);if(j>0&&h>0){const y=h-j,g=y/j*100;return{margin:y,marginPercent:g}}return null})();return r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier le produit"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Modifiez les informations du produit"})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:u,className:"space-y-6",children:[a.general&&r.jsx("div",{className:"rounded-md bg-red-50 p-4",children:r.jsx("div",{className:"text-sm text-red-700",children:a.general})}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"nom_produit",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nom du Produit ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"nom_produit",name:"nom_produit",value:s.nom_produit,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.nom_produit?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom du produit"}),a.nom_produit&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.nom_produit})]}),r.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prix_achat",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prix d'Achat (MAD) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",id:"prix_achat",name:"prix_achat",value:s.prix_achat,onChange:c,step:"0.01",min:"0",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.prix_achat?"border-red-500":"border-gray-300"}`,placeholder:"0.00"}),a.prix_achat&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.prix_achat})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prix_vente",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prix de Vente (MAD) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",id:"prix_vente",name:"prix_vente",value:s.prix_vente,onChange:c,step:"0.01",min:"0",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.prix_vente?"border-red-500":"border-gray-300"}`,placeholder:"0.00"}),a.prix_vente&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.prix_vente})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"unite",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Unité ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"unite",name:"unite",value:s.unite,onChange:j=>n(h=>({...h,unite:j.target.value})),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.unite?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"unite",children:"Unité"}),r.jsx("option",{value:"ml",children:"Mètre linéaire (ML)"}),r.jsx("option",{value:"m2",children:"Mètre carré (M²)"}),r.jsx("option",{value:"kg",children:"Kilogramme (KG)"}),r.jsx("option",{value:"l",children:"Litre (L)"}),r.jsx("option",{value:"pcs",children:"Pièces (PCS)"}),r.jsx("option",{value:"box",children:"Boîte"}),r.jsx("option",{value:"cm",children:"Centimètre (CM)"}),r.jsx("option",{value:"m",children:"Mètre (M)"}),r.jsx("option",{value:"g",children:"Gramme (G)"}),r.jsx("option",{value:"t",children:"Tonne (T)"})]}),a.unite&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.unite})]})]}),m(s.unite)&&r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"dimension_standard",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Dimension Standard ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",id:"dimension_standard",name:"dimension_standard",value:s.dimension_standard,onChange:c,step:"0.01",min:"0.01",className:`w-32 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.dimension_standard?"border-red-500":"border-gray-300"}`,placeholder:"4.3"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[p(s.unite)," par pièce"]})]}),a.dimension_standard&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.dimension_standard}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dimension standard par pièce. Exemple: une poutrelle de 3m"})]}),f&&r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Aperçu de la marge"}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Marge unitaire:"}),r.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(f.margin)," DH"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Pourcentage de marge:"}),r.jsxs("span",{className:`ml-2 font-medium ${f.marginPercent>=0?"text-green-600":"text-red-600"}`,children:[f.marginPercent>=0?"+":"",f.marginPercent.toFixed(1),"%"]})]})]})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:l,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),l?"Enregistrement...":"Modifier le produit"]})]})})]})})})]})},jg=({onNavigateToAdd:t,onNavigateToEdit:e,onConvertToDelivery:s})=>{const[n,a]=N.useState([]),[i,l]=N.useState(!0),[o,c]=N.useState(null),[d,u]=N.useState(1),[m,p]=N.useState(""),[x,f]=N.useState(20),[v,j]=N.useState({dateFrom:"",dateTo:""}),[h,y]=N.useState(""),g=async()=>{try{l(!0),c(null);const{data:L,error:U}=await Q.from("bon_de_commande").select(`
          *,
          client:clients(nom, prenom, societe),
          fournisseur:fournisseurs(nom, prenom, societe)
        `).order("created_at",{ascending:!1});if(U)throw U;a(L||[])}catch(L){console.error("Error fetching purchase orders:",L),c("Erreur lors du chargement des bons de commande")}finally{l(!1)}};ye.useEffect(()=>{g()},[]);const C=(L,U)=>{j(se=>({...se,[L]:U})),u(1)},M=()=>{p(""),j({dateFrom:"",dateTo:""}),y(""),u(1)},$=()=>m||v.dateFrom||v.dateTo||h,T=L=>{if(!v.dateFrom&&!v.dateTo)return!0;const U=L,se=!v.dateFrom||U>=v.dateFrom,P=!v.dateTo||U<=v.dateTo;return se&&P},D=n.filter(L=>L.numero_commande.toLowerCase().includes(m.toLowerCase())||L.fournisseur.nom.toLowerCase().includes(m.toLowerCase())||L.fournisseur.societe.toLowerCase().includes(m.toLowerCase())||L.fournisseur.prenom.toLowerCase().includes(m.toLowerCase())||`${L.fournisseur.prenom} ${L.fournisseur.nom}`.toLowerCase().includes(m.toLowerCase())||L.client&&(L.client.nom.toLowerCase().includes(m.toLowerCase())||L.client.prenom.toLowerCase().includes(m.toLowerCase())||L.client.societe.toLowerCase().includes(m.toLowerCase())||`${L.client.prenom} ${L.client.nom}`.toLowerCase().includes(m.toLowerCase()))).filter(L=>T(L.date_commande)&&(!h||L.statut===h)),q=Math.ceil(D.length/x),K=(d-1)*x,J=K+x,Z=D.slice(K,J),Y=L=>{u(L)},V=()=>{d>1&&u(d-1)},I=()=>{d<q&&u(d+1)},O=L=>{f(L),u(1)},b=()=>{const L=["Numéro BC","Date Commande","Fournisseur","Client","Statut","Total HT (DH)","Notes"],U=D.map(z=>[z.numero_commande,new Date(z.date_commande).toLocaleDateString("fr-FR"),z.fournisseur.societe||`${z.fournisseur.prenom} ${z.fournisseur.nom}`,z.client?z.client.societe||`${z.client.prenom} ${z.client.nom}`:"Non assigné",z.statut==="brouillon"?"Brouillon":z.statut==="envoyee"?"Envoyée":z.statut==="confirmee"?"Confirmée":z.statut==="livree"?"Livrée":z.statut==="annulee"?"Annulée":z.statut,z.total_ht.toFixed(2),z.notes||""]);U.push([`TOTAUX (${D.length} commandes)`,"","","","",E.totalAmount.toFixed(2),""]);const se=[L,...U].map(z=>z.map(ee=>`"${ee}"`).join(",")).join(`
`),P=new Blob([se],{type:"text/csv;charset=utf-8;"}),B=document.createElement("a"),k=URL.createObjectURL(P);B.setAttribute("href",k),B.setAttribute("download",`bons_commande_${new Date().toISOString().split("T")[0]}.csv`),B.style.visibility="hidden",document.body.appendChild(B),B.click(),document.body.removeChild(B)},E=(()=>{const L=D.filter(B=>B.statut==="confirmee"),U=D.filter(B=>B.statut==="livree"),se=D.filter(B=>B.statut==="envoyee"),P=D.filter(B=>B.statut==="brouillon");return{totalAmount:D.reduce((B,k)=>B+k.total_ht,0),confirmedTotal:L.reduce((B,k)=>B+k.total_ht,0),deliveredTotal:U.reduce((B,k)=>B+k.total_ht,0),sentTotal:se.reduce((B,k)=>B+k.total_ht,0),count:D.length,confirmedCount:L.length,deliveredCount:U.length,sentCount:se.length,draftCount:P.length}})(),w=L=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(L)+" DH",R=L=>{const U={brouillon:"bg-gray-100 text-gray-800",envoyee:"bg-blue-100 text-blue-800",confirmee:"bg-green-100 text-green-800",livree:"bg-purple-100 text-purple-800",annulee:"bg-red-100 text-red-800"},se={brouillon:"Brouillon",envoyee:"Envoyée",confirmee:"Confirmée",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${U[L]||U.brouillon}`,children:se[L]||L})};return i?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des bons de commande..."})]})}):o?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:o}),r.jsx("button",{onClick:g,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bons de commande"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos commandes fournisseurs"})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:b,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(Qr,{className:"w-4 h-4"}),"Exporter CSV (",D.length,")"]}),r.jsxs("button",{onClick:()=>window.print(),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer (",D.length,")"]}),r.jsxs("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200 shadow-sm",children:[r.jsx(vt,{className:"w-5 h-5"}),"Créer un bon de commande"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Commandes"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.count}),r.jsx("p",{className:"text-sm font-medium text-blue-600",children:w(E.totalAmount)})]}),r.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Confirmées"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:E.confirmedCount}),r.jsx("p",{className:"text-sm font-medium text-green-600",children:w(E.confirmedTotal)})]}),r.jsx(Fs,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Livrées"}),r.jsx("p",{className:"text-2xl font-bold text-purple-600",children:E.deliveredCount}),r.jsx("p",{className:"text-sm font-medium text-purple-600",children:w(E.deliveredTotal)})]}),r.jsx(we,{className:"w-8 h-8 text-purple-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Envoyées"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:E.sentCount}),r.jsx("p",{className:"text-sm font-medium text-blue-600",children:w(E.sentTotal)})]}),r.jsx(hn,{className:"w-8 h-8 text-blue-600"})]})})]}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher par numéro, fournisseur ou client...",value:m,onChange:L=>{p(L.target.value),u(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtres avancés"}),$()&&r.jsxs("button",{onClick:M,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:[r.jsx(Wr,{className:"w-4 h-4"}),"Effacer tous les filtres"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:v.dateFrom,onChange:L=>C("dateFrom",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:v.dateTo,onChange:L=>C("dateTo",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Statut"}),r.jsxs("select",{id:"status-filter",value:h,onChange:L=>{y(L.target.value),u(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[r.jsx("option",{value:"",children:"Tous les statuts"}),r.jsx("option",{value:"brouillon",children:"Brouillon"}),r.jsx("option",{value:"envoyee",children:"Envoyée"}),r.jsx("option",{value:"confirmee",children:"Confirmée"}),r.jsx("option",{value:"livree",children:"Livrée"}),r.jsx("option",{value:"annulee",children:"Annulée"})]})]})]}),$()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:D.length})," bon(s) de commande trouvé(s) avec les filtres actifs"]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Total filtré: ",w(E.totalAmount)]})]})})]}),r.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Fournisseur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Client"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Z.length>0?Z.map(L=>r.jsxs("tr",{onClick:()=>e(L),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:L.numero_commande}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:L.fournisseur.societe}),r.jsxs("div",{className:"text-sm text-gray-500",children:[L.fournisseur.prenom," ",L.fournisseur.nom]})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:L.client?r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:L.client.societe}),r.jsxs("div",{className:"text-sm text-gray-500",children:[L.client.prenom," ",L.client.nom]})]}):r.jsx("span",{className:"text-gray-400 text-sm italic",children:"Non assigné"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(L.date_commande).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R(L.statut)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:w(L.total_ht)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:U=>{U.stopPropagation(),e(L)},className:"text-blue-600 hover:text-blue-900 flex items-center gap-1",children:[r.jsx(zr,{className:"w-4 h-4"}),"Voir"]}),(L.statut==="confirmee"||L.statut==="envoyee")&&r.jsxs("button",{onClick:U=>{U.stopPropagation(),s(L)},className:"text-green-600 hover:text-green-900 flex items-center gap-1",children:[r.jsx(we,{className:"w-4 h-4"}),"Livrer"]})]})})]},L.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(Ae,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:m?"Aucun bon de commande trouvé":"Aucun bon de commande disponible"}),!m&&r.jsx("button",{onClick:t,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Créer votre premier bon de commande"})]})})})})]})})}),q>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",K+1," à ",Math.min(J,D.length)," sur ",D.length," bons de commande"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Éléments par page:"}),r.jsxs("select",{value:x,onChange:L=>O(Number(L.target.value)),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:20,children:"20"}),r.jsx("option",{value:60,children:"60"}),r.jsx("option",{value:100,children:"100"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:V,disabled:d===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:q},(L,U)=>U+1).map(L=>r.jsx("button",{onClick:()=>Y(L),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${d===L?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:L},L)),r.jsx("button",{onClick:I,disabled:d===q,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"hidden print:block fixed inset-0 bg-white p-8",children:[r.jsxs("div",{className:"relative text-center border-b-2 border-gray-800 pb-6 mb-8",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"absolute top-0 left-0 h-24 w-auto"}),r.jsx("p",{className:"text-lg text-gray-700 mt-2",children:"LISTE DES BONS DE COMMANDE"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")," |",D.length," commande(s) | Total: ",w(E.totalAmount)]})]}),r.jsxs("table",{className:"w-full border-collapse border border-gray-800",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"N° BC"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Date"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Fournisseur"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Client"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Statut"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Total"})]})}),r.jsx("tbody",{children:D.map(L=>r.jsxs("tr",{children:[r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:L.numero_commande}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:new Date(L.date_commande).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:L.fournisseur.societe||`${L.fournisseur.prenom} ${L.fournisseur.nom}`}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:L.client?L.client.societe||`${L.client.prenom} ${L.client.nom}`:"Non assigné"}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:L.statut==="brouillon"?"Brouillon":L.statut==="envoyee"?"Envoyée":L.statut==="confirmee"?"Confirmée":L.statut==="livree"?"Livrée":L.statut==="annulee"?"Annulée":L.statut}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:w(L.total_ht)})]},L.id))}),r.jsx("tfoot",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsxs("td",{className:"border border-gray-800 px-3 py-3 font-bold text-sm",colSpan:5,children:["TOTAUX (",D.length," commandes)"]}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:w(E.totalAmount)})]})})]}),r.jsx("div",{className:"absolute bottom-8 left-8 right-8 text-center text-xs text-gray-500 border-t border-gray-300 pt-4",children:r.jsxs("p",{children:["ANTURGOOD - Système de gestion | Document généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 1cm;
            size: A4 portrait;
          }
          
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          /* Hide everything by default */
          body * {
            visibility: hidden;
          }
          
          /* Show only the print content */
          .print\\:block,
          .print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print content */
          .print\\:block {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            padding: 1cm !important;
            background: white !important;
            color: black !important;
            font-size: 12pt !important;
            line-height: 1.4 !important;
          }
          
          /* Table styling for print */
          table {
            border-collapse: collapse !important;
            width: 100% !important;
            font-size: 10pt !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 4px !important;
          }
          
          /* Page breaks */
          tbody tr {
            page-break-inside: avoid;
          }
          
          thead {
            display: table-header-group;
          }
          
          tfoot {
            display: table-footer-group;
            page-break-inside: avoid;
          }
          
          /* Hide any remaining UI elements */
          nav, aside, button:not(.print\\:block button), .print\\:hidden {
            display: none !important;
          }
        }
      `})]})},wg=({onNavigateBack:t})=>{const[e,s]=N.useState(null),[n,a]=N.useState([]),[i,l]=N.useState([]),[o,c]=N.useState([]),[d,u]=N.useState(!1),[m,p]=N.useState(!1),[x,f]=N.useState(""),[v,j]=N.useState(""),[h,y]=N.useState({date_commande:new Date().toISOString().split("T")[0],notes:""}),[g,C]=N.useState({}),[M,$]=N.useState(!1),[T,A]=N.useState(""),D=async()=>{try{const{data:k,error:z}=await Q.from("bon_de_commande").select("numero_commande").order("created_at",{ascending:!1}).limit(1);if(z)throw z;let ee=1;if(k&&k.length>0){const ne=k[0].numero_commande.replace("BC-","");ee=parseInt(ne)+1}return`BC-${String(ee).padStart(4,"0")}`}catch(k){return console.error("Error generating order number:",k),"BC-0001"}};ye.useEffect(()=>{(async()=>{await Promise.all([D().then(A),q(),K()])})()},[]);const q=async()=>{try{const{data:k,error:z}=await Q.from("fournisseurs").select("*").order("societe",{ascending:!0});if(z)throw z;a(k||[])}catch(k){console.error("Error fetching fournisseurs:",k)}},K=async()=>{try{const{data:k,error:z}=await Q.from("produits").select("*, dimension_standard").order("nom_produit",{ascending:!0});if(z)throw z;l(k||[])}catch(k){console.error("Error fetching products:",k)}},J=k=>{const{name:z,value:ee}=k.target;y(ne=>({...ne,[z]:ee}))},Z=k=>{s(k),u(!1),f("")},Y=k=>{const z=o.find(ee=>ee.produit_id===k.id);if(z)V(z.id,z.quantite_pieces+1);else{const ee={id:`temp-${Date.now()}`,produit_id:k.id,nom_produit:k.nom_produit,prix_unitaire:k.prix_achat,quantite_pieces:1,quantite_unitaire:k.dimension_standard,quantite_totale:1*k.dimension_standard,total:k.prix_achat*(1*k.dimension_standard),unite:k.unite};c(ne=>[...ne,ee])}p(!1),j("")},V=(k,z)=>{if(z<=0){b(k);return}c(ee=>ee.map(ne=>ne.id===k?{...ne,quantite_pieces:z,quantite_totale:z*ne.quantite_unitaire,total:ne.prix_unitaire*(z*ne.quantite_unitaire)}:ne))},I=(k,z)=>{z<=0||c(ee=>ee.map(ne=>ne.id===k?{...ne,quantite_unitaire:z,quantite_totale:ne.quantite_pieces*z,total:ne.prix_unitaire*(ne.quantite_pieces*z)}:ne))},O=(k,z)=>{c(ee=>ee.map(ne=>ne.id===k?{...ne,prix_unitaire:z,total:z*ne.quantite_totale}:ne))},b=k=>{c(z=>z.filter(ee=>ee.id!==k))},S=()=>o.reduce((k,z)=>k+z.total,0),E=n.filter(k=>k.societe.toLowerCase().includes(x.toLowerCase())||k.nom.toLowerCase().includes(x.toLowerCase())||k.prenom.toLowerCase().includes(x.toLowerCase())),w=i.filter(k=>k.nom_produit.toLowerCase().includes(v.toLowerCase())),R=k=>({unite:"Unité",ml:"ML",m2:"M²",kg:"KG",l:"L",pcs:"PCS",box:"Boîte",cm:"CM",m:"M",g:"G",t:"T"})[k]||k.toUpperCase(),L=k=>["ml","m2","kg","l","cm","m","g","t"].includes(k),U=k=>{const z={unite:"bg-gray-100 text-gray-800",ml:"bg-blue-100 text-blue-800",m2:"bg-green-100 text-green-800",kg:"bg-purple-100 text-purple-800",l:"bg-cyan-100 text-cyan-800",pcs:"bg-orange-100 text-orange-800",box:"bg-amber-100 text-amber-800",cm:"bg-indigo-100 text-indigo-800",m:"bg-teal-100 text-teal-800",g:"bg-pink-100 text-pink-800",t:"bg-red-100 text-red-800"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${z[k]||z.unite}`,children:R(k)})},se=()=>{const k={};return e||(k.fournisseur="Veuillez sélectionner un fournisseur"),o.length===0&&(k.items="Veuillez ajouter au moins un produit"),h.date_commande||(k.date_commande="La date de commande est requise"),C(k),Object.keys(k).length===0},P=async k=>{if(k.preventDefault(),!!se()){$(!0);try{const{data:z,error:ee}=await Q.from("bon_de_commande").insert([{numero_commande:T,fournisseur_id:e.id,date_commande:h.date_commande,total_ht:S(),notes:h.notes.trim()||null,statut:"confirmee"}]).select().single();if(ee)throw ee;const ne=o.map(ue=>({commande_id:z.id,produit_id:ue.produit_id,quantite:ue.quantite_totale,quantite_pieces:ue.quantite_pieces,quantite_unitaire:ue.quantite_unitaire,prix_unitaire:ue.prix_unitaire})),{error:ie}=await Q.from("bon_de_commande_items").insert(ne);if(ie)throw ie;console.log("Purchase order created successfully:",z),t()}catch(z){console.error("Error creating purchase order:",z),C({general:"Erreur lors de la création. Veuillez réessayer."})}finally{$(!1)}}},B=k=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(k)+" DH";return T?r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Créer un bon de commande"}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Numéro: ",T]})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ut,{className:"w-5 h-5"}),"Fournisseur"]}),e?r.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:e.societe}),r.jsxs("p",{className:"text-sm text-gray-600",children:[e.prenom," ",e.nom," - ",e.numero_fournisseur]})]}),r.jsx("button",{onClick:()=>u(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Changer"})]}):r.jsxs("button",{onClick:()=>u(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors duration-200 flex items-center justify-center gap-2 text-gray-600 hover:text-blue-600",children:[r.jsx(vt,{className:"w-5 h-5"}),"Sélectionner un fournisseur"]}),g.fournisseur&&r.jsx("p",{className:"text-red-500 text-sm mt-2",children:g.fournisseur})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(As,{className:"w-5 h-5"}),"Produits"]}),r.jsxs("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium transition-colors duration-200",children:[r.jsx(vt,{className:"w-4 h-4"}),"Ajouter produit"]})]}),o.length>0?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Produit"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Unité"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Prix unitaire"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Quantité"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Dimension"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Quantité Totale"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Total"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:o.map(k=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:k.nom_produit}),r.jsx("td",{className:"px-4 py-3 text-center",children:U(k.unite)}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"number",step:"0.01",min:"0",value:k.prix_unitaire,onChange:z=>O(k.id,Number(z.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"number",min:"0",step:"1",value:k.quantite_pieces,onChange:z=>V(k.id,Number(z.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})}),r.jsx("td",{className:"px-4 py-3",children:L(k.unite)?r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"number",min:"0",step:"0.01",value:k.quantite_unitaire,onChange:z=>I(k.id,Number(z.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),r.jsx("span",{className:"text-xs text-gray-500",children:R(k.unite)})]}):r.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("div",{className:"text-sm font-medium text-blue-600",children:L(k.unite)?`${k.quantite_totale} ${R(k.unite)}`:`${k.quantite_pieces} ${R(k.unite)}`})}),r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:B(k.total)}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("button",{onClick:()=>b(k.id),className:"text-red-600 hover:text-red-800 p-1",children:r.jsx(Qo,{className:"w-4 h-4"})})})]},k.id))})]})}):r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(As,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"Aucun produit ajouté"})]}),g.items&&r.jsx("p",{className:"text-red-500 text-sm mt-2",children:g.items})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date_commande",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de commande"}),r.jsx("input",{type:"date",id:"date_commande",name:"date_commande",value:h.date_commande,onChange:J,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g.date_commande?"border-red-500":"border-gray-300"}`}),g.date_commande&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.date_commande})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optionnel)"}),r.jsx("textarea",{id:"notes",name:"notes",rows:3,value:h.notes,onChange:J,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes pour ce bon de commande..."})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Récapitulatif"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-200",children:[r.jsx("span",{className:"text-gray-600",children:"Nombre d'articles:"}),r.jsx("span",{className:"font-medium",children:o.reduce((k,z)=>k+z.quantite_pieces,0)})]}),r.jsxs("div",{className:"flex justify-between py-2 text-lg font-semibold",children:[r.jsx("span",{children:"Total:"}),r.jsx("span",{children:B(S())})]})]})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{onClick:P,disabled:M,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-3 rounded-lg flex items-center justify-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-4 h-4"}),M?"Création...":"Créer"]})]}),g.general&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:g.general})})]})]})}),d&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sélectionner un fournisseur"})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"relative mb-4",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un fournisseur...",value:x,onChange:k=>f(k.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.jsx("div",{className:"space-y-2",children:E.map(k=>r.jsxs("button",{onClick:()=>Z(k),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors duration-200",children:[r.jsx("div",{className:"font-medium text-gray-900",children:k.societe}),r.jsxs("div",{className:"text-sm text-gray-600",children:[k.prenom," ",k.nom," - ",k.numero_fournisseur]})]},k.id))})})]}),r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx("button",{onClick:()=>u(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Fermer"})})]})}),m&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ajouter un produit"})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"relative mb-4",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:v,onChange:k=>j(k.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.jsx("div",{className:"space-y-2",children:w.map(k=>r.jsx("button",{onClick:()=>Y(k),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors duration-200",children:r.jsx("div",{className:"flex justify-between items-start",children:r.jsxs("div",{children:[r.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[k.nom_produit,U(k.unite)]}),r.jsxs("div",{className:"text-sm text-gray-600",children:["Prix d'achat: ",B(k.prix_achat)]}),L(k.unite)?r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Dimension standard: ",k.dimension_standard," ",R(k.unite),"/pièce"]}):r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Prix par ",R(k.unite)]})]})})},k.id))})})]}),r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx("button",{onClick:()=>p(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Fermer"})})]})})]}):r.jsx("div",{className:"min-h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500",children:"Chargement..."})})},Ng=({onNavigateBack:t,order:e})=>{const[s,n]=N.useState([]),[a,i]=N.useState([]),[l,o]=N.useState(!0),[c,d]=N.useState(null),[u,m]=N.useState(!1),[p,x]=N.useState(""),[f,v]=N.useState({statut:e.statut,notes:e.notes||""}),[j,h]=N.useState(!1);ye.useEffect(()=>{(async()=>{await Promise.all([y(),g()])})()},[]);const y=async()=>{try{o(!0),d(null);const{data:O,error:b}=await Q.from("bon_de_commande_items").select(`
          *,
          produit:produits(nom_produit, unite)
        `).eq("commande_id",e.id).order("id",{ascending:!0});if(b)throw b;const S=(O||[]).map(E=>({...E,quantite_pieces:E.quantite_pieces||1,quantite_unitaire:E.quantite_unitaire||E.quantite,quantite_totale:E.quantite}));n(S)}catch(O){console.error("Error fetching order items:",O),d("Erreur lors du chargement des détails de la commande")}finally{o(!1)}},g=async()=>{try{const{data:O,error:b}=await Q.from("produits").select("id, nom_produit, prix_achat, prix_vente, unite, dimension_standard").order("nom_produit",{ascending:!0});if(b)throw b;i(O||[])}catch(O){console.error("Error fetching products:",O)}},C=O=>{const{name:b,value:S}=O.target;v(E=>({...E,[b]:S}))},M=O=>{const b=s.find(S=>S.produit_id===O.id);if(b)$(b.id,b.quantite_pieces+1);else{const S={id:`temp-${Date.now()}`,produit_id:O.id,quantite_pieces:1,quantite_unitaire:O.dimension_standard,quantite_totale:1*O.dimension_standard,prix_unitaire:O.prix_achat,total_ligne:O.prix_achat*(1*O.dimension_standard),produit:{nom_produit:O.nom_produit,unite:O.unite}};n(E=>[...E,S])}x("")},$=(O,b)=>{if(b<=0){D(O);return}n(S=>S.map(E=>E.id===O?{...E,quantite_pieces:b,quantite_totale:b*E.quantite_unitaire,total_ligne:E.prix_unitaire*(b*E.quantite_unitaire)}:E))},T=(O,b)=>{b<=0||n(S=>S.map(E=>E.id===O?{...E,quantite_unitaire:b,quantite_totale:E.quantite_pieces*b,total_ligne:E.prix_unitaire*(E.quantite_pieces*b)}:E))},A=(O,b)=>{n(S=>S.map(E=>E.id===O?{...E,prix_unitaire:b,total_ligne:b*E.quantite_totale}:E))},D=O=>{n(b=>b.filter(S=>S.id!==O))},q=()=>s.reduce((O,b)=>O+b.total_ligne,0),K=a.filter(O=>O.nom_produit.toLowerCase().includes(p.toLowerCase())),J=O=>({unite:"Unité",ml:"ML",m2:"M²",kg:"KG",l:"L",pcs:"PCS",box:"Boîte",cm:"CM",m:"M",g:"G",t:"T"})[O]||O.toUpperCase(),Z=O=>["ml","m2","kg","l","cm","m","g","t"].includes(O),Y=async O=>{O.preventDefault(),h(!0);try{const b=q(),{data:S,error:E}=await Q.from("bon_de_commande").update({statut:f.statut,notes:f.notes.trim()||null,total_ht:b}).eq("id",e.id).select();if(E)throw E;const{error:w}=await Q.from("bon_de_commande_items").delete().eq("commande_id",e.id);if(w)throw w;if(s.length>0){const R=s.map(U=>({commande_id:e.id,produit_id:U.produit_id,quantite:U.quantite_totale,quantite_pieces:U.quantite_pieces,quantite_unitaire:U.quantite_unitaire,prix_unitaire:U.prix_unitaire})),{error:L}=await Q.from("bon_de_commande_items").insert(R);if(L)throw L}console.log("Purchase order updated successfully:",S),t()}catch(b){console.error("Error updating purchase order:",b),d("Erreur lors de la modification. Veuillez réessayer.")}finally{h(!1)}},V=O=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(O)+" DH",I=O=>{const b={brouillon:"bg-gray-100 text-gray-800",envoyee:"bg-blue-100 text-blue-800",confirmee:"bg-green-100 text-green-800",livree:"bg-purple-100 text-purple-800",annulee:"bg-red-100 text-red-800"},S={brouillon:"Brouillon",envoyee:"Envoyée",confirmee:"Confirmée",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b[O]||b.brouillon}`,children:S[O]||O})};return l?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des détails..."})]})}):r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:e.numero_commande}),I(e.statut)]}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Bon de commande du ",new Date(e.date_commande).toLocaleDateString("fr-FR")]})]}),r.jsxs("button",{onClick:()=>window.print(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200 print:hidden",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer"]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ae,{className:"w-5 h-5"}),"Fournisseur"]}),r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.fournisseur.societe}),r.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.fournisseur.prenom," ",e.fournisseur.nom]}),r.jsx("div",{className:"text-sm text-gray-500 mt-1",children:e.fournisseur.numero_fournisseur})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(As,{className:"w-5 h-5"}),"Produits"]}),r.jsxs("button",{onClick:()=>m(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium transition-colors duration-200",children:[r.jsx(vt,{className:"w-4 h-4"}),"Ajouter produit"]})]}),s.length>0?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Produit"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Prix unitaire"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Quantité"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Dimension"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Total"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Total"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:s.map(O=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:O.produit.nom_produit}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"number",step:"0.01",min:"0",value:O.prix_unitaire,onChange:b=>A(O.id,Number(b.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"number",min:"1",step:"1",value:O.quantite_pieces,onChange:b=>$(O.id,Number(b.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})}),r.jsx("td",{className:"px-4 py-3",children:Z(O.produit.unite)?r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"number",min:"0",step:"0.01",value:O.quantite_unitaire,onChange:b=>T(O.id,Number(b.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),r.jsx("span",{className:"text-xs text-gray-500",children:J(O.produit.unite)})]}):r.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("div",{className:"text-sm font-medium text-blue-600",children:Z(O.produit.unite)?`${O.quantite_totale} ${J(O.produit.unite)}`:`${O.quantite_pieces} ${J(O.produit.unite)}`})}),r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:V(O.total_ligne)}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("button",{onClick:()=>D(O.id),className:"text-red-600 hover:text-red-800 p-1",children:r.jsx(Qo,{className:"w-4 h-4"})})})]},O.id))}),r.jsx("tfoot",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("td",{colSpan:5,className:"px-4 py-3 text-right text-sm font-semibold text-gray-900",children:"Total:"}),r.jsx("td",{className:"px-4 py-3 text-sm font-bold text-gray-900",children:V(q())}),r.jsx("td",{})]})})]})}):r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(As,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"Aucun article dans cette commande"})]})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("form",{onSubmit:Y,className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ha,{className:"w-5 h-5"}),"Modifier la commande"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"statut",className:"block text-sm font-medium text-gray-700 mb-1",children:"Statut"}),r.jsxs("select",{id:"statut",name:"statut",value:f.statut,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"brouillon",children:"Brouillon"}),r.jsx("option",{value:"envoyee",children:"Envoyée"}),r.jsx("option",{value:"confirmee",children:"Confirmée"}),r.jsx("option",{value:"livree",children:"Livrée"}),r.jsx("option",{value:"annulee",children:"Annulée"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),r.jsx("textarea",{id:"notes",name:"notes",rows:4,value:f.notes,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes pour cette commande..."})]})]}),r.jsxs("div",{className:"flex gap-4 pt-6 border-t border-gray-200 mt-6",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:j,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-3 rounded-lg flex items-center justify-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-4 h-4"}),j?"Enregistrement...":"Enregistrer"]})]}),c&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:c})})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Récapitulatif"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Date de commande:"}),r.jsx("span",{className:"font-medium",children:new Date(e.date_commande).toLocaleDateString("fr-FR")})]}),r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Nombre d'articles:"}),r.jsx("span",{className:"font-medium",children:s.reduce((O,b)=>O+b.quantite_pieces,0)})]}),r.jsxs("div",{className:"flex justify-between py-2 border-t border-gray-200 text-lg font-semibold",children:[r.jsx("span",{children:"Total:"}),r.jsx("span",{children:V(q())})]})]})]})]})]})}),r.jsxs("div",{className:"hidden print:block fixed inset-0 bg-white px-8 pt-0 pb-8",style:{marginTop:"-28px"},children:[r.jsxs("div",{className:"grid grid-cols-3 items-center border-b-2 border-gray-800 py-1 mb-2",children:[r.jsx("div",{className:"flex justify-start",children:r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"h-32 w-auto"})}),r.jsx("div",{className:"text-center",children:r.jsx("p",{className:"text-lg text-gray-900 font-bold",children:"BON DECOMMANDE"})}),r.jsx("div",{})]}),r.jsx("div",{className:"mb-8",children:r.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations Commande"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"N° BC:"}),r.jsx("span",{className:"text-gray-900",children:e.numero_commande})]}),r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"Date:"}),r.jsx("span",{className:"text-gray-900",children:new Date(e.date_commande).toLocaleDateString("fr-FR")})]}),r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"Statut:"}),r.jsx("span",{className:"text-gray-900",children:e.statut==="brouillon"?"Brouillon":e.statut==="envoyee"?"Envoyée":e.statut==="confirmee"?"Confirmée":e.statut==="livree"?"Livrée":e.statut==="annulee"?"Annulée":e.statut})]})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Fournisseur"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"Société:"}),r.jsx("span",{className:"text-gray-900",children:e.fournisseur.societe})]}),r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"Contact:"}),r.jsxs("span",{className:"text-gray-900",children:[e.fournisseur.prenom," ",e.fournisseur.nom]})]})]})]})]})}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Articles Commandés"}),r.jsxs("table",{className:"w-full border-collapse border border-gray-800",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-left font-semibold",children:"Produit"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-center font-semibold",children:"Nb Pièces"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-center font-semibold",children:"Dimension"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-center font-semibold",children:"Quantité Totale"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-right font-semibold",children:"Prix Unitaire"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-right font-semibold",children:"Total"})]})}),r.jsxs("tbody",{children:[s.map(O=>r.jsxs("tr",{children:[r.jsx("td",{className:"border border-gray-800 px-4 py-2",children:O.produit.nom_produit}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-center",children:O.quantite_pieces}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-center",children:Z(O.produit.unite)?`${O.quantite_unitaire} ${J(O.produit.unite)}`:"-"}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-center font-medium",children:Z(O.produit.unite)?`${O.quantite_totale} ${J(O.produit.unite)}`:`${O.quantite_pieces} ${J(O.produit.unite)}`}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-right",children:V(O.prix_unitaire)}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-right font-medium",children:V(O.total_ligne)})]},O.id)),r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("td",{className:"border border-gray-800 px-4 py-3 font-bold",colSpan:5,children:"TOTAL"}),r.jsx("td",{className:"border border-gray-800 px-4 py-3 text-right font-bold text-lg",children:V(q())})]})]})]})]}),f.notes&&r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Notes"}),r.jsx("div",{className:"border border-gray-300 p-4 rounded",children:r.jsx("p",{className:"text-gray-900",children:f.notes})})]}),r.jsx("div",{className:"absolute bottom-8 left-8 right-8 text-center text-xs text-gray-500 border-t border-gray-300 pt-4",children:r.jsxs("p",{children:["ANTURGOOD - Système de gestion wget.ma | Document généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 15px;
            size: A4 portrait;
          }
          
          /* Hide everything by default */
          body * {
            visibility: hidden;
          }
          
          /* Show only the print content */
          .print\\:block,
          .print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print content */
          .print\\:block {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            background: white !important;
            color: black !important;
            font-size: 12pt !important;
            line-height: 1.4 !important;
          }
          
          /* Table styling for print */
          table {
            border-collapse: collapse !important;
            width: 100% !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 8px !important;
          }
          
          /* Ensure proper page breaks */
          .print\\:block {
            page-break-inside: avoid;
          }
          
          /* Hide any remaining UI elements */
          nav, aside, button, .print\\:hidden {
            display: none !important;
            padding: 15px !important;
          }
        }
      `}),u&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ajouter un produit"})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"relative mb-4",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:p,onChange:O=>x(O.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.jsx("div",{className:"space-y-2",children:K.map(O=>r.jsx("button",{onClick:()=>M(O),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors duration-200",children:r.jsx("div",{className:"flex justify-between items-start",children:r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:O.nom_produit}),r.jsxs("div",{className:"text-sm text-gray-600",children:["Prix d'achat: ",V(O.prix_achat)]})]})})},O.id))})})]}),r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx("button",{onClick:()=>m(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Fermer"})})]})})]})},_g=({onNavigateToAdd:t,onNavigateToEdit:e,onNavigateToDetails:s})=>{const[n,a]=N.useState([]),[i,l]=N.useState(!0),[o,c]=N.useState(null),[d,u]=N.useState(1),[m,p]=N.useState(""),x=10,f=async()=>{try{l(!0),c(null);const{data:A,error:D}=await Q.from("chauffeurs").select(`
          id,
          numero_chauffeur,
          nom,
          prenom,
          telephone,
          immatricule,
          type_chauffeur,
          created_at
        `).order("created_at",{ascending:!1});if(D)throw D;a(A||[])}catch(A){console.error("Error fetching chauffeurs:",A),c("Erreur lors du chargement des chauffeurs")}finally{l(!1)}};ye.useEffect(()=>{f()},[]);const v=n.filter(A=>A.nom.toLowerCase().includes(m.toLowerCase())||A.prenom.toLowerCase().includes(m.toLowerCase())||A.numero_chauffeur.toLowerCase().includes(m.toLowerCase())||A.telephone.toLowerCase().includes(m.toLowerCase())||A.immatricule.toLowerCase().includes(m.toLowerCase())),j=Math.ceil(v.length/x),h=(d-1)*x,y=h+x,g=v.slice(h,y),C=A=>{u(A)},M=()=>{d>1&&u(d-1)},$=()=>{d<j&&u(d+1)},T=A=>{e(A)};return i?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des chauffeurs..."})]})}):o?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:o}),r.jsx("button",{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Chauffeurs"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos chauffeurs et leurs véhicules assignés"})]}),r.jsxs("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200 shadow-sm",children:[r.jsx(vt,{className:"w-5 h-5"}),"Ajouter un chauffeur"]})]}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un chauffeur...",value:m,onChange:A=>p(A.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro Chauffeur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Nom & Prénom"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Téléphone"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Véhicule Assigné"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Type"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.length>0?g.map(A=>r.jsxs("tr",{onClick:()=>s==null?void 0:s(A),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:A.numero_chauffeur}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:r.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:r.jsx(we,{className:"h-5 w-5 text-blue-600"})})}),r.jsx("div",{className:"ml-4",children:r.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[A.prenom," ",A.nom]})})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:A.telephone}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"flex items-center",children:r.jsx("div",{className:"text-sm font-medium text-gray-900 bg-gray-100 px-3 py-1 rounded-full font-mono",children:A.immatricule})})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${A.type_chauffeur==="interne"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:A.type_chauffeur==="interne"?"Interne":"Externe"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:D=>{D.stopPropagation(),s==null||s(A)},className:"text-blue-600 hover:text-blue-900 flex items-center gap-1",children:[r.jsx(zr,{className:"w-4 h-4"}),"Voir"]}),r.jsx("button",{onClick:D=>{D.stopPropagation(),T(A)},className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors duration-200",children:"Modifier"})]})})]},A.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(we,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:m?"Aucun chauffeur trouvé":"Aucun chauffeur disponible"}),!m&&r.jsx("button",{onClick:t,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Ajouter votre premier chauffeur"})]})})})})]})})}),j>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",h+1," à ",Math.min(y,v.length)," sur ",v.length," chauffeurs"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:M,disabled:d===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:j},(A,D)=>D+1).map(A=>r.jsx("button",{onClick:()=>C(A),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${d===A?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:A},A)),r.jsx("button",{onClick:$,disabled:d===j,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]})]})},kg=({onNavigateBack:t})=>{const[e,s]=N.useState({nom:"",prenom:"",telephone:"",immatricule:"",type_chauffeur:"externe"}),[n,a]=N.useState({}),[i,l]=N.useState(!1),[o,c]=N.useState(""),d=async()=>{try{const{data:x,error:f}=await Q.from("chauffeurs").select("numero_chauffeur").order("created_at",{ascending:!1}).limit(1);if(f)throw f;let v=1;if(x&&x.length>0){const j=x[0].numero_chauffeur.replace("CHA-","");v=parseInt(j)+1}return`CHA-${String(v).padStart(3,"0")}`}catch(x){return console.error("Error generating chauffeur number:",x),"CHA-001"}};ye.useEffect(()=>{d().then(c)},[]);const u=x=>{const{name:f,value:v}=x.target;s(j=>({...j,[f]:v})),n[f]&&a(j=>({...j,[f]:""}))},m=()=>{const x={};return e.nom.trim()||(x.nom="Le nom est requis"),e.prenom.trim()||(x.prenom="Le prénom est requis"),e.telephone.trim()?/^(\+212|0)[5-7]\d{8}$/.test(e.telephone.replace(/\s/g,""))||(x.telephone="Format de téléphone marocain invalide"):x.telephone="Le téléphone est requis",e.immatricule.trim()?/^[0-9]+\s*[|‎-]\s*[أ-ي]+\s*[|‎-]\s*[0-9]+$|^[0-9]{1,6}\s*[A-Z]{1,3}\s*[0-9]{1,3}$/.test(e.immatricule.trim())||(x.immatricule="Format d'immatricule invalide (ex: 123456 A 12 ou 12345|أ|67)"):x.immatricule="L'immatricule est requise",a(x),Object.keys(x).length===0},p=async x=>{var f,v;if(x.preventDefault(),!!m()){l(!0);try{const{data:j,error:h}=await Q.from("chauffeurs").insert([{numero_chauffeur:o,nom:e.nom.trim(),prenom:e.prenom.trim(),telephone:e.telephone.trim(),immatricule:e.immatricule.trim(),type_chauffeur:e.type_chauffeur}]).select();if(h)throw h;console.log("Chauffeur saved successfully:",j),s({nom:"",prenom:"",telephone:"",immatricule:"",type_chauffeur:"externe"}),t()}catch(j){console.error("Error saving chauffeur:",j),j.code==="23505"?(f=j.details)!=null&&f.includes("numero_chauffeur")?a({general:"Ce numéro chauffeur existe déjà"}):(v=j.details)!=null&&v.includes("immatricule")?a({immatricule:"Cette immatricule est déjà utilisée"}):a({general:"Ces informations existent déjà"}):a({general:"Erreur lors de l'enregistrement. Veuillez réessayer."})}finally{l(!1)}}};return o?r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Ajouter un chauffeur"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Créez un nouveau chauffeur dans le système"})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"max-w-2xl bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:p,className:"space-y-6",children:[n.general&&r.jsx("div",{className:"rounded-md bg-red-50 p-4",children:r.jsx("div",{className:"text-sm text-red-700",children:n.general})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro Chauffeur"}),r.jsx("input",{type:"text",value:o,readOnly:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ce numéro sera généré automatiquement"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prenom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prénom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"prenom",name:"prenom",value:e.prenom,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.prenom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le prénom"}),n.prenom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.prenom})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"nom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"nom",name:"nom",value:e.nom,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.nom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom"}),n.nom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.nom})]})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"telephone",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Téléphone ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"tel",id:"telephone",name:"telephone",value:e.telephone,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${n.telephone?"border-red-500":"border-gray-300"}`,placeholder:"+212 6 12 34 56 78"}),n.telephone&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.telephone}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: +212 6 XX XX XX XX ou 06 XX XX XX XX"})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"immatricule",className:"block text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[r.jsx(we,{className:"w-4 h-4"}),"Véhicule Assigné (Immatricule) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"immatricule",name:"immatricule",value:e.immatricule,onChange:u,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 font-mono ${n.immatricule?"border-red-500":"border-gray-300"}`,placeholder:"123456 A 12 ou 12345|أ|67"}),n.immatricule&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.immatricule}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Véhicule par défaut assigné au chauffeur. Peut être modifié lors des livraisons."})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"type_chauffeur",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Type de Chauffeur ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"type_chauffeur",name:"type_chauffeur",value:e.type_chauffeur,onChange:x=>s(f=>({...f,type_chauffeur:x.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200",children:[r.jsx("option",{value:"externe",children:"Externe (Payé par BL)"}),r.jsx("option",{value:"interne",children:"Interne (Salaire fixe)"})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Les chauffeurs externes sont payés par bon de livraison, les internes reçoivent un salaire fixe."})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:i,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),i?"Enregistrement...":"Enregistrer le chauffeur"]})]})})]})})})]}):r.jsx("div",{className:"min-h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500",children:"Chargement..."})})},Cg=({onNavigateBack:t,chauffeur:e})=>{const[s,n]=N.useState({nom:e.nom,prenom:e.prenom,telephone:e.telephone,immatricule:e.immatricule,type_chauffeur:e.type_chauffeur||"externe"}),[a,i]=N.useState({}),[l,o]=N.useState(!1),c=m=>{const{name:p,value:x}=m.target;n(f=>({...f,[p]:x})),a[p]&&i(f=>({...f,[p]:""}))},d=()=>{const m={};return s.nom.trim()||(m.nom="Le nom est requis"),s.prenom.trim()||(m.prenom="Le prénom est requis"),s.telephone.trim()?/^(\+212|0)[5-7]\d{8}$/.test(s.telephone.replace(/\s/g,""))||(m.telephone="Format de téléphone marocain invalide"):m.telephone="Le téléphone est requis",s.immatricule.trim()?/^[0-9]+\s*[|‎-]\s*[أ-ي]+\s*[|‎-]\s*[0-9]+$|^[0-9]{1,6}\s*[A-Z]{1,3}\s*[0-9]{1,3}$/.test(s.immatricule.trim())||(m.immatricule="Format d'immatricule invalide (ex: 123456 A 12 ou 12345|أ|67)"):m.immatricule="L'immatricule est requise",i(m),Object.keys(m).length===0},u=async m=>{var p;if(m.preventDefault(),!!d()){o(!0);try{const{data:x,error:f}=await Q.from("chauffeurs").update({nom:s.nom.trim(),prenom:s.prenom.trim(),telephone:s.telephone.trim(),immatricule:s.immatricule.trim(),type_chauffeur:s.type_chauffeur}).eq("id",e.id).select();if(f)throw f;console.log("Chauffeur updated successfully:",x),t()}catch(x){console.error("Error updating chauffeur:",x),x.code==="23505"?(p=x.details)!=null&&p.includes("immatricule")?i({immatricule:"Cette immatricule est déjà utilisée par un autre chauffeur"}):i({general:"Ces informations existent déjà"}):i({general:"Erreur lors de la modification. Veuillez réessayer."})}finally{o(!1)}}};return r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier le chauffeur"}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Modifiez les informations du chauffeur ",e.numero_chauffeur]})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsx("div",{className:"max-w-2xl bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsxs("form",{onSubmit:u,className:"space-y-6",children:[a.general&&r.jsx("div",{className:"rounded-md bg-red-50 p-4",children:r.jsx("div",{className:"text-sm text-red-700",children:a.general})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Numéro Chauffeur"}),r.jsx("input",{type:"text",value:e.numero_chauffeur,readOnly:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"prenom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Prénom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"prenom",name:"prenom",value:s.prenom,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.prenom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le prénom"}),a.prenom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.prenom})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"nom",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nom ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"nom",name:"nom",value:s.nom,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.nom?"border-red-500":"border-gray-300"}`,placeholder:"Entrez le nom"}),a.nom&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.nom})]})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"telephone",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Téléphone ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"tel",id:"telephone",name:"telephone",value:s.telephone,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${a.telephone?"border-red-500":"border-gray-300"}`,placeholder:"+212 6 12 34 56 78"}),a.telephone&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.telephone}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: +212 6 XX XX XX XX ou 06 XX XX XX XX"})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"immatricule",className:"block text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[r.jsx(we,{className:"w-4 h-4"}),"Véhicule Assigné (Immatricule) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"immatricule",name:"immatricule",value:s.immatricule,onChange:c,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 font-mono ${a.immatricule?"border-red-500":"border-gray-300"}`,placeholder:"123456 A 12 ou 12345|أ|67"}),a.immatricule&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.immatricule}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Véhicule par défaut assigné au chauffeur. Peut être modifié lors des livraisons."})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"type_chauffeur",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Type de Chauffeur ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"type_chauffeur",name:"type_chauffeur",value:s.type_chauffeur,onChange:m=>n(p=>({...p,type_chauffeur:m.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200",children:[r.jsx("option",{value:"externe",children:"Externe (Payé par BL)"}),r.jsx("option",{value:"interne",children:"Interne (Salaire fixe)"})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Les chauffeurs externes sont payés par bon de livraison, les internes reçoivent un salaire fixe."})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:l,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),l?"Enregistrement...":"Modifier le chauffeur"]})]})})]})})})]})},Sg=({onNavigateToAdd:t,onNavigateToEdit:e})=>{const[s,n]=N.useState([]),[a,i]=N.useState(!0),[l,o]=N.useState(null),[c,d]=N.useState(1),[u,m]=N.useState(""),[p,x]=N.useState(20),[f,v]=N.useState({dateFrom:"",dateTo:""}),[j,h]=N.useState(""),[y,g]=N.useState(""),[C,M]=N.useState([]),$=async()=>{try{i(!0),o(null);const{data:P,error:B}=await Q.from("bon_de_livraison").select(`
          *,
          client:clients(nom, prenom, societe),
          chauffeur:chauffeurs(nom, prenom),
          bon_commande:bon_de_commande(numero_commande, fournisseur:fournisseurs(nom, prenom, societe))
        `).neq("statut","annulee").order("created_at",{ascending:!1});if(B)throw B;n(P||[]);const k=Array.from(new Map((P||[]).map(z=>[z.chauffeur.nom+z.chauffeur.prenom,{id:z.chauffeur.nom+z.chauffeur.prenom,nom:z.chauffeur.nom,prenom:z.chauffeur.prenom}])).values());M(k)}catch(P){console.error("Error fetching delivery notes:",P),o("Erreur lors du chargement des bons de livraison")}finally{i(!1)}};ye.useEffect(()=>{$()},[]);const T=(P,B)=>{v(k=>({...k,[P]:B})),d(1)},A=()=>{v({dateFrom:"",dateTo:""}),h(""),g(""),d(1)},D=()=>f.dateFrom||f.dateTo||j||y,q=P=>{if(!f.dateFrom&&!f.dateTo)return!0;const B=P,k=!f.dateFrom||B>=f.dateFrom,z=!f.dateTo||B<=f.dateTo;return k&&z},J=s.filter(P=>{var k,z,ee,ne,ie,ue,ge,be;const B=u.toLowerCase();return P.numero_livraison.toLowerCase().includes(B)||P.bon_commande.numero_commande.toLowerCase().includes(B)||P.client.nom.toLowerCase().includes(B)||P.client.prenom.toLowerCase().includes(B)||P.client.societe.toLowerCase().includes(B)||`${P.client.prenom} ${P.client.nom}`.toLowerCase().includes(B)||`${P.client.nom} ${P.client.prenom}`.toLowerCase().includes(B)||P.chauffeur.nom.toLowerCase().includes(B)||P.chauffeur.prenom.toLowerCase().includes(B)||`${P.chauffeur.prenom} ${P.chauffeur.nom}`.toLowerCase().includes(B)||`${P.chauffeur.nom} ${P.chauffeur.prenom}`.toLowerCase().includes(B)||(((k=P.bon_commande.fournisseur)==null?void 0:k.nom)||"").toLowerCase().includes(B)||(((z=P.bon_commande.fournisseur)==null?void 0:z.prenom)||"").toLowerCase().includes(B)||(((ee=P.bon_commande.fournisseur)==null?void 0:ee.societe)||"").toLowerCase().includes(B)||(((ne=P.bon_commande.fournisseur)==null?void 0:ne.numero_fournisseur)||"").toLowerCase().includes(B)||`${((ie=P.bon_commande.fournisseur)==null?void 0:ie.prenom)||""} ${((ue=P.bon_commande.fournisseur)==null?void 0:ue.nom)||""}`.toLowerCase().includes(B)||`${((ge=P.bon_commande.fournisseur)==null?void 0:ge.nom)||""} ${((be=P.bon_commande.fournisseur)==null?void 0:be.prenom)||""}`.toLowerCase().includes(B)}).filter(P=>{const B=q(P.date_livraison),k=!j||P.statut===j,z=!y||P.chauffeur.nom+P.chauffeur.prenom===y;return B&&k&&z}),Z=Math.ceil(J.length/p),Y=(c-1)*p,V=Y+p,I=J.slice(Y,V),O=P=>{d(P)},b=()=>{c>1&&d(c-1)},S=()=>{c<Z&&d(c+1)},E=P=>{x(P),d(1)},w=()=>{const P=["Numéro BL","BC Source","Date Livraison","Fournisseur","Client","Chauffeur","Statut","Total (DH)","Notes"],B=J.map(ie=>{var ue,ge,be;return[ie.numero_livraison,ie.bon_commande.numero_commande,new Date(ie.date_livraison).toLocaleDateString("fr-FR"),((ue=ie.bon_commande.fournisseur)==null?void 0:ue.societe)||`${((ge=ie.bon_commande.fournisseur)==null?void 0:ge.prenom)||""} ${((be=ie.bon_commande.fournisseur)==null?void 0:be.nom)||""}`.trim()||"Non spécifié",ie.client.societe||`${ie.client.prenom} ${ie.client.nom}`,`${ie.chauffeur.prenom} ${ie.chauffeur.nom}`,ie.statut==="en_preparation"?"En préparation":ie.statut==="en_cours"?"En cours":ie.statut==="livree"?"Livrée":ie.statut==="annulee"?"Annulée":ie.statut,ie.total_ht.toFixed(2),ie.notes||""]}),k=[P,...B].map(ie=>ie.map(ue=>`"${ue}"`).join(",")).join(`
`);B.push([`TOTAUX (${J.length} livraisons)`,"","","","","","",L.totalAmount.toFixed(2),""]);const z=new Blob([k],{type:"text/csv;charset=utf-8;"}),ee=document.createElement("a"),ne=URL.createObjectURL(z);ee.setAttribute("href",ne),ee.setAttribute("download",`bons_livraison_${new Date().toISOString().split("T")[0]}.csv`),ee.style.visibility="hidden",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee)},L=(()=>{const P=J.filter(ee=>ee.statut==="livree"),B=J.filter(ee=>ee.statut!=="livree"&&ee.statut!=="annulee"),k=J.filter(ee=>ee.statut==="en_preparation"),z=J.filter(ee=>ee.statut==="en_cours");return{totalAmount:J.reduce((ee,ne)=>ee+ne.total_ht,0),deliveredTotal:P.reduce((ee,ne)=>ee+ne.total_ht,0),pendingTotal:B.reduce((ee,ne)=>ee+ne.total_ht,0),count:J.length,deliveredCount:P.length,pendingCount:B.length,preparationCount:k.length,inProgressCount:z.length}})(),U=P=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(P)+" DH",se=P=>{const B={en_preparation:"bg-yellow-100 text-yellow-800",en_cours:"bg-blue-100 text-blue-800",livree:"bg-green-100 text-green-800",annulee:"bg-red-100 text-red-800"},k={en_preparation:"En préparation",en_cours:"En cours",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${B[P]||B.en_preparation}`,children:k[P]||P})};return a?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des bons de livraison..."})]})}):l?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:l}),r.jsx("button",{onClick:$,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bons de livraison"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos livraisons clients"})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:w,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(Qr,{className:"w-4 h-4"}),"Exporter CSV (",J.length,")"]}),r.jsxs("button",{onClick:()=>window.print(),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer (",J.length,")"]}),r.jsxs("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200 shadow-sm",children:[r.jsx(vt,{className:"w-5 h-5"}),"Créer un bon de livraison"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Livraisons"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:L.count}),r.jsx("p",{className:"text-sm font-medium text-blue-600",children:U(L.totalAmount)})]}),r.jsx(we,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Livrées"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:L.deliveredCount}),r.jsx("p",{className:"text-sm font-medium text-green-600",children:U(L.deliveredTotal)})]}),r.jsx(Fs,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"En Cours"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:L.pendingCount}),r.jsx("p",{className:"text-sm font-medium text-blue-600",children:U(L.pendingTotal)})]}),r.jsx(hn,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"En Préparation"}),r.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:L.preparationCount}),r.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"À traiter"})]}),r.jsx(Ls,{className:"w-8 h-8 text-yellow-600"})]})})]}),r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher par numéro, client ou chauffeur...",value:u,onChange:P=>m(P.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtres avancés"}),D()&&r.jsxs("button",{onClick:A,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:[r.jsx(Wr,{className:"w-4 h-4"}),"Effacer tous les filtres"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:f.dateFrom,onChange:P=>T("dateFrom",P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:f.dateTo,onChange:P=>T("dateTo",P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Statut"}),r.jsxs("select",{id:"status-filter",value:j,onChange:P=>{h(P.target.value),d(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[r.jsx("option",{value:"",children:"Tous les statuts"}),r.jsx("option",{value:"en_preparation",children:"En préparation"}),r.jsx("option",{value:"en_cours",children:"En cours"}),r.jsx("option",{value:"livree",children:"Livrée"}),r.jsx("option",{value:"annulee",children:"Annulée"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"chauffeur-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Chauffeur"}),r.jsxs("select",{id:"chauffeur-filter",value:y,onChange:P=>{g(P.target.value),d(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[r.jsx("option",{value:"",children:"Tous les chauffeurs"}),C.map(P=>r.jsxs("option",{value:P.id,children:[P.prenom," ",P.nom]},P.id))]})]})]}),D()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:J.length})," bon(s) de livraison trouvé(s) avec les filtres actifs"]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Total filtré: ",U(J.reduce((P,B)=>P+B.total_ht,0))]})]})})]}),r.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro BL"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Bon de commande"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Fournisseur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Client"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Chauffeur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.length>0?I.map(P=>{var B,k,z;return r.jsxs("tr",{onClick:()=>e(P),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:P.numero_livraison}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono",children:P.bon_commande.numero_commande}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm font-medium text-gray-900",children:((B=P.bon_commande.fournisseur)==null?void 0:B.societe)||`${(k=P.bon_commande.fournisseur)==null?void 0:k.prenom} ${(z=P.bon_commande.fournisseur)==null?void 0:z.nom}`})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:P.client.societe}),r.jsxs("div",{className:"text-sm text-gray-500",children:[P.client.prenom," ",P.client.nom]})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(we,{className:"w-4 h-4 text-gray-400 mr-2"}),r.jsxs("div",{className:"text-sm text-gray-900",children:[P.chauffeur.prenom," ",P.chauffeur.nom]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(P.date_livraison).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:se(P.statut)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:U(P.total_ht)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("button",{onClick:ee=>{ee.stopPropagation(),e(P)},className:"text-blue-600 hover:text-blue-900 flex items-center gap-1",children:[r.jsx(zr,{className:"w-4 h-4"}),"Voir"]})})]},P.id)}):r.jsx("tr",{children:r.jsx("td",{colSpan:9,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(we,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:u?"Aucun bon de livraison trouvé":"Aucun bon de livraison disponible"}),!u&&r.jsx("button",{onClick:t,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Créer votre premier bon de livraison"})]})})})})]})})}),Z>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",Y+1," à ",Math.min(V,J.length)," sur ",J.length," bons de livraison"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Éléments par page:"}),r.jsxs("select",{value:p,onChange:P=>E(Number(P.target.value)),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:20,children:"20"}),r.jsx("option",{value:60,children:"60"}),r.jsx("option",{value:100,children:"100"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:b,disabled:c===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:Z},(P,B)=>B+1).map(P=>r.jsx("button",{onClick:()=>O(P),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${c===P?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:P},P)),r.jsx("button",{onClick:S,disabled:c===Z,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"hidden print:block fixed inset-0 bg-white p-8",children:[r.jsxs("div",{className:"relative text-center border-b-2 border-gray-800 pb-6 mb-8",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"absolute top-0 left-0 h-24 w-auto"}),r.jsx("p",{className:"text-lg text-gray-700 mt-2",children:"LISTE DES BONS DE LIVRAISON"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")," |",J.length," livraison(s) | Total: ",U(L.totalAmount)]})]}),r.jsxs("table",{className:"w-full border-collapse border border-gray-800",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"N° BL"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"BC Source"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Fournisseur"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Client"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Chauffeur"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Date"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-left font-semibold text-sm",children:"Statut"}),r.jsx("th",{className:"border border-gray-800 px-3 py-2 text-right font-semibold text-sm",children:"Total"})]})}),r.jsx("tbody",{children:J.map(P=>{var B,k,z;return r.jsxs("tr",{children:[r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:P.numero_livraison}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm font-mono",children:P.bon_commande.numero_commande}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:((B=P.bon_commande.fournisseur)==null?void 0:B.societe)||`${((k=P.bon_commande.fournisseur)==null?void 0:k.prenom)||""} ${((z=P.bon_commande.fournisseur)==null?void 0:z.nom)||""}`.trim()||"Non spécifié"}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:P.client.societe||`${P.client.prenom} ${P.client.nom}`}),r.jsxs("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:[P.chauffeur.prenom," ",P.chauffeur.nom]}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:new Date(P.date_livraison).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm",children:P.statut==="en_preparation"?"En préparation":P.statut==="en_cours"?"En cours":P.statut==="livree"?"Livrée":P.statut==="annulee"?"Annulée":P.statut}),r.jsx("td",{className:"border border-gray-800 px-3 py-2 text-sm text-right font-medium",children:U(P.total_ht)})]},P.id)})}),r.jsx("tfoot",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsxs("td",{className:"border border-gray-800 px-3 py-3 font-bold text-sm",colSpan:7,children:["TOTAUX (",J.length," livraisons)"]}),r.jsx("td",{className:"border border-gray-800 px-3 py-3 text-right font-bold text-sm",children:U(L.totalAmount)})]})})]}),r.jsx("div",{className:"absolute bottom-8 left-8 right-8 text-center text-xs text-gray-500 border-t border-gray-300 pt-4",children:r.jsxs("p",{children:["ANTURGOOD - Système de gestion | Document généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 1cm;
            size: A4 portrait;
          }
          
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          /* Hide everything by default */
          body * {
            visibility: hidden;
          }
          
          /* Show only the print content */
          .print\\:block,
          .print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print content */
          .print\\:block {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            padding: 1cm !important;
            background: white !important;
            color: black !important;
            font-size: 12pt !important;
            line-height: 1.4 !important;
          }
          
          /* Table styling for print */
          table {
            border-collapse: collapse !important;
            width: 100% !important;
            font-size: 10pt !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 4px !important;
          }
          
          /* Page breaks */
          tbody tr {
            page-break-inside: avoid;
          }
          
          thead {
            display: table-header-group;
          }
          
          tfoot {
            display: table-footer-group;
            page-break-inside: avoid;
          }
          
          /* Hide any remaining UI elements */
          nav, aside, button:not(.print\\:block button), .print\\:hidden {
            display: none !important;
          }
        }
      `})]})},Eg=({onNavigateBack:t,preSelectedPurchaseOrder:e})=>{const[s,n]=N.useState(null),[a,i]=N.useState(null),[l,o]=N.useState(null),[c,d]=N.useState(""),[u,m]=N.useState([]),[p,x]=N.useState([]),[f,v]=N.useState([]),[j,h]=N.useState([]),[y,g]=N.useState(!1),[C,M]=N.useState(!1),[$,T]=N.useState(!1),[A,D]=N.useState(""),[q,K]=N.useState(""),[J,Z]=N.useState(""),[Y,V]=N.useState({date_livraison:new Date().toISOString().split("T")[0],notes:""}),[I,O]=N.useState({}),[b,S]=N.useState(!1),[E,w]=N.useState(""),R=async()=>{try{const{data:_,error:F}=await Q.from("bon_de_livraison").select("numero_livraison").order("created_at",{ascending:!1}).limit(1);if(F)throw F;let X=1;if(_&&_.length>0){const le=_[0].numero_livraison.replace("BL-","");X=parseInt(le)+1}return`BL-${String(X).padStart(4,"0")}`}catch(_){return console.error("Error generating delivery number:",_),"BL-0001"}};ye.useEffect(()=>{(async()=>{await Promise.all([R().then(w),L(),U(),se()]),e&&(n(e),P(e.id))})()},[e]);const L=async()=>{try{const{data:_,error:F}=await Q.from("bon_de_livraison").select("bon_commande_id");if(F)throw F;const X=(_||[]).map(kt=>kt.bon_commande_id),{data:le,error:ae}=await Q.from("bon_de_commande").select(`
          *,
          fournisseur:fournisseurs(societe)
        `).neq("statut","annulee").order("created_at",{ascending:!1});if(ae)throw ae;const Se=(le||[]).filter(kt=>!X.includes(kt.id));m(Se)}catch(_){console.error("Error fetching purchase orders:",_)}},U=async()=>{try{const{data:_,error:F}=await Q.from("clients").select("*").order("societe",{ascending:!0});if(F)throw F;x(_||[])}catch(_){console.error("Error fetching clients:",_)}},se=async()=>{try{const{data:_,error:F}=await Q.from("chauffeurs").select("*").order("nom",{ascending:!0});if(F)throw F;v(_||[])}catch(_){console.error("Error fetching chauffeurs:",_)}},P=async _=>{try{const{data:F,error:X}=await Q.from("bon_de_commande_items").select(`
          *,
          produit:produits(id, nom_produit, prix_vente, unite, dimension_standard)
        `).eq("commande_id",_);if(X)throw X;console.log("BC Items data:",F);const le=(F||[]).map(ae=>(console.log("Processing item:",ae),console.log("Product data:",ae.produit),{id:ae.id,produit_id:ae.produit_id,nom_produit:ae.produit.nom_produit,prix_unitaire:ae.prix_unitaire,quantite_pieces:ae.quantite_pieces,quantite_unitaire:ae.quantite_unitaire,quantite_totale:ae.quantite,total:ae.prix_unitaire*ae.quantite,unite:ae.produit.unite,produit:{nom_produit:ae.produit.nom_produit,unite:ae.produit.unite,dimension_standard:ae.produit.dimension_standard}}));console.log("Converted items:",le),h(le)}catch(F){console.error("Error fetching order items:",F)}},B=_=>{const{name:F,value:X}=_.target;V(le=>({...le,[F]:X}))},k=_=>{n(_),P(_.id),g(!1),D("")},z=_=>{i(_),M(!1),K("")},ee=_=>{o(_),d(_.immatricule),T(!1),Z("")},ne=()=>j.reduce((_,F)=>_+F.total,0),ie=u.filter(_=>_.numero_commande.toLowerCase().includes(A.toLowerCase())||_.fournisseur.societe.toLowerCase().includes(A.toLowerCase())),ue=p.filter(_=>_.societe.toLowerCase().includes(q.toLowerCase())||_.nom.toLowerCase().includes(q.toLowerCase())||_.prenom.toLowerCase().includes(q.toLowerCase())),ge=f.filter(_=>_.nom.toLowerCase().includes(J.toLowerCase())||_.prenom.toLowerCase().includes(J.toLowerCase())||_.numero_chauffeur.toLowerCase().includes(J.toLowerCase())),be=()=>{const _={};return s||(_.purchaseOrder="Veuillez sélectionner un bon de commande"),a||(_.client="Veuillez sélectionner un client"),l||(_.chauffeur="Veuillez sélectionner un chauffeur"),c.trim()||(_.immatricule="L'immatricule du véhicule est requise"),Y.date_livraison||(_.date_livraison="La date de livraison est requise"),O(_),Object.keys(_).length===0},Le=(_,F)=>{h(X=>X.map(le=>le.id===_?{...le,prix_unitaire:F,total:F*le.quantite_totale}:le))},ce=async()=>{if(be()){S(!0),O({});try{const{data:_,error:F}=await Q.from("bon_de_livraison").insert({numero_livraison:E,bon_commande_id:s.id,client_id:a.id,chauffeur_id:l.id,immatricule_utilise:c,date_livraison:Y.date_livraison,notes:Y.notes,statut:"livree",total_ht:ne()}).select().single();if(F)throw F;const X=j.map(Se=>({livraison_id:_.id,produit_id:Se.produit_id,quantite_commandee:Se.quantite_totale,quantite_livree:Se.quantite_totale,prix_unitaire:Se.prix_unitaire})),{error:le}=await Q.from("bon_de_livraison_items").insert(X);if(le)throw le;const{error:ae}=await Q.from("bon_de_commande").update({statut:"livree",client_id:a.id}).eq("id",s.id);ae?console.error("Error updating purchase order:",ae):console.log("Purchase order updated to delivered status with client assignment"),console.log("Delivery note created successfully:",_),t()}catch(_){console.error("Error creating delivery note:",_),O({general:"Erreur lors de la création. Veuillez réessayer."})}finally{S(!1)}}},te=_=>({unite:"Unité",ml:"ML",m2:"M²",kg:"KG",l:"L",pcs:"PCS",box:"Boîte",cm:"CM",m:"M",g:"G",t:"T"})[_]||_.toUpperCase(),G=_=>{const F={unite:"bg-gray-100 text-gray-800",ml:"bg-blue-100 text-blue-800",m2:"bg-green-100 text-green-800",kg:"bg-purple-100 text-purple-800",l:"bg-cyan-100 text-cyan-800",pcs:"bg-orange-100 text-orange-800",box:"bg-amber-100 text-amber-800",cm:"bg-indigo-100 text-indigo-800",m:"bg-teal-100 text-teal-800",g:"bg-pink-100 text-pink-800",t:"bg-red-100 text-red-800"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${F[_]||F.unite}`,children:te(_)})},H=_=>["ml","m2","kg","l","cm","m","g","t"].includes(_),oe=_=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(_)+" DH";return E?r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Créer un bon de livraison"}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Numéro: ",E]})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ae,{className:"w-5 h-5"}),"Bon de commande source"]}),s?r.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:s.numero_commande}),r.jsxs("p",{className:"text-sm text-gray-600",children:[s.fournisseur.societe," - ",oe(s.total_ht)]})]}),r.jsx("button",{onClick:()=>g(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Changer"})]}):r.jsxs("button",{onClick:()=>g(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors duration-200 flex items-center justify-center gap-2 text-gray-600 hover:text-blue-600",children:[r.jsx(vt,{className:"w-5 h-5"}),"Sélectionner un bon de commande"]}),I.purchaseOrder&&r.jsx("p",{className:"text-red-500 text-sm mt-2",children:I.purchaseOrder})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Lt,{className:"w-5 h-5"}),"Client à livrer"]}),a?r.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:a.societe}),r.jsxs("p",{className:"text-sm text-gray-600",children:[a.prenom," ",a.nom," - ",a.numero_client]})]}),r.jsx("button",{onClick:()=>M(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Changer"})]}):r.jsxs("button",{onClick:()=>M(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors duration-200 flex items-center justify-center gap-2 text-gray-600 hover:text-blue-600",children:[r.jsx(vt,{className:"w-5 h-5"}),"Sélectionner un client"]}),I.client&&r.jsx("p",{className:"text-red-500 text-sm mt-2",children:I.client})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(we,{className:"w-5 h-5"}),"Chauffeur et véhicule"]}),l?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsxs("div",{children:[r.jsxs("p",{className:"font-medium text-gray-900",children:[l.prenom," ",l.nom]}),r.jsx("p",{className:"text-sm text-gray-600",children:l.numero_chauffeur})]}),r.jsx("button",{onClick:()=>T(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Changer"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"immatricule",className:"block text-sm font-medium text-gray-700 mb-2",children:"Véhicule utilisé (Immatricule)"}),r.jsx("input",{type:"text",id:"immatricule",value:c,onChange:_=>d(_.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono ${I.immatricule?"border-red-500":"border-gray-300"}`,placeholder:"Immatricule du véhicule"}),I.immatricule&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:I.immatricule}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Véhicule par défaut: ",l.immatricule]})]})]}):r.jsxs("button",{onClick:()=>T(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors duration-200 flex items-center justify-center gap-2 text-gray-600 hover:text-blue-600",children:[r.jsx(vt,{className:"w-5 h-5"}),"Sélectionner un chauffeur"]}),I.chauffeur&&r.jsx("p",{className:"text-red-500 text-sm mt-2",children:I.chauffeur})]}),j.length>0&&r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Produits à livrer"}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Produit"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Unité"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Prix unitaire"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Quantité"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Dimension"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Quantité Totale"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Total Prix"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(_=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:_.nom_produit}),r.jsx("td",{className:"px-4 py-3 text-center",children:G(_.produit.unite)}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"number",step:"0.01",min:"0",value:_.prix_unitaire,onChange:F=>Le(_.id,Number(F.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:_.quantite_pieces}),r.jsx("td",{className:"px-4 py-3",children:H(_.produit.unite)?r.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[_.quantite_unitaire," ",te(_.produit.unite)]}):r.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("div",{className:"text-sm font-medium text-blue-600",children:H(_.produit.unite)?`${_.quantite_totale} ${te(_.produit.unite)}`:`${_.quantite_pieces} ${te(_.produit.unite)}`})}),r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:oe(_.total)})]},_.id))})]})})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations livraison"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date_livraison",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de livraison"}),r.jsx("input",{type:"date",id:"date_livraison",name:"date_livraison",value:Y.date_livraison,onChange:B,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${I.date_livraison?"border-red-500":"border-gray-300"}`}),I.date_livraison&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:I.date_livraison})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optionnel)"}),r.jsx("textarea",{id:"notes",name:"notes",rows:3,value:Y.notes,onChange:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes pour cette livraison..."})]})]})]}),j.length>0&&r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Récapitulatif"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-200",children:[r.jsx("span",{className:"text-gray-600",children:"Nombre d'articles:"}),r.jsx("span",{className:"font-medium",children:j.reduce((_,F)=>_+F.quantite_pieces,0)})]}),r.jsxs("div",{className:"flex justify-between py-2 text-lg font-semibold",children:[r.jsx("span",{children:"Total:"}),r.jsx("span",{children:oe(ne())})]})]})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{onClick:ce,disabled:b,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-3 rounded-lg flex items-center justify-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-4 h-4"}),b?"Création...":"Créer"]})]}),I.general&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:I.general})})]})]})}),y&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sélectionner un bon de commande"})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"relative mb-4",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher par numéro ou fournisseur...",value:A,onChange:_=>D(_.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.jsxs("div",{className:"space-y-2",children:[ie.map(_=>r.jsx("button",{onClick:()=>k(_),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors duration-200",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:_.numero_commande}),r.jsx("div",{className:"text-sm text-gray-600",children:_.fournisseur.societe}),r.jsx("div",{className:"text-xs text-gray-500",children:new Date(_.date_commande).toLocaleDateString("fr-FR")})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"font-medium text-gray-900",children:oe(_.total_ht)}),r.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${_.statut==="confirmee"?"bg-green-100 text-green-800":_.statut==="livree"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:_.statut==="confirmee"?"Confirmée":_.statut==="livree"?"Livrée":_.statut==="envoyee"?"Envoyée":"Brouillon"})]})]})},_.id)),ie.length===0&&r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{children:"Aucun bon de commande disponible"}),r.jsx("p",{className:"text-sm mt-1",children:"Tous les bons de commande ont déjà une livraison associée"})]})]})})]}),r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx("button",{onClick:()=>g(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Fermer"})})]})}),C&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sélectionner un client"})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"relative mb-4",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un client...",value:q,onChange:_=>K(_.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.jsx("div",{className:"space-y-2",children:ue.map(_=>r.jsxs("button",{onClick:()=>z(_),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors duration-200",children:[r.jsx("div",{className:"font-medium text-gray-900",children:_.societe}),r.jsxs("div",{className:"text-sm text-gray-600",children:[_.prenom," ",_.nom," - ",_.numero_client]})]},_.id))})})]}),r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx("button",{onClick:()=>M(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Fermer"})})]})}),$&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sélectionner un chauffeur"})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"relative mb-4",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un chauffeur...",value:J,onChange:_=>Z(_.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.jsx("div",{className:"space-y-2",children:ge.map(_=>r.jsx("button",{onClick:()=>ee(_),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors duration-200",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"font-medium text-gray-900",children:[_.prenom," ",_.nom]}),r.jsx("div",{className:"text-sm text-gray-600",children:_.numero_chauffeur})]}),r.jsx("div",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:_.immatricule})]})},_.id))})})]}),r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx("button",{onClick:()=>T(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Fermer"})})]})})]}):r.jsx("div",{className:"min-h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500",children:"Chargement..."})})},Pg=({onNavigateBack:t,note:e})=>{const[s,n]=N.useState([]),[a,i]=N.useState(!0),[l,o]=N.useState(null),[c,d]=N.useState({statut:e.statut,notes:e.notes||"",immatricule_utilise:e.immatricule_utilise}),[u,m]=N.useState(!1),[p,x]=N.useState(!1),[f,v]=N.useState(!0),j=D=>{v(D),x(!1),setTimeout(()=>{window.print()},100)};ye.useEffect(()=>{h()},[]);const h=async()=>{try{i(!0),o(null);const{data:D,error:q}=await Q.from("bon_de_livraison_items").select(`
          *,
          produit:produits(nom_produit, prix_vente)
        `).eq("livraison_id",e.id).order("id",{ascending:!0});if(q)throw q;n(D||[])}catch(D){console.error("Error fetching delivery items:",D),o("Erreur lors du chargement des détails de la livraison")}finally{i(!1)}},y=D=>{const{name:q,value:K}=D.target;d(J=>({...J,[q]:K}))},g=async D=>{D.preventDefault(),m(!0);try{const q=s.reduce((Z,Y)=>Z+Y.total_ligne,0),{data:K,error:J}=await Q.from("bon_de_livraison").update({statut:c.statut,notes:c.notes.trim()||null,immatricule_utilise:c.immatricule_utilise.trim(),total_ht:q}).eq("id",e.id).select();if(J)throw J;for(const Z of s){const{error:Y}=await Q.from("bon_de_livraison_items").update({quantite_livree:Z.quantite_livree}).eq("id",Z.id);if(Y)throw Y}if(c.statut==="livree"){const{data:Z,error:Y}=await Q.from("bon_de_livraison").select("bon_commande_id, client_id").eq("id",e.id).single();if(Y)console.error("Error fetching delivery data:",Y);else{const{error:V}=await Q.from("bon_de_commande").update({statut:"livree",client_id:Z.client_id}).eq("id",Z.bon_commande_id);V?console.error("Error updating purchase order:",V):console.log("Purchase order updated to delivered status with client assignment")}}console.log("Delivery note updated successfully:",K),t()}catch(q){console.error("Error updating delivery note:",q),o("Erreur lors de la modification. Veuillez réessayer.")}finally{m(!1)}},C=D=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(D)+" DH",M=D=>{const q={en_preparation:"bg-yellow-100 text-yellow-800",en_cours:"bg-blue-100 text-blue-800",livree:"bg-green-100 text-green-800",annulee:"bg-red-100 text-red-800"},K={en_preparation:"En préparation",en_cours:"En cours",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${q[D]||q.en_preparation}`,children:K[D]||D})},$=D=>({unite:"Unité",ml:"ML",m2:"M²",kg:"KG",l:"L",pcs:"PCS",box:"Boîte",cm:"CM",m:"M",g:"G",t:"T"})[D]||D.toUpperCase(),T=D=>{const q={unite:"bg-gray-100 text-gray-800",ml:"bg-blue-100 text-blue-800",m2:"bg-green-100 text-green-800",kg:"bg-purple-100 text-purple-800",l:"bg-cyan-100 text-cyan-800",pcs:"bg-orange-100 text-orange-800",box:"bg-amber-100 text-amber-800",cm:"bg-indigo-100 text-indigo-800",m:"bg-teal-100 text-teal-800",g:"bg-pink-100 text-pink-800",t:"bg-red-100 text-red-800"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${q[D]||q.unite}`,children:$(D)})},A=D=>["ml","m2","kg","l","cm","m","g","t"].includes(D);return a?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des détails..."})]})}):r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:e.numero_livraison}),M(e.statut)]}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Bon de livraison du ",new Date(e.date_livraison).toLocaleDateString("fr-FR")]})]}),r.jsxs("button",{onClick:()=>x(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200 print:hidden",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer"]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ae,{className:"w-5 h-5"}),"Informations générales"]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsx("div",{className:"font-medium text-gray-900",children:"Bon de commande source"}),r.jsx("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:e.bon_commande.numero_commande})]}),r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsx("div",{className:"font-medium text-gray-900",children:"Date de livraison"}),r.jsx("div",{className:"text-sm text-gray-600 mt-1",children:new Date(e.date_livraison).toLocaleDateString("fr-FR")})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Lt,{className:"w-5 h-5"}),"Client"]}),r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.client.societe}),r.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.client.prenom," ",e.client.nom]}),r.jsx("div",{className:"text-sm text-gray-500 mt-1",children:e.client.numero_client})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(we,{className:"w-5 h-5"}),"Chauffeur et véhicule"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsxs("div",{className:"font-medium text-gray-900",children:[e.chauffeur.prenom," ",e.chauffeur.nom]}),r.jsx("div",{className:"text-sm text-gray-500 mt-1",children:e.chauffeur.numero_chauffeur})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"immatricule_utilise",className:"block text-sm font-medium text-gray-700 mb-2",children:"Véhicule utilisé (Immatricule)"}),r.jsx("input",{type:"text",id:"immatricule_utilise",name:"immatricule_utilise",value:c.immatricule_utilise,onChange:y,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono"})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Articles à livrer"}),s.length>0?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Produit"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Unité"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Prix unitaire"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Nb Pièces"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Dimension"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Quantité Totale"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Total"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:s.map(D=>{var q,K,J,Z,Y,V,I,O;return r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:D.produit.nom_produit}),r.jsx("td",{className:"px-4 py-3 text-center",children:T(((q=D.produit)==null?void 0:q.unite)||"unite")}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:C(D.prix_unitaire)}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Math.round(D.quantite_livree/(((K=D.produit)==null?void 0:K.dimension_standard)||1))||1}),r.jsx("td",{className:"px-4 py-3",children:A(((J=D.produit)==null?void 0:J.unite)||"unite")?r.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[((Z=D.produit)==null?void 0:Z.dimension_standard)||1," ",$(((Y=D.produit)==null?void 0:Y.unite)||"unite")]}):r.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("div",{className:"text-sm font-medium text-blue-600",children:A(((V=D.produit)==null?void 0:V.unite)||"unite")?`${D.quantite_livree} ${$(((I=D.produit)==null?void 0:I.unite)||"unite")}`:`${D.quantite_livree} ${$(((O=D.produit)==null?void 0:O.unite)||"unite")}`})}),r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:C(D.total_ligne)})]},D.id)})}),r.jsx("tfoot",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("td",{colSpan:6,className:"px-4 py-3 text-right text-sm font-semibold text-gray-900",children:"Total:"}),r.jsx("td",{className:"px-4 py-3 text-sm font-bold text-gray-900",children:C(s.reduce((D,q)=>D+q.total_ligne,0))})]})})]})}):r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(Ae,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"Aucun article dans cette livraison"})]})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("form",{onSubmit:g,className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ha,{className:"w-5 h-5"}),"Modifier la livraison"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"statut",className:"block text-sm font-medium text-gray-700 mb-1",children:"Statut"}),r.jsxs("select",{id:"statut",name:"statut",value:c.statut,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"en_preparation",children:"En préparation"}),r.jsx("option",{value:"en_cours",children:"En cours"}),r.jsx("option",{value:"livree",children:"Livrée"}),r.jsx("option",{value:"annulee",children:"Annulée"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),r.jsx("textarea",{id:"notes",name:"notes",rows:4,value:c.notes,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes pour cette livraison..."})]})]}),r.jsxs("div",{className:"flex gap-4 pt-6 border-t border-gray-200 mt-6",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:u,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-3 rounded-lg flex items-center justify-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-4 h-4"}),u?"Enregistrement...":"Enregistrer"]})]}),l&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:l})})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Récapitulatif"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Date de livraison:"}),r.jsx("span",{className:"font-medium",children:new Date(e.date_livraison).toLocaleDateString("fr-FR")})]}),r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Articles commandés:"}),r.jsx("span",{className:"font-medium",children:s.reduce((D,q)=>D+q.quantite_commandee,0)})]}),r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Articles à livrer:"}),r.jsx("span",{className:"font-medium",children:s.reduce((D,q)=>D+q.quantite_livree,0)})]}),r.jsxs("div",{className:"flex justify-between py-2 border-t border-gray-200 text-lg font-semibold",children:[r.jsx("span",{children:"Total:"}),r.jsx("span",{children:C(s.reduce((D,q)=>D+q.total_ligne,0))})]})]})]})]})]})}),p&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[r.jsxs("div",{className:"p-6 border-b border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Options d'impression"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Choisissez le type de bon de livraison à imprimer"})]}),r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("button",{onClick:()=>j(!0),className:"w-full p-4 border-2 border-blue-300 rounded-lg hover:bg-blue-50 transition-colors duration-200 text-left",children:[r.jsx("div",{className:"font-medium text-gray-900",children:"BL Chiffré"}),r.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Avec prix unitaires et totaux"})]}),r.jsxs("button",{onClick:()=>j(!1),className:"w-full p-4 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 text-left",children:[r.jsx("div",{className:"font-medium text-gray-900",children:"BL Non Chiffré"}),r.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Sans informations de prix"})]})]})}),r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx("button",{onClick:()=>x(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"})})]})}),r.jsxs("div",{className:"hidden print:block fixed inset-0 bg-white px-8 pt-0 pb-8",style:{marginTop:"-28px"},children:[r.jsxs("div",{className:"grid grid-cols-3 items-center border-b-2 border-gray-800 py-1 mb-2",children:[r.jsx("div",{className:"flex justify-start",children:r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"h-32 w-auto"})}),r.jsx("div",{className:"text-center",children:r.jsx("p",{className:"text-lg text-gray-900 font-bold",children:"BON DE LIVRAISON"})}),r.jsx("div",{})]}),r.jsx("div",{className:"mb-8",children:r.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations Livraison"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"N° BL:"}),r.jsx("span",{className:"text-gray-900",children:e.numero_livraison})]}),r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"Date:"}),r.jsx("span",{className:"text-gray-900",children:new Date(e.date_livraison).toLocaleDateString("fr-FR")})]}),r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"BC Source:"}),r.jsx("span",{className:"text-gray-900",children:e.bon_commande.numero_commande})]})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Client"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"Société:"}),r.jsx("span",{className:"text-gray-900",children:e.client.societe})]}),r.jsxs("div",{className:"flex",children:[r.jsx("span",{className:"font-medium text-gray-700 w-32",children:"Contact:"}),r.jsxs("span",{className:"text-gray-900",children:[e.client.prenom," ",e.client.nom]})]})]})]})]})}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Articles Livrés"}),r.jsxs("table",{className:"w-full border-collapse border border-gray-800",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-left font-semibold",children:"Produit"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-center font-semibold",children:"Nb Pièces"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-center font-semibold",children:"Dimension"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-center font-semibold",children:"Quantité Totale"}),f&&r.jsxs(r.Fragment,{children:[r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-right font-semibold",children:"Prix Unitaire"}),r.jsx("th",{className:"border border-gray-800 px-4 py-2 text-right font-semibold",children:"Total"})]})]})}),r.jsxs("tbody",{children:[s.map(D=>{var q,K,J,Z;return r.jsxs("tr",{children:[r.jsx("td",{className:"border border-gray-800 px-4 py-2",children:D.produit.nom_produit}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-center",children:Math.round(D.quantite_livree/(((q=D.produit)==null?void 0:q.dimension_standard)||1))||1}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-center",children:(K=D.produit)!=null&&K.unite&&["ml","m2","kg","l","cm","m","g","t"].includes(D.produit.unite)?`${D.produit.dimension_standard||1} ${D.produit.unite.toUpperCase()}`:"-"}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-center font-medium",children:(J=D.produit)!=null&&J.unite&&["ml","m2","kg","l","cm","m","g","t"].includes(D.produit.unite)?`${D.quantite_livree} ${D.produit.unite.toUpperCase()}`:`${D.quantite_livree} ${(Z=D.produit)!=null&&Z.unite?D.produit.unite.toUpperCase():"Unité"}`}),f&&r.jsxs(r.Fragment,{children:[r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-right",children:C(D.prix_unitaire)}),r.jsx("td",{className:"border border-gray-800 px-4 py-2 text-right font-medium",children:C(D.total_ligne)})]})]},D.id)}),f&&r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("td",{className:"border border-gray-800 px-4 py-3 font-bold",colSpan:4,children:"TOTAL"}),r.jsx("td",{className:"border border-gray-800 px-4 py-3 text-right font-bold text-lg",colSpan:2,children:C(s.reduce((D,q)=>D+q.total_ligne,0))})]})]})]})]}),c.notes&&r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Notes"}),r.jsx("div",{className:"border border-gray-300 p-4 rounded",children:r.jsx("p",{className:"text-gray-900",children:c.notes})})]}),r.jsx("div",{className:"absolute bottom-8 left-8 right-8 text-center text-xs text-gray-500 border-t border-gray-300 pt-4",children:r.jsxs("p",{children:["ANTURGOOD - Système de gestion wget.ma | Document généré le ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 15px;
            size: A4 portrait;
          }
          
          /* Hide everything by default */
          body * {
            visibility: hidden;
          }
          
          /* Show only the print content */
          .print\\:block,
          .print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print content */
          .print\\:block {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            background: white !important;
            color: black !important;
            font-size: 12pt !important;
            line-height: 1.4 !important;
          }
          
          /* Table styling for print */
          table {
            border-collapse: collapse !important;
            width: 100% !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 8px !important;
          }
          
          /* Ensure proper page breaks */
          .print\\:block {
            page-break-inside: avoid;
          }
          
          /* Hide any remaining UI elements */
          nav, aside, button, .print\\:hidden {
            display: none !important;
            padding: 15px !important;
          }
          }
        }
      `})]})},Tg=({client:t,onNavigateBack:e,onNavigateToDelivery:s})=>{const[n,a]=N.useState(t),[i,l]=N.useState([]),[o,c]=N.useState([]),[d,u]=N.useState(null),[m,p]=N.useState(!0),[x,f]=N.useState(null),[v,j]=N.useState(!1),[h,y]=N.useState(1),[g,C]=N.useState(1),M=10,$=10,[T,A]=N.useState({dateFrom:"",dateTo:""}),[D,q]=N.useState({montant:"",mode_paiement:"cash",reference:"",issuer:"",date_paiement:new Date().toISOString().split("T")[0],notes:""}),[K,J]=N.useState(!1);N.useEffect(()=>{Y()},[n.id]),N.useEffect(()=>{a(t)},[t]);const Z=async()=>{try{const{data:G,error:H}=await Q.from("clients").select(`
          id,
          numero_client,
          nom,
          prenom,
          societe,
          ice,
          email,
          telephone,
          credit_initial,
          chiffre_affaires,
          total_paiements,
          current_debt,
          available_credit,
          total_margin,
          created_at
        `).eq("id",n.id).single();if(H)throw H;a(G)}catch(G){console.error("Error fetching updated client data:",G)}},Y=async()=>{try{p(!0),f(null);const{data:G,error:H}=await Q.from("bon_de_livraison").select(`
          *,
          client:clients(nom, prenom, societe),
          chauffeur:chauffeurs(nom, prenom),
          bon_commande:bon_de_commande(numero_commande, total_ht),
          items:bon_de_livraison_items(
            id,
            quantite_livree,
            prix_unitaire,
            total_ligne,
            produit:produits(nom_produit, prix_achat, prix_vente)
          )
        `).eq("client_id",n.id).neq("statut","annulee").order("date_livraison",{ascending:!1});if(H)throw H;l(G||[]);const{data:oe,error:_}=await Q.from("paiements_clients").select("*").eq("client_id",n.id).order("date_paiement",{ascending:!1});if(_)throw _;c(oe||[]);const F=G||[],X=F.filter(ae=>ae.statut==="livree").length,le=F.filter(ae=>ae.statut!=="livree"&&ae.statut!=="annulee").length;u({deliveredCount:X,pendingCount:le})}catch(G){console.error("Error fetching client data:",G),f("Erreur lors du chargement des données client")}finally{p(!1)}},V=G=>{const{name:H,value:oe}=G.target;q(_=>({..._,[H]:oe}))},I=async G=>{if(G.preventDefault(),!D.montant||Number(D.montant)<=0){f("Le montant doit être supérieur à 0");return}J(!0),f(null);try{const{data:H,error:oe}=await Q.from("paiements_clients").insert([{client_id:n.id,montant:Number(D.montant),mode_paiement:D.mode_paiement,reference:D.reference.trim()||null,issuer:D.issuer.trim()||null,date_paiement:D.date_paiement,notes:D.notes.trim()||null}]).select();if(oe)throw oe;console.log("Payment added successfully:",H),q({montant:"",mode_paiement:"cash",reference:"",issuer:"",date_paiement:new Date().toISOString().split("T")[0],notes:""}),j(!1),C(1),await Z(),await Y()}catch(H){console.error("Error adding payment:",H),f("Erreur lors de l'ajout du paiement. Veuillez réessayer.")}finally{J(!1)}},O=(G,H)=>{A(oe=>({...oe,[G]:H})),y(1),C(1)},b=()=>{A({dateFrom:"",dateTo:""}),y(1),C(1)},S=()=>T.dateFrom||T.dateTo,E=G=>{if(!T.dateFrom&&!T.dateTo)return!0;const H=G,oe=!T.dateFrom||H>=T.dateFrom,_=!T.dateTo||H<=T.dateTo;return oe&&_},w=G=>{y(G)},R=()=>{h>1&&y(h-1)},L=()=>{const G=Math.ceil(i.length/M);h<G&&y(h+1)},U=G=>{C(G)},se=()=>{g>1&&C(g-1)},P=()=>{const G=Math.ceil(o.length/$);g<G&&C(g+1)},B=i.filter(G=>E(G.date_livraison)),k=o.filter(G=>E(G.date_paiement)),z=Math.ceil(B.length/M),ee=(h-1)*M,ne=ee+M,ie=B.slice(ee,ne),ue=Math.ceil(k.length/$),ge=(g-1)*$,be=ge+$,Le=k.slice(ge,be),ce=G=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(G)+" DH",te=G=>{const H={en_preparation:"bg-yellow-100 text-yellow-800",en_cours:"bg-blue-100 text-blue-800",livree:"bg-green-100 text-green-800",annulee:"bg-red-100 text-red-800"},oe={en_preparation:"En préparation",en_cours:"En cours",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${H[G]||H.en_preparation}`,children:oe[G]||G})};return m?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des données client..."})]})}):x?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:x}),r.jsx("button",{onClick:Y,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:e,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(Lt,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n.societe}),r.jsxs("p",{className:"text-gray-600",children:[n.prenom," ",n.nom," - ",n.numero_client]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ko,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Contact"})]}),r.jsxs("div",{className:"mt-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.email}),r.jsx("p",{className:"text-sm text-gray-600",children:n.telephone})]})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_s,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"ICE"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:n.ice})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_r,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Client depuis"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(n.created_at).toLocaleDateString("fr-FR")})})]})]})]})]}),d&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Chiffre d'Affaires"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ce(n.chiffre_affaires)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Hors annulées"})]}),r.jsx(mt,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Crédit"}),r.jsx("p",{className:`text-2xl font-bold ${n.current_debt>0?"text-red-600":"text-green-600"}`,children:ce(n.current_debt)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Dû par le client"})]}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(_s,{className:`w-8 h-8 ${n.current_debt>0?"text-red-600":"text-green-600"}`}),r.jsx("button",{onClick:()=>j(!0),className:"mt-2 text-xs bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded transition-colors duration-200",children:"+ Paiement"})]})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Marge"}),r.jsx("p",{className:`text-2xl font-bold ${n.total_margin>=0?"text-green-600":"text-red-600"}`,children:ce(n.total_margin)}),r.jsx("p",{className:"text-xs text-gray-500",children:"Sur livraisons terminées"})]}),r.jsx(mt,{className:`w-8 h-8 ${n.total_margin>=0?"text-green-600":"text-red-600"}`})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),r.jsx("span",{className:"font-medium text-blue-800",children:"Total Paiements"})]}),r.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:ce(n.total_paiements)})]}),r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),r.jsx("span",{className:"font-medium text-green-800",children:"Avance à consommer"})]}),r.jsx("p",{className:"text-2xl font-bold text-green-900 mt-1",children:ce(n.available_credit)})]})]}),d&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),r.jsx("span",{className:"font-medium text-green-800",children:"Livraisons Terminées"})]}),r.jsx("p",{className:"text-2xl font-bold text-green-900 mt-1",children:d.deliveredCount})]}),r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),r.jsx("span",{className:"font-medium text-blue-800",children:"Livraisons En Cours"})]}),r.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:d.pendingCount})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtrer par période"}),S()&&r.jsx("button",{onClick:b,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:"Effacer les filtres"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:T.dateFrom,onChange:G=>O("dateFrom",G.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:T.dateTo,onChange:G=>O("dateTo",G.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:b,className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Effacer les filtres"})})]}),S()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:B.length})," livraison(s) et ",r.jsx("strong",{children:k.length})," paiement(s) trouvé(s)",T.dateFrom&&T.dateTo&&` du ${new Date(T.dateFrom).toLocaleDateString("fr-FR")} au ${new Date(T.dateTo).toLocaleDateString("fr-FR")}`,T.dateFrom&&!T.dateTo&&` à partir du ${new Date(T.dateFrom).toLocaleDateString("fr-FR")}`,!T.dateFrom&&T.dateTo&&` jusqu'au ${new Date(T.dateTo).toLocaleDateString("fr-FR")}`]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["CA filtré: ",ce(B.reduce((G,H)=>G+(H.total_ht||0),0))]})]})})]}),r.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Historique des Livraisons"}),S()&&r.jsxs("span",{className:"text-sm text-gray-600",children:[B.length," livraison(s) trouvée(s)"]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro BL"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Chauffeur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Nb Produits"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ie.length>0?ie.map(G=>r.jsxs("tr",{onClick:()=>s(G),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:G.numero_livraison}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(we,{className:"w-4 h-4 text-gray-400 mr-2"}),r.jsxs("div",{className:"text-sm text-gray-900",children:[G.chauffeur.prenom," ",G.chauffeur.nom]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(G.date_livraison).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:te(G.statut)}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[G.items.length," produit",G.items.length>1?"s":""]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:ce(G.total_ht||0)})]},G.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(we,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:"Aucune livraison pour ce client"})]})})})})]})})]}),z>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",ee+1," à ",Math.min(ne,i.length)," sur ",i.length," livraisons"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:R,disabled:h===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(ChevronLeft,{className:"w-5 h-5"})}),Array.from({length:z},(G,H)=>H+1).map(G=>r.jsx("button",{onClick:()=>w(G),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${h===G?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:G},G)),r.jsx("button",{onClick:L,disabled:h===z,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(ChevronRight,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"mt-8 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Historique des Paiements"})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Montant"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Mode de Paiement"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Référence"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Émetteur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Notes"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Le.length>0?Le.map(G=>r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(G.date_paiement).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:ce(G.montant)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${G.mode_paiement==="cash"?"bg-green-100 text-green-800":G.mode_paiement==="cheque"?"bg-blue-100 text-blue-800":G.mode_paiement==="effet"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:G.mode_paiement==="cash"?"Espèces":G.mode_paiement==="cheque"?"Chèque":G.mode_paiement==="effet"?"Effet":G.mode_paiement==="virement"?"Virement":G.mode_paiement})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono",children:G.reference||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:G.issuer||"-"}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",children:G.notes||"-"})]},G.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(_s,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:"Aucun paiement enregistré pour ce client"}),r.jsx("button",{onClick:()=>j(!0),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Ajouter le premier paiement"})]})})})})]})})]}),ue>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",ge+1," à ",Math.min(be,k.length)," sur ",k.length," paiements"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:se,disabled:g===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(ChevronLeft,{className:"w-5 h-5"})}),Array.from({length:ue},(G,H)=>H+1).map(G=>r.jsx("button",{onClick:()=>U(G),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${g===G?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:G},G)),r.jsx("button",{onClick:P,disabled:g===ue,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(ChevronRight,{className:"w-5 h-5"})})]})]}),v&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[r.jsxs("div",{className:"p-6 border-b border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ajouter un paiement"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Client: ",n.societe]})]}),r.jsxs("form",{onSubmit:I,className:"p-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"montant",className:"block text-sm font-medium text-gray-700 mb-1",children:["Montant (DH) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",id:"montant",name:"montant",step:"0.01",min:"0.01",value:D.montant,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"mode_paiement",className:"block text-sm font-medium text-gray-700 mb-1",children:["Mode de paiement ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"mode_paiement",name:"mode_paiement",value:D.mode_paiement,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"cash",children:"Espèces"}),r.jsx("option",{value:"cheque",children:"Chèque"}),r.jsx("option",{value:"effet",children:"Effet"}),r.jsx("option",{value:"virement",children:"Virement bancaire"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"reference",className:"block text-sm font-medium text-gray-700 mb-1",children:"Référence"}),r.jsx("input",{type:"text",id:"reference",name:"reference",value:D.reference,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"N° chèque, effet, virement..."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"issuer",className:"block text-sm font-medium text-gray-700 mb-1",children:"Émetteur"}),r.jsx("input",{type:"text",id:"issuer",name:"issuer",value:D.issuer,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom de la banque, émetteur..."})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"date_paiement",className:"block text-sm font-medium text-gray-700 mb-1",children:["Date de paiement ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"date",id:"date_paiement",name:"date_paiement",value:D.date_paiement,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),r.jsx("textarea",{id:"notes",name:"notes",rows:3,value:D.notes,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes optionnelles..."})]})]}),x&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:x})}),r.jsxs("div",{className:"flex gap-4 mt-6",children:[r.jsx("button",{type:"button",onClick:()=>j(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsx("button",{type:"submit",disabled:K,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200",children:K?"Ajout...":"Ajouter"})]})]})]})})]})},Dg=({fournisseur:t,onNavigateBack:e,onNavigateToPurchaseOrder:s})=>{const[n,a]=N.useState(t),[i,l]=N.useState([]),[o,c]=N.useState([]),[d,u]=N.useState(null),[m,p]=N.useState(!0),[x,f]=N.useState(null),[v,j]=N.useState(!1),[h,y]=N.useState(1),[g,C]=N.useState(1),M=10,$=10,[T,A]=N.useState({montant:"",mode_paiement:"cash",reference:"",issuer:"",date_paiement:new Date().toISOString().split("T")[0],notes:""}),[D,q]=N.useState(!1),[K,J]=N.useState({dateFrom:"",dateTo:""});N.useEffect(()=>{Z()},[n.id]),N.useEffect(()=>{a(t)},[t]);const Z=async()=>{try{p(!0),f(null);const{data:H,error:oe}=await Q.from("bon_de_commande").select(`
          *,
          items:bon_de_commande_items(
            id,
            quantite,
            prix_unitaire,
            total_ligne,
            produit:produits(nom_produit)
          )
        `).eq("fournisseur_id",n.id).neq("statut","annulee").order("date_commande",{ascending:!1});if(oe)throw oe;l(H||[]);const{data:_,error:F}=await Q.from("paiements_fournisseurs").select("*").eq("fournisseur_id",n.id).order("date_paiement",{ascending:!1});if(F)throw F;c(_||[]);const X=H||[],le=(_||[]).reduce((Pr,gi)=>Pr+gi.montant,0),ae=X.length,Se=X.filter(Pr=>Pr.statut==="confirmee").length,kt=X.filter(Pr=>Pr.statut==="livree").length,zs=X.reduce((Pr,gi)=>Pr+(gi.total_ht||0),0),ke=zs-le,pi=Math.max(0,ke),hh=Math.max(0,-ke);u({totalOrders:ae,confirmedOrders:Se,deliveredOrders:kt,totalAmount:zs,totalPayments:le,currentDebt:pi,availableCredit:hh})}catch(H){console.error("Error fetching supplier data:",H),f("Erreur lors du chargement des données fournisseur")}finally{p(!1)}},Y=H=>{const{name:oe,value:_}=H.target;A(F=>({...F,[oe]:_}))},V=async H=>{if(H.preventDefault(),!T.montant||Number(T.montant)<=0){f("Le montant doit être supérieur à 0");return}q(!0),f(null);try{const{data:oe,error:_}=await Q.from("paiements_fournisseurs").insert([{fournisseur_id:n.id,montant:Number(T.montant),mode_paiement:T.mode_paiement,reference:T.reference.trim()||null,issuer:T.issuer.trim()||null,date_paiement:T.date_paiement,notes:T.notes.trim()||null}]).select();if(_)throw _;console.log("Payment added successfully:",oe),A({montant:"",mode_paiement:"cash",reference:"",issuer:"",date_paiement:new Date().toISOString().split("T")[0],notes:""}),j(!1),C(1),await Z()}catch(oe){console.error("Error adding payment:",oe),f("Erreur lors de l'ajout du paiement. Veuillez réessayer.")}finally{q(!1)}},I=(H,oe)=>{J(_=>({..._,[H]:oe})),y(1),C(1)},O=()=>{J({dateFrom:"",dateTo:""}),y(1),C(1)},b=()=>K.dateFrom||K.dateTo,S=H=>{if(!K.dateFrom&&!K.dateTo)return!0;const oe=H,_=!K.dateFrom||oe>=K.dateFrom,F=!K.dateTo||oe<=K.dateTo;return _&&F},E=H=>{y(H)},w=()=>{h>1&&y(h-1)},R=()=>{const H=Math.ceil(P.length/M);h<H&&y(h+1)},L=H=>{C(H)},U=()=>{g>1&&C(g-1)},se=()=>{const H=Math.ceil(B.length/$);g<H&&C(g+1)},P=i.filter(H=>S(H.date_commande)),B=o.filter(H=>S(H.date_paiement)),k=Math.ceil(P.length/M),z=(h-1)*M,ee=z+M,ne=P.slice(z,ee),ie=Math.ceil(B.length/$),ue=(g-1)*$,ge=ue+$,be=B.slice(ue,ge),ce=(()=>{if(!b())return d;const H=P.reduce((le,ae)=>le+(ae.total_ht||0),0),oe=B.reduce((le,ae)=>le+ae.montant,0),_=H-oe,F=Math.max(0,_),X=Math.max(0,-_);return{totalOrders:P.length,confirmedOrders:P.filter(le=>le.statut==="confirmee").length,deliveredOrders:P.filter(le=>le.statut==="livree").length,totalAmount:H,totalPayments:oe,currentDebt:F,availableCredit:X}})(),te=H=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(H)+" DH",G=H=>{const oe={brouillon:"bg-gray-100 text-gray-800",envoyee:"bg-blue-100 text-blue-800",confirmee:"bg-green-100 text-green-800",livree:"bg-purple-100 text-purple-800",annulee:"bg-red-100 text-red-800"},_={brouillon:"Brouillon",envoyee:"Envoyée",confirmee:"Confirmée",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${oe[H]||oe.brouillon}`,children:_[H]||H})};return m?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des données fournisseur..."})]})}):x&&!v?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:x}),r.jsx("button",{onClick:Z,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:e,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(Ut,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n.societe}),r.jsxs("p",{className:"text-gray-600",children:[n.prenom," ",n.nom," - ",n.numero_fournisseur]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ko,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Contact"})]}),r.jsxs("div",{className:"mt-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.email}),r.jsx("p",{className:"text-sm text-gray-600",children:n.telephone})]})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ae,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"ICE"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:n.ice})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_r,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Fournisseur depuis"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(n.created_at).toLocaleDateString("fr-FR")})})]})]})]})]}),ce&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 min-h-[120px] flex flex-col justify-between",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Commandes"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ce.totalOrders}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Toutes commandes"})]}),r.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 min-h-[120px] flex flex-col justify-between",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Montant Total"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:te(ce.totalAmount)}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Toutes commandes"})]}),r.jsx(mt,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 min-h-[120px] flex flex-col justify-between",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Paiements"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:te(ce.totalPayments)}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Payé au fournisseur"})]}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(mt,{className:"w-8 h-8 text-green-600"}),r.jsx("button",{onClick:()=>j(!0),className:"mt-2 text-xs bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded transition-colors duration-200",children:"+ Paiement"})]})]})})]}),ce&&r.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-100 rounded-xl border border-blue-200 p-8 mb-8",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6 text-center",children:"Résumé Financier"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(mt,{className:"w-8 h-8 text-green-600"})}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:te(ce.totalPayments)}),r.jsx("p",{className:"text-sm text-gray-700 mt-1 font-medium",children:"Total Paiements"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Versés au fournisseur"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("div",{className:"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center",children:r.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})}),r.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:te(ce.availableCredit)}),r.jsx("p",{className:"text-sm text-gray-700 mt-1 font-medium",children:"Avance à consommer"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Disponible"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 ${ce.currentDebt>0?"bg-red-100":"bg-green-100"}`,children:r.jsx(_s,{className:`w-8 h-8 ${ce.currentDebt>0?"text-red-600":"text-green-600"}`})}),r.jsx("p",{className:`text-2xl font-bold ${ce.currentDebt>0?"text-red-600":"text-green-600"}`,children:te(ce.currentDebt)}),r.jsx("p",{className:"text-sm text-gray-700 mt-1 font-medium",children:"Crédit Fournisseur"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:ce.currentDebt>0?"Dû au fournisseur":"À jour"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 ${ce.currentDebt>0?"bg-red-100":ce.availableCredit>0?"bg-green-100":"bg-gray-100"}`,children:r.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${ce.currentDebt>0?"bg-red-500":ce.availableCredit>0?"bg-green-500":"bg-gray-500"}`,children:r.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})}),r.jsx("p",{className:`text-lg font-bold ${ce.currentDebt>0?"text-red-600":ce.availableCredit>0?"text-green-600":"text-gray-600"}`,children:ce.currentDebt>0?"Crédit Actif":ce.availableCredit>0?"Avance Active":"Équilibré"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:ce.currentDebt>0?"Paiement requis":ce.availableCredit>0?"Fonds disponibles":"Aucune dette"})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtrer par période"}),b()&&r.jsx("button",{onClick:O,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:"Effacer les filtres"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:K.dateFrom,onChange:H=>I("dateFrom",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:K.dateTo,onChange:H=>I("dateTo",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:O,className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Effacer les filtres"})})]}),b()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:P.length})," commande(s) et ",r.jsx("strong",{children:B.length})," paiement(s) trouvé(s)",K.dateFrom&&K.dateTo&&` du ${new Date(K.dateFrom).toLocaleDateString("fr-FR")} au ${new Date(K.dateTo).toLocaleDateString("fr-FR")}`,K.dateFrom&&!K.dateTo&&` à partir du ${new Date(K.dateFrom).toLocaleDateString("fr-FR")}`,!K.dateFrom&&K.dateTo&&` jusqu'au ${new Date(K.dateTo).toLocaleDateString("fr-FR")}`]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Montant filtré: ",te((ce==null?void 0:ce.totalAmount)||0)]})]})})]}),r.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Historique des Bons de Commande"}),b()&&r.jsxs("span",{className:"text-sm text-gray-600",children:[P.length," commande(s) trouvée(s)"]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro BC"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Nb Produits"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Notes"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ne.length>0?ne.map(H=>r.jsxs("tr",{onClick:()=>s(H),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:H.numero_commande}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(H.date_commande).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:G(H.statut)}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[H.items.length," produit",H.items.length>1?"s":""]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:te(H.total_ht)}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",children:H.notes||"-"})]},H.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(Ae,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:"Aucune commande pour ce fournisseur"})]})})})})]})})]}),k>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",z+1," à ",Math.min(ee,P.length)," sur ",P.length," commandes"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:w,disabled:h===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:k},(H,oe)=>oe+1).map(H=>r.jsx("button",{onClick:()=>E(H),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${h===H?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:H},H)),r.jsx("button",{onClick:R,disabled:h===k,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"mt-8 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Historique des Paiements"}),b()&&r.jsxs("span",{className:"text-sm text-gray-600",children:[B.length," paiement(s) trouvé(s)"]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Montant"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Mode de Paiement"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Référence"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Émetteur"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Notes"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:be.length>0?be.map(H=>r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(H.date_paiement).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600",children:te(H.montant)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${H.mode_paiement==="cash"?"bg-green-100 text-green-800":H.mode_paiement==="cheque"?"bg-blue-100 text-blue-800":H.mode_paiement==="effet"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:H.mode_paiement==="cash"?"Espèces":H.mode_paiement==="cheque"?"Chèque":H.mode_paiement==="effet"?"Effet":H.mode_paiement==="virement"?"Virement":H.mode_paiement})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono",children:H.reference||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.issuer||"-"}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",children:H.notes||"-"})]},H.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(_s,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:"Aucun paiement enregistré pour ce fournisseur"}),r.jsx("button",{onClick:()=>j(!0),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Ajouter le premier paiement"})]})})})})]})})]}),ie>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",ue+1," à ",Math.min(ge,B.length)," sur ",B.length," paiements"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:U,disabled:g===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:ie},(H,oe)=>oe+1).map(H=>r.jsx("button",{onClick:()=>L(H),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${g===H?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:H},H)),r.jsx("button",{onClick:se,disabled:g===ie,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]}),v&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[r.jsxs("div",{className:"p-6 border-b border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ajouter un paiement"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Fournisseur: ",n.societe]})]}),r.jsxs("form",{onSubmit:V,className:"p-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"montant",className:"block text-sm font-medium text-gray-700 mb-1",children:["Montant (DH) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",id:"montant",name:"montant",step:"0.01",min:"0.01",value:T.montant,onChange:Y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"mode_paiement",className:"block text-sm font-medium text-gray-700 mb-1",children:["Mode de paiement ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"mode_paiement",name:"mode_paiement",value:T.mode_paiement,onChange:Y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"cash",children:"Espèces"}),r.jsx("option",{value:"cheque",children:"Chèque"}),r.jsx("option",{value:"effet",children:"Effet"}),r.jsx("option",{value:"virement",children:"Virement bancaire"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"reference",className:"block text-sm font-medium text-gray-700 mb-1",children:"Référence"}),r.jsx("input",{type:"text",id:"reference",name:"reference",value:T.reference,onChange:Y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"N° chèque, effet, virement..."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"issuer",className:"block text-sm font-medium text-gray-700 mb-1",children:"Émetteur"}),r.jsx("input",{type:"text",id:"issuer",name:"issuer",value:T.issuer,onChange:Y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom de la banque, émetteur..."})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"date_paiement",className:"block text-sm font-medium text-gray-700 mb-1",children:["Date de paiement ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"date",id:"date_paiement",name:"date_paiement",value:T.date_paiement,onChange:Y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),r.jsx("textarea",{id:"notes",name:"notes",rows:3,value:T.notes,onChange:Y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes optionnelles..."})]})]}),x&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:x})}),r.jsxs("div",{className:"flex gap-4 mt-6",children:[r.jsx("button",{type:"button",onClick:()=>j(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsx("button",{type:"submit",disabled:D,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200",children:D?"Ajout...":"Ajouter"})]})]})]})})]})},Lg=({chauffeur:t,onNavigateBack:e})=>{const[s,n]=N.useState([]),[a,i]=N.useState(null),[l,o]=N.useState(!0),[c,d]=N.useState(null),[u,m]=N.useState(1),p=15,[x,f]=N.useState(""),[v,j]=N.useState({dateFrom:"",dateTo:""});N.useEffect(()=>{h()},[t.id]);const h=async()=>{try{o(!0),d(null);const{data:b,error:S}=await Q.from("bon_de_livraison").select(`
          *,
          client:clients(nom, prenom, societe, numero_client),
          bon_commande:bon_de_commande(
            numero_commande,
            fournisseur:fournisseurs(nom, prenom, societe, numero_fournisseur)
          )
        `).eq("chauffeur_id",t.id).neq("statut","annulee").order("date_livraison",{ascending:!1});if(S)throw S;n(b||[]);const E=b||[],w=E.length,R=E.filter(se=>se.statut==="livree").length,L=E.filter(se=>se.statut!=="livree"&&se.statut!=="annulee").length,U=E.reduce((se,P)=>se+(P.total_ht||0),0);i({totalDeliveries:w,deliveredCount:R,pendingCount:L,totalRevenue:U})}catch(b){console.error("Error fetching chauffeur data:",b),d("Erreur lors du chargement des données chauffeur")}finally{o(!1)}},y=(b,S)=>{j(E=>({...E,[b]:S})),m(1)},g=()=>{f(""),j({dateFrom:"",dateTo:""}),m(1)},C=()=>x||v.dateFrom||v.dateTo,M=b=>{if(!v.dateFrom&&!v.dateTo)return!0;const S=b,E=!v.dateFrom||S>=v.dateFrom,w=!v.dateTo||S<=v.dateTo;return E&&w},$=b=>{var E,w,R,L,U,se,P,B,k,z,ee,ne,ie,ue,ge,be,Le,ce,te,G,H,oe,_,F,X;if(!x)return!0;const S=x.toLowerCase();return(((E=b.client)==null?void 0:E.nom)||"").toLowerCase().includes(S)||(((w=b.client)==null?void 0:w.prenom)||"").toLowerCase().includes(S)||(((R=b.client)==null?void 0:R.societe)||"").toLowerCase().includes(S)||(((L=b.client)==null?void 0:L.numero_client)||"").toLowerCase().includes(S)||`${((U=b.client)==null?void 0:U.prenom)||""} ${((se=b.client)==null?void 0:se.nom)||""}`.toLowerCase().includes(S)||`${((P=b.client)==null?void 0:P.nom)||""} ${((B=b.client)==null?void 0:B.prenom)||""}`.toLowerCase().includes(S)||(((z=(k=b.bon_commande)==null?void 0:k.fournisseur)==null?void 0:z.nom)||"").toLowerCase().includes(S)||(((ne=(ee=b.bon_commande)==null?void 0:ee.fournisseur)==null?void 0:ne.prenom)||"").toLowerCase().includes(S)||(((ue=(ie=b.bon_commande)==null?void 0:ie.fournisseur)==null?void 0:ue.societe)||"").toLowerCase().includes(S)||(((be=(ge=b.bon_commande)==null?void 0:ge.fournisseur)==null?void 0:be.numero_fournisseur)||"").toLowerCase().includes(S)||`${((ce=(Le=b.bon_commande)==null?void 0:Le.fournisseur)==null?void 0:ce.prenom)||""} ${((G=(te=b.bon_commande)==null?void 0:te.fournisseur)==null?void 0:G.nom)||""}`.toLowerCase().includes(S)||`${((oe=(H=b.bon_commande)==null?void 0:H.fournisseur)==null?void 0:oe.nom)||""} ${((F=(_=b.bon_commande)==null?void 0:_.fournisseur)==null?void 0:F.prenom)||""}`.toLowerCase().includes(S)||(b.numero_livraison||"").toLowerCase().includes(S)||(((X=b.bon_commande)==null?void 0:X.numero_commande)||"").toLowerCase().includes(S)},A=s.filter(b=>M(b.date_livraison)&&$(b)),D=Math.ceil(A.length/p),q=(u-1)*p,K=q+p,J=A.slice(q,K),Z=b=>{m(b)},Y=()=>{u>1&&m(u-1)},V=()=>{u<D&&m(u+1)},I=b=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(b)+" DH",O=b=>{const S={en_preparation:"bg-yellow-100 text-yellow-800",en_cours:"bg-blue-100 text-blue-800",livree:"bg-green-100 text-green-800",annulee:"bg-red-100 text-red-800"},E={en_preparation:"En préparation",en_cours:"En cours",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S[b]||S.en_preparation}`,children:E[b]||b})};return l?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des données chauffeur..."})]})}):c?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:c}),r.jsx("button",{onClick:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:e,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(we,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[t.prenom," ",t.nom]}),r.jsxs("p",{className:"text-gray-600",children:[t.numero_chauffeur," - ",t.immatricule]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ko,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Contact"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.telephone})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(we,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Véhicule assigné"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:t.immatricule})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_r,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Type"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.type_chauffeur==="interne"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:t.type_chauffeur==="interne"?"Interne":"Externe"})})]})]})]})]}),a&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Livraisons"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalDeliveries})]}),r.jsx(we,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Livrées"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.deliveredCount})]}),r.jsx(mt,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"En cours"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.pendingCount})]}),r.jsx(_s,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Chiffre d'affaires"}),r.jsx("p",{className:"text-2xl font-bold text-purple-600",children:I(a.totalRevenue)})]}),r.jsx(mt,{className:"w-8 h-8 text-purple-600"})]})})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recherche et filtres"}),C()&&r.jsxs("button",{onClick:g,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:[r.jsx(Wr,{className:"w-4 h-4"}),"Effacer tous les filtres"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Rechercher client ou fournisseur"}),r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",id:"search",placeholder:"Client, fournisseur, numéro...",value:x,onChange:b=>{f(b.target.value),m(1)},className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:v.dateFrom,onChange:b=>y("dateFrom",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:v.dateTo,onChange:b=>y("dateTo",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})]}),C()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:A.length})," livraison(s) trouvée(s) avec les filtres actifs"]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Total filtré: ",I(A.reduce((b,S)=>b+S.total_ht,0))]})]})})]}),r.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Historique des Livraisons"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[A.length," livraison(s)",C()&&" (filtrées)"]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Numéro BL"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"BC Source"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Fournisseur"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Client"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date Livraison"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Véhicule"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:J.length>0?J.map(b=>{var S,E,w,R,L,U,se,P,B,k,z,ee,ne;return r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-blue-600",children:b.numero_livraison}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 font-mono",children:((S=b.bon_commande)==null?void 0:S.numero_commande)||"-"}),r.jsxs("td",{className:"px-4 py-3 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-orange-600",children:((w=(E=b.bon_commande)==null?void 0:E.fournisseur)==null?void 0:w.societe)||`${((L=(R=b.bon_commande)==null?void 0:R.fournisseur)==null?void 0:L.prenom)||""} ${((se=(U=b.bon_commande)==null?void 0:U.fournisseur)==null?void 0:se.nom)||""}`.trim()||"Non spécifié"}),r.jsx("div",{className:"text-xs text-gray-500",children:((B=(P=b.bon_commande)==null?void 0:P.fournisseur)==null?void 0:B.numero_fournisseur)||"-"})]}),r.jsxs("td",{className:"px-4 py-3 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:((k=b.client)==null?void 0:k.societe)||`${((z=b.client)==null?void 0:z.prenom)||""} ${((ee=b.client)==null?void 0:ee.nom)||""}`.trim()||"Non spécifié"}),r.jsx("div",{className:"text-xs text-gray-500",children:((ne=b.client)==null?void 0:ne.numero_client)||"-"})]}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:new Date(b.date_livraison).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("div",{className:"text-sm font-medium text-gray-900 bg-gray-100 px-2 py-1 rounded font-mono text-center",children:b.immatricule_utilise})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:O(b.statut)}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:I(b.total_ht)})]},b.id)}):r.jsx("tr",{children:r.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(we,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:C()?"Aucune livraison trouvée avec ces filtres":"Aucune livraison effectuée par ce chauffeur"}),C()&&r.jsx("button",{onClick:g,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Effacer les filtres"})]})})})})]})})]}),D>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",q+1," à ",Math.min(K,A.length)," sur ",A.length," livraisons"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:Y,disabled:u===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:D},(b,S)=>S+1).map(b=>r.jsx("button",{onClick:()=>Z(b),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${u===b?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:b},b)),r.jsx("button",{onClick:V,disabled:u===D,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]})]})},Fg=()=>{var v,j;const[t,e]=N.useState(null),[s,n]=N.useState(!0),[a,i]=N.useState(null),[l,o]=N.useState(""),[c,d]=N.useState("");N.useEffect(()=>{p()},[l,c]);const u=()=>[{value:"",label:"Tous les mois"},{value:"1",label:"Janvier"},{value:"2",label:"Février"},{value:"3",label:"Mars"},{value:"4",label:"Avril"},{value:"5",label:"Mai"},{value:"6",label:"Juin"},{value:"7",label:"Juillet"},{value:"8",label:"Août"},{value:"9",label:"Septembre"},{value:"10",label:"Octobre"},{value:"11",label:"Novembre"},{value:"12",label:"Décembre"}],m=()=>{const h=new Date().getFullYear(),y=[{value:"",label:"Toutes les années"}];for(let g=2020;g<=h+1;g++)y.push({value:g.toString(),label:g.toString()});return y.reverse()},p=async()=>{try{n(!0),i(null);const h=new Date;let y,g;c&&l?(y=new Date(parseInt(c),parseInt(l)-1,1),g=new Date(parseInt(c),parseInt(l),0)):c&&!l?(y=new Date(parseInt(c),0,1),g=new Date(parseInt(c),11,31)):!c&&l?(y=new Date(h.getFullYear(),parseInt(l)-1,1),g=new Date(h.getFullYear(),parseInt(l),0)):(y=new Date(h.getFullYear(),h.getMonth(),1),g=new Date(h.getFullYear(),h.getMonth()+1,0));const C=y.toISOString().split("T")[0],M=g.toISOString().split("T")[0],[$,T,A,D]=await Promise.all([Q.from("clients").select("*",{count:"exact",head:!0}),Q.from("fournisseurs").select("*",{count:"exact",head:!0}),Q.from("chauffeurs").select("*",{count:"exact",head:!0}),Q.from("produits").select("*",{count:"exact",head:!0})]),{data:q,error:K}=await Q.from("bon_de_livraison").select(`
          *,
          client:clients(id, nom, prenom, societe),
          items:bon_de_livraison_items(
            quantite_livree,
            prix_unitaire,
            total_ligne,
            produit:produits(prix_achat, prix_vente)
          )
        `).gte("date_livraison",C).lte("date_livraison",M).neq("statut","annulee").order("date_livraison",{ascending:!1});if(K)throw K;const{data:J,error:Z}=await Q.from("bon_de_commande").select("*").gte("date_commande",C).lte("date_commande",M).neq("statut","annulee");if(Z)throw Z;const{data:Y,error:V}=await Q.from("paiements_clients").select("client_id, montant").gte("date_paiement",C).lte("date_paiement",M);if(V)throw V;const{data:I,error:O}=await Q.from("paiements_fournisseurs").select("fournisseur_id, montant").gte("date_paiement",C).lte("date_paiement",M);if(O)throw O;const b=q||[],S=J||[],E=Y||[],w=I||[],R=b.reduce((_,F)=>_+(F.total_ht||0),0),L=E.reduce((_,F)=>_+(F.montant||0),0),U=R-L,se=Math.max(0,L-R),P=b.reduce((_,F)=>_+(F.items||[]).reduce((X,le)=>{var Se;const ae=(le.prix_unitaire-(((Se=le.produit)==null?void 0:Se.prix_achat)||0))*le.quantite_livree;return X+ae},0),0),B=new Map;b.forEach(_=>{const F=_.client.id,X=B.get(F)||{id:F,nom:_.client.nom,prenom:_.client.prenom,societe:_.client.societe,revenue:0,margin:0};X.revenue+=_.total_ht||0,X.margin+=(_.items||[]).reduce((le,ae)=>{var kt;const Se=(ae.prix_unitaire-(((kt=ae.produit)==null?void 0:kt.prix_achat)||0))*ae.quantite_livree;return le+Se},0),B.set(F,X)});const k=Array.from(B.values()).sort((_,F)=>F.revenue-_.revenue).slice(0,5),z=S.reduce((_,F)=>_+(F.total_ht||0),0),ee=w.reduce((_,F)=>_+(F.montant||0),0),ne=z-ee,ie=new Map;S.filter(_=>_.statut!=="annulee").forEach(_=>{const F=_.fournisseur_id,X=ie.get(F)||{id:F,ordered:0,payments:0};X.ordered+=_.total_ht||0,ie.set(F,X)}),w.forEach(_=>{const F=_.fournisseur_id,X=ie.get(F)||{id:F,ordered:0,payments:0};X.payments+=_.montant||0,ie.set(F,X)});const ue=Array.from(ie.keys()),{data:ge}=await Q.from("fournisseurs").select("id, societe").in("id",ue),be=Array.from(ie.entries()).map(([_,F])=>{const X=(ge||[]).find(le=>le.id===_);return{id:_,societe:(X==null?void 0:X.societe)||"Fournisseur inconnu",ordered:F.ordered,debt:F.ordered-F.payments}}).sort((_,F)=>F.ordered-_.ordered).slice(0,5),Le=b.filter(_=>_.statut==="livree").length,ce=b.filter(_=>_.statut!=="livree"&&_.statut!=="annulee").length,te=S.filter(_=>_.statut==="confirmee").length,G=S.filter(_=>_.statut==="livree").length,H=b.slice(0,5).map(_=>({numero_livraison:_.numero_livraison,client_societe:_.client.societe,total_ht:_.total_ht,date_livraison:_.date_livraison})),oe={totalClients:$.count||0,totalFournisseurs:T.count||0,totalChauffeurs:A.count||0,totalProducts:D.count||0,currentMonth:{clientsRevenue:R,clientsPayments:L,clientsDebt:U,clientsCredit:se,clientsMargin:P,suppliersOrdered:z,suppliersPayments:ee,suppliersDebt:ne,deliveriesCount:b.length,deliveriesCompleted:Le,deliveriesPending:ce,ordersCount:S.length,ordersConfirmed:te,ordersDelivered:G},topClients:k,topSuppliers:be,recentDeliveries:H};e(oe)}catch(h){console.error("Error fetching dashboard stats:",h),i("Erreur lors du chargement des statistiques")}finally{n(!1)}},x=h=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(h)+" DH",f=()=>c&&l?new Date(parseInt(c),parseInt(l)-1,1).toLocaleDateString("fr-FR",{month:"long",year:"numeric"}):c&&!l?`Année ${c}`:!c&&l?new Date(new Date().getFullYear(),parseInt(l)-1,1).toLocaleDateString("fr-FR",{month:"long",year:"numeric"}):new Date().toLocaleDateString("fr-FR",{month:"long",year:"numeric"});return s?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement du tableau de bord..."})]})}):a?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:a}),r.jsx("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):t?r.jsxs("div",{className:"h-full flex flex-col space-y-8",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(Hl,{className:"w-8 h-8 text-blue-600"}),"Tableau de bord"]}),r.jsxs("p",{className:"text-gray-600 mt-1",children:["Vue d'ensemble des performances - ",f()]})]}),r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(_r,{className:"w-4 h-4"}),"Actualiser"]})})]}),r.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-lg border border-gray-200/50 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_r,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Période d'analyse"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{htmlFor:"month-filter",className:"text-xs text-gray-600 font-medium",children:"Mois"}),r.jsx("select",{id:"month-filter",value:l,onChange:h=>o(h.target.value),className:"text-xs border border-gray-300 rounded-md px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/90 min-w-[120px]",children:u().map(h=>r.jsx("option",{value:h.value,children:h.label},h.value))})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{htmlFor:"year-filter",className:"text-xs text-gray-600 font-medium",children:"Année"}),r.jsx("select",{id:"year-filter",value:c,onChange:h=>d(h.target.value),className:"text-xs border border-gray-300 rounded-md px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/90 min-w-[100px]",children:m().map(h=>r.jsx("option",{value:h.value,children:h.label},h.value))})]}),(l||c)&&r.jsx("button",{onClick:()=>{o(""),d("")},className:"text-xs text-gray-500 hover:text-gray-700 underline transition-colors duration-200",children:"Réinitialiser"})]})]}),(l||c)&&r.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200/50",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),r.jsxs("span",{className:"text-xs text-blue-700 font-medium",children:["Filtre actif:",l&&` ${(v=u().find(h=>h.value===l))==null?void 0:v.label}`,c&&` ${c}`,!l&&c&&` Toute l'année ${c}`,l&&!c&&` ${(j=u().find(h=>h.value===l))==null?void 0:j.label} (année courante)`]})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Clients"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.totalClients})]}),r.jsx(Lt,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Fournisseurs"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.totalFournisseurs})]}),r.jsx(Ut,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Chauffeurs"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.totalChauffeurs})]}),r.jsx(we,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Produits"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.totalProducts})]}),r.jsx(As,{className:"w-8 h-8 text-blue-600"})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(Lt,{className:"w-6 h-6 text-blue-600"}),"Performance Clients"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(mt,{className:"w-4 h-4 text-blue-600"}),r.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Chiffre d'Affaires"})]}),r.jsx("p",{className:"text-xl font-bold text-blue-900",children:x(t.currentMonth.clientsRevenue)})]}),r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(_t,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"text-sm font-medium text-green-800",children:"Paiements Reçus"})]}),r.jsx("p",{className:"text-xl font-bold text-green-900",children:x(t.currentMonth.clientsPayments)})]}),r.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Ls,{className:"w-4 h-4 text-red-600"}),r.jsx("span",{className:"text-sm font-medium text-red-800",children:"Crédit Clients"})]}),r.jsx("p",{className:"text-xl font-bold text-red-900",children:x(t.currentMonth.clientsDebt)})]}),r.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Wf,{className:"w-4 h-4 text-purple-600"}),r.jsx("span",{className:"text-sm font-medium text-purple-800",children:"Marge Totale"})]}),r.jsx("p",{className:"text-xl font-bold text-purple-900",children:x(t.currentMonth.clientsMargin)})]})]}),t.currentMonth.clientsCredit>0&&r.jsxs("div",{className:"mt-4 bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(hn,{className:"w-4 h-4 text-yellow-600"}),r.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Avance à Consommer"})]}),r.jsx("p",{className:"text-xl font-bold text-yellow-900",children:x(t.currentMonth.clientsCredit)})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(Ut,{className:"w-6 h-6 text-orange-600"}),"Performance Fournisseurs"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Ae,{className:"w-4 h-4 text-orange-600"}),r.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Total Commandé"})]}),r.jsx("p",{className:"text-xl font-bold text-orange-900",children:x(t.currentMonth.suppliersOrdered)})]}),r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(_t,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"text-sm font-medium text-green-800",children:"Total Payé"})]}),r.jsx("p",{className:"text-xl font-bold text-green-900",children:x(t.currentMonth.suppliersPayments)})]}),r.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200 md:col-span-2",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Ls,{className:"w-4 h-4 text-red-600"}),r.jsx("span",{className:"text-sm font-medium text-red-800",children:"Crédit Fournisseurs"})]}),r.jsx("p",{className:"text-xl font-bold text-red-900",children:x(t.currentMonth.suppliersDebt)})]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(we,{className:"w-6 h-6 text-green-600"}),"Livraisons du Mois"]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2",children:r.jsx(Ae,{className:"w-6 h-6 text-blue-600"})}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.currentMonth.deliveriesCount}),r.jsx("p",{className:"text-sm text-gray-600",children:"Total"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"bg-green-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2",children:r.jsx(Fs,{className:"w-6 h-6 text-green-600"})}),r.jsx("p",{className:"text-2xl font-bold text-green-900",children:t.currentMonth.deliveriesCompleted}),r.jsx("p",{className:"text-sm text-gray-600",children:"Terminées"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"bg-yellow-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2",children:r.jsx(hn,{className:"w-6 h-6 text-yellow-600"})}),r.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:t.currentMonth.deliveriesPending}),r.jsx("p",{className:"text-sm text-gray-600",children:"En cours"})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(Ae,{className:"w-6 h-6 text-purple-600"}),"Commandes du Mois"]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2",children:r.jsx(Ae,{className:"w-6 h-6 text-blue-600"})}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.currentMonth.ordersCount}),r.jsx("p",{className:"text-sm text-gray-600",children:"Total"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"bg-green-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2",children:r.jsx(Fs,{className:"w-6 h-6 text-green-600"})}),r.jsx("p",{className:"text-2xl font-bold text-green-900",children:t.currentMonth.ordersConfirmed}),r.jsx("p",{className:"text-sm text-gray-600",children:"Confirmées"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"bg-purple-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2",children:r.jsx(we,{className:"w-6 h-6 text-purple-600"})}),r.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.currentMonth.ordersDelivered}),r.jsx("p",{className:"text-sm text-gray-600",children:"Livrées"})]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(mt,{className:"w-6 h-6 text-blue-600"}),"Top 5 Clients"]}),r.jsxs("div",{className:"space-y-4",children:[t.topClients.slice(0,5).map((h,y)=>r.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ${y===0?"bg-yellow-500":y===1?"bg-gray-400":y===2?"bg-orange-600":"bg-blue-500"}`,children:y+1}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:h.societe||`${h.nom} ${h.prenom}`}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Marge: ",x(h.margin)]})]})]}),r.jsx("div",{className:"text-right",children:r.jsx("p",{className:"font-semibold text-gray-900",children:x(h.revenue)})})]},h.id)),t.topClients.length===0&&r.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun client avec chiffre d'affaires"})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(Xf,{className:"w-6 h-6 text-orange-600"}),"Top 5 Fournisseurs"]}),r.jsxs("div",{className:"space-y-4",children:[t.topSuppliers.slice(0,5).map((h,y)=>r.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ${y===0?"bg-yellow-500":y===1?"bg-gray-400":y===2?"bg-orange-600":"bg-blue-500"}`,children:y+1}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:h.societe}),r.jsxs("p",{className:`text-sm ${h.debt>0?"text-red-600":"text-green-600"}`,children:["Crédit: ",x(h.debt)]})]})]}),r.jsx("div",{className:"text-right",children:r.jsx("p",{className:"font-semibold text-gray-900",children:x(h.ordered)})})]},h.id)),t.topSuppliers.length===0&&r.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun fournisseur avec commandes"})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(hn,{className:"w-6 h-6 text-green-600"}),"Livraisons Récentes"]}),t.recentDeliveries.length>0?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"N° BL"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Client"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Montant"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Date"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:t.recentDeliveries.map((h,y)=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-blue-600",children:h.numero_livraison}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:h.client_societe}),r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:x(h.total_ht)}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(h.date_livraison).toLocaleDateString("fr-FR")})]},y))})]})}):r.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucune livraison récente"})]})]}):null},Ag=()=>{const[t,e]=N.useState([]),[s,n]=N.useState(null),[a,i]=N.useState([]),[l,o]=N.useState(0),[c,d]=N.useState(!0),[u,m]=N.useState(null),[p,x]=N.useState(""),[f,v]=N.useState(!1),[j,h]=N.useState({dateFrom:"",dateTo:""}),[y,g]=N.useState({dateFrom:"",dateTo:""});N.useEffect(()=>{C()},[]),N.useEffect(()=>{s&&M()},[s,j]);const C=async()=>{try{d(!0),m(null);const{data:b,error:S}=await Q.from("fournisseurs").select("*").order("societe",{ascending:!0});if(S)throw S;e(b||[])}catch(b){console.error("Error fetching suppliers:",b),m("Erreur lors du chargement des fournisseurs")}finally{d(!1)}},M=async()=>{if(s)try{d(!0),m(null);let b=Q.from("bon_de_commande").select(`
          *,
          items:bon_de_commande_items(
            id,
            quantite,
            prix_unitaire,
            total_ligne,
            produit:produits(nom_produit)
          )
        `).eq("fournisseur_id",s.id).neq("statut","annulee").order("date_commande",{ascending:!1});j.dateFrom&&(b=b.gte("date_commande",j.dateFrom)),j.dateTo&&(b=b.lte("date_commande",j.dateTo));const{data:S,error:E}=await b;if(E)throw E;const w=await Promise.all((S||[]).map(async se=>({...se,payment_status:"unpaid",paid_amount:0})));let R=Q.from("paiements_fournisseurs").select("montant").eq("fournisseur_id",s.id);j.dateFrom&&(R=R.gte("date_paiement",j.dateFrom)),j.dateTo&&(R=R.lte("date_paiement",j.dateTo));const{data:L}=await R,U=(L||[]).reduce((se,P)=>se+P.montant,0);i(w),o(U)}catch(b){console.error("Error fetching supplier orders:",b),m("Erreur lors du chargement des commandes")}finally{d(!1)}},$=b=>{n(b),v(!1),x("")},T=(b,S)=>{g(E=>({...E,[b]:S}))},A=(b,S)=>{h(E=>({...E,[b]:S}))},D=()=>{h({dateFrom:"",dateTo:""}),g({dateFrom:"",dateTo:""})},q=()=>{window.print()},K=()=>{if(!s)return;const b=["Numéro Commande","Date Commande","Statut","Total HT (DH)","Total Payé (DH)","Solde (DH)","Notes"],S=a.map(U=>[U.numero_commande,new Date(U.date_commande).toLocaleDateString("fr-FR"),U.statut==="brouillon"?"Brouillon":U.statut==="envoyee"?"Envoyée":U.statut==="confirmee"?"Confirmée":U.statut==="livree"?"Livrée":U.statut==="annulee"?"Annulée":U.statut,U.total_ht.toFixed(2),"","",U.notes||""]);S.push([`TOTAUX (${I.ordersCount} commandes)`,"","",I.totalOrders.toFixed(2),I.totalPaid.toFixed(2),I.totalBalance.toFixed(2),""]);const E=[b,...S].map(U=>U.map(se=>`"${se}"`).join(",")).join(`
`),w=new Blob([E],{type:"text/csv;charset=utf-8;"}),R=document.createElement("a"),L=URL.createObjectURL(w);R.setAttribute("href",L),R.setAttribute("download",`commandes_${s.societe.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)},J=t.filter(b=>b.societe.toLowerCase().includes(p.toLowerCase())||b.nom.toLowerCase().includes(p.toLowerCase())||b.prenom.toLowerCase().includes(p.toLowerCase())||b.numero_fournisseur.toLowerCase().includes(p.toLowerCase())),Z=b=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(b)+" DH",Y=b=>{const S={brouillon:"bg-gray-100 text-gray-800",envoyee:"bg-blue-100 text-blue-800",confirmee:"bg-green-100 text-green-800",livree:"bg-purple-100 text-purple-800",annulee:"bg-red-100 text-red-800"},E={brouillon:"Brouillon",envoyee:"Envoyée",confirmee:"Confirmée",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S[b]||S.brouillon}`,children:E[b]||b})},I=(()=>{const b=a.reduce((w,R)=>w+R.total_ht,0),S=l,E=b-S;return{totalOrders:b,totalPaid:S,totalBalance:E,ordersCount:a.length}})(),O=()=>j.dateFrom&&j.dateTo?`Du ${new Date(j.dateFrom).toLocaleDateString("fr-FR")} au ${new Date(j.dateTo).toLocaleDateString("fr-FR")}`:j.dateFrom?`À partir du ${new Date(j.dateFrom).toLocaleDateString("fr-FR")}`:j.dateTo?`Jusqu'au ${new Date(j.dateTo).toLocaleDateString("fr-FR")}`:"Toutes les périodes";return N.useEffect(()=>{g(j)},[j]),c?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement..."})]})}):u?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:u}),r.jsx("button",{onClick:()=>s?M():C(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):s?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8 print:hidden",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>n(null),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(Ut,{className:"w-8 h-8 text-blue-600"}),"Commandes - ",s.societe]}),r.jsxs("p",{className:"text-gray-600 mt-1",children:[s.prenom," ",s.nom," - ",s.numero_fournisseur]})]})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:K,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(Qr,{className:"w-4 h-4"}),"Exporter CSV"]}),r.jsxs("button",{onClick:q,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer"]})]})]}),r.jsx("div",{className:"hidden print:block mb-8",children:r.jsxs("div",{className:"relative text-center border-b-2 border-gray-300 pb-4",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"absolute top-0 left-0 h-24 w-auto"}),r.jsxs("h2",{className:"text-xl font-semibold text-gray-700 mt-2",children:["Rapport Commandes Fournisseur - ",(s==null?void 0:s.societe)||`${s==null?void 0:s.prenom} ${s==null?void 0:s.nom}`]})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6 print:hidden",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(_r,{className:"w-5 h-5"}),"Filtres de période"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-2",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:y.dateFrom,onChange:b=>T("dateFrom",b.target.value),onBlur:b=>A("dateFrom",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-2",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:y.dateTo,onChange:b=>T("dateTo",b.target.value),onBlur:b=>A("dateTo",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:D,className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Effacer les filtres"})})]}),(j.dateFrom||j.dateTo)&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:"Période active:"})," ",O()]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 print:hidden",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Commandes"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:I.ordersCount})]}),r.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Commandes"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Z(I.totalOrders)})]}),r.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Payé"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:Z(I.totalPaid)})]}),r.jsx(_t,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Solde"}),r.jsx("p",{className:`text-2xl font-bold ${I.totalBalance>0?"text-red-600":"text-green-600"}`,children:Z(I.totalBalance)})]}),r.jsx(_t,{className:`w-8 h-8 ${I.totalBalance>0?"text-red-600":"text-green-600"}`})]})})]}),r.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200 print:hidden",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Rapport bon de commandes"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[a.length," commande(s)"]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full print:text-sm",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"N° Commande"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"TOTAL HT"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Payé"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Crédit"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length>0?a.map(b=>r.jsxs("tr",{className:"hover:bg-gray-50 print:hover:bg-transparent",children:[r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("div",{className:"text-sm font-medium text-blue-600",children:b.numero_commande})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:new Date(b.date_commande).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:Y(b.statut)}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:Z(b.total_ht)}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-green-600",children:Z(b.paid_amount)}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium",children:r.jsx("span",{className:`${b.total_ht-b.paid_amount>0?"text-red-600":"text-green-600"}`,children:Z(b.total_ht-b.paid_amount)})})]},b.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(Ae,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:"Aucune commande pour la période sélectionnée"})]})})})}),a.length>0&&r.jsx("tfoot",{className:"bg-gray-100 border-t-2 border-gray-300",children:r.jsxs("tr",{className:"font-semibold",children:[r.jsxs("td",{className:"px-4 py-4 text-sm font-bold text-gray-900",colSpan:3,children:["TOTAUX (",I.ordersCount," commandes)"]}),r.jsx("td",{className:"px-4 py-4 text-sm font-bold text-blue-600",children:Z(I.totalOrders)}),r.jsx("td",{className:"px-4 py-4 text-sm font-bold text-green-600",children:Z(I.totalPaid)}),r.jsx("td",{className:`px-4 py-4 text-sm font-bold ${I.totalBalance>0?"text-red-600":"text-green-600"}`,children:Z(I.totalBalance)})]})})]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 15px;
            size: A4 portrait;
          }
          
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          .print\\:hidden {
            display: none !important;
          }
          
          .print\\:block {
            display: block !important;
          }
          
          /* Hide everything except the table container and its content */
          * {
            visibility: hidden;
          }
          
          /* Show only the main content container and table */
          .h-full,
          .flex-1:last-child,
          .flex-1:last-child *,
          .hidden.print\\:block,
          .hidden.print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print */
          .h-full {
            height: auto !important;
            display: block !important;
            position: static !important;
          }
          
          .flex-1:last-child {
            width: 100% !important;
            margin: 0 !important;
            padding: 15px !important;
            background: white !important;
            color: black !important;
          }
          
          /* Table styling for print */
          table {
            width: 100% !important;
            border-collapse: collapse !important;
            margin-top: 20px !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 8px !important;
            text-align: left !important;
          }
          
          th {
            background-color: #f5f5f5 !important;
            font-weight: bold !important;
          }
          
          tr {
            page-break-inside: avoid;
          }
          
          thead {
            display: table-header-group;
          }
          
          tfoot {
            display: table-footer-group;
            page-break-inside: avoid;
            font-weight: bold !important;
          }
          
          /* Hide any remaining layout elements */
          nav, aside, button, .print\\:hidden {
            display: none !important;
            visibility: hidden !important;
          }
        }
      `})]}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"flex items-center justify-between mb-8",children:r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(Ut,{className:"w-8 h-8 text-blue-600"}),"Rapport Fournisseurs"]}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Sélectionnez un fournisseur pour voir ses commandes"})]})}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un fournisseur...",value:p,onChange:b=>x(b.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:J.map(b=>r.jsxs("div",{onClick:()=>$(b),className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:border-blue-300 hover:shadow-md cursor-pointer transition-all duration-200",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx(Ut,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:b.societe}),r.jsx("p",{className:"text-sm text-gray-600",children:b.numero_fournisseur})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("p",{className:"text-sm text-gray-900",children:[b.prenom," ",b.nom]}),r.jsx("p",{className:"text-sm text-gray-600",children:b.email}),r.jsx("p",{className:"text-sm text-gray-600",children:b.telephone})]})]},b.id))}),J.length===0&&r.jsxs("div",{className:"text-center py-12 text-gray-500",children:[r.jsx(Ut,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"Aucun fournisseur trouvé"})]})]})},Og=()=>{const[t,e]=N.useState([]),[s,n]=N.useState(null),[a,i]=N.useState([]),[l,o]=N.useState(0),[c,d]=N.useState(!0),[u,m]=N.useState(null),[p,x]=N.useState(""),[f,v]=N.useState({dateFrom:"",dateTo:""}),[j,h]=N.useState({dateFrom:"",dateTo:""});N.useEffect(()=>{y()},[]),N.useEffect(()=>{s&&g()},[s,f]);const y=async()=>{try{d(!0),m(null);const{data:I,error:O}=await Q.from("clients").select("*").order("societe",{ascending:!0});if(O)throw O;e(I||[])}catch(I){console.error("Error fetching clients:",I),m("Erreur lors du chargement des clients")}finally{d(!1)}},g=async()=>{if(s)try{d(!0),m(null);let I=Q.from("bon_de_livraison").select(`
          *,
          items:bon_de_livraison_items(
            id,
            quantite_livree,
            prix_unitaire,
            total_ligne,
            produit:produits(nom_produit, prix_achat)
          ),
          bon_commande:bon_de_commande(
            numero_commande,
            fournisseur:fournisseurs(nom, prenom, societe)
          )
        `).eq("client_id",s.id).neq("statut","annulee").order("date_livraison",{ascending:!1});f.dateFrom&&(I=I.gte("date_livraison",f.dateFrom)),f.dateTo&&(I=I.lte("date_livraison",f.dateTo));const{data:O,error:b}=await I;if(b)throw b;i(O||[]);let S=Q.from("paiements_clients").select("montant").eq("client_id",s.id);f.dateFrom&&(S=S.gte("date_paiement",f.dateFrom)),f.dateTo&&(S=S.lte("date_paiement",f.dateTo));const{data:E}=await S,w=(E||[]).reduce((R,L)=>R+L.montant,0);o(w)}catch(I){console.error("Error fetching client deliveries:",I),m("Erreur lors du chargement des livraisons")}finally{d(!1)}},C=I=>{n(I),x("")},M=(I,O)=>{h(b=>({...b,[I]:O}))},$=(I,O)=>{v(b=>({...b,[I]:O}))},T=()=>{v({dateFrom:"",dateTo:""}),h({dateFrom:"",dateTo:""})},A=()=>{window.print()},D=()=>{if(!s)return;const I=["Date Livraison","BC Source","Numéro Livraison","Total HT (DH)","Statut","Notes"],O=a.map(R=>{var L;return[new Date(R.date_livraison).toLocaleDateString("fr-FR"),((L=R.bon_commande)==null?void 0:L.numero_commande)||"",R.numero_livraison,R.total_ht.toFixed(2),R.statut==="en_preparation"?"En préparation":R.statut==="en_cours"?"En cours":R.statut==="livree"?"Livrée":R.statut==="annulee"?"Annulée":R.statut,R.notes||""]});O.push(["","",`TOTAUX (${a.length} livraisons)`,Y.totalDeliveries.toFixed(2),"",""]);const b=[I,...O].map(R=>R.map(L=>`"${L}"`).join(",")).join(`
`),S=new Blob([b],{type:"text/csv;charset=utf-8;"}),E=document.createElement("a"),w=URL.createObjectURL(S);E.setAttribute("href",w),E.setAttribute("download",`livraisons_${s.societe.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.csv`),E.style.visibility="hidden",document.body.appendChild(E),E.click(),document.body.removeChild(E)},q=t.filter(I=>I.societe.toLowerCase().includes(p.toLowerCase())||I.nom.toLowerCase().includes(p.toLowerCase())||I.prenom.toLowerCase().includes(p.toLowerCase())||I.numero_client.toLowerCase().includes(p.toLowerCase())),K=I=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(I)+" DH",J=I=>{const O={en_preparation:"bg-yellow-100 text-yellow-800",en_cours:"bg-blue-100 text-blue-800",livree:"bg-green-100 text-green-800",annulee:"bg-red-100 text-red-800"},b={en_preparation:"En préparation",en_cours:"En cours",livree:"Livrée",annulee:"Annulée"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O[I]||O.en_preparation}`,children:b[I]||I})},Y=(()=>{const I=a.reduce((b,S)=>b+S.total_ht,0),O=I-l;return{totalDeliveries:I,totalPaid:l,totalBalance:O,deliveriesCount:a.length}})(),V=()=>f.dateFrom&&f.dateTo?`Du ${new Date(f.dateFrom).toLocaleDateString("fr-FR")} au ${new Date(f.dateTo).toLocaleDateString("fr-FR")}`:f.dateFrom?`À partir du ${new Date(f.dateFrom).toLocaleDateString("fr-FR")}`:f.dateTo?`Jusqu'au ${new Date(f.dateTo).toLocaleDateString("fr-FR")}`:"Toutes les périodes";return N.useEffect(()=>{h(f)},[f]),c?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement..."})]})}):u?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:u}),r.jsx("button",{onClick:()=>s?g():y(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):s?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8 print:hidden",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>n(null),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(Lt,{className:"w-8 h-8 text-blue-600"}),"Livraisons - ",s.societe]}),r.jsxs("p",{className:"text-gray-600 mt-1",children:[s.prenom," ",s.nom," - ",s.numero_client]})]})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:D,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(Qr,{className:"w-4 h-4"}),"Exporter CSV"]}),r.jsxs("button",{onClick:A,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer"]})]})]}),r.jsx("div",{className:"hidden print:block mb-8",children:r.jsxs("div",{className:"relative text-center border-b-2 border-gray-300 pb-4",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"absolute top-0 left-0 h-24 w-auto"}),r.jsxs("h2",{className:"text-xl font-semibold text-gray-700 mt-2",children:["Rapport Livraisons Client - ",(s==null?void 0:s.societe)||`${s==null?void 0:s.prenom} ${s==null?void 0:s.nom}`]})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6 print:hidden",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(_r,{className:"w-5 h-5"}),"Filtres de période"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-2",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:j.dateFrom,onChange:I=>M("dateFrom",I.target.value),onBlur:I=>$("dateFrom",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-2",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:j.dateTo,onChange:I=>M("dateTo",I.target.value),onBlur:I=>$("dateTo",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:T,className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Effacer les filtres"})})]}),(f.dateFrom||f.dateTo)&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:"Période active:"})," ",V()]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 print:hidden",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Livraisons"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Y.deliveriesCount})]}),r.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Chiffre d'Affaires"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:K(Y.totalDeliveries)})]}),r.jsx(mt,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Payé"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:K(Y.totalPaid)})]}),r.jsx(_t,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Solde"}),r.jsx("p",{className:`text-2xl font-bold ${Y.totalBalance>0?"text-red-600":"text-green-600"}`,children:K(Y.totalBalance)})]}),r.jsx(Ls,{className:`w-8 h-8 ${Y.totalBalance>0?"text-red-600":"text-green-600"}`})]})})]}),r.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200 print:hidden",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Rapport bon de livraison"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[a.length," livraison(s)"]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full print:text-sm",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"BC Source"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"N° Livraison"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total HT"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Statut"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length>0?a.map(I=>{var O;return r.jsxs("tr",{className:"hover:bg-gray-50 print:hover:bg-transparent",children:[r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("div",{className:"text-sm text-gray-900",children:new Date(I.date_livraison).toLocaleDateString("fr-FR")})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 font-mono",children:((O=I.bon_commande)==null?void 0:O.numero_commande)||"-"}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("div",{className:"text-sm font-medium text-blue-600",children:I.numero_livraison})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:K(I.total_ht)}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:J(I.statut)})]},I.id)}):r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(Ae,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:"Aucune livraison pour la période sélectionnée"})]})})})}),a.length>0&&r.jsx("tfoot",{className:"bg-gray-100 border-t-2 border-gray-300",children:r.jsxs("tr",{className:"font-semibold",children:[r.jsxs("td",{className:"px-4 py-4 text-sm font-bold text-gray-900",colSpan:4,children:["TOTAUX (",Y.deliveriesCount," livraisons)"]}),r.jsx("td",{className:"px-4 py-4 text-sm font-bold text-blue-600",children:K(Y.totalDeliveries)})]})})]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 15px;
            size: A4 portrait;
          }
          
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          .print\\:hidden {
            display: none !important;
          }
          
          .print\\:block {
            display: block !important;
          }
          
          /* Hide everything except the table container and its content */
          * {
            visibility: hidden;
          }
          
          /* Show only the main content container and table */
          .h-full,
          .flex-1:last-child,
          .flex-1:last-child *,
          .hidden.print\\:block,
          .hidden.print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print */
          .h-full {
            height: auto !important;
            display: block !important;
            position: static !important;
          }
          
          .flex-1:last-child {
            width: 100% !important;
            margin: 0 !important;
            padding: 15px !important;
            background: white !important;
            color: black !important;
          }
          
          /* Table styling for print */
          table {
            width: 100% !important;
            border-collapse: collapse !important;
            margin-top: 20px !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 8px !important;
            text-align: left !important;
          }
          
          th {
            background-color: #f5f5f5 !important;
            font-weight: bold !important;
          }
          
          tr {
            page-break-inside: avoid;
          }
          
          thead {
            display: table-header-group;
          }
          
          tfoot {
            display: table-footer-group;
            page-break-inside: avoid;
            font-weight: bold !important;
          }
          
          /* Hide any remaining layout elements */
          nav, aside, button, .print\\:hidden {
            display: none !important;
            visibility: hidden !important;
          }
        }
      `})]}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"flex items-center justify-between mb-8",children:r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(Lt,{className:"w-8 h-8 text-blue-600"}),"Rapport Clients"]}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Sélectionnez un client pour voir ses livraisons"})]})}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un client...",value:p,onChange:I=>x(I.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(I=>r.jsxs("div",{onClick:()=>C(I),className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:border-blue-300 hover:shadow-md cursor-pointer transition-all duration-200",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx(Lt,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:I.societe}),r.jsx("p",{className:"text-sm text-gray-600",children:I.numero_client})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("p",{className:"text-sm text-gray-900",children:[I.prenom," ",I.nom]}),r.jsx("p",{className:"text-sm text-gray-600",children:I.email}),r.jsx("p",{className:"text-sm text-gray-600",children:I.telephone})]})]},I.id))}),q.length===0&&r.jsxs("div",{className:"text-center py-12 text-gray-500",children:[r.jsx(Lt,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"Aucun client trouvé"})]})]})},$g=()=>{const[t,e]=N.useState([]),[s,n]=N.useState(null),[a,i]=N.useState([]),[l,o]=N.useState([]),[c,d]=N.useState(!0),[u,m]=N.useState(null),[p,x]=N.useState(""),[f,v]=N.useState({dateFrom:"",dateTo:""}),[j,h]=N.useState({dateFrom:"",dateTo:""});N.useEffect(()=>{y()},[]),N.useEffect(()=>{s&&g()},[s,f]);const y=async()=>{try{d(!0),m(null);const{data:V,error:I}=await Q.from("chauffeurs").select("*").order("nom",{ascending:!0});if(I)throw I;e(V||[])}catch(V){console.error("Error fetching chauffeurs:",V),m("Erreur lors du chargement des chauffeurs")}finally{d(!1)}},g=async()=>{if(s)try{d(!0),m(null);let V=Q.from("bon_de_livraison").select(`
          *,
          client:clients(nom, prenom, societe, numero_client),
          bon_commande:bon_de_commande(
            numero_commande,
            fournisseur:fournisseurs(nom, prenom, societe, numero_fournisseur)
          )
        `).eq("chauffeur_id",s.id).neq("statut","annulee").order("date_livraison",{ascending:!1});f.dateFrom&&(V=V.gte("date_livraison",f.dateFrom)),f.dateTo&&(V=V.lte("date_livraison",f.dateTo));const{data:I,error:O}=await V;if(O)throw O;i(I||[]);let b=Q.from("paiements_chauffeurs").select("*").eq("chauffeur_id",s.id);f.dateFrom&&(b=b.gte("date_paiement",f.dateFrom)),f.dateTo&&(b=b.lte("date_paiement",f.dateTo));const{data:S}=await b;o(S||[])}catch(V){console.error("Error fetching chauffeur deliveries:",V),m("Erreur lors du chargement des livraisons")}finally{d(!1)}},C=V=>{n(V),x("")},M=(V,I)=>{h(O=>({...O,[V]:I}))},$=(V,I)=>{v(O=>({...O,[V]:I}))},T=()=>{v({dateFrom:"",dateTo:""}),h({dateFrom:"",dateTo:""})},A=()=>{window.print()},D=()=>{if(!s)return;const V=["Date","BL number","Supplier","Client","Total"],I=a.map(w=>{var R,L,U,se,P,B,k,z,ee;return[new Date(w.date_livraison).toLocaleDateString("fr-FR"),w.numero_livraison,w.numero_livraison,((L=(R=w.bon_commande)==null?void 0:R.fournisseur)==null?void 0:L.societe)||`${((se=(U=w.bon_commande)==null?void 0:U.fournisseur)==null?void 0:se.prenom)||""} ${((B=(P=w.bon_commande)==null?void 0:P.fournisseur)==null?void 0:B.nom)||""}`.trim()||"Non spécifié",((k=w.client)==null?void 0:k.societe)||`${((z=w.client)==null?void 0:z.prenom)||""} ${((ee=w.client)==null?void 0:ee.nom)||""}`.trim()||"Non spécifié",w.total_ht.toFixed(2)]});I.push(["","",`TOTAUX (${a.length} livraisons)`,Z.totalDeliveries.toFixed(2)]);const O=[V,...I].map(w=>w.map(R=>`"${R}"`).join(",")).join(`
`),b=new Blob([O],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a"),E=URL.createObjectURL(b);S.setAttribute("href",E),S.setAttribute("download",`livraisons_chauffeur_${s.prenom}_${s.nom}_${new Date().toISOString().split("T")[0]}.csv`),S.style.visibility="hidden",document.body.appendChild(S),S.click(),document.body.removeChild(S)},q=t.filter(V=>V.nom.toLowerCase().includes(p.toLowerCase())||V.prenom.toLowerCase().includes(p.toLowerCase())||V.numero_chauffeur.toLowerCase().includes(p.toLowerCase())||V.telephone.toLowerCase().includes(p.toLowerCase())),K=V=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(V)+" DH",Z=(()=>{const V=a.reduce((S,E)=>S+E.total_ht,0),I=l.reduce((S,E)=>S+E.montant,0),O=a.length,b=a.filter(S=>S.statut==="livree").length;return{totalDeliveries:V,totalPayments:I,deliveriesCount:O,completedDeliveries:b}})(),Y=()=>f.dateFrom&&f.dateTo?`Du ${new Date(f.dateFrom).toLocaleDateString("fr-FR")} au ${new Date(f.dateTo).toLocaleDateString("fr-FR")}`:f.dateFrom?`À partir du ${new Date(f.dateFrom).toLocaleDateString("fr-FR")}`:f.dateTo?`Jusqu'au ${new Date(f.dateTo).toLocaleDateString("fr-FR")}`:"Toutes les périodes";return N.useEffect(()=>{h(f)},[f]),c?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement..."})]})}):u?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:u}),r.jsx("button",{onClick:()=>s?g():y(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):s?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8 print:hidden",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>n(null),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(we,{className:"w-8 h-8 text-blue-600"}),"Livraisons - ",s.prenom," ",s.nom]}),r.jsxs("p",{className:"text-gray-600 mt-1",children:[s.numero_chauffeur," - ",s.immatricule]})]})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:D,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(Qr,{className:"w-4 h-4"}),"Exporter CSV"]}),r.jsxs("button",{onClick:A,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-colors duration-200",children:[r.jsx(rr,{className:"w-4 h-4"}),"Imprimer"]})]})]}),r.jsx("div",{className:"hidden print:block mb-8",children:r.jsxs("div",{className:"relative text-center border-b-2 border-gray-300 pb-4",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/logo2.png",alt:"ANTURGOOD Logo",className:"absolute top-0 left-0 h-24 w-auto"}),r.jsxs("h2",{className:"text-xl font-semibold text-gray-700 mt-2",children:["Rapport Livraisons Chauffeur - ",s==null?void 0:s.prenom," ",s==null?void 0:s.nom]})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6 print:hidden",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(_r,{className:"w-5 h-5"}),"Filtres de période"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-2",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:j.dateFrom,onChange:V=>M("dateFrom",V.target.value),onBlur:V=>$("dateFrom",V.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-2",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:j.dateTo,onChange:V=>M("dateTo",V.target.value),onBlur:V=>$("dateTo",V.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:T,className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Effacer les filtres"})})]}),(f.dateFrom||f.dateTo)&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:"Période active:"})," ",Y()]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 print:hidden",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Livraisons"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Z.deliveriesCount})]}),r.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Terminées"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:Z.completedDeliveries})]}),r.jsx(mt,{className:"w-8 h-8 text-green-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Chiffre d'Affaires"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:K(Z.totalDeliveries)})]}),r.jsx(_t,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Paiements Reçus"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:K(Z.totalPayments)})]}),r.jsx(_t,{className:"w-8 h-8 text-green-600"})]})})]}),r.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200 print:hidden",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Rapport livraisons chauffeur"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[a.length," livraison(s)"]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full print:text-sm",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"BL number"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Supplier"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Client"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Total"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length>0?a.map(V=>{var I,O,b,S,E,w,R,L,U;return r.jsxs("tr",{className:"hover:bg-gray-50 print:hover:bg-transparent",children:[r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("div",{className:"text-sm text-gray-900",children:new Date(V.date_livraison).toLocaleDateString("fr-FR")})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("div",{className:"text-sm font-medium text-blue-600",children:V.numero_livraison})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:((O=(I=V.bon_commande)==null?void 0:I.fournisseur)==null?void 0:O.societe)||`${((S=(b=V.bon_commande)==null?void 0:b.fournisseur)==null?void 0:S.prenom)||""} ${((w=(E=V.bon_commande)==null?void 0:E.fournisseur)==null?void 0:w.nom)||""}`.trim()||"Non spécifié"}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:((R=V.client)==null?void 0:R.societe)||`${((L=V.client)==null?void 0:L.prenom)||""} ${((U=V.client)==null?void 0:U.nom)||""}`.trim()||"Non spécifié"}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:K(V.total_ht)})]},V.id)}):r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(Ae,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:"Aucune livraison pour la période sélectionnée"})]})})})}),a.length>0&&r.jsx("tfoot",{className:"bg-gray-100 border-t-2 border-gray-300",children:r.jsxs("tr",{className:"font-semibold",children:[r.jsxs("td",{className:"px-4 py-4 text-sm font-bold text-gray-900",colSpan:4,children:["TOTAUX (",Z.deliveriesCount," livraisons)"]}),r.jsx("td",{className:"px-4 py-4 text-sm font-bold text-blue-600",children:K(Z.totalDeliveries)})]})})]})})]}),r.jsx("style",{jsx:!0,children:`
        @media print {
          @page {
            margin: 15px;
            size: A4 portrait;
          }
          
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          .print\\:hidden {
            display: none !important;
          }
          
          .print\\:block {
            display: block !important;
          }
          
          /* Hide everything except the table container and its content */
          * {
            visibility: hidden;
          }
          
          /* Show only the main content container and table */
          .h-full,
          .flex-1:last-child,
          .flex-1:last-child *,
          .hidden.print\\:block,
          .hidden.print\\:block * {
            visibility: visible;
          }
          
          /* Reset layout for print */
          .h-full {
            height: auto !important;
            display: block !important;
            position: static !important;
          }
          
          .flex-1:last-child {
            width: 100% !important;
            margin: 0 !important;
            padding: 15px !important;
            background: white !important;
            color: black !important;
          }
          
          /* Table styling for print */
          table {
            width: 100% !important;
            border-collapse: collapse !important;
            margin-top: 20px !important;
          }
          
          th, td {
            border: 1px solid #000 !important;
            padding: 8px !important;
            text-align: left !important;
          }
          
          th {
            background-color: #f5f5f5 !important;
            font-weight: bold !important;
          }
          
          tr {
            page-break-inside: avoid;
          }
          
          thead {
            display: table-header-group;
          }
          
          tfoot {
            display: table-footer-group;
            page-break-inside: avoid;
            font-weight: bold !important;
          }
          
          /* Hide any remaining layout elements */
          nav, aside, button, .print\\:hidden {
            display: none !important;
            visibility: hidden !important;
          }
        }
      `})]}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"flex items-center justify-between mb-8",children:r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(we,{className:"w-8 h-8 text-blue-600"}),"Rapport Chauffeurs"]}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Sélectionnez un chauffeur pour voir ses livraisons"})]})}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher un chauffeur...",value:p,onChange:V=>x(V.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(V=>r.jsxs("div",{onClick:()=>C(V),className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:border-blue-300 hover:shadow-md cursor-pointer transition-all duration-200",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx(we,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsxs("h3",{className:"font-semibold text-gray-900",children:[V.prenom," ",V.nom]}),r.jsx("p",{className:"text-sm text-gray-600",children:V.numero_chauffeur})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-sm text-gray-900 font-mono",children:V.immatricule}),r.jsx("p",{className:"text-sm text-gray-600",children:V.telephone}),r.jsx("div",{className:"mt-2",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${V.type_chauffeur==="interne"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:V.type_chauffeur==="interne"?"Interne":"Externe"})})]})]},V.id))}),q.length===0&&r.jsxs("div",{className:"text-center py-12 text-gray-500",children:[r.jsx(we,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"Aucun chauffeur trouvé"})]})]})},Rg=()=>{const[t,e]=N.useState([]),[s,n]=N.useState(!0),[a,i]=N.useState(null),[l,o]=N.useState(1),[c,d]=N.useState(""),[u,m]=N.useState(20),[p,x]=N.useState(""),[f,v]=N.useState(""),[j,h]=N.useState({dateFrom:"",dateTo:""}),[y,g]=N.useState(!1),[C,M]=N.useState(!1),[$,T]=N.useState(null),[A,D]=N.useState(!1),[q,K]=N.useState(!1),[J,Z]=N.useState(!1),[Y,V]=N.useState({montant:"",mode_paiement:"cash",reference:"",issuer:"",date_paiement:"",notes:""});N.useEffect(()=>{I()},[]);const I=async()=>{try{n(!0),i(null);const{data:F,error:X}=await Q.from("paiements_clients").select(`
          *,
          client:clients(id, nom, prenom, societe, numero_client)
        `).order("date_paiement",{ascending:!1});if(X)throw X;const{data:le,error:ae}=await Q.from("paiements_fournisseurs").select(`
          *,
          fournisseur:fournisseurs(id, nom, prenom, societe, numero_fournisseur)
        `).order("date_paiement",{ascending:!1});if(ae)throw ae;const{data:Se,error:kt}=await Q.from("paiements_chauffeurs").select(`
          *,
          chauffeur:chauffeurs(id, nom, prenom, numero_chauffeur)
        `).order("date_paiement",{ascending:!1});if(kt)throw kt;const zs=[...(F||[]).map(ke=>({...ke,type:"client",entity:{id:ke.client.id,nom:ke.client.nom,prenom:ke.client.prenom,societe:ke.client.societe,numero_client:ke.client.numero_client}})),...(le||[]).map(ke=>({...ke,type:"fournisseur",entity:{id:ke.fournisseur.id,nom:ke.fournisseur.nom,prenom:ke.fournisseur.prenom,societe:ke.fournisseur.societe,numero_fournisseur:ke.fournisseur.numero_fournisseur}})),...(Se||[]).map(ke=>({...ke,type:"chauffeur",entity:{id:ke.chauffeur.id,nom:ke.chauffeur.nom,prenom:ke.chauffeur.prenom,numero_chauffeur:ke.chauffeur.numero_chauffeur}}))];zs.sort((ke,pi)=>new Date(pi.date_paiement).getTime()-new Date(ke.date_paiement).getTime()),e(zs)}catch(F){console.error("Error fetching payments:",F),i("Erreur lors du chargement des paiements")}finally{n(!1)}},O=(F,X)=>{h(le=>({...le,[F]:X})),o(1)},b=()=>{d(""),h({dateFrom:"",dateTo:""}),x(""),v(""),o(1)},S=()=>c||j.dateFrom||j.dateTo||p||f,E=F=>{if(!j.dateFrom&&!j.dateTo)return!0;const X=F,le=!j.dateFrom||X>=j.dateFrom,ae=!j.dateTo||X<=j.dateTo;return le&&ae},R=t.filter(F=>{const X=c.toLowerCase();return(F.reference||"").toLowerCase().includes(X)||(F.issuer||"").toLowerCase().includes(X)||F.entity.nom.toLowerCase().includes(X)||F.entity.prenom.toLowerCase().includes(X)||(F.entity.societe||"").toLowerCase().includes(X)||(F.entity.numero_client||"").toLowerCase().includes(X)||(F.entity.numero_fournisseur||"").toLowerCase().includes(X)||(F.entity.numero_chauffeur||"").toLowerCase().includes(X)||`${F.entity.prenom} ${F.entity.nom}`.toLowerCase().includes(X)||`${F.entity.nom} ${F.entity.prenom}`.toLowerCase().includes(X)}).filter(F=>{const X=E(F.date_paiement),le=!p||F.type===p,ae=!f||F.mode_paiement===f;return X&&le&&ae}),L=Math.ceil(R.length/u),U=(l-1)*u,se=U+u,P=R.slice(U,se),B=F=>{o(F)},k=()=>{l>1&&o(l-1)},z=()=>{l<L&&o(l+1)},ee=F=>{m(F),o(1)},ne=(F,X=!1)=>{T(F),D(X),X&&V({montant:F.montant.toString(),mode_paiement:F.mode_paiement,reference:F.reference||"",issuer:F.issuer||"",date_paiement:F.date_paiement,notes:F.notes||""}),g(!0)},ie=()=>{g(!1),T(null),D(!1),V({montant:"",mode_paiement:"cash",reference:"",issuer:"",date_paiement:"",notes:""}),i(null)},ue=F=>{const{name:X,value:le}=F.target;V(ae=>({...ae,[X]:le}))},ge=async F=>{if(F.preventDefault(),!!$){if(!Y.montant||Number(Y.montant)<=0){i("Le montant doit être supérieur à 0");return}K(!0),i(null);try{const X=$.type==="client"?"paiements_clients":$.type==="fournisseur"?"paiements_fournisseurs":"paiements_chauffeurs",{error:le}=await Q.from(X).update({montant:Number(Y.montant),mode_paiement:Y.mode_paiement,reference:Y.reference.trim()||null,issuer:Y.issuer.trim()||null,date_paiement:Y.date_paiement,notes:Y.notes.trim()||null}).eq("id",$.id);if(le)throw le;console.log("Payment updated successfully"),ie(),await I()}catch(X){console.error("Error updating payment:",X),i("Erreur lors de la modification du paiement. Veuillez réessayer.")}finally{K(!1)}}},be=async()=>{if($){Z(!0),i(null);try{const F=$.type==="client"?"paiements_clients":$.type==="fournisseur"?"paiements_fournisseurs":"paiements_chauffeurs",{error:X}=await Q.from(F).delete().eq("id",$.id);if(X)throw X;console.log("Payment deleted successfully"),M(!1),ie(),await I()}catch(F){console.error("Error deleting payment:",F),i("Erreur lors de la suppression du paiement. Veuillez réessayer.")}finally{Z(!1)}}},Le=F=>new Intl.NumberFormat("fr-MA",{minimumFractionDigits:2,useGrouping:!1}).format(F)+" DH",ce=F=>({cash:"Espèces",cheque:"Chèque",effet:"Effet",virement:"Virement"})[F]||F,te=F=>({client:"Client",fournisseur:"Fournisseur",chauffeur:"Chauffeur"})[F]||F,G=F=>{const X={client:"bg-blue-100 text-blue-800",fournisseur:"bg-orange-100 text-orange-800",chauffeur:"bg-green-100 text-green-800"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${X[F]||X.client}`,children:te(F)})},H=F=>{const X={cash:"bg-green-100 text-green-800",cheque:"bg-blue-100 text-blue-800",effet:"bg-purple-100 text-purple-800",virement:"bg-indigo-100 text-indigo-800"};return r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${X[F]||X.cash}`,children:ce(F)})},_=(()=>{const F=R.filter(ae=>ae.type==="client"),X=R.filter(ae=>ae.type==="fournisseur"),le=R.filter(ae=>ae.type==="chauffeur");return{totalAmount:R.reduce((ae,Se)=>ae+Se.montant,0),clientTotal:F.reduce((ae,Se)=>ae+Se.montant,0),supplierTotal:X.reduce((ae,Se)=>ae+Se.montant,0),chauffeurTotal:le.reduce((ae,Se)=>ae+Se.montant,0),count:R.length,clientCount:F.length,supplierCount:X.length,chauffeurCount:le.length}})();return s?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"Chargement des paiements..."})]})}):a&&!y?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:a}),r.jsx("button",{onClick:I,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Réessayer"})]})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"flex items-center justify-between mb-8",children:r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Paiements"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez tous vos paiements clients, fournisseurs et chauffeurs"})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Paiements"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Le(_.totalAmount)}),r.jsxs("p",{className:"text-xs text-gray-500",children:[_.count," paiement(s)"]})]}),r.jsx(_t,{className:"w-8 h-8 text-gray-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Clients"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Le(_.clientTotal)}),r.jsxs("p",{className:"text-xs text-gray-500",children:[_.clientCount," paiement(s)"]})]}),r.jsx(Lt,{className:"w-8 h-8 text-blue-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Fournisseurs"}),r.jsx("p",{className:"text-2xl font-bold text-orange-600",children:Le(_.supplierTotal)}),r.jsxs("p",{className:"text-xs text-gray-500",children:[_.supplierCount," paiement(s)"]})]}),r.jsx(Ut,{className:"w-8 h-8 text-orange-600"})]})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Chauffeurs"}),r.jsx("p",{className:"text-2xl font-bold text-green-600",children:Le(_.chauffeurTotal)}),r.jsxs("p",{className:"text-xs text-gray-500",children:[_.chauffeurCount," paiement(s)"]})]}),r.jsx(we,{className:"w-8 h-8 text-green-600"})]})})]}),r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx($e,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher par nom, société, référence...",value:c,onChange:F=>{d(F.target.value),o(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtres avancés"}),S()&&r.jsxs("button",{onClick:b,className:"text-red-600 hover:text-red-700 text-sm flex items-center gap-1 transition-colors duration-200",children:[r.jsx(Wr,{className:"w-4 h-4"}),"Effacer tous les filtres"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-from",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date début"}),r.jsx("input",{type:"date",id:"date-from",value:j.dateFrom,onChange:F=>O("dateFrom",F.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-to",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),r.jsx("input",{type:"date",id:"date-to",value:j.dateTo,onChange:F=>O("dateTo",F.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"type-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),r.jsxs("select",{id:"type-filter",value:p,onChange:F=>{x(F.target.value),o(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[r.jsx("option",{value:"",children:"Tous les types"}),r.jsx("option",{value:"client",children:"Clients"}),r.jsx("option",{value:"fournisseur",children:"Fournisseurs"}),r.jsx("option",{value:"chauffeur",children:"Chauffeurs"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"method-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Mode de paiement"}),r.jsxs("select",{id:"method-filter",value:f,onChange:F=>{v(F.target.value),o(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[r.jsx("option",{value:"",children:"Tous les modes"}),r.jsx("option",{value:"cash",children:"Espèces"}),r.jsx("option",{value:"cheque",children:"Chèque"}),r.jsx("option",{value:"effet",children:"Effet"}),r.jsx("option",{value:"virement",children:"Virement"})]})]})]}),S()&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:R.length})," paiement(s) trouvé(s) avec les filtres actifs"]}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Total filtré: ",Le(_.totalAmount)]})]})})]}),r.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Type"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Bénéficiaire"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Montant"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Mode de Paiement"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Référence"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.length>0?P.map(F=>r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(F.date_paiement).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:G(F.type)}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:F.entity.societe||`${F.entity.prenom} ${F.entity.nom}`}),r.jsx("div",{className:"text-sm text-gray-500",children:F.entity.numero_client||F.entity.numero_fournisseur||F.entity.numero_chauffeur})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("span",{className:`${F.type==="client"?"text-green-600":"text-red-600"}`,children:[F.type==="client"?"+":"-",Le(F.montant)]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:H(F.mode_paiement)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono",children:F.reference||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:()=>ne(F,!1),className:"text-blue-600 hover:text-blue-900 flex items-center gap-1",children:[r.jsx(zr,{className:"w-4 h-4"}),"Voir"]}),r.jsxs("button",{onClick:()=>ne(F,!0),className:"text-green-600 hover:text-green-900 flex items-center gap-1",children:[r.jsx(Ha,{className:"w-4 h-4"}),"Modifier"]})]})})]},F.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(_t,{className:"w-8 h-8 text-gray-300 mb-2"}),r.jsx("p",{children:c||S()?"Aucun paiement trouvé":"Aucun paiement disponible"}),S()&&r.jsx("button",{onClick:b,className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Effacer les filtres"})]})})})})]})})}),L>1&&r.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Affichage de ",U+1," à ",Math.min(se,R.length)," sur ",R.length," paiements"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Éléments par page:"}),r.jsxs("select",{value:u,onChange:F=>ee(Number(F.target.value)),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:20,children:"20"}),r.jsx("option",{value:50,children:"50"}),r.jsx("option",{value:100,children:"100"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:k,disabled:l===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx(Bt,{className:"w-5 h-5"})}),Array.from({length:L},(F,X)=>X+1).map(F=>r.jsx("button",{onClick:()=>B(F),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${l===F?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:F},F)),r.jsx("button",{onClick:z,disabled:l===L,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:r.jsx($t,{className:"w-5 h-5"})})]})]}),y&&$&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:A?"Modifier le paiement":"Détails du paiement"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[te($.type),": ",$.entity.societe||`${$.entity.prenom} ${$.entity.nom}`]})]}),r.jsx("button",{onClick:ie,className:"text-gray-400 hover:text-gray-600",children:r.jsx(Wr,{className:"w-5 h-5"})})]})}),A?r.jsxs("form",{onSubmit:ge,className:"p-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"edit-montant",className:"block text-sm font-medium text-gray-700 mb-1",children:["Montant (DH) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",id:"edit-montant",name:"montant",step:"0.01",min:"0.01",value:Y.montant,onChange:ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"edit-mode_paiement",className:"block text-sm font-medium text-gray-700 mb-1",children:["Mode de paiement ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"edit-mode_paiement",name:"mode_paiement",value:Y.mode_paiement,onChange:ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"cash",children:"Espèces"}),r.jsx("option",{value:"cheque",children:"Chèque"}),r.jsx("option",{value:"effet",children:"Effet"}),r.jsx("option",{value:"virement",children:"Virement bancaire"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"edit-reference",className:"block text-sm font-medium text-gray-700 mb-1",children:"Référence"}),r.jsx("input",{type:"text",id:"edit-reference",name:"reference",value:Y.reference,onChange:ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"N° chèque, effet, virement..."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"edit-issuer",className:"block text-sm font-medium text-gray-700 mb-1",children:"Émetteur"}),r.jsx("input",{type:"text",id:"edit-issuer",name:"issuer",value:Y.issuer,onChange:ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom de la banque, émetteur..."})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"edit-date_paiement",className:"block text-sm font-medium text-gray-700 mb-1",children:["Date de paiement ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"date",id:"edit-date_paiement",name:"date_paiement",value:Y.date_paiement,onChange:ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"edit-notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),r.jsx("textarea",{id:"edit-notes",name:"notes",rows:3,value:Y.notes,onChange:ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes optionnelles..."})]})]}),a&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:a})}),r.jsxs("div",{className:"flex gap-4 mt-6",children:[r.jsx("button",{type:"button",onClick:ie,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsx("button",{type:"button",onClick:()=>M(!0),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors duration-200",children:"Supprimer"}),r.jsxs("button",{type:"submit",disabled:q,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2",children:[r.jsx(ot,{className:"w-4 h-4"}),q?"Enregistrement...":"Enregistrer"]})]})]}):r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Montant"}),r.jsx("p",{className:"text-lg font-semibold text-gray-900",children:Le($.montant)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Mode de paiement"}),r.jsx("p",{className:"text-sm text-gray-900 mt-1",children:H($.mode_paiement)})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Référence"}),r.jsx("p",{className:"text-sm text-gray-900 font-mono",children:$.reference||"-"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Émetteur"}),r.jsx("p",{className:"text-sm text-gray-900",children:$.issuer||"-"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Date de paiement"}),r.jsx("p",{className:"text-sm text-gray-900",children:new Date($.date_paiement).toLocaleDateString("fr-FR")})]}),$.notes&&r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notes"}),r.jsx("p",{className:"text-sm text-gray-900 mt-1",children:$.notes})]})]}),r.jsxs("div",{className:"flex gap-4 mt-6",children:[r.jsx("button",{onClick:ie,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Fermer"}),r.jsxs("button",{onClick:()=>D(!0),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2",children:[r.jsx(Ha,{className:"w-4 h-4"}),"Modifier"]})]})]})]})}),C&&$&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirmer la suppression"})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("p",{className:"text-gray-600 mb-4",children:["Êtes-vous sûr de vouloir supprimer ce paiement de ",r.jsx("strong",{children:Le($.montant)})," ?"]}),r.jsx("p",{className:"text-sm text-gray-500",children:"Cette action est irréversible et peut affecter les calculs financiers."}),a&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:r.jsx("p",{className:"text-red-700 text-sm",children:a})}),r.jsxs("div",{className:"flex gap-4 mt-6",children:[r.jsx("button",{onClick:()=>M(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{onClick:be,disabled:J,className:"flex-1 bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2",children:[r.jsx(Qo,{className:"w-4 h-4"}),J?"Suppression...":"Supprimer"]})]})]})]})})]})},Ig=({onNavigateBack:t})=>{const[e,s]=N.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[n,a]=N.useState({current:!1,new:!1,confirm:!1}),[i,l]=N.useState({}),[o,c]=N.useState(!1),[d,u]=N.useState(""),m=v=>{const{name:j,value:h}=v.target;s(y=>({...y,[j]:h})),i[j]&&l(y=>({...y,[j]:""})),d&&u("")},p=v=>{a(j=>({...j,[v]:!j[v]}))},x=()=>{const v={};return e.currentPassword.trim()||(v.currentPassword="Le mot de passe actuel est requis"),e.newPassword.trim()?e.newPassword.length<6&&(v.newPassword="Le nouveau mot de passe doit contenir au moins 6 caractères"):v.newPassword="Le nouveau mot de passe est requis",e.confirmPassword.trim()?e.newPassword!==e.confirmPassword&&(v.confirmPassword="Les mots de passe ne correspondent pas"):v.confirmPassword="La confirmation du mot de passe est requise",e.currentPassword===e.newPassword&&(v.newPassword="Le nouveau mot de passe doit être différent de l'actuel"),l(v),Object.keys(v).length===0},f=async v=>{var j,h,y;if(v.preventDefault(),!!x()){c(!0),l({}),u("");try{const{data:{user:g},error:C}=await Q.auth.getUser();if(C||!(g!=null&&g.email)){await Q.auth.signOut();return}const{error:M}=await Q.auth.signInWithPassword({email:g.email,password:e.currentPassword});if(M){if((j=M.message)!=null&&j.includes("Invalid login credentials"))l({currentPassword:"Mot de passe actuel incorrect"});else{await Q.auth.signOut();return}return}const{error:$}=await Q.auth.updateUser({password:e.newPassword});if($)throw $;u("Mot de passe modifié avec succès !"),s({currentPassword:"",newPassword:"",confirmPassword:""})}catch(g){console.error("Password change error:",g),(h=g.message)!=null&&h.includes("Password should be at least")?l({newPassword:"Le mot de passe doit contenir au moins 6 caractères"}):(y=g.message)!=null&&y.includes("Session invalide")?l({general:g.message}):l({general:"Erreur lors de la modification. Veuillez réessayer."})}finally{c(!1)}}};return r.jsxs("div",{className:"min-h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:r.jsx(Me,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Changer le mot de passe"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Modifiez votre mot de passe de connexion"})]})]}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsxs("div",{className:"max-w-md bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[r.jsxs("form",{onSubmit:f,className:"space-y-6",children:[i.general&&r.jsx("div",{className:"rounded-md bg-red-50 p-4",children:r.jsx("div",{className:"text-sm text-red-700",children:i.general})}),d&&r.jsx("div",{className:"rounded-md bg-green-50 p-4",children:r.jsx("div",{className:"text-sm text-green-700",children:d})}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"currentPassword",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Mot de passe actuel ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:n.current?"text":"password",id:"currentPassword",name:"currentPassword",value:e.currentPassword,onChange:m,className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${i.currentPassword?"border-red-500":"border-gray-300"}`,placeholder:"Entrez votre mot de passe actuel"}),r.jsx(tn,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("button",{type:"button",onClick:()=>p("current"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n.current?r.jsx(Hi,{className:"w-5 h-5"}):r.jsx(zr,{className:"w-5 h-5"})})]}),i.currentPassword&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.currentPassword})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"newPassword",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Nouveau mot de passe ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:n.new?"text":"password",id:"newPassword",name:"newPassword",value:e.newPassword,onChange:m,className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${i.newPassword?"border-red-500":"border-gray-300"}`,placeholder:"Entrez votre nouveau mot de passe"}),r.jsx(tn,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("button",{type:"button",onClick:()=>p("new"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n.new?r.jsx(Hi,{className:"w-5 h-5"}):r.jsx(zr,{className:"w-5 h-5"})})]}),i.newPassword&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.newPassword}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Le mot de passe doit contenir au moins 6 caractères"})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Confirmer le nouveau mot de passe ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:n.confirm?"text":"password",id:"confirmPassword",name:"confirmPassword",value:e.confirmPassword,onChange:m,className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 ${i.confirmPassword?"border-red-500":"border-gray-300"}`,placeholder:"Confirmez votre nouveau mot de passe"}),r.jsx(tn,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("button",{type:"button",onClick:()=>p("confirm"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n.confirm?r.jsx(Hi,{className:"w-5 h-5"}):r.jsx(zr,{className:"w-5 h-5"})})]}),i.confirmPassword&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.confirmPassword})]}),r.jsx("div",{className:"pt-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors duration-200",children:"Annuler"}),r.jsxs("button",{type:"submit",disabled:o,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium transition-colors duration-200",children:[r.jsx(ot,{className:"w-5 h-5"}),o?"Modification...":"Changer le mot de passe"]})]})})]}),r.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(tn,{className:"w-5 h-5 text-blue-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Sécurité"}),r.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Après la modification, vous resterez connecté sur cet appareil. Vous devrez utiliser le nouveau mot de passe lors de vos prochaines connexions."})]})]})})]})})]})};function Mg(){const[t,e]=N.useState(null),[s,n]=ye.useState("clients-list"),[a,i]=ye.useState("Clients"),[l,o]=ye.useState(null),[c,d]=ye.useState(null),[u,m]=ye.useState(null),[p,x]=ye.useState(null),[f,v]=ye.useState(null),[j,h]=ye.useState(null),[y,g]=ye.useState(null),[C,M]=ye.useState(null),[$,T]=ye.useState(null),[A,D]=ye.useState(null),[q,K]=ye.useState(null),[J,Z]=ye.useState(null);N.useEffect(()=>{Q.auth.getSession().then(({data:{session:G}})=>{e(!!G)});const{data:{subscription:te}}=Q.auth.onAuthStateChange((G,H)=>{e(!!H)});return()=>te.unsubscribe()},[]);const Y=()=>{e(!0)},V=async()=>{await Q.auth.signOut(),e(!1)},I=[{name:"Tableau de bord",icon:Hl},{name:"Clients",icon:Lt},{name:"Fournisseurs",icon:Ut},{name:"Produits",icon:As},{name:"Bon de commande",icon:Ae},{name:"Paiements",icon:_t},{name:"Bon de livraison",icon:we},{name:"Chauffeurs",icon:Kf},{name:"Rapports",icon:Hl,submenu:[{name:"Fournisseurs",path:"supplier-reports"},{name:"Clients",path:"client-reports"},{name:"Chauffeurs",path:"chauffeur-reports"}]},{name:"Paramètres",icon:tn}],O=te=>{const G=I.find(H=>H.name===te);G!=null&&G.submenu?d(c===te?null:te):(i(te),o(null),d(null),n(te==="Tableau de bord"?"dashboard":te==="Clients"?"clients-list":te==="Fournisseurs"?"fournisseurs-list":te==="Produits"?"products-list":te==="Bon de commande"?"purchase-orders-list":te==="Paiements"?"payments-list":te==="Chauffeurs"?"chauffeurs-list":te==="Bon de livraison"?"delivery-notes-list":te==="Paramètres"?"password-change":"default"))},b=(te,G,H)=>{i(te),o(H),d(null),n(G)},S=()=>{n("clients-add")},E=te=>{m(te),n("clients-edit")},w=te=>{T(te),n("clients-details")},R=te=>{K(te),n("fournisseurs-details")},L=te=>{M(te),n("delivery-notes-edit")},U=()=>{l?a==="Rapports"&&l==="Fournisseurs"?n("supplier-reports"):a==="Rapports"&&l==="Clients"?n("client-reports"):a==="Rapports"&&l==="Chauffeurs"&&n("chauffeur-reports"):a==="Tableau de bord"?n("dashboard"):a==="Clients"?n("clients-list"):a==="Fournisseurs"?n("fournisseurs-list"):a==="Produits"?n("products-list"):a==="Bon de commande"?n("purchase-orders-list"):a==="Paiements"?n("payments-list"):a==="Chauffeurs"?n("chauffeurs-list"):a==="Bon de livraison"?n("delivery-notes-list"):a==="Paramètres"&&n("password-change"),m(null),x(null),v(null),h(null),g(null),M(null),T(null),D(null),K(null),Z(null),window.location.hash=Math.random().toString()},se=()=>{n("fournisseurs-add")},P=te=>{x(te),n("fournisseurs-edit")},B=()=>{n("products-add")},k=te=>{v(te),n("products-edit")},z=()=>{n("purchase-orders-add")},ee=te=>{h(te),n("purchase-orders-edit")},ne=()=>{n("chauffeurs-add")},ie=te=>{g(te),n("chauffeurs-edit")},ue=()=>{n("delivery-notes-add"),D(null)},ge=te=>{M(te),n("delivery-notes-edit")},be=te=>{D(te),n("delivery-notes-add")},Le=te=>{Z(te),n("chauffeurs-details")},ce=()=>{switch(s){case"dashboard":return r.jsx(Fg,{});case"supplier-reports":return r.jsx(Ag,{});case"client-reports":return r.jsx(Og,{});case"chauffeur-reports":return r.jsx($g,{});case"clients-list":return r.jsx(mg,{onNavigateToAdd:S,onNavigateToEdit:E,onNavigateToDetails:w});case"password-change":return r.jsx(Ig,{onNavigateBack:U});case"clients-add":return r.jsx(hg,{onNavigateBack:U});case"clients-edit":return u?r.jsx(xg,{client:u,onNavigateBack:U}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Client introuvable"})});case"clients-details":return $?r.jsx(Tg,{client:$,onNavigateBack:U,onNavigateToDelivery:L}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Client introuvable"})});case"fournisseurs-details":return q?r.jsx(Dg,{fournisseur:q,onNavigateBack:U,onNavigateToPurchaseOrder:ee}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Fournisseur introuvable"})});case"fournisseurs-list":return r.jsx(fg,{onNavigateToAdd:se,onNavigateToEdit:P,onNavigateToDetails:R});case"fournisseurs-add":return r.jsx(pg,{onNavigateBack:U});case"fournisseurs-edit":return p?r.jsx(gg,{fournisseur:p,onNavigateBack:U}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Fournisseur introuvable"})});case"products-list":return r.jsx(yg,{onNavigateToAdd:B,onNavigateToEdit:k});case"products-add":return r.jsx(bg,{onNavigateBack:U});case"products-edit":return f?r.jsx(vg,{product:f,onNavigateBack:U}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Produit introuvable"})});case"purchase-orders-list":return r.jsx(jg,{onNavigateToAdd:z,onNavigateToEdit:ee,onConvertToDelivery:be});case"purchase-orders-add":return r.jsx(wg,{onNavigateBack:U});case"purchase-orders-edit":return j?r.jsx(Ng,{order:j,onNavigateBack:U}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Bon de commande introuvable"})});case"payments-list":return r.jsx(Rg,{});case"chauffeurs-list":return r.jsx(_g,{onNavigateToAdd:ne,onNavigateToEdit:ie,onNavigateToDetails:Le});case"chauffeurs-add":return r.jsx(kg,{onNavigateBack:U});case"chauffeurs-edit":return y?r.jsx(Cg,{chauffeur:y,onNavigateBack:U}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Chauffeur introuvable"})});case"chauffeurs-details":return J?r.jsx(Lg,{chauffeur:J,onNavigateBack:U}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Chauffeur introuvable"})});case"delivery-notes-list":return r.jsx(Sg,{onNavigateToAdd:ue,onNavigateToEdit:ge});case"delivery-notes-add":return r.jsx(Eg,{onNavigateBack:U,preSelectedPurchaseOrder:A});case"delivery-notes-edit":return C?r.jsx(Pg,{note:C,onNavigateBack:U}):r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:"Bon de livraison introuvable"})});default:return r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsx("p",{className:"text-gray-500 text-lg",children:a==="Tableau de bord"||a==="Clients"||a==="Fournisseurs"||a==="Produits"||a==="Bon de commande"||a==="Chauffeurs"?`Loading ${a.toLowerCase()}...`:`Page ${a} en cours de développement`})})}};return t===null?r.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/ANTURGOOD.svg",alt:"ANTURGOOD Logo",className:"h-8 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})}):t?r.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[r.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("img",{src:"https://pub-237d2da54b564d23aaa1c3826e1d4e65.r2.dev/ANTURGOOD/ANTURGOOD.svg",alt:"ANTURGOOD Logo",className:"h-8"}),r.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors duration-200 text-sm font-medium",children:[r.jsx(Gf,{className:"w-4 h-4"}),"Se déconnecter"]})]})}),r.jsxs("div",{className:"flex flex-1",children:[r.jsx("aside",{className:"w-64 bg-white shadow-sm border-r border-gray-200",children:r.jsx("nav",{className:"mt-8",children:r.jsx("ul",{className:"space-y-1 px-4",children:I.map((te,G)=>{const H=te.icon,oe=te.submenu&&te.submenu.length>0,_=c===te.name,F=a===te.name;return r.jsx("li",{children:r.jsxs("div",{children:[r.jsxs("button",{onClick:()=>O(te.name),className:`w-full text-left flex items-center justify-between px-4 py-3 rounded-lg transition-colors duration-200 font-medium ${F&&!l?"bg-blue-50 text-blue-700 border-r-2 border-blue-700":"text-gray-700 hover:bg-gray-100"}`,children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(H,{className:"w-5 h-5 mr-3"}),te.name]}),oe&&r.jsx($t,{className:`w-4 h-4 transition-transform duration-200 ${_?"transform rotate-90":""}`})]}),oe&&_&&r.jsx("ul",{className:"mt-2 ml-8 space-y-1",children:te.submenu.map((X,le)=>r.jsx("li",{children:r.jsx("button",{onClick:()=>b(te.name,X.path,X.name),className:`w-full text-left px-4 py-2 text-sm rounded-lg transition-colors duration-200 ${F&&l===X.name?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:X.name})},le))})]})},G)})})})}),r.jsx("main",{className:"flex-1 bg-gray-50 p-8 overflow-auto",children:ce()})]})]}):r.jsx(ug,{onLogin:Y})}qm(document.getElementById("root")).render(r.jsx(N.StrictMode,{children:r.jsx(Mg,{})}));
